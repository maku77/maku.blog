---
title: "React フック: useState/useEffect/useCallback/useMemo について理解する"
url: "/p/g7n2fs6"
date: "2021-07-18"
tags: ["React"]
weight: 200
draft: true
---

{{% private %}}
- https://overreacted.io/ja/a-complete-guide-to-useeffect/
{{% /private %}}

React のフック関数
----

React のフック関数を利用すると、関数コンポーネントにステートを持たせたり、ライフサイクルに応じて再描画を行うことができます。
`react` モジュールは、例えば次のようなフックをインポートできます。

- __`useState`__ ... コンポーネントの状態を保持するための変数と、その値を変更するためのセッター関数を提供します。値を変更すると、コンポーネントの再描画が行われます。
- __`useEffect`__ ... 現在のレンダリングフェーズが終わった後に任意の処理を実行できます。第 2 引数の依存配列 (deps) を指定することにより、特定の `props` 値やステート値が変わった時のみ実行することができます。
- __`useCallback`__ ... コールバック関数（の変数）を保持します。コンポーネントの再描画時に同一のオブジェクトを返してくれるので、そのコールバック関数を渡した子コンポーネントの無駄な再描画処理を防ぐことができます。依存する変数を指定することができ、その変数の値が変わったときにコールバック関数を再生成することができます。
- __`useMemo`__ ... 関数呼び出しの結果を保持（メモ化）します。依存する変数の値が変化したときは、再度関数を実行して、新しい結果を保持します。


useState （ステートフック）
----

`useState` フックは、コンポーネントに状態を持たせるためのステート変数と、そのステート変数を変更するためのセッター関数を提供します。
ステート変数の初期値は、`useState` 関数の引数で指定します。

{{< code lang="ts" >}}
const [count, setCount] = useState(1)
{{< /code >}}

`useState` で作成したステート変数（上記の例では `name`）は不変 (immutable) であり、その値を変更するためには、戻り値の第 2 要素として返される関数オブジェクト（上記の例では `setName`）を使う必要があります。
ステート変数が不変であることによって、コンポーネントのレンダリング処理が、一貫した値で行われることが保証されます。

{{< code lang="ts" >}}
setCount(2)
{{< /code >}}

とすると、コンポーネントの再レンダリングが予約され、次のレンダリングフェーズにおいて `count` の値が 2 になります。

ステート変数の変更（セッター関数の呼び出し）は、通常、ユーザー入力時（ボタンクリック時など）や、`useEffect` によるコールバック呼び出し時に行います。


useEffect （副作用フック）
----

`useEffect` フックを使うと、コンポーネントに対して副作用を与えるエフェクト関数を設定することができます。
副作用というのは、その関数が呼び出された時点で、コンポーネントの出力内容が変化する（再描画が発生する）ということを意味します。

コンポーネントの出力内容は基本的に、与えられた `props` によって決まりますが、副作用フックを使うことで出力内容を段階的に変化させていくことができるようになります。
代表的なのが外部データのフェッチです。
Web API によるデータ取得前に Loading 表示をしておき、取得後にそのデータを表示する、といった感じです。

`useEffect` で指定したエフェクト関数は、レンダリング後（DOM ツリーに反映された後）に呼び出されると考えてください。
エフェクト関数の中でプリミティブな `props` 値やステート変数を参照すると、その値はそのレンダリングフェーズ時の値がキャプチャされます。

// タイマーの例



useMemo（メモ化）
----

関数型のコンポーネントは、レンダリングのたびにその関数全体が実行されるので、その中で時間のかかる計算処理などを行うと、全体のレンダリングが遅くなってしまいます。
`useMemo` フックは、ある関数呼び出しの結果をキャッシュ（メモ化）する機能を提供します。

> りあクトの例
>> ```
>> const primse = useMemo(
>>   () => getPrimes(limit),
>>   [limit]
>> )
>> ```

