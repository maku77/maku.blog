---
title: "LUIS と QnA Maker でキーの管理方法が異なるのはなぜか？"
url: "/p/8myms6s"
date: "2019-03-18"
tags: ["Azure", "Chatbot", "LUIS", "QnA Maker"]
description: "Microsoft の素敵なサービス、LUIS と QnA Maker で扱うキー情報に関するコラムです。"
weight: 1000
---

LUIS や QnA Maker サービスを利用するためのエンドポイントキーは、下記の 2 種類が提供されます。

* <b>実運用のためのキー</b>: チャットクライアントなどからの、一般的な問い合わせを処理するためのキー。
* <b>管理用のキー</b>: 各サービスの情報を取得したり、データを編集したりするためのキー。

LUIS も QnA Maker も便利なサービスなのですが、Azure リソースとの結びつけ方法や、キーの管理方法が異なっているため、最初はわけがわからなくなるかもしれません。
例えば、Azure ポータル上の <samp>RESOURCE MANAGEMENT / Keys</samp> のページで表示されるキー（サブスクリプションキー）が、**LUIS の場合は実運用のためのキー**であるのに対し、**QnA Maker の場合は管理用のキー** であったりします。

LUIS/QnA を使用する場合は、それぞれ、エンドポイントキーとしてどちらのキーを使用するかを間違えないようしなければいけません。

* <b>LUIS のサブスクリプションキー（実運用のためのキー）</b>: Azure ポータルの LUIS リソースの Keys で表示されるもの
* <b>LUIS のオーサリングキー（管理用のキー）</b>: LUIS ポータルの Authoring Key で表示されるもの
* <b>QnA Maker のエンドポイントキー（実運用のためのキー）</b>: QnA Maker ポータルのプロファイル設定で表示されるもの
* <b>QnA Maker のサブスクリプションキー（管理用のキー）</b>: Azure ポータルの QnA Maker リソースの Keys で表示されるもの

この時点で、キーの管理方法が QnA Maker と LUIS では完全に逆になっています。
Azure 上でのインタフェースは LUIS リソースと QnA Maker リソースで見た目が同じなので、混乱に拍車をかけています。

{{< image w="600" border="true" src="keys-between-luis-and-qna1.png" title="LUIS リソースの Keys 管理画面" >}}

{{< image w="600" border="true" src="keys-between-luis-and-qna2.png" title="QnA Maker リソースの Keys 管理画面" >}}

なぜこのようなことになっているのか、Microsoft のサポートの方に確認してみたところ、下記のような回答をいただきました。
簡単に言うと、**各サービスの生い立ちの違いによるもの**だそうです。
わかりにくいですが、この辺りはそういうものなのだと納得するしかないですね。

> <b>各サービスの違いについて</b>
>
> LUIS は 当初 Azure と紐づかないサービスとして提供されており、Azure のリソースがなくても新しい LUIS のアプリケーションを作成できるように作られたサービスになっておりました。
> そのため、アプリケーションの作成や編集を行うオーサリングキーは LUIS ポータルで作成されるものになっております。
>
> 後に LUIS が Azure の Cognitive Service として正式にリリースされた後、Azure のリソースとして関連付けるためにエンドポイントキーを Azure ポータルで取得する LUIS のリソースキーと紐づけております。
> それぞれの LUIS のアプリケーションそのものは Azure リソースに紐づいておらず、各ユーザーアカウント (メールアドレス) に紐づいており、エンドポイントへのアクセスキーのみが Azure のリソースとして存在しております。
>
> 対しまして QnA Maker は Azure のリソースと紐づくことを当初から想定してリリースされたサービスになっているため、アプリケーションの作成や編集を行うために Azure のサブスクリプションキーが必要になります。
>
> このように LUIS と QnA Maker ではリリースまでの経緯に違いがあることから、各種キーの扱いも異なっております。

