<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>.NET on まくろぐ</title><link>https://maku.blog/tags/.net/</link><description>Recent content in .NET on まくろぐ</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Mon, 18 Jun 2018 00:00:00 +0900</lastBuildDate><atom:link href="https://maku.blog/tags/.net/index.xml" rel="self" type="application/rss+xml"/><item><title>C# で Microsoft Outlook の情報を取得する</title><link>https://maku.blog/p/eb5nx4z/</link><pubDate>Mon, 18 Jun 2018 00:00:00 +0900</pubDate><guid>https://maku.blog/p/eb5nx4z/</guid><description>&lt;p>組織内で Outlook を使用している場合は、プログラムから Outlook の情報（Exchange サーバの情報）を取得してごにょごにょすると、日々の作業を効率化できるかもしれません。
ここでは、C# から Outlook の情報を取得する方法を紹介します。&lt;/p>
&lt;p>プログラミング言語に C# を使っていますが、もともとは VBA などのインタフェース (COM) として使われていたものなので、本格的にコーディングするときは、VBA のリファレンスが参考になります。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://msdn.microsoft.com/ja-jp/vba/vba-outlook">Outlook VBA リファレンス｜MSDN&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>以下のサンプルは、Visual Studio Community 2017 を使って確認しています。
Visual Studio で新規のプロジェクト（ここではシンプルにコンソールアプリを選択）を作成したら、まずは次のようにして Outlook のインタフェースの参照を追加してください。&lt;/p>
&lt;ol>
&lt;li>プロジェクト(P) → 参照の追加(R)&lt;/li>
&lt;li>COM → &lt;strong>Microsoft Outlook 14.0 Object Library&lt;/strong>&lt;/li>
&lt;/ol>
&lt;p>次のコードは、現在 Outlook を使用しているユーザの名前とメールアドレス、および上司の名前とメールアドレスを表示します。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-csharp" data-lang="csharp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">using&lt;/span> &lt;span class="nn">System&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">using&lt;/span> &lt;span class="nn">Outlook&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">Microsoft&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Office&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Interop&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Outlook&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">namespace&lt;/span> &lt;span class="nn">ConsoleApp1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">class&lt;/span> &lt;span class="nc">Program&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="n">Outlook&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Application&lt;/span> &lt;span class="n">outlookApp&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="n">Outlook&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Application&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Exchange ユーザの情報を表示する&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">ShowRecipientInfo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Outlook&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ExchangeUser&lt;/span> &lt;span class="n">user&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">WriteLine&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Name&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// 名前&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">WriteLine&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">PrimarySmtpAddress&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// メールアドレス&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">static&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">Main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">[]&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// カレントユーザーの情報を表示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Outlook&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Recipient&lt;/span> &lt;span class="n">rcp&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">outlookApp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Session&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">CurrentUser&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Outlook&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ExchangeUser&lt;/span> &lt;span class="n">currentUser&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">rcp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">AddressEntry&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">GetExchangeUser&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ShowRecipientInfo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">currentUser&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 上司の情報を表示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Outlook&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ExchangeUser&lt;/span> &lt;span class="n">manager&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">currentUser&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">GetExchangeUserManager&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">manager&lt;/span> &lt;span class="p">!=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ShowRecipientInfo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">Yamada Taro
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">yamada-taro@example.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tokoro George
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tokoro-george@example.com&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="参考">参考&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://msdn.microsoft.com/ja-jp/library/office/bb612741.aspx">Office - Dev Center - 操作方法 (Outlook リファレンス)&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>