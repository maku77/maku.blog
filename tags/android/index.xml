<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Android on まくろぐ</title><link>https://maku.blog/tags/android/</link><description>Recent content in Android on まくろぐ</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Tue, 08 Jun 2021 00:00:00 +0900</lastBuildDate><atom:link href="https://maku.blog/tags/android/index.xml" rel="self" type="application/rss+xml"/><item><title>Android Studio の IdeaVim プラグインで快適コーディング</title><link>https://maku.blog/p/f4ugxri/</link><pubDate>Tue, 08 Jun 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/f4ugxri/</guid><description>&lt;h2 id="ideavim-プラグインのインストール">IdeaVim プラグインのインストール&lt;/h2>
&lt;p>Android Studio (IntelliJ IDEA) に &lt;strong>IdeaVim&lt;/strong> プラグインを入れると、Vim 系のキーマッピングが有効になり、高速にコーディングできるようになります（もちろん Vim の操作に精通しておく必要がありますが）。
IdeaVim プラグインは Android Studio から下記のように辿って簡単にインストールできます。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="685" height="238" src="../../p/f4ugxri/img-001.png" alt="/p/f4ugxri/img-001.png" />
&lt;/figure>

&lt;ol>
&lt;li>&lt;code>File&lt;/code> → &lt;code>Settings&lt;/code> → &lt;code>Plugins&lt;/code>&lt;/li>
&lt;li>&lt;code>IdeaVim&lt;/code> で検索してインストール&lt;/li>
&lt;/ol>
&lt;h2 id="ideavim-の設定-ideavimrc">IdeaVim の設定 (.ideavimrc)&lt;/h2>
&lt;p>通常の Vim エディタの設定ファイルは &lt;code>~/.vimrm&lt;/code> ですが、IdeaVim の設定ファイルは &lt;strong>&lt;code>~/.ideavimrc&lt;/code>&lt;/strong> です。
Windows の場合は、&lt;code>%USERPROFILE%\.ideavimrc&lt;/code> です（or &lt;code>_ideavimrc&lt;/code>）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">~/.ideavimrc&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">set clipboard=unnamed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nnoremap gd :action GotoDeclaration&amp;lt;CR&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nnoremap gi :action GotoImplementation&amp;lt;CR&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nnoremap gs :action GotoSuperMethod&amp;lt;CR&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nnoremap gb :action Back&amp;lt;CR&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nnoremap gf :action Forward&amp;lt;CR&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nnoremap &amp;lt;C-Left&amp;gt; :action Back&amp;lt;CR&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nnoremap &amp;lt;C-Right&amp;gt; :action Forward&amp;lt;CR&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>.ideavimrc&lt;/code> ファイルを変更したときは、次のようにして反映できます。&lt;/p></description></item><item><title>Android アプリのテンプレートコード（空っぽのフラグメント）</title><link>https://maku.blog/p/vdnv5dm/</link><pubDate>Thu, 25 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/vdnv5dm/</guid><description>&lt;p>Android のアプリを作るときは、大体まっさらな Activity + Fragment の組み合わせで作り始めるんですが、そのようなクリーンなテンプレートコード（土台）を作るのが意外と大変だったりするので、ここにメモしておきます。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="500" height="281" src="../../p/vdnv5dm/img-001_hu17692582442934172820.png" alt="/p/vdnv5dm/img-001.png" />
 &lt;figcaption>図: 空っぽの Android アプリ&lt;/figcaption>
&lt;/figure>

&lt;p>下記は、Android TV アプリ用のテンプレートです。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/maku77/Template-AndroidTv">maku77/Template-AndroidTv: Template of Android TV App&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>主なコードを抜粋。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">app/src/main/java/com/example/myapp/MainActivity.kt&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">package&lt;/span> &lt;span class="nn">com.example.myapp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">android.os.Bundle&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">androidx.appcompat.app.AppCompatActivity&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">androidx.fragment.app.commit&lt;/span> &lt;span class="c1">// androidx.fragment:fragment-ktx
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">MainActivity&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">AppCompatActivity&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">override&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">onCreate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">savedInstanceState&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Bundle&lt;/span>&lt;span class="p">?)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">super&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">onCreate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">savedInstanceState&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setContentView&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">R&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">layout&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">activity_main&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">showMainFragment&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">showMainFragment&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">supportFragmentManager&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">commit&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">R&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">fragment_container&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nc">MainFragment&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">newInstance&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//addToBackStack(null) // 戻るキー用にスタック
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">app/src/main/java/com/example/myapp/MainFragment.kt&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">package&lt;/span> &lt;span class="nn">com.example.myapp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">androidx.fragment.app.Fragment&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">MainFragment&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">Fragment&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">R&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">layout&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">fragment_main&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">companion&lt;/span> &lt;span class="k">object&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fun&lt;/span> &lt;span class="nf">newInstance&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">MainFragment&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">app/src/main/AndroidManifest.xml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;utf-8&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;manifest&lt;/span> &lt;span class="na">xmlns:android=&lt;/span>&lt;span class="s">&amp;#34;http://schemas.android.com/apk/res/android&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">package=&lt;/span>&lt;span class="s">&amp;#34;com.example.myapp&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;uses-permission&lt;/span> &lt;span class="na">android:name=&lt;/span>&lt;span class="s">&amp;#34;android.permission.INTERNET&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;uses-feature&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:name=&lt;/span>&lt;span class="s">&amp;#34;android.hardware.touchscreen&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:required=&lt;/span>&lt;span class="s">&amp;#34;false&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;uses-feature&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:name=&lt;/span>&lt;span class="s">&amp;#34;android.software.leanback&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:required=&lt;/span>&lt;span class="s">&amp;#34;true&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;application&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:allowBackup=&lt;/span>&lt;span class="s">&amp;#34;true&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:icon=&lt;/span>&lt;span class="s">&amp;#34;@mipmap/ic_launcher&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:label=&lt;/span>&lt;span class="s">&amp;#34;@string/app_name&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:supportsRtl=&lt;/span>&lt;span class="s">&amp;#34;true&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:theme=&lt;/span>&lt;span class="s">&amp;#34;@style/Theme.AppCompat&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;activity&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:name=&lt;/span>&lt;span class="s">&amp;#34;.MainActivity&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:banner=&lt;/span>&lt;span class="s">&amp;#34;@drawable/app_icon&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:icon=&lt;/span>&lt;span class="s">&amp;#34;@drawable/app_icon&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:label=&lt;/span>&lt;span class="s">&amp;#34;@string/app_name&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:logo=&lt;/span>&lt;span class="s">&amp;#34;@drawable/app_icon&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:screenOrientation=&lt;/span>&lt;span class="s">&amp;#34;landscape&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;intent-filter&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;action&lt;/span> &lt;span class="na">android:name=&lt;/span>&lt;span class="s">&amp;#34;android.intent.action.MAIN&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;category&lt;/span> &lt;span class="na">android:name=&lt;/span>&lt;span class="s">&amp;#34;android.intent.category.LEANBACK_LAUNCHER&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/intent-filter&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/activity&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/application&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/manifest&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">app/src/main/res/layout/activity_main.xml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;utf-8&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;FrameLayout&lt;/span> &lt;span class="na">xmlns:android=&lt;/span>&lt;span class="s">&amp;#34;http://schemas.android.com/apk/res/android&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:id=&lt;/span>&lt;span class="s">&amp;#34;@+id/fragment_container&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:layout_width=&lt;/span>&lt;span class="s">&amp;#34;match_parent&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:layout_height=&lt;/span>&lt;span class="s">&amp;#34;match_parent&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/FrameLayout&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">app/src/main/res/layout/fragment_main.xml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;utf-8&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;LinearLayout&lt;/span> &lt;span class="na">xmlns:android=&lt;/span>&lt;span class="s">&amp;#34;http://schemas.android.com/apk/res/android&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:orientation=&lt;/span>&lt;span class="s">&amp;#34;vertical&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:layout_width=&lt;/span>&lt;span class="s">&amp;#34;match_parent&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:layout_height=&lt;/span>&lt;span class="s">&amp;#34;match_parent&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/LinearLayout&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Android開発: ContraintLayout で配置されたビューの実際のサイズを取得する</title><link>https://maku.blog/p/khqpnjf/</link><pubDate>Mon, 27 Jul 2020 00:00:00 +0900</pubDate><guid>https://maku.blog/p/khqpnjf/</guid><description>&lt;p>ConstraintLayout で配置したビューは、周囲のビューとの位置関係で位置やサイズなどが決まるため、実際に内部的なレイアウトが終了するまでは、ビューのサイズ情報などが取得できなかったりします（0 になります）。&lt;/p>
&lt;p>&lt;strong>&lt;code>View.doOnLayout()&lt;/code>&lt;/strong> などで、レイアウト完了するのを待ってからサイズを取得すればうまくいきます。
これは、&lt;code>TransitionManager&lt;/code> などでレイアウトを切り替えた直後なども同様です。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// レイアウト変更＆アニメーション開始
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nc">TransitionManager&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">beginDelayedTransition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">constraintLayout&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">constraintSet&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">applyTo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">constraintLayout&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// この直後にレイアウト情報取得してもうまく取得できない
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">val&lt;/span> &lt;span class="py">w&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">myView&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">width&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">val&lt;/span> &lt;span class="py">h&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">myView&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">height&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">myView&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">doOnLayout&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// このタイミングであればうまく取得できる
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">w&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">it&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">width&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">h&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">it&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">height&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Android開発: ダイアログ表示時の背景の暗転（ディミング）を防ぐ</title><link>https://maku.blog/p/voanw2h/</link><pubDate>Fri, 06 Mar 2020 00:00:00 +0900</pubDate><guid>https://maku.blog/p/voanw2h/</guid><description>&lt;p>Android でダイアログを表示するときに &lt;code>DialogFragment&lt;/code> クラスなどを使用すると、デフォルトではダイアログの後ろは暗くなって、下の UI がうっすらと見える状態になります。
このような効果を抑制して、背景が明るいままにするには、ウィンドウから &lt;strong>&lt;code>FLAG_DIM_BEHIND&lt;/code>&lt;/strong> フラグをクリアします。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">MyDialogFragment&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">DialogFragment&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">override&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">onCreateView&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">inflater&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">LayoutInflater&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">container&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ViewGroup&lt;/span>&lt;span class="p">?,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">savedInstanceState&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Bundle&lt;/span>&lt;span class="p">?&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">):&lt;/span> &lt;span class="n">View&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ダイアログの中身を独自レイアウトにする
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">inflater&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">inflate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">R&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">layout&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">my_dialog&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">container&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">false&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">override&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">onViewCreated&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">View&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">savedInstanceState&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Bundle&lt;/span>&lt;span class="p">?)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">super&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">onViewCreated&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">savedInstanceState&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">disableBackgroundDimming&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/** ダイアログの背景が暗くなるのを防ぐ */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">disableBackgroundDimming&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dialog&lt;/span>&lt;span class="o">?.&lt;/span>&lt;span class="n">window&lt;/span>&lt;span class="o">?.&lt;/span>&lt;span class="n">clearFlags&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">WindowManager&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nc">LayoutParams&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">FLAG_DIM_BEHIND&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Androidメモ: RecyclerView にアニメーションを追加する方法</title><link>https://maku.blog/p/8avcr5h/</link><pubDate>Tue, 21 Jan 2020 00:00:00 +0900</pubDate><guid>https://maku.blog/p/8avcr5h/</guid><description>&lt;p>Android の RecyclerView にリスト表示する各要素を、左や右からスライドインさせながら表示する方法を説明します。&lt;/p>
&lt;h2 id="recyclerview-へのアニメーション追加方法">RecyclerView へのアニメーション追加方法&lt;/h2>
&lt;p>RecyclerView の各要素をアニメーションさせるには、下記のような方法があります。&lt;/p>
&lt;ol>
&lt;li>カスタム ItemAnimator を作成してセットする方法&lt;/li>
&lt;li>LayoutAnimation をセットする方法（RecyclerView だけでなく、すべての ViewGroup に適用できます）&lt;/li>
&lt;/ol>
&lt;p>1 の方法を使うと、アイテムの追加・削除に応じたアニメ―ションを定義できるので、柔軟なカスタマイズが可能になりますが、2 の方法であれば、アニメーションの定義だけを行えばよいので簡単です。
ここでは、シンプルな 2 の方法を説明します。&lt;/p>
&lt;p>アニメーションの定義は、XML 形式のリソースファイルで行います。
ディレクトリ名やファイル名は任意ですが、通常は &lt;code>res/anim/xxx.xml&lt;/code> のような名前にし、コードの中から &lt;code>R.anim.xxx&lt;/code> と参照できるようにします。&lt;/p>
&lt;h2 id="要素を左からスライドインさせる">要素を左からスライドインさせる&lt;/h2>
&lt;p>下記の &lt;code>res/anim/slide_from_left.xml&lt;/code> リソースでは、画面内の要素をどのように表示するかを定義しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">res/anim/slide_from_left.xml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;utf-8&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;layoutAnimation&lt;/span> &lt;span class="na">xmlns:android=&lt;/span>&lt;span class="s">&amp;#34;http://schemas.android.com/apk/res/android&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:animation=&lt;/span>&lt;span class="s">&amp;#34;@android:anim/slide_in_left&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:delay=&lt;/span>&lt;span class="s">&amp;#34;10%&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:animationOrder=&lt;/span>&lt;span class="s">&amp;#34;normal&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">/&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>各属性の説明です。&lt;/p>
&lt;ul>
&lt;li>&lt;code>android:animation=&amp;quot;@android:anim/slide_in_left&amp;quot;&lt;/code>
&lt;ul>
&lt;li>個々の要素がどのようにアニメーションするかを指定します。ここでは、Android にあらかじめ定義されている &lt;code>slide_in_left&lt;/code> を指定しています。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>android:delay=&amp;quot;10%&amp;quot;&lt;/code>
&lt;ul>
&lt;li>1 つ前の要素のアニメーションが何％まで完了してから、次の要素のアニメーションを開始するかを指定します。&lt;code>100%&lt;/code> と指定すると、各要素のアニメーションが完全に終了してから次の要素のアニメーションが開始されるため、すべての要素が表示されるまでに非常に時間がかかります。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>android:animationOrder=&amp;quot;normal&amp;quot;&lt;/code>
&lt;ul>
&lt;li>要素がどのような順番で表示されていくかを指定します。&lt;code>normal&lt;/code>、&lt;code>reverse&lt;/code>、&lt;code>random&lt;/code> などを指定できます。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>ここでは、個々の要素のアニメーション方法として、Android 付属の &lt;code>@android:anim/slide_in_left&lt;/code> を使っていますが、これは次のように定義されています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">@android/anim/slide_in_left（抜粋）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;utf-8&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;set&lt;/span> &lt;span class="na">xmlns:android=&lt;/span>&lt;span class="s">&amp;#34;http://schemas.android.com/apk/res/android&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;translate&lt;/span> &lt;span class="na">android:fromXDelta=&lt;/span>&lt;span class="s">&amp;#34;-50%p&amp;#34;&lt;/span> &lt;span class="na">android:toXDelta=&lt;/span>&lt;span class="s">&amp;#34;0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:duration=&lt;/span>&lt;span class="s">&amp;#34;@android:integer/config_mediumAnimTime&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;alpha&lt;/span> &lt;span class="na">android:fromAlpha=&lt;/span>&lt;span class="s">&amp;#34;0.0&amp;#34;&lt;/span> &lt;span class="na">android:toAlpha=&lt;/span>&lt;span class="s">&amp;#34;1.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">android:duration=&lt;/span>&lt;span class="s">&amp;#34;@android:integer/config_mediumAnimTime&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/set&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>アニメーションの開始位置、終了位置、透過度の変化などを定義しています。&lt;/p>
&lt;p>RecyclerView に LayoutAnimation を適用するには、レイアウトファイルの中の &lt;code>layoutAnimation&lt;/code> 属性を使用します。&lt;/p></description></item><item><title>Android開発: ShapeDrawable で基本図形を描く</title><link>https://maku.blog/p/qj8p3eq/</link><pubDate>Sun, 03 Aug 2014 00:00:00 +0900</pubDate><guid>https://maku.blog/p/qj8p3eq/</guid><description>&lt;h2 id="矩形の描画">矩形の描画&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ShapeDrawable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mDrawable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ShapeDrawable&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">draw&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Canvas&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">mDrawable&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setBounds&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">100&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">100&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">200&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">200&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">mDrawable&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getPaint&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">setColor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Color&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">YELLOW&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">mDrawable&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">draw&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="円楕円の描画">円、楕円の描画&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ShapeDrawable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mDrawable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ShapeDrawable&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">OvalShape&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">draw&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Canvas&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">mDrawable&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setBounds&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">100&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">100&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">200&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">200&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">mDrawable&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getPaint&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">setColor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Color&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">YELLOW&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">mDrawable&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">draw&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">canvas&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Android開発: TextureView に関するメモ</title><link>https://maku.blog/p/2udtaq5/</link><pubDate>Thu, 24 Jul 2014 00:00:00 +0900</pubDate><guid>https://maku.blog/p/2udtaq5/</guid><description>&lt;ul>
&lt;li>少ない数の &lt;code>Canvas#drawRect()&lt;/code> や &lt;code>Canvas#drawText()&lt;/code> をするなら、&lt;code>SurfaceView&lt;/code> よりも描画が速い。ある程度たくさん描画すると、&lt;code>SurfaceView&lt;/code> に負ける。さらにたくさん描画すると同じくらいになる。&lt;/li>
&lt;li>ベンチマークを Xperia Tablet Z で取ると次のような感じ。
&lt;ul>
&lt;li>Rect(x100),Text(x100): SurfaceView 60fps, TextureView 80fps&lt;/li>
&lt;li>Rect(x500),Text(x500): SurfaceView 32fps, TextureView 27fps&lt;/li>
&lt;li>Rect(x1000),Text(x1000); SurfaceView 15fps, TextureView 15fps&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>lockCanvas()&lt;/code> ～ &lt;code>unlockCanvasAndPost()&lt;/code> の中では毎回全体を描き直す必要がある。前回の描画情報が保持されることが保証されないため（&lt;code>TextureView#lockCanvas()&lt;/code> の Javadoc を参照）。&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>&lt;code>SurfaceTextureListener#onSurfaceTextureDestroyed()&lt;/code> は通常 &lt;code>return true&lt;/code> するように実装する。&lt;/li>
&lt;li>画面回転すると強制終了したりする（&lt;code>SurfaceView&lt;/code> のときは大丈夫だった）。&lt;/li>
&lt;/ul></description></item><item><title>Android開発: Handler.post した Runnable タスクがメインスレッドで実行される仕組み</title><link>https://maku.blog/p/9ne93oc/</link><pubDate>Mon, 08 Aug 2011 00:00:00 +0900</pubDate><guid>https://maku.blog/p/9ne93oc/</guid><description>&lt;p>Android プログラムで UI 操作を行う場合は、その処理はアプリのメインスレッドから行わなければいけません（Android に限らずほとんどの OS で同じような感じです）。
&lt;code>Activity&lt;/code> の &lt;code>onCreate&lt;/code> メソッドなどを呼び出しているのがそのアプリのメインスレッドであり、Android ではイコール UI スレッドです。
タイマー処理などで、UI を更新する場合はこのメインスレッドから行う必要があり、新しく立ち上げた別のスレッドから UI を更新することはできません。&lt;/p>
&lt;p>このようなケースで利用できるのが &lt;strong>&lt;code>android.os.Handler&lt;/code>&lt;/strong> クラスです。
&lt;code>Handler#post&lt;/code> メソッドに &lt;code>Runnable&lt;/code> オブジェクトを渡すと、最終的にその &lt;code>Handler&lt;/code> オブジェクトを生成したスレッドで &lt;code>Runnable&lt;/code> オブジェクトの &lt;code>run&lt;/code> メソッドが実行されるようになっています。
つまり、&lt;code>Handler&lt;/code> オブジェクトを &lt;code>Application&lt;/code> のメインスレッドから（例えば &lt;code>Activity&lt;/code> のフィールドとして）生成しておけば、そこに &lt;code>post&lt;/code> した &lt;code>Runnable&lt;/code> タスクは、メインスレッドで実行されることが保証されます。&lt;/p>
&lt;p>&lt;code>Handler#post&lt;/code> メソッドは、内部的にはスレッドローカルな &lt;code>Looper&lt;/code> に結び付けられた &lt;code>MessageQueue&lt;/code> オブジェクトに処理をキューイングしています。
&lt;code>Handler&lt;/code> オブジェクトをメインスレッドから生成すれば、メインスレッド上の &lt;code>MessageQueue&lt;/code> と結び付けられ、その &lt;code>MessageQueue&lt;/code> が &lt;code>Looper&lt;/code> によってメインスレッド上で処理されるという流れになっています。&lt;/p>
&lt;p>別の言い方をすれば、メインスレッドの &lt;code>MessageQueue&lt;/code> に対して、&lt;code>Runnable&lt;/code> タスクを投入するためのインタフェースとなるのが &lt;code>Handler&lt;/code> オブジェクトというわけです。&lt;/p></description></item><item><title>Android開発: LowMemoryKiller の動きのメモ</title><link>https://maku.blog/p/7s4vnax/</link><pubDate>Wed, 11 May 2011 00:00:00 +0900</pubDate><guid>https://maku.blog/p/7s4vnax/</guid><description>&lt;p>Android の lowmemorykiller では、最もメモリを使っていて、&lt;strong>oom_adj&lt;/strong> の値が大きいものが殺されます。&lt;/p>
&lt;p>oom_adj の値は、&lt;code>/proc/&amp;lt;Process ID&amp;gt;/oom_adj&lt;/code> に書かれた値です。
本来は Linux の oom (Out of memory) killer が使うファイルですが、Android の lowmemorykiller もこのファイルを使っています。&lt;/p>
&lt;p>oom_adj の値は -16～15 をとり、小さいほど殺されにくくなります。デフォルトは 0 です。
ただし、oom_adj に &lt;code>OOM_DISABLE (-17)&lt;/code> を設定すると、lowmemorykiller の対象外になるようです。&lt;/p>
&lt;p>oom_adj の値を確認したり、強引に変更したい場合はこんな感じ。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl"># cat /proc/1234/oom_adj
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># echo -16 &amp;gt; /proc/1234/oom_adj&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Android開発: レイアウトの種類まとめ</title><link>https://maku.blog/p/64zojt6/</link><pubDate>Mon, 10 Jan 2011 00:00:00 +0900</pubDate><guid>https://maku.blog/p/64zojt6/</guid><description>&lt;ul>
&lt;li>FrameLayout
&lt;ul>
&lt;li>ウィジェットを左上に１つだけ配置する。&lt;/li>
&lt;li>FrameLayout の中で複数の View を配置した場合は、最後に表示したものが上に重ねて表示される。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>LinearLayout
&lt;ul>
&lt;li>水平か、垂直に一直線にウィジェットを並べる。&lt;/li>
&lt;li>水平: &lt;code>android:orientation=&amp;quot;horizontal&amp;quot;&lt;/code>&lt;/li>
&lt;li>垂直: &lt;code>android:orientation=&amp;quot;vertical&amp;quot;&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://developer.android.com/training/constraint-layout?hl=ja">ConstraintLayout&lt;/a>
&lt;ul>
&lt;li>フラットなビュー階層を持つ大きくて複雑なレイアウトを作成する。&lt;/li>
&lt;li>RelativeLayout より柔軟。&lt;/li>
&lt;li>LinearLayout を組み合わせてレイアウトを入れ子構造にするとパフォーマンスが悪くなるが、ConstraintLayout ひとつでフラットにビューを配置すると効率的な描画が可能。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>TableLayout
&lt;ul>
&lt;li>HTML の TABLE 要素のようにウィジェットを並べる。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>RelativeLayout
&lt;ul>
&lt;li>他のウィジェットとの相対的な位置関係で配置する。&lt;/li>
&lt;li>参照されるウィジェットは、参照するウィジェットよりも先に定義されていなければならない。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>AbsoluteLayout（非推奨）
&lt;ul>
&lt;li>絶対座標でウィジェットを配置する。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>それぞれの Layout を入れ子にして、その中にウィジェットを配置していくことで複雑なレイアウトを作成することができます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;LinearLayout&lt;/span> &lt;span class="err">...&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;LinearLayout&lt;/span> &lt;span class="err">...&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/LinearLayout&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;LinearLayout&lt;/span> &lt;span class="err">...&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/LinearLayout&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/LinearLayout&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Android開発: 3種類のタイムスタンプの使い分け</title><link>https://maku.blog/p/sfvqxtr/</link><pubDate>Tue, 09 Nov 2010 00:00:00 +0900</pubDate><guid>https://maku.blog/p/sfvqxtr/</guid><description>&lt;p>Android において long 型のタイムスタンプを取得する方法には、以下の 3 種類があり、それぞれ意味が異なるため、用途に応じて使い分ける必要があります。&lt;/p>
&lt;ul>
&lt;li>System. &lt;strong>currentTimeMillis()&lt;/strong>
&lt;ul>
&lt;li>Epoch (1970-01-01) を基準にしたシステムタイムまでの経過ミリ秒。&lt;/li>
&lt;li>ユーザがシステムの現在時刻を変更すると、過去にジャンプしたりするので、タイムスタンプベースのタイマーなどに使用するべきではない。時計の UI を表示するときに使用する。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>android.os.SystemClock. &lt;strong>elapsedRealtime()&lt;/strong>
&lt;ul>
&lt;li>Android 端末をブートしてからの経過ミリ秒。&lt;code>uptimeMillis()&lt;/code> とは異なり、スリープ中にもカウントされる。&lt;/li>
&lt;li>AlarmManager はスリープ中の時間もカウントして発火するので、内部で &lt;code>elapsedRealtime()&lt;/code> ベースのタイマを使用する。これは、AlarmManager のタイプで &lt;code>ELAPSED_REALTIME (ELAPSED_REALTIME_WAKEUP)&lt;/code> を指定した場合の振る舞いで、&lt;code>RTC (RTC_WAKEUP)&lt;/code> を指定すれば、&lt;code>System.currentTimeMillis()&lt;/code> ベースのタイマで発火するように指定することもできる。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>android.os.SystemClock. &lt;strong>uptimeMillis()&lt;/strong>
&lt;ul>
&lt;li>Android 端末をブートしてからの経過ミリ秒。スリープ中にはカウントされない。&lt;/li>
&lt;li>タイムスタンプベースのタイマーに使用できる。例えば &lt;code>Handler&lt;/code> クラスは、&lt;code>uptimeMillis()&lt;/code> ベースのタイマを使用して非同期コールバックを発火している。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>&lt;/th>
 &lt;th style="text-align: center">AlarmManager&lt;/th>
 &lt;th style="text-align: center">Handler.&lt;br>postAtTime&lt;/th>
 &lt;th style="text-align: center">Handler.&lt;br>sendMessageAtTime&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>&lt;b>System.&lt;wbr>currentTimeMillis&lt;/b>&lt;br>&lt;br>UTC&lt;wbr>（システム時刻設定で変化）&lt;/td>
 &lt;td style="text-align: center">○&lt;br>RTC&lt;wbr>(_WAKEUP)&lt;/td>
 &lt;td style="text-align: center">×&lt;/td>
 &lt;td style="text-align: center">×&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;b>SystemClock.&lt;wbr>elapsedRealtime&lt;/b>&lt;br>&lt;br>ブートからの経過時間&lt;wbr>（スリープ時間含む）&lt;/td>
 &lt;td style="text-align: center">○&lt;br>ELAPSED_REALTIME&lt;wbr>(_WAKEUP)&lt;/td>
 &lt;td style="text-align: center">×&lt;/td>
 &lt;td style="text-align: center">×&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;b>SystemClock.&lt;wbr>uptimeMillis&lt;/b>&lt;br>&lt;br>ブートからの経過時間&lt;wbr>（スリープ時間含まず）&lt;/td>
 &lt;td style="text-align: center">×&lt;br>（スリープ時カウントできないため）&lt;/td>
 &lt;td style="text-align: center">○&lt;/td>
 &lt;td style="text-align: center">○&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table></description></item></channel></rss>