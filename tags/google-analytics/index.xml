<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Google Analytics on まくろぐ</title><link>https://maku.blog/tags/google-analytics/</link><description>Recent content in Google Analytics on まくろぐ</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Tue, 21 Mar 2023 00:00:00 +0900</lastBuildDate><atom:link href="https://maku.blog/tags/google-analytics/index.xml" rel="self" type="application/rss+xml"/><item><title>Next.js アプリに Google Analytics を設定する (next/script)</title><link>https://maku.blog/p/zycmw6f/</link><pubDate>Tue, 21 Mar 2023 00:00:00 +0900</pubDate><guid>https://maku.blog/p/zycmw6f/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>Google Analytics で Web サイトのアクセス解析を行うには、次のような感じのコードを各ページに埋め込む必要があります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Google Analytics 用の埋め込みコード&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="c">&amp;lt;!-- Google tag (gtag.js) --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">async&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://www.googletagmanager.com/gtag/js?id=G-ABCDE12345&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dataLayer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dataLayer&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="p">[];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">function&lt;/span> &lt;span class="nx">gtag&lt;/span>&lt;span class="p">(){&lt;/span>&lt;span class="nx">dataLayer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">arguments&lt;/span>&lt;span class="p">);}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">gtag&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;js&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">gtag&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;config&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;G-ABCDE12345&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ここでは、Next.js が提供する &lt;strong>&lt;code>Script&lt;/code>&lt;/strong> コンポーネント (&lt;strong>&lt;code>next/script&lt;/code>&lt;/strong>) を使用して、Next.js アプリに同等のコードを埋め込む方法を説明します。
HTML 標準の &lt;code>script&lt;/code> ではなく、Next.js の &lt;code>Script&lt;/code> コンポーネントを使用することで、Next.js アプリのレンダリング処理に合わせて実行タイミングを最適化できます。&lt;/p>
&lt;h2 id="事前準備google-analitics-でプロパティとデータストリームを追加する">事前準備（Google Analitics でプロパティとデータストリームを追加する）&lt;/h2>
&lt;p>事前準備として、&lt;a href="https://analytics.google.com/">Google Analytics&lt;/a> のサイトで、サイドバーの &lt;strong>管理&lt;/strong> メニューから対象アプリ用に &lt;strong>プロパティ&lt;/strong> を追加しておいてください。
さらに、そのプロパティに対して &lt;strong>データストリーム&lt;/strong> を追加すると、Web サイトや Android アプリの利用状況を監視できるようになります。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="1830" height="718" src="../../p/zycmw6f/img-001.png" alt="/p/zycmw6f/img-001.png" />
 &lt;figcaption>図: プロパティにデータストリームを追加する&lt;/figcaption>
&lt;/figure>

&lt;p>データストリームを追加すると、次のように &lt;strong>測定 ID&lt;/strong> が発行されます。
これが、前述の JavaScript コードで指定する ID になります。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="1952" height="634" src="../../p/zycmw6f/img-002.png" alt="/p/zycmw6f/img-002.png" />
 &lt;figcaption>図: 測定 ID が発行された&lt;/figcaption>
&lt;/figure>

&lt;h2 id="nextjs-用の-analytics-コンポーネントを作成する">Next.js 用の Analytics コンポーネントを作成する&lt;/h2>
&lt;p>下記の &lt;code>Analytics.tsx&lt;/code> は、Google Analytics 用のコードを埋め込むためのコンポーネントの実装例です。
Google Analytics の測定 ID は、ホスティングサーバー（例えば Vercel）の環境変数 &lt;strong>&lt;code>NEXT_PUBLIC_ANALYTICS_ID&lt;/code>&lt;/strong> で設定することを想定しています（自サイト専用のコンポーネントにするなら、ハードコーディングしちゃっても大丈夫です）。&lt;/p></description></item></channel></rss>