<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>GitHub Pages on まくろぐ</title><link>https://maku.blog/tags/github-pages/</link><description>Recent content in GitHub Pages on まくろぐ</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Wed, 17 Aug 2022 00:00:00 +0900</lastBuildDate><atom:link href="https://maku.blog/tags/github-pages/index.xml" rel="self" type="application/rss+xml"/><item><title>Jekyll と Hugo を共存させて GitHub Actions でビルドする</title><link>https://maku.blog/p/qbmv6fp/</link><pubDate>Wed, 17 Aug 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/qbmv6fp/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>こことは違う Web サイト (GitHub Pages) の話ですが、いい加減 &lt;a href="../../p/xwfwdy6/">Jekyll での Web サイト管理は限界&lt;/a> になってきたので、重い腰を上げて全面的に Hugo に乗り換えようと思います。
待っていれば Jekyll も高速化されるかなという淡い期待を抱いて 3 年が経ちましたが、一向にその気配はないので、残念ですがここで Jekyll は見限ります（決して Ruby と Golang の速度の差だけだとは思いませんが、やはり Golang 製のツールの方が高速な傾向はあるのかも）。&lt;/p>
&lt;p>とはいえ、現状 Jekyll で管理している Web ページは何千ページにも膨れ上がっており、一気に乗り換えるのは困難です。
そこで、Jekyll 運用されている Web サイトに、少しずつ Hugo 管理のページを加えていく、という作戦を取りたいと思います。
ドメイン名はそのまま &lt;code>xxx.github.io&lt;/code> を使いたいので、ホスティングはこれまで通り GitHub Pages で行い、ビルドやデプロイには GitHub Actions を使うことにします。&lt;/p>
&lt;h2 id="基本方針">基本方針&lt;/h2>
&lt;p>GitHub Pages のデフォルトの仕組みとして、Markdown ファイルをソース用リポジトリに置いておくだけで、Jekyll で HTML に変換して公開してくれるというのがあるのですが、今回はこの仕組みは使えません。
なぜなら、Jekyll によるビルド結果と、Hugo によるビルド結果をマージしたものをデプロイしなければいけないからです。
イメージとしては、GitHub リポジトリに push したときに、GitHub Actions で次のような処理を実行できればうまくいくはずです。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="" height="auto" src="../../p/qbmv6fp/img-001.drawio.svg" alt="/p/qbmv6fp/img-001.drawio.svg" />
 &lt;figcaption>図: GitHub Actions でやること&lt;/figcaption>
&lt;/figure>

&lt;ol>
&lt;li>Jekyll プロジェクトの Markdown ファイルをビルドする
&lt;ul>
&lt;li>Jekyll のビルド対象から Hugo のディレクトリを除外しておきます&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Hugo プロジェクトの Markdown ファイルをビルドする&lt;/li>
&lt;li>Hugo プロジェクトのビルド結果を Jekyll プロジェクトのビルド結果にマージする
&lt;ul>
&lt;li>同名のファイルは上書きしないことにします（先輩である Jekyll の出力を優先）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>GitHub Pages のホスティング先にデプロイ
&lt;ul>
&lt;li>ここでは &lt;code>gh-pages&lt;/code> ブランチを公開ブランチとして使います&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>Hugo のプロジェクトをフラットに配置してしまうと、&lt;code>content&lt;/code> ディレクトリや &lt;code>layouts&lt;/code> ディレクトリが混在してわかりにくくなるので、Hugo 側のファイル群は、&lt;code>hugo-files&lt;/code> ディレクトリを作ってそこに配置することにします。
最終的に、Jekyll から Hugo への以降がすべて完了したら、この中のファイル群をルートに移動させる想定です。&lt;/p></description></item><item><title>GitHub Pages で React Router を使った SPA サイトを動かす方法</title><link>https://maku.blog/p/9u8it5f/</link><pubDate>Mon, 07 Sep 2020 00:00:00 +0900</pubDate><guid>https://maku.blog/p/9u8it5f/</guid><description>&lt;p>React Router などを使った SPA (Single Page Application) な Web サイトは、GitHub Pages でそのまま動作させようとしてもうまく動きません。
ここでは、その理由と、対応方法について説明します。&lt;/p>
&lt;h2 id="github-pages-で-spa-サイトが動作しない理由">GitHub Pages で SPA サイトが動作しない理由&lt;/h2>
&lt;p>たとえば、React Router を使った Web サイトは、次のような URL を使って目的のコンテンツ (&lt;code>/book/123&lt;/code>) を表示するようルーティングします。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">https://yourname.github.io/repo-name/book/123&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>React Router を使ったアプリで、この URL を実際に処理するファイルは、&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">https://yourname.github.io/repo-name/index.html&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>であり、そこに記述された JavaScript ファイル内で、URL の末尾の &lt;code>/book/123&lt;/code> という部分をルーティング用のパス文字列として処理します。
つまり、前述の URL の &lt;code>/book/123&lt;/code> という部分は、単なるアプリ用のデータであり、実際に存在するファイルを示しているわけではありません。&lt;/p>
&lt;p>一方、GitHub Pages はそのような事情を知らないので、&lt;strong>&lt;code>/book/123&lt;/code> という URL でアクセスしようとすると、&lt;code>/book/123/index.html&lt;/code> というファイルを見つけようとして 404 エラー&lt;/strong> になってしまいます。&lt;/p>
&lt;p>先頭ページ (&lt;code>/index.html&lt;/code>) を開いた後で、JavaScript でルーティング（React の &lt;code>Link&lt;/code> コンポーネントによる遷移）を行っている間はうまく動作するのですが、ページをリロードしたり、Web ブラウザのアドレスバーに URL を直接入力したりすると、やはり 404 エラーになってしまいます。
OAuth 認証を使用した Web サイトの場合は、リダイレクトによって指定された URL へのアクセスが必要になるため、これは大きな制約になります。&lt;/p></description></item><item><title>GitHub Pages で Jekyll による自動変換を無効化する (.nojekyll)</title><link>https://maku.blog/p/my8fmsy/</link><pubDate>Thu, 03 Sep 2020 00:00:00 +0900</pubDate><guid>https://maku.blog/p/my8fmsy/</guid><description>&lt;p>GitHub プロジェクトの設定画面から、GitHub Pages を有効化すると、簡単にウェブサイトをホスティングすることができます。
デフォルトでは、リポジトリ内の Markdown ファイル (&lt;code>.md&lt;/code>) が Jekyll によって HTML に変換されるのですが、直接 HTML ファイルをデプロイする場合は、この変換処理は無駄です。&lt;/p>
&lt;p>そのような場合は、次のようにして Jekyll による変換を無効化できます。&lt;/p>
&lt;ol>
&lt;li>リポジトリのルート（GitHub Pages のソースディレクトリ）に &lt;strong>&lt;code>.nojekyll&lt;/code>&lt;/strong> ファイルを置く&lt;/li>
&lt;/ol>
&lt;p>これだけです。&lt;/p>
&lt;p>Hugo などの静的 Web サイト生成ツールで作成したサイトをデプロイするような場合は、この設定を行っておくと、ファイルのプッシュ後に GitHub Pages に反映されるまでの時間がほんの少し早くなるかもしれません。&lt;/p>
&lt;p>速度を気にしない場合はこの設定をする必要はありませんが、プッシュする Web サイトリソース内に、アンダースコア (&lt;code>_&lt;/code>) で始まるファイルやディレクトリなどが含まれている場合は、この設定は必須になります。
なぜなら、Jekyll がアンダースコアで始まるファイルやディレクトリを取り除いてしまうからです。&lt;/p>
&lt;p>GitHub Pages のソースブランチとして &lt;code>gh-pages&lt;/code> ブランチを設定している場合は、そのブランチのルートに &lt;code>.nojekyll&lt;/code> を配置しなければいけないことに注意してください。
ちなみに、GitHub Actions でデプロイするときに、&lt;a href="https://github.com/peaceiris/actions-gh-pages">peaceiris/actions-gh-pages&lt;/a> を使っている場合は、&lt;a href="https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-enable-built-in-jekyll-enable_jekyll">自動的にデプロイ先のブランチ (&lt;code>gh-pages&lt;/code>) に &lt;code>.nojekyll&lt;/code> ファイルを作成してくれます&lt;/a>。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deploy&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-gh-pages@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">github_token&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.GITHUB_TOKEN }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">publish_dir&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">./public&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Parcel でビルドした Web サイトが GitHub Pages で動作しないとき</title><link>https://maku.blog/p/m7jw8ju/</link><pubDate>Tue, 01 Sep 2020 00:00:00 +0900</pubDate><guid>https://maku.blog/p/m7jw8ju/</guid><description>&lt;p>React アプリを Parcel でビルドして GitHub Pages で公開しようとしたら、真っ白な画面になってしまったので対応方法のメモです。
原因は、トップページの &lt;code>index.html&lt;/code> から読み込んでいる JavaScript ファイルのパスが、&lt;code>/index.js&lt;/code> のように、ドメインルートからの相対パスになっていることでした。&lt;/p>
&lt;p>GitHub Pages で公開する Web サイトの URL が、&lt;/p>
&lt;ul>
&lt;li>&lt;code>https://yourname.github.io/&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>であれば問題ないのですが、&lt;/p>
&lt;ul>
&lt;li>&lt;code>https://yourname.github.io/project名/&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>になっている場合は、読み込むファイルは &lt;code>/project名/index.js&lt;/code> になっていないといけません。
これを解決するには、例えば、Parcel でビルドしているときは &lt;strong>&lt;code>--public-url&lt;/code>&lt;/strong> オプションを使って、次のように指定します。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ parcel build src/index.html -d build --public-url &amp;#34;/project名/&amp;#34;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>こうすることで、トップページから &lt;code>/index.js&lt;/code> というパスで参照していたものが &lt;code>/project名/index.js&lt;/code> に変わってうまく動作するようになります。&lt;/p>
&lt;p>&lt;code>npm run build&lt;/code> で Web サイトのビルドを行っているのであれば、&lt;code>package.json&lt;/code> 内のスクリプト定義で次のように記述しておけばよいでしょう。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">package.json&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="s2">&amp;#34;scripts&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;start&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;parcel src/index.html --open&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;build&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;rm -rf build &amp;amp;&amp;amp; parcel build src/index.html -d build --public-url &amp;#39;/project名/&amp;#39;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>NPM スクリプト内に GitHub のプロジェクト名を含めるのが嫌なときは、CI/CD サーバー上のビルド設定でパラメータ指定するのがよいかもしれません。
例えば、GitHub Actions を使っている場合は、次のような感じで NPM スクリプトに追加パラメータを指定することができます。&lt;/p></description></item></channel></rss>