<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>音声認識 on まくろぐ</title><link>https://maku.blog/tags/%E9%9F%B3%E5%A3%B0%E8%AA%8D%E8%AD%98/</link><description>Recent content in 音声認識 on まくろぐ</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Wed, 31 Jul 2024 00:00:00 +0900</lastBuildDate><atom:link href="https://maku.blog/tags/%E9%9F%B3%E5%A3%B0%E8%AA%8D%E8%AD%98/index.xml" rel="self" type="application/rss+xml"/><item><title>Svelte 実装例: Web ブラウザで音声認識する (SpeechRecognition)</title><link>https://maku.blog/p/bf4cpjx/</link><pubDate>Wed, 31 Jul 2024 00:00:00 +0900</pubDate><guid>https://maku.blog/p/bf4cpjx/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>Web ブラウザーの &lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechRecognition">SpeechRecognition&lt;/a> API を使って、音声認識をしてみます。
ここでは Svelte アプリケーションとして作成しますが、単純な HTML + JavaScript の組み合わせでもほぼ同様のコードになると思います（参考: &lt;a href="../../p/td962u6/">Svelte 関連メモ&lt;/a>）。&lt;/p>
&lt;iframe allow="microphone" frameborder="0" style="border: none" width="100%" height="300" src="https://p-bf4cpjx-svelte-speech-recognition.vercel.app" style="resize: both; overflow: auto;">&lt;/iframe>
&lt;ul>
&lt;li>デモ: &lt;a href="https://p-bf4cpjx-svelte-speech-recognition.vercel.app/">https://p-bf4cpjx-svelte-speech-recognition.vercel.app/&lt;/a>&lt;/li>
&lt;li>ソースコード: &lt;a href="https://github.com/maku77/p-bf4cpjx-svelte-speech-recognition/">https://github.com/maku77/p-bf4cpjx-svelte-speech-recognition/&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="プロジェクトの準備">プロジェクトの準備&lt;/h2>
&lt;p>Svelte (SvelteKit) のプロジェクトがない場合は最初に作成しておきます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">プロジェクトの作成&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> npm create svelte@latest myapp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">(選択肢が表示されたら TypeScript を選択しておく）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="gp">$&lt;/span> &lt;span class="nb">cd&lt;/span> myapp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> npm install
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>SpeechRecognition&lt;/code> はブラウザ標準の API として策定されているものですが、TypeScript の型情報が認識されなかったので DefinitelyTyped で提供されている型情報 &lt;strong>&lt;code>@types/dom-speech-recognition&lt;/code>&lt;/strong> をインストールしておきます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">型情報のインストール&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> npm install --save-dev @types/dom-speech-recognition
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これで、&lt;code>window.SpeechRecognition&lt;/code> コンストラクタや、&lt;code>SpeechRecognitionResult&lt;/code> などの各型情報を参照できるようになります。&lt;/p>
&lt;h2 id="speechrecognition-の使い方">SpeechRecognition の使い方&lt;/h2>
&lt;p>&lt;code>SpeechRecognition&lt;/code> による音声認識の基本的な流れは次のようになります。&lt;/p>
&lt;ol>
&lt;li>&lt;code>SpeechRecognition&lt;/code> インスタンスを生成して、各種パラメーターを設定する。&lt;/li>
&lt;li>&lt;code>SpeechRecognition.onresult&lt;/code> プロパティに、認識結果を受け取るためのコールバック関数を設定する。&lt;/li>
&lt;li>&lt;code>SpeechRecognition.start()&lt;/code> でマイクからの音声キャプチャと音声認識を開始する。&lt;/li>
&lt;/ol>
&lt;h2 id="speechrecognition-インスタンスの生成">SpeechRecognition インスタンスの生成&lt;/h2>
&lt;p>まず、&lt;code>SpeechRecognition&lt;/code> インスタンスを生成して、各種パラメータを設定していきます。
次のような感じで関数化しておくと分かりやすいです。&lt;/p></description></item><item><title>Azure Speech Service を使って音声をテキストに変換する (STT)</title><link>https://maku.blog/p/5zx3ozz/</link><pubDate>Wed, 24 Jul 2019 00:00:00 +0900</pubDate><guid>https://maku.blog/p/5zx3ozz/</guid><description>&lt;p>Microsoft の Cognitive Services のひとつとして提供されている &lt;a href="https://azure.microsoft.com/ja-jp/services/cognitive-services/speech-services/">Speech Service&lt;/a> を使用すると、音声をテキストに変換したり、逆にテキストを音声に変換したりすることができます。&lt;/p>
&lt;p>ここでは、Python から Speech Service の機能を利用してみます（Windows 10 で動作確認済）。
実行するにはマイクのついた PC が必要です
マイクのついていない PC で実行すると &lt;code>SPXERR_MIC_NOT_AVAILABLE&lt;/code> エラーが発生します。&lt;/p>
&lt;h2 id="準備">準備&lt;/h2>
&lt;h3 id="speech-service-の準備">Speech Service の準備&lt;/h3>
&lt;p>&lt;a href="https://portal.azure.com/">Azure Portal&lt;/a> から &lt;samp>Speech&lt;/samp> のリソースを作成し、Subscription Key を取得しておいてください。&lt;/p>
&lt;h3 id="speech-sdk-のインストール">Speech SDK のインストール&lt;/h3>
&lt;p>Python の &lt;code>azure-cognitiveservices-speech&lt;/code> パッケージをインストールします。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ pip install azure-cognitiveservices-speech
&lt;/code>&lt;/pre>&lt;h3 id="visual-studio-c-redistributable-のインストール">Visual Studio C++ Redistributable のインストール&lt;/h3>
&lt;p>必要があれば、Visual Studio C++ の再頒布可能パッケージをインストールします。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://support.microsoft.com/ja-jp/help/2977003/the-latest-supported-visual-c-downloads">Visual C++ 再頒布可能パッケージ&lt;/a> (&lt;a href="https://aka.ms/vs/16/release/vc_redist.x64.exe">vc_redist.x64.exe&lt;/a>)&lt;/li>
&lt;/ul>
&lt;h2 id="python-コード">Python コード&lt;/h2>
&lt;h3 id="一回だけ変換して終わるバージョン">一回だけ変換して終わるバージョン&lt;/h3>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">stt.py&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">azure.cognitiveservices.speech&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">speechsdk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># この設定は適宜変更してください&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">subscription&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;e1b5f0964ab743133b7de4f892741c7a&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">region&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;japaneast&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">language&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;ja-JP&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># proxy = (&amp;#34;proxy.example.com&amp;#34;, 8888, &amp;#34;&amp;#34;, &amp;#34;&amp;#34;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># SpeechConfig オブジェクトを生成します&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">speech_config&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">speechsdk&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SpeechConfig&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">subscription&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">subscription&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">region&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">region&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">speech_recognition_language&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">language&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;proxy&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">locals&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">speech_config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">set_proxy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># SpeechRecognizer インスタンスを生成します&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">recognizer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">speechsdk&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SpeechRecognizer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">speech_config&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">speech_config&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;何かしゃべってください&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">recognizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">recognize_once&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reason&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">speechsdk&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ResultReason&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">RecognizedSpeech&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;「&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">」&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">elif&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reason&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">speechsdk&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ResultReason&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">NoMatch&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;No speech could be recognized: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">no_match_details&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">elif&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reason&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">speechsdk&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ResultReason&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Canceled&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cancellation_details&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cancellation_details&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Speech Recognition canceled: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cancellation_details&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reason&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">cancellation_details&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">reason&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">speechsdk&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CancellationReason&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Error&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Error details: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cancellation_details&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">error_details&lt;/span>&lt;span class="p">))&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="繰り返し入力を受け付けるバージョン">繰り返し入力を受け付けるバージョン&lt;/h3>
&lt;p>こちらのバージョンは、&lt;kbd>Ctrl+C&lt;/kbd> でプログラムを停止するまで、繰り返しユーザーの入力（発話）を受け付けます。&lt;/p></description></item></channel></rss>