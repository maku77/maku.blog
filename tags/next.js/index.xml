<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Next.js on まくろぐ</title><link>https://maku.blog/tags/next.js/</link><description>Recent content in Next.js on まくろぐ</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Tue, 21 Mar 2023 00:00:00 +0900</lastBuildDate><atom:link href="https://maku.blog/tags/next.js/index.xml" rel="self" type="application/rss+xml"/><item><title>Next.js ですべてのページにグローバルな CSS を適用する (pages/_app.ts)</title><link>https://maku.blog/p/s9iry9g/</link><pubDate>Thu, 06 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/s9iry9g/</guid><description>&lt;p>Next.js で、すべてのページコンポーネント (&lt;code>pages/*.tsx&lt;/code>) に共通のスタイルシート（いわゆるグローバル CSS）を適用したい場合は、&lt;strong>&lt;code>pages/_app.tsx(js)&lt;/code>&lt;/strong> というファイルを作成して、そこで CSS ファイルをインポートします。&lt;/p>
&lt;p>例えば、グローバル CSS として次のようなファイルを用意したとします。&lt;/p>

&lt;div class="xAccordion">
 &lt;input id="id-253419786" type="checkbox">
 &lt;label class="xAccordion_title" for="id-253419786">styles/global.css&lt;/label>
 &lt;div class="xAccordion_body">
 

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-css" data-lang="css">&lt;span class="line">&lt;span class="cl">&lt;span class="o">*&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">box-sizing&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">border-box&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">html&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">margin&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">padding&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">body&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">font-family&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">apple-system&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">BlinkMacSystemFont&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Segoe&lt;/span> &lt;span class="n">UI&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Roboto&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Oxygen&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Ubuntu&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Cantarell&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Fira&lt;/span> &lt;span class="n">Sans&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Droid&lt;/span> &lt;span class="n">Sans&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Helvetica&lt;/span> &lt;span class="n">Neue&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">sans-serif&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">max-width&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">50&lt;/span>&lt;span class="kt">rem&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">padding&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="kt">rem&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">margin&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="kc">auto&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">font-size&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="kt">%&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">a&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">color&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">inherit&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">text-decoration&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">none&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


 &lt;/div>
&lt;/div>


&lt;p>この CSS ファイルを &lt;code>pages/_app.tsx&lt;/code> からインポートすれば、すべてのコンポーネントにスタイルが反映されます。
このファイルが存在しない場合は作成してください。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">pages/_app.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="kr">type&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">AppProps&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next/app&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="s1">&amp;#39;../styles/global.css&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">MyApp&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">Component&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">pageProps&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">AppProps&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Component&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="na">...pageProps&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ pages/_app.tsx って何者？&lt;/span>
 &lt;span class="xNote_body">Next.js は &lt;code>pages/_app.tsx&lt;/code> を特殊なファイルとして扱い、ここで &lt;code>default export&lt;/code> しているコンポーネントを、すべてのページコンポーネントの親コンポーネントとして扱います。
具体的には、上記コード中の &lt;code>Component&lt;/code> 部分が各ページのコンポーネントに置き換えられた形で動作します。
結果的に、ここでインポートした CSS が、全ページから参照できることになります。
ちなみに、ここで複数の CSS ファイルをインポートしている場合は、Next.js が Web サイトのビルド時に 1 つの CSS ファイルにマージしてくれます。&lt;/span>
&lt;/div>
&lt;p>Bootstrap や Tailwind CSS などの CSS フレームワークを使いたい場合も、この &lt;code>pages/_app.tsx&lt;/code> ファイルでインポートすれば OK です。&lt;/p></description></item><item><title>Next.js の API Routes 機能で Web API を作成する</title><link>https://maku.blog/p/qcp2coz/</link><pubDate>Wed, 05 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/qcp2coz/</guid><description>&lt;h2 id="nextjs-の-web-api-機能">Next.js の Web API 機能&lt;/h2>
&lt;p>Next.js では、&lt;strong>&lt;code>pages/api&lt;/code>&lt;/strong> ディレクトリ以下に TypeScript (JavaScript) コードを配置するだけで、クライアントサイド JavaScript から呼び出せる API を定義することができます。&lt;/p>
&lt;p>例えば、次のようなファイルを作成します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">pages/api/hello.ts&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="kr">type&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">NextApiRequest&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">NextApiResponse&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">type&lt;/span> &lt;span class="nx">Response&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">name&lt;/span>: &lt;span class="kt">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">req&lt;/span>: &lt;span class="kt">NextApiRequest&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">res&lt;/span>: &lt;span class="kt">NextApiResponse&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Response&lt;/span>&lt;span class="p">&amp;gt;)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">res&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">status&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">200&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">json&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">name&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;John Doe&amp;#39;&lt;/span> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// チェーン呼び出しせずに次のように記述しても OK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// res.statusCode = 200
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// res.json({ name: &amp;#39;John Doe&amp;#39;})
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>あとは、Next.js サーバーを起動した状態で、&lt;strong>&lt;code>/api/hello&lt;/code>&lt;/strong> というエンドポイントにアクセスすると、次のような JSON データを取得できます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;John Doe&amp;#34;&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>API 機能は次のような用途に使用することができます。&lt;/p>
&lt;ul>
&lt;li>フォームに入力された値が POST されたときにサーバーサイドで DB に保存する&lt;/li>
&lt;li>3rd パーティ製の Web API の呼び出しを中継する&lt;/li>
&lt;/ul>
&lt;p>このような機能を実装するには、データベースのパスワードや、3rd パーティ製 Web API のアクセスキーなどが必要になりますが、そういった情報は Next.js サーバ側の環境変数などに保存しておくことができます。
そうすれば、API の実装コードから &lt;code>process.env.XXX_ACCESS_KEY&lt;/code> のように参照できます。
&lt;code>pages/api&lt;/code> ディレクトリ以下の実装内容が、クライアントに見られてしまうことはありません。&lt;/p></description></item><item><title>Next.js で各ページの head 要素をカスタマイズする (next/head)</title><link>https://maku.blog/p/rdr4fq2/</link><pubDate>Tue, 04 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/rdr4fq2/</guid><description>&lt;p>Next.js で各ページの &lt;code>head&lt;/code> 要素をカスタマイズしたいときは、Next.js の &lt;a href="https://nextjs.org/docs/api-reference/next/head">Head コンポーネント&lt;/a> を使用して、必要な値のみを設定していきます。
典型的なのは、次のような &lt;code>title&lt;/code> 要素の設定です。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// import Head from &amp;#39;next/head&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Head&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">title&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Page&lt;/span> &lt;span class="nx">Title&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">title&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Head&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ちなみに、&lt;code>head&lt;/code> 要素ではなく、&lt;code>html&lt;/code> 要素の属性値などを設定したいときは、&lt;code>pages/_document.tsx&lt;/code> ファイルを作成します。&lt;/p></description></item><item><title>Next.js のプリレンダリング機能を使用する (getStaticProps)</title><link>https://maku.blog/p/iv4agnt/</link><pubDate>Tue, 04 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/iv4agnt/</guid><description>&lt;h2 id="pre-rendering-とは">Pre-rendering とは&lt;/h2>
&lt;p>ブログの記事一覧ページなどを生成する場合、なんらかの API で取得した値をもとにページのコンテンツを生成する必要があります。
例えば、次のように取得した値を使ってページを生成することになります。&lt;/p>
&lt;ul>
&lt;li>Web API で取得した値&lt;/li>
&lt;li>データベースのクエリ結果&lt;/li>
&lt;li>ローカルファイルの内容や、ファイルの一覧情報&lt;/li>
&lt;/ul>
&lt;p>Next.js には、Web サイトのビルド時や、Web サーバーへのアクセス時にこういった API を呼び出して、HTML コンテンツを生成する &lt;strong>Pre-rendering&lt;/strong> 機能が備わっています。
Pre-rendering 機能は次の 2 種類があり、どちらか一方を使うこともできますし、両方を組み合わせて使うこともできます。&lt;/p>
&lt;dl>
&lt;dt>&lt;strong>SSG: Static Generation（静的サイトジェネレーション）&lt;/strong>&lt;/dt>
&lt;dd>Web サイトのビルド時に HTML ファイルを生成します。Web サーバーは静的な HTML ファイルを返すだけでよいので、パフォーマンスが非常に高くなります。すべてのページを事前に列挙できるのであれば、できるだけこの SSG を使って静的に HTML 生成してしまうことが推奨されています。静的な HTML ファイルをホスト可能なサーバー（GitHub Pages など）があれば、Web サイトを公開できます。&lt;/dd>
&lt;dt>&lt;strong>SSR: Server-side Rendering（サーバーサイドレンダリング）&lt;/strong>&lt;/dt>
&lt;dd>クライアントが Web サーバーにアクセスしたときに、サーバーサイドで動的に HTML を生成します。この仕組みを使うと、日々増減するデータを扱いやすくなりますが、Web サーバーとして Next.js サーバーを稼働させておく必要があります。感覚的には、PHP サーバーなどが動作しているイメージに近いです。&lt;/dd>
&lt;/dl>
&lt;p>ちなみに、純粋に React.js のみを使用した場合とはどう違うのでしょうか？
React.js 自体には Pre-rendering 機能は備わっておらず、主に SPA (Single Page Application) を作成するライブラリとして使用されています。
React.js のみを使って上記の例のような記事一覧ページを生成する場合、Web ブラウザ上で JavaScript を実行してコンテンツを動的に生成する必要があります。
これを SSG や SSR と区別するために、&lt;strong>CSR: Client-side rendering（クライアントサイドレンダリング）&lt;/strong> と呼びます。&lt;/p></description></item><item><title>Next.js から AWS DynamoDB にアクセスする</title><link>https://maku.blog/p/xp8o5k2/</link><pubDate>Tue, 02 Nov 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/xp8o5k2/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>Next.js アプリの API routes (&lt;code>pages/*.ts&lt;/code>) や、&lt;code>getServerSideProps&lt;/code> などのサーバーサイドで実行される関数では、通常の Node.js モジュールを使うことができるため、AWS の DynamoDB からデータを取得する、といったことも自由に行えます。
ここでは、Next.js の API routes 機能を使って、DynamoDB から情報を取得する Web API を作ってみます。
具体的には次のようなことをします。&lt;/p>
&lt;ul>
&lt;li>テスト用の DynamoDB テーブル (&lt;code>Books&lt;/code>) を作成する&lt;/li>
&lt;li>&lt;code>Books&lt;/code> テーブルを参照するためのアクセスキー（IAM ユーザー）を作成する&lt;/li>
&lt;li>Next.js の API routes の実装 (&lt;code>pages/api/books.ts&lt;/code>) を行う
&lt;ul>
&lt;li>AWS SDK を使って DynamoDB から情報を取得する&lt;/li>
&lt;li>&lt;code>/api/books/001&lt;/code> のような URL にアクセスすると JSON データを返す&lt;/li>
&lt;li>アクセスキーは環境変数で設定する&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ アクセスキーを使った AWS リソースのアクセスについて&lt;/span>
 &lt;span class="xNote_body">&lt;p>AWS のアクセスキーは、IAM ユーザーに設定されるものであり、このアクセスキーが漏洩すると、&lt;strong>そのユーザーの権限で何でもできる&lt;/strong> ということになります。
そのため、アクセスキーを使用するときは、IAM ユーザーの権限を適切に絞ることが大切で、そもそも本当に必要なケースでのみアクセスキーを使うようにすべきです。
アクセスキーが必要になるのは、AWS の外から AWS リソースに直接アクセスするケースです。
例えば、AWS CLI のコマンドで AWS の制御を行う場合や、今回の例のように AWS 外のサーバーから AWS へアクセスするようなケースです。&lt;/p></description></item><item><title>Next.js でコンポーネント単位の CSS を作成する (CSS Modules)</title><link>https://maku.blog/p/seq2cmw/</link><pubDate>Thu, 06 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/seq2cmw/</guid><description>&lt;h2 id="css-modules-とは">CSS Modules とは&lt;/h2>
&lt;p>&lt;strong>CSS Modules&lt;/strong> は、コンポーネント（ファイル）単位で CSS ファイルを分けて管理する仕組みです（これ自体は Next.js の仕組みではありません）。
CSS の名前空間がコンポーネントごとに分離されるため、シンプルな CSS クラス名を付けても名前がコンフリクトする心配がありません。&lt;/p>
&lt;p>Next.js は標準で CSS Modules の仕組みをサポートしており、CSS ファイルの拡張子を &lt;strong>&lt;code>.module.css&lt;/code>&lt;/strong> にするだけで、各コンポーネントの実装ファイルから簡単にインポートすることができます。&lt;/p>
&lt;h2 id="nextjs-で-css-modules-機能を使う">Next.js で CSS Modules 機能を使う&lt;/h2>
&lt;p>Next.js で特定のコンポーネント用に CSS ファイルを用意するときは、そのコンポーネントと同じディレクトリに &lt;strong>&lt;code>.module.css&lt;/code>&lt;/strong> という拡張子を持つファイルを作成します。
この拡張子は、Next.js で CSS Modules の仕組みを使うときのルールです。&lt;/p>
&lt;p>ここでは、警告メッセージを表示する &lt;code>Alert&lt;/code> コンポーネント用の &lt;code>Alert.module.css&lt;/code> を作成してみます。
といっても、普通に CSS ファイルを記述するだけです。
グローバルに適用する CSS ファイルと異なるのは、&lt;code>Alert&lt;/code> コンポーネント用のスタイル定義しか含まれていないことです。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">components/Alert.module.css&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-css" data-lang="css">&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>&lt;span class="nc">box&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">margin&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="kt">em&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">padding&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="kt">em&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">background&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">red&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">color&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">white&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">font-weight&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">bolder&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">border-radius&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">0.5&lt;/span>&lt;span class="kt">em&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>この CSS ファイルを &lt;code>Alert&lt;/code> コンポーネントから使用するには、次のようにインポートします。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">components/Alert.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">React&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">styles&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;./Alert.module.css&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">type&lt;/span> &lt;span class="nx">Props&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">message&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">Alert&lt;/span>: &lt;span class="kt">React.FC&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Props&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">({&lt;/span> &lt;span class="nx">message&lt;/span> &lt;span class="p">})&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">className&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">styles&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">box&lt;/span>&lt;span class="p">}&amp;gt;{&lt;/span>&lt;span class="nx">message&lt;/span>&lt;span class="p">}&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記の例では &lt;code>.css&lt;/code> ファイルを使いましたが、Next.js は &lt;a href="../../p/2n2doyb">Sass を標準サポート&lt;/a> しているので、&lt;code>.scss&lt;/code> ファイルも同様にインポートすることができます。&lt;/p></description></item><item><title>Next.js のダイナミックルーティング機能を利用する (getStaticPaths, getStaticProps, getServerSideProps)</title><link>https://maku.blog/p/rdq3ep2/</link><pubDate>Wed, 05 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/rdq3ep2/</guid><description>&lt;h2 id="ダイナミックルーティングとは">ダイナミックルーティングとは&lt;/h2>
&lt;p>Next.js では、&lt;strong>&lt;code>pages/books/[id].tsx&lt;/code>&lt;/strong> のようなファイル名でページを作成すると、1 つのファイルで、&lt;/p>
&lt;ul>
&lt;li>&lt;code>/books/001&lt;/code>&lt;/li>
&lt;li>&lt;code>/books/002&lt;/code>&lt;/li>
&lt;li>&lt;code>/books/003&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>のようなパス (URL) によるアクセスをハンドルできます。
これを &lt;strong>ダイナミックルーティング (Dynamic Routes)&lt;/strong> 機能と呼びます。&lt;/p>
&lt;p>Next.js のページコンポーネント (&lt;code>/pages/xxx.tsx&lt;/code>) は、そのページのエントリポイント（ルートコンポーネント）となるため、通常の React コンポーネントとは違って、上位のコンポーネントから props 情報を渡すことができません。
そこで Next.js では、ページコンポーネントの実装ファイル内で &lt;strong>&lt;code>getStaticProps&lt;/code>&lt;/strong> という関数を定義することで、ページコンポーネントに渡す props 情報を生成できるようにしています。
&lt;code>getStaticProps&lt;/code> 内では、上記のような URL パラメータ情報（&lt;code>/books/[id]&lt;/code> の &lt;code>id&lt;/code> の部分の値）を取り出して、それを元に props 情報を生成できます。
この仕組みによって、Next.js のページコンポーネントは、1 つの &lt;code>.tsx&lt;/code> ファイルで、複数のページ (.html) を生成できるようになっています。&lt;/p>
&lt;h2 id="ダイナミックルーティングの実装ssg-の場合">ダイナミックルーティングの実装（SSG の場合）&lt;/h2>
&lt;p>静的ジェネレーション (SSG: Static Generation)、つまり Web サイトのビルド時にすべての HTML ファイルを生成してしまうには、あらかじめどのようなパラメーター（上記の例では &lt;code>id&lt;/code>）でのアクセスが行われるかを把握した上で、各ページの内容を生成する必要があります。
これを実現するには、ページコンポーネントの実装ファイル (&lt;code>pages/*.tsx&lt;/code>) で、次のような &lt;code>async&lt;/code> 関数を実装して &lt;code>export&lt;/code> します。&lt;/p>
&lt;dl>
&lt;dt>&lt;strong>getStaticPaths 関数&lt;/strong>&lt;/dt>
&lt;dd>URL のパラメーター部分（上記の例では &lt;code>id&lt;/code>）で指定可能な値を返すように実装します。言い換えると、プリビルドすべきページの一覧情報を Next.js に教えてあげるための実装です。この関数は通常、Web サイトのビルド時にだけ実行されますが、開発サーバー (&lt;code>next dev&lt;/code>) 使用時はアクセス毎に呼び出されることに注意してください。&lt;/dd>
&lt;dt>&lt;strong>getStaticProps 関数&lt;/strong>&lt;/dt>
&lt;dd>指定されたパラメーターに対応するデータを返すように実装します。この値がページコンポーネントに引数として渡されます。この関数は通常、Web サイトのビルド時にだけ実行されますが、&lt;code>getStaticPath&lt;/code> の戻り値のプロパティ &lt;code>fallback&lt;/code> を &lt;code>true&lt;/code>、あるいは &lt;code>'blocking'&lt;/code> に設定した場合は、アクセス時に呼び出される可能性があります（後述のフォールバックの説明を参照）。&lt;/dd>
&lt;/dl>
&lt;p>次の例では、&lt;code>/books/001&lt;/code>、&lt;code>/books/002&lt;/code>、&lt;code>/books/003&lt;/code> といった URL でアクセス可能な &lt;code>books/[id]&lt;/code> ページを定義しています。&lt;/p></description></item><item><title>Next.js で全ページ共通のレイアウトを定義する（Layout コンポーネント）</title><link>https://maku.blog/p/dxamw8i/</link><pubDate>Tue, 04 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/dxamw8i/</guid><description>&lt;p>Next.js で Web サイトに見た目の統一感を持たせるには、&lt;code>Layout&lt;/code> コンポーネントを作成して、全てのページのベースレイアウトとして使用するようにします。
Next.js の仕組みというより、React コンポーネントを作成するときの慣例のようなもので、コンポーネントに &lt;code>Layout&lt;/code> という名前を付けるのも多くの人がその名前を使っているだけです。&lt;/p>
&lt;h2 id="layout-コンポーネントを定義する">Layout コンポーネントを定義する&lt;/h2>
&lt;p>&lt;code>Layout&lt;/code> コンポーネントを定義するために、次のようなファイルをプロジェクト内に作成します。
&lt;strong>&lt;code>{children}&lt;/code>&lt;/strong> の部分には、&lt;code>Layout&lt;/code> 要素以下に配置した子要素が展開されることになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">components/Layout.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">ReactNode&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">type&lt;/span> &lt;span class="nx">Props&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">children&lt;/span>: &lt;span class="kt">ReactNode&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">Layout&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">children&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">...&lt;/span>&lt;span class="nx">props&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">Props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="na">...props&lt;/span>&lt;span class="p">}&amp;gt;{&lt;/span>&lt;span class="nx">children&lt;/span>&lt;span class="p">}&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>この &lt;code>Layout&lt;/code> コンポーネントを使用するには、各ページのコンポーネント実装において、ルート要素として配置します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">pages/about.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">Head&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next/head&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">Link&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next/link&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">Layout&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;../components/Layout&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Layout&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Head&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">title&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">About&lt;/span> &lt;span class="nx">me&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">title&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Head&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">About&lt;/span> &lt;span class="nx">me&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Link&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">a&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Back&lt;/span> &lt;span class="nx">to&lt;/span> &lt;span class="nx">home&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">a&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Link&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Layout&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="layout-コンポーネントに-css-を適用する">Layout コンポーネントに CSS を適用する&lt;/h2>
&lt;h3 id="styled-jsx-で直接スタイルを埋め込む方法">styled-jsx で直接スタイルを埋め込む方法&lt;/h3>
&lt;p>&lt;a href="../../p/pbp2dpy">styled-jsx の仕組み&lt;/a> を使って、コンポーネントの定義内に直接 CSS を埋め込んでしまう方法です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">components/Layout.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">ReactNode&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">type&lt;/span> &lt;span class="nx">Props&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">children&lt;/span>: &lt;span class="kt">ReactNode&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">Layout&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">children&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">...&lt;/span>&lt;span class="nx">props&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">Props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">&amp;lt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">style&lt;/span> &lt;span class="na">jsx&lt;/span>&lt;span class="p">&amp;gt;{&lt;/span>&lt;span class="sb">`
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb"> .container {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb"> max-width: 36rem;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb"> padding: 0 1rem;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb"> margin: 3rem auto 6rem;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb"> background: #eee;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb"> `&lt;/span>&lt;span class="p">}&amp;lt;/&lt;/span>&lt;span class="nt">style&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">className&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;container&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="na">...props&lt;/span>&lt;span class="p">}&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nx">children&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="css-modules-の仕組みで別ファイルにスタイル定義する方法">CSS Modules の仕組みで別ファイルにスタイル定義する方法&lt;/h3>
&lt;p>&lt;a href="../../p/seq2cmw">CSS Modules の仕組み&lt;/a> で、&lt;code>Layout&lt;/code> コンポーネント用の CSS ファイルを作成してインポートする方法です。&lt;/p></description></item><item><title>Next.js で Sass (scss/sass) を有効にする</title><link>https://maku.blog/p/2n2doyb/</link><pubDate>Thu, 06 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/2n2doyb/</guid><description>&lt;p>Next.js は Sass を使ったスタイルシート記述 (&lt;code>.scss&lt;/code> / &lt;code>.sass&lt;/code> ファイル）をサポートしています。
ほぼゼロコンフィグ（設定なし）で使用できますが、NPM の sass モジュールだけはマニュアルでインストールする必要があります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sass のインストール&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">### yarn の場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ yarn add sass --dev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">### npm の場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ npm install sass --save-dev&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>今まで &lt;code>.css&lt;/code> 拡張子で作成していたファイルを、&lt;code>.scss&lt;/code> に変更すれば、SCSS フォーマットでスタイル記述できます。&lt;/p>
&lt;ul>
&lt;li>置換前: &lt;code>styles/global&lt;strong>.css&lt;/strong>&lt;/code>&lt;/li>
&lt;li>置換後: &lt;code>styles/global&lt;strong>.scss&lt;/strong>&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>あとは、&lt;code>.css&lt;/code> ファイルをインポートしている部分を、&lt;code>.scss&lt;/code> に置換すれば導入完了です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">pages/_app.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="kr">type&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">AppProps&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next/app&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="s1">&amp;#39;../styles/global.scss&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">MyApp&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">Component&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">pageProps&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">AppProps&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Component&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="na">...pageProps&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>もちろん、&lt;a href="../../p/seq2cmw">CSS Modules の仕組み&lt;/a> を使っている場合にも Sass を使うことができます。
その場合は、&lt;code>.module.css&lt;/code> という拡張子を &lt;code>.module.scss&lt;/code> に置き換えます。&lt;/p></description></item><item><title>Next.js でコンポーネント内に直接 CSS を記述する (styled-jsx)</title><link>https://maku.blog/p/pbp2dpy/</link><pubDate>Tue, 04 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/pbp2dpy/</guid><description>&lt;p>Next.js は CSS-in-JS ライブラリの一種である &lt;a href="https://www.npmjs.com/package/styled-jsx">styled-jsx&lt;/a> をデフォルトでサポートしています（&lt;code>styled-jsx&lt;/code> も &lt;code>Next.js&lt;/code> と同様に Vercel がメンテナンスしています）。
React コンポーネントの定義の中に、次のように CSS を直接記述することができます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">style&lt;/span> &lt;span class="na">jsx&lt;/span>&lt;span class="p">&amp;gt;{&lt;/span>&lt;span class="sb">`
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb"> ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb">`&lt;/span>&lt;span class="p">}&amp;lt;/&lt;/span>&lt;span class="nt">style&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>下記は実際に styled-jsx を使って &lt;code>p&lt;/code> 要素をスタイル設定した例です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">pages/sample.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">&amp;lt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">only&lt;/span> &lt;span class="k">this&lt;/span> &lt;span class="nx">paragraph&lt;/span> &lt;span class="nx">will&lt;/span> &lt;span class="kr">get&lt;/span> &lt;span class="nx">the&lt;/span> &lt;span class="nx">style&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">style&lt;/span> &lt;span class="na">jsx&lt;/span>&lt;span class="p">&amp;gt;{&lt;/span>&lt;span class="sb">`
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb"> p {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb"> color: red;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb"> `&lt;/span>&lt;span class="p">}&amp;lt;/&lt;/span>&lt;span class="nt">style&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ここで設定したスタイルのスコープは、この React コンポーネントに閉じたものになるため、他の React コンポーネントに影響を与えてしまう心配がありません。
そのため、シンプルなタグ名やクラス名でスタイル設定を行うことができます。&lt;/p>
&lt;p>Next.js は、外部ファイルとして作成した &lt;code>.css&lt;/code> や &lt;code>scss&lt;/code> ファイルを読み込む &lt;a href="../../p/seq2cmw">CSS Modules の機能&lt;/a> もデフォルトでサポートしています（その場合は &lt;code>*.module.css&lt;/code> というファイル名にするというルールがあります）。&lt;/p></description></item><item><title>Next.js で HelloWorld（プロジェクト作成からサーバー起動まで）</title><link>https://maku.blog/p/ubmu3bj/</link><pubDate>Sun, 18 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/ubmu3bj/</guid><description>&lt;h2 id="nextjs-とは">Next.js とは&lt;/h2>


&lt;figure class="xImage">
 &lt;img style="" width="250" height="auto" src="../../p/ubmu3bj/img-001.svg" alt="/p/ubmu3bj/img-001.svg" />
&lt;/figure>

&lt;p>&lt;a href="https://nextjs.org/">Next.js&lt;/a> は、React.js アプリ開発に必要なアレコレを詰め込んだパッケージです。
React.js を素の状態で導入すると、他にもいろいろなツールやライブラリを組み合わせていくことになるのですが、&lt;strong>Next.js を使うとモダンな Web アプリ開発に必要なものが一気に揃えられます&lt;/strong>。&lt;/p>
&lt;p>React.js は基本的に SPA（シングルページアプリ）を想定していますが、Next.js では複数ページによる構成や、サーバーサイドレンダリングなどをサポートしています。
これは、Next.js が単なる React.js 用のコンポーネントライブラリでないことを示しています。&lt;/p>
&lt;p>Next.js には次のような特徴があります。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ゼロコンフィグ&lt;/strong>: 何も設定しなくても、最初から開発サーバーの立ち上げ、プロダクト用ビルドを行えるようになっています。これらは、最適なパフォーマンスが出るようメンテナンスが続けられています。カスタマイズしたいときも、複雑怪奇な &lt;code>webpack.config.js&lt;/code> を作成する必要はなく、&lt;code>next.config.js&lt;/code> による最小限の設定で済みます。できれば何も設定しないのが理想です。&lt;/li>
&lt;li>&lt;strong>SSR/SSG によるプリレンダリング&lt;/strong>: React.js はクライアントサイドで JavaScript を実行する CSR (Client Side Rendering) で動作しますが、Next.js は SSR (Server Side Rendering) や SSG (Static Site Generation) をサポートしています。これは、一般的な Node.js の API を利用してページを構築できることを意味します。開発元の Vercel は、パフォーマンスの面から SSG を推奨しています。&lt;/li>
&lt;li>&lt;strong>TypeScript をサポート&lt;/strong>: いまどきの Web アプリ開発では TypeScript はほぼ必須なので、標準サポートはうれしいです。空の &lt;code>tsconfig.js&lt;/code> を置くだけで、TypeScript 対応は完了です（設定は自動で行われます）。&lt;/li>
&lt;li>&lt;strong>ファイルベースのルーティング&lt;/strong>: &lt;code>pages&lt;/code> ディレクトリ以下の構成をそのままルーティング用のリンク名として使うことができます。例えば、&lt;code>pages/xxx/yyy.js&lt;/code> は、&lt;code>/xxx/yyy&lt;/code> というリンク名にマッピングされます。React Router によるルーティング設定が面倒だと感じている人にとってはうれしいかもしれません。&lt;/li>
&lt;li>&lt;strong>部分的な高速リロード (Fast Refresh)&lt;/strong>: Next.js の開発サーバーを使って開発しているときに、React コンポーネントのステートを保ったままコード修正を反映できます。例えば、フォームに入力された値を保ったままページ内容を部分的に更新できます。&lt;/li>
&lt;li>&lt;strong>サーバーレス API&lt;/strong>: アプリ作成用に、簡易な Web API を作る機能が備わっています。&lt;code>pages/api&lt;/code> ディレクトリに JS ファイルを置くだけで API の完成です。&lt;/li>
&lt;li>&lt;strong>CSS Modules &amp;amp; Sass&lt;/strong>: コンポーネントから CSS ファイルを import できるようにする CSS modules の仕組みを標準サポートしています。もちろん生の CSS ではなく、Sass で記述できます。生の CSS を使った場合も、ベンダープレフィックスや Flexbox の不具合などを考慮してくれるため、ブラウザの互換性を考慮する必要がありません。CSS-in-JS な styled-jsx もデフォルトで使えます。&lt;/li>
&lt;li>&lt;strong>コードスプリッティング&lt;/strong>: 効率的なウェブサイト表示のためのコードスプリッティング機能をサポートしています。これは自動で行われるため、特に意識しなくても最適な形で Web サイトをデプロイできます。&lt;/li>
&lt;/ul>
&lt;h2 id="nextjs-の-hello-world-アプリを作成する">Next.js の Hello World アプリを作成する&lt;/h2>
&lt;h3 id="create-next-app-によるアプリ生成">create-next-app によるアプリ生成&lt;/h3>
&lt;p>次のように &lt;strong>&lt;code>create-next-app&lt;/code>&lt;/strong> コマンドを実行すると、カレントディレクトリに Next.js アプリの雛形として &lt;code>myapp&lt;/code> ディレクトリが作成されます（Node.js はインストール済みとします）。&lt;/p></description></item><item><title>Next.js のプロジェクトを TypeScript 化する</title><link>https://maku.blog/p/ny9fmty/</link><pubDate>Mon, 26 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/ny9fmty/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>&lt;code>create-next-app&lt;/code> コマンドで Next.js プロジェクトを生成するときに &lt;strong>&lt;code>--typescript (--ts)&lt;/code>&lt;/strong> オプションをつけて実行すると、TypeScript 対応したプロジェクトを生成することができます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ npx create-next-app myapp --typescript
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># ただ、こっちのテンプレートを使う方法の方が若干洗練されてる気はする
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ npx create-next-app myapp --example with-typescript&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>また、Next.js は既存の JavaScript プロジェクトを TypeScript 化する機能も備えています。
ここから先は、その方法を説明します。&lt;/p>
&lt;aside style="display: flex; border: thin dashed gray;">
&lt;div style="align-self: stretch; writing-mode: vertical-lr; text-align: center; letter-spacing: 0.2em; color: #666; border-right: thin dashed gray; padding: 0.4em 0; line-height: 1.5;">参考&lt;/div>
&lt;div style="align-self: center; padding: 0.6em 0; line-height: 1.2 !important;">&lt;ul>
&lt;li>&lt;a href="../../p/ubmu3bj">Next.js で HelloWorld&lt;/a>&lt;/li>
&lt;/ul>
&lt;/div>
&lt;/aside>
&lt;h2 id="typescript-環境の導入">TypeScript 環境の導入&lt;/h2>
&lt;p>Next.js は、プロジェクトのルートに &lt;strong>&lt;code>tsconfig.json&lt;/code>&lt;/strong> ファイルがあると、自動的に TypeScript モードで動作するようになります。
次のようにして、空の &lt;code>tsconfig.json&lt;/code> ファイルを作成し、TypeScript 用のパッケージをインストールします。&lt;/p></description></item><item><title>Next.js アプリのソースコードを GitHub で管理する</title><link>https://maku.blog/p/xjw8it5/</link><pubDate>Sat, 24 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/xjw8it5/</guid><description>&lt;p>Next.js のプロジェクトは、&lt;code>create-next-app&lt;/code> コマンドで作成済みであるとします。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/ubmu3bj">Next.js で HelloWorld&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>create-next-app&lt;/code> コマンドで Next.js アプリを新規作成すると、アプリのトップディレクトリに、Git リポジトリ (&lt;code>.git/&lt;/code>) が自動的に生成されます。
&lt;code>git log&lt;/code> コマンドを実行すると、初回のコミットがすでに生成されていることがわかります。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ git log
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">commit 4607ecdd2f3f9f3d0d4c86442463c3b86856e88a (HEAD -&amp;gt; main)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Author: maku &amp;lt;maku@example.com&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Date: Sun Apr 18 23:28:22 2021 +0900
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Initial commit from Create Next App&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>この Next.js アプリを GitHub で管理したいときは、以下の手順で GitHub リポジトリと結びつけます。&lt;/p>
&lt;ol>
&lt;li>GitHub 上に &lt;a href="https://github.com/new">新規リポジトリを追加&lt;/a> します
&lt;ul>
&lt;li>リポジトリ名は &lt;code>create-next-app&lt;/code> で指定したアプリ名と合わせましょう。&lt;/li>
&lt;li>&lt;code>Initialize this repository with:&lt;/code> の項目では、&lt;code>README.txt&lt;/code> の作成にはチェックを入れないでください。リポジトリファイル (&lt;code>.git&lt;/code>) はすでに &lt;code>create-next-app&lt;/code> によって生成されているので、GitHub 側のリポジトリは空の状態で作成する必要があります。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>既存の Next.js アプリを上記の GitHub リポジトリに結びつけます
&lt;pre tabindex="0">&lt;code>$ cd myapp
$ git remote add origin https://github.com/&amp;lt;username&amp;gt;/myapp.git
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>既存の Next.js アプリの内容（前述の初回コミット）をプッシュします
&lt;pre tabindex="0">&lt;code>$ git push -u origin main
&lt;/code>&lt;/pre>&lt;/li>
&lt;/ol>
&lt;p>あとは、コード修正しながらコミット＆プッシュを繰り返し、Next.js アプリを育てていけば OK です。&lt;/p></description></item><item><title>Next.js アプリを GitHub Actions でビルドして GitHub Pages で公開する</title><link>https://maku.blog/p/au8ju6g/</link><pubDate>Sat, 24 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/au8ju6g/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>ここでは、Next.js アプリを次のような構成でホスティング（Web サイトとして公開）できるようにします。&lt;/p>
&lt;ul>
&lt;li>&lt;code>create-next-app&lt;/code> で作成した Next.js アプリのコードを GitHub で管理する&lt;/li>
&lt;li>&lt;code>main&lt;/code> ブランチにプッシュ（マージ）したら &lt;strong>GitHub Actions&lt;/strong> で下記を実行
&lt;ul>
&lt;li>Next.js アプリをビルド (&lt;code>npm run build&lt;/code>, &lt;code>npm run export&lt;/code>)&lt;/li>
&lt;li>&lt;strong>GitHub Pages&lt;/strong> にデプロイ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>つまり、この設定が終わると、GitHub に Next.js アプリのコードをプッシュするだけで、自動的にビルドされて、Web サイトに反映されるようになります。&lt;/p>
&lt;h2 id="github-リポジトリの準備">GitHub リポジトリの準備&lt;/h2>
&lt;p>空の GitHub リポジトリを作成し、そこに &lt;code>create-next-app&lt;/code> で作成した Next.js アプリをプッシュします。
リポジトリ名は、最終的な Web サイトのアドレスをどうしたいかで、次のように作り分けます。&lt;/p>
&lt;ul>
&lt;li>ユーザーサイト（あるいは Organization サイト）
&lt;ul>
&lt;li>公開 URL: &lt;code>https://&amp;lt;username&amp;gt;.github.io/&lt;/code>&lt;/li>
&lt;li>作成するリポジトリ名: &lt;strong>&lt;code>&amp;lt;username&amp;gt;.github.io&lt;/code>&lt;/strong>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>プロジェクトサイト
&lt;ul>
&lt;li>公開 URL: &lt;code>https://&amp;lt;username&amp;gt;.github.io/&amp;lt;repository&amp;gt;/&lt;/code>&lt;/li>
&lt;li>作成するリポジトリ名: &lt;strong>&lt;code>&amp;lt;repository&amp;gt;&lt;/code>&lt;/strong>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>ここでは、プロジェクトサイトとして &lt;code>myapp&lt;/code> というリポジトリを作成した場合の例で説明していきます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ npx create-next-app myapp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ cd myapp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git remote add origin https://github.com/&amp;lt;username&amp;gt;/myapp.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git push -u origin main&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記のように実行すると、初期状態の Next.js アプリが GitHub にプッシュされます。&lt;/p></description></item><item><title>Next.js アプリを Vercel で公開する</title><link>https://maku.blog/p/j6ht5fq/</link><pubDate>Fri, 07 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/j6ht5fq/</guid><description>&lt;h2 id="vercel-とは">Vercel とは？&lt;/h2>
&lt;p>Vercel は Next.js を開発している企業であり、同名の Vercel というサービスを提供しています。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://vercel.com/">Vercel - Develop. Preview. Ship. For the best frontend teams&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Vercel サービスは Next.js アプリのホスティングに特化しており、GitHub などのリポジトリと連携させることにより、ビルドから Next.js サーバーによるホスティングまでを簡単に自動化することができます（実際には、Vercel サービスは、Next.js 以外で作成した Web サイト、例えば、&lt;a href="https://gohugo.io/">Hugo&lt;/a> で作成したブログなどのホスティングにも対応しています）。&lt;/p>
&lt;p>Next.js アプリで SSR (Server-side Rendering) や API ルートなどの機能を使用している場合は、Next.js サーバー上で Web サイトをホスティングする必要があるのですが、現状そのような環境をサーバーレスなサービスとして提供しているのは Vercel のみです（一応 &lt;a href="https://www.serverless.com/blog/serverless-nextjs">Serverless Next.js&lt;/a> という AWS Lambda で動かすものもあったりしますが）。&lt;/p>
&lt;p>Next.js の開発サーバー (&lt;code>next dev&lt;/code>) で何らかのアプリをローカルで動かせているのであれば、Vercel を使って、ほぼそのままの形でネット上に公開することができます。
小規模な Web サイトであれば無料で動かせますし、とっても簡単なので、一度試してみるとよいです。&lt;/p>
&lt;h2 id="vercel-で-nextjs-アプリを公開する">Vercel で Next.js アプリを公開する&lt;/h2>
&lt;p>ここでは、GitHub にプッシュした Next.js アプリを Vercel を使って公開してみます。
まずは、下記を参考にして、GitHub に何らかの Next.js コードをプッシュしてください（といっても &lt;code>create-next-app&lt;/code> で生成したコードをそのままプッシュするだけで OK です）。&lt;/p></description></item><item><title>Vercel のウェブサイトに独自ドメインを割り当てる</title><link>https://maku.blog/p/9vakw8i/</link><pubDate>Fri, 07 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/9vakw8i/</guid><description>&lt;p>Vercel で公開している Web サイトに、&lt;a href="https://px.a8.net/svt/ejp?a8mat=3NCT8C+EVU582+50+2HHVNM" rel="nofollow">お名前.com&lt;/a>
&lt;img border="0" width="1" height="1" src="https://www15.a8.net/0.gif?a8mat=3NCT8C+EVU582+50+2HHVNM" alt="">
 で取得した独自ドメインを割り当てる方法を説明します。
Vercel 上での Next.js アプリ公開までの手順は、下記の記事を参考にしてください。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/j6ht5fq">Next.js アプリを Vercel で公開する&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>ここでは、独自ドメインを「お名前.com」で取得済みだと仮定しますが、別のレジストラで取得している場合もほぼ同様に設定できるはずです。
大きく分けて、次の 2 種類の設定方法があります。&lt;/p>
&lt;ul>
&lt;li>Vercel の DNS サーバーを使う方法&lt;/li>
&lt;li>Vercel 以外の DNS サーバーを使う方法&lt;/li>
&lt;/ul>
&lt;p>独自ドメインの「レジストラ」と「DNS サーバー」の関係については、下記の記事で簡単にまとめていますので参考にしてください。
後述の設定で何をしているのかが分かりやすくなると思います。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="../../p/bwamwgp/">ドメイン管理と DNS 管理の違いを理解する&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="vercel-の-dns-サーバーを使う方法">Vercel の DNS サーバーを使う方法&lt;/h2>
&lt;p>お名前.com などのレジストラで独自ドメインを取得すると、そのドメインをどの DNS サーバーで運用するかという設定を行えるはずです。
次のように Vercel 側の DNS サーバー設定を行うと、お名前.com 側に設定すべき DNS サーバー名を確認できます。&lt;/p>
&lt;p>(1) &lt;a href="https://vercel.com/">Vercel のサイト&lt;/a> から対象アプリのページを開き、&lt;strong>Settings&lt;/strong> → &lt;strong>Domains&lt;/strong> と選択し、取得済みの独自ドメイン名を入力して &lt;strong>Add&lt;/strong> ボタンを押してください。ここでは、例として &lt;code>example.com&lt;/code> というドメインを管理するとします（ドメイン自体は「お名前.com」で取得したものです）。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="800" height="384" src="../../p/9vakw8i/img-001_hu500919531342924169.png" alt="/p/9vakw8i/img-001.png" />
 &lt;figcaption>図: Vercel に独自ドメインを設定する&lt;/figcaption>
&lt;/figure>

&lt;p>(2) &lt;code>example.com&lt;/code> に加えて &lt;code>www.example.com&lt;/code> もエイリアスとして設定するかというダイアログが出ますが、&lt;code>example.com&lt;/code> だけでよければ、&lt;strong>&lt;code>Add example.com&lt;/code>&lt;/strong> を選択すれば　OK です。&lt;/p></description></item><item><title>ESLint (4) ESLint の設定方法まとめ (for Next.js 11)</title><link>https://maku.blog/p/dexgg8o/</link><pubDate>Mon, 19 Jul 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/dexgg8o/</guid><description>&lt;h2 id="nextjs-11-が-eslint-を組み込みサポート">Next.js 11 が ESLint を組み込みサポート&lt;/h2>
&lt;p>&lt;a href="https://nextjs.org/docs/basic-features/eslint">Next.js 11 で ESLint を Next.js が組み込みでサポートしました&lt;/a>。
これで、&lt;code>create-next-app&lt;/code> で新規作成するアプリでは、ESLint に関してもゼロコンフィグで &lt;code>next eslint&lt;/code> とするだけで実行できるようになります。&lt;/p>
&lt;p>ただ、ESLint には色々な共有設定 (config) があるわけで、Next.js がデフォルトで設定してくれているもの以外（TypeScript や Prettier 関連）は自分で設定する必要があります。
ここでは、Next.js 11 がデフォルトで提供する &lt;code>.eslintrc&lt;/code> にそれらの設定を追加します。&lt;/p>
&lt;h2 id="nextjs-11-デフォルトの-eslint-設定">Next.js 11 デフォルトの ESLint 設定&lt;/h2>
&lt;p>Next.js 11 が生成する &lt;code>.eslintrc&lt;/code> ファイルは次のようなシンプルなものです。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">.eslintrc&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;extends&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;next&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;next/core-web-vitals&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>問題はこれらがどのような共有設定を含んでいるかですが、&lt;a href="https://github.com/vercel/next.js/blob/canary/packages/eslint-config-next/index.js">eslint-config-next&lt;/a> のコードを見ると、次のような感じになっています。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">module&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">exports&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">extends&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;plugin:react/recommended&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;plugin:react-hooks/recommended&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;plugin:@next/next/recommended&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>React 系の共有設定はここに含まれているので、&lt;code>&amp;quot;extends&amp;quot;: [&amp;quot;next&amp;quot;]&lt;/code> だけでカバーできそうです。
&lt;a href="https://nextjs.org/docs/basic-features/eslint#base-configuration">公式ドキュメントの ESLint - Base Configuration&lt;/a> にも同様の説明が書かれています。
逆に、TypeScript 関連や、Prettier 関連の共有設定は自分で追加しなければいけません。&lt;/p>
&lt;h2 id="eslint-設定を追加する">ESLint 設定を追加する&lt;/h2>
&lt;p>ここでは、下記のような ESLint extends 設定を手動で追加してやります。&lt;/p></description></item><item><title>Next.js アプリに Google Analytics を設定する (next/script)</title><link>https://maku.blog/p/zycmw6f/</link><pubDate>Tue, 21 Mar 2023 00:00:00 +0900</pubDate><guid>https://maku.blog/p/zycmw6f/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>Google Analytics で Web サイトのアクセス解析を行うには、次のような感じのコードを各ページに埋め込む必要があります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Google Analytics 用の埋め込みコード&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="c">&amp;lt;!-- Google tag (gtag.js) --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">async&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://www.googletagmanager.com/gtag/js?id=G-ABCDE12345&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dataLayer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dataLayer&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="p">[];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">function&lt;/span> &lt;span class="nx">gtag&lt;/span>&lt;span class="p">(){&lt;/span>&lt;span class="nx">dataLayer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">arguments&lt;/span>&lt;span class="p">);}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">gtag&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;js&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">gtag&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;config&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;G-ABCDE12345&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ここでは、Next.js が提供する &lt;strong>&lt;code>Script&lt;/code>&lt;/strong> コンポーネント (&lt;strong>&lt;code>next/script&lt;/code>&lt;/strong>) を使用して、Next.js アプリに同等のコードを埋め込む方法を説明します。
HTML 標準の &lt;code>script&lt;/code> ではなく、Next.js の &lt;code>Script&lt;/code> コンポーネントを使用することで、Next.js アプリのレンダリング処理に合わせて実行タイミングを最適化できます。&lt;/p>
&lt;h2 id="事前準備google-analitics-でプロパティとデータストリームを追加する">事前準備（Google Analitics でプロパティとデータストリームを追加する）&lt;/h2>
&lt;p>事前準備として、&lt;a href="https://analytics.google.com/">Google Analytics&lt;/a> のサイトで、サイドバーの &lt;strong>管理&lt;/strong> メニューから対象アプリ用に &lt;strong>プロパティ&lt;/strong> を追加しておいてください。
さらに、そのプロパティに対して &lt;strong>データストリーム&lt;/strong> を追加すると、Web サイトや Android アプリの利用状況を監視できるようになります。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="1830" height="718" src="../../p/zycmw6f/img-001.png" alt="/p/zycmw6f/img-001.png" />
 &lt;figcaption>図: プロパティにデータストリームを追加する&lt;/figcaption>
&lt;/figure>

&lt;p>データストリームを追加すると、次のように &lt;strong>測定 ID&lt;/strong> が発行されます。
これが、前述の JavaScript コードで指定する ID になります。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="1952" height="634" src="../../p/zycmw6f/img-002.png" alt="/p/zycmw6f/img-002.png" />
 &lt;figcaption>図: 測定 ID が発行された&lt;/figcaption>
&lt;/figure>

&lt;h2 id="nextjs-用の-analytics-コンポーネントを作成する">Next.js 用の Analytics コンポーネントを作成する&lt;/h2>
&lt;p>下記の &lt;code>Analytics.tsx&lt;/code> は、Google Analytics 用のコードを埋め込むためのコンポーネントの実装例です。
Google Analytics の測定 ID は、ホスティングサーバー（例えば Vercel）の環境変数 &lt;strong>&lt;code>NEXT_PUBLIC_ANALYTICS_ID&lt;/code>&lt;/strong> で設定することを想定しています（自サイト専用のコンポーネントにするなら、ハードコーディングしちゃっても大丈夫です）。&lt;/p></description></item><item><title>Next.js でローカル開発時 (next dev) のみ有効なデバッグページを作成する (getStaticProps)</title><link>https://maku.blog/p/3vbr2bm/</link><pubDate>Mon, 09 May 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/3vbr2bm/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>Next.js アプリを作っていると、開発中にだけ表示したいデバッグ用のページを作りたくなることがよくあります。
ここでは、ローカルサーバー (&lt;code>next dev&lt;/code>) での開発中のみ有効になるデバッグページの作り方を説明します。&lt;/p>
&lt;h2 id="デバッグページの作成">デバッグページの作成&lt;/h2>
&lt;p>Next.js の各ページのビルド時には、必要に応じてデータフェッチなどを行うための &lt;code>getStaticProps&lt;/code> 関数が呼び出されます（参考: &lt;a href="../../p/iv4agnt/">Next.js のプリレンダリング機能を使用する (getStaticProps)&lt;/a>）。&lt;/p>
&lt;p>この関数の戻り値として、&lt;a href="https://nextjs.org/docs/api-reference/data-fetching/get-static-props#notfound">notFound プロパティ&lt;/a> を true にしたオブジェクトを返すと、そのページがないものとして扱うことができます（404 Not Found になる）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">getStaticProps&lt;/span>: &lt;span class="kt">GetStaticProps&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Return the default 404 page with a status code of 404.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">notFound&lt;/span>: &lt;span class="kt">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>この仕組みを利用して次のように実装すれば、ローカルサーバーでの開発中のみ表示可能なデバッグページを作ることができます。
ローカルサーバー (&lt;code>next dev&lt;/code>) で実行されているかどうかは、環境変数 &lt;code>process.env.NODE_ENV&lt;/code> の値で判断できます（参考: &lt;a href="../../p/gbpeyov/">Next.js で環境変数を扱う (.env, NEXT_PUBLIC, NODE_ENV)&lt;/a>）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">src/pages/debug/info.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">GetStaticProps&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">NextPage&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">type&lt;/span> &lt;span class="nx">EmptyProps&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">key&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kt">never&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * デバッグページのビルド時の前処理。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * 開発サーバー (next dev) での実行時のみ、このページが存在するようにします。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * 本番サーバー (next start) での実行時は、404 Not Found になります。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">getStaticProps&lt;/span>: &lt;span class="kt">GetStaticProps&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">EmptyProps&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">isLocalDev&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">process&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">env&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">NODE_ENV&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="s1">&amp;#39;production&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">notFound&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="o">!&lt;/span>&lt;span class="nx">isLocalDev&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">props&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{}&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">DebugInfoPage&lt;/span>: &lt;span class="kt">NextPage&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Debug&lt;/span> &lt;span class="nx">page&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">This&lt;/span> &lt;span class="nx">page&lt;/span> &lt;span class="k">is&lt;/span> &lt;span class="nx">displayed&lt;/span> &lt;span class="nx">only&lt;/span> &lt;span class="nx">during&lt;/span> &lt;span class="nx">development&lt;/span>&lt;span class="p">.&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="nx">DebugInfoPage&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="おまけモジュール化しておく">（おまけ）モジュール化しておく&lt;/h2>
&lt;p>複数のデバッグページを作成する場合は、前述の &lt;code>getStaticProps&lt;/code> 実装を使いまわせるようにしておくと便利です。&lt;/p></description></item><item><title>Next.js でブラウザ履歴で戻るボタンを表示する (router.back)</title><link>https://maku.blog/p/m4dmu4c/</link><pubDate>Tue, 22 Feb 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/m4dmu4c/</guid><description>&lt;p>Next.js の &lt;code>next/router&lt;/code> モジュールが提供する &lt;code>NextRouter&lt;/code> オブジェクトの &lt;a href="https://nextjs.org/docs/api-reference/next/router#routerback">back メソッド&lt;/a> を呼び出すと、ブラウザの履歴に従って 1 つ前のページに遷移することができます。
つまり、ブラウザの「戻る」ボタンを押した場合と同じ振る舞いをします。
&lt;code>NextRouter&lt;/code> オブジェクトは、&lt;code>useRouter&lt;/code> フックで取得することができます。&lt;/p>
&lt;p>次の &lt;code>BackButton&lt;/code> コンポーネントはシンプルな「戻る」ボタンを表示し、クリック時に &lt;code>NextRouter#back()&lt;/code> を呼び出します。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="136" height="88" src="../../p/m4dmu4c/img-001.png" alt="/p/m4dmu4c/img-001.png" />
 &lt;figcaption>図: 戻るボタン（標準の button 版）&lt;/figcaption>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">components/BackButton.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">FC&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">useRouter&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next/router&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">BackButton&lt;/span>: &lt;span class="kt">FC&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">router&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useRouter&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">button&lt;/span> &lt;span class="na">alia-label&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;戻る&amp;#34;&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;button&amp;#34;&lt;/span> &lt;span class="na">onClick&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">router&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">back&lt;/span>&lt;span class="p">()}&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">戻る&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上の例では、素の &lt;code>button&lt;/code> コンポーネントを使っていますが、mui (Material-UI) などの UI ライブラリを使えばリッチなボタンを表示できます。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="188" height="116" src="../../p/m4dmu4c/img-002.png" alt="/p/m4dmu4c/img-002.png" />
 &lt;figcaption>図: 戻るボタン（mui 版）&lt;/figcaption>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">components/BackButton.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">FC&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">useRouter&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next/router&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">BackIcon&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@mui/icons-material/ArrowBackIosNew&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">Button&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@mui/material/Button&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">BackButton&lt;/span>: &lt;span class="kt">FC&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">router&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useRouter&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Button&lt;/span> &lt;span class="na">aria-label&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;戻る&amp;#34;&lt;/span> &lt;span class="na">variant&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;contained&amp;#34;&lt;/span> &lt;span class="na">onClick&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">router&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">back&lt;/span>&lt;span class="p">()}&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">BackIcon&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Next.js で Firebase: Cloud Firestore データベースを使う</title><link>https://maku.blog/p/m3bjrz7/</link><pubDate>Thu, 30 Dec 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/m3bjrz7/</guid><description>&lt;h2 id="何をするか">何をするか&lt;/h2>
&lt;p>&lt;a href="https://firebase.google.com/docs/firestore">Cloud Firestore&lt;/a> は、Firebase サービス（あるいは GCP）が提供するサーバーレスな NoSQL データベースです。
Firestore データベースには様々な環境からアクセスできますが、ここでは Web サイトからアクセスすることを想定して、Firebase が提供する JavaScript SDK（クライアントサイド SDK）を使って Firestore データベースを操作してみます。&lt;/p>
&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ Firebase と GCP の使い分け&lt;/span>
 &lt;span class="xNote_body">Firebase と GCP (Google Cloud Platform) の両方に Firestore の記載があるので混乱しますが、どちらのプロジェクトで作った Firestore データベースも内部的には共有されているようです。
Firebase プロジェクトも、GCP プロジェクトとして参照できるようになっています。
一方で、SDK は共通化されておらず、主に Firebase はクライアントサイド用の SDK を提供し、GCP はサーバーサイド用の SDK を提供しています。&lt;/span>
&lt;/div>
&lt;p>前提条件として、Firebase プロジェクトの作成は完了し、&lt;code>FirebaseApp&lt;/code> インスタンスの初期化コードは準備できているものとします。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/73eq2cm">Next.js で Firebase: プロジェクトの作成と接続準備&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="firestore-データベースの作成">Firestore データベースの作成&lt;/h2>
&lt;p>クライアントアプリの実装を始める前に、Firebase プロジェクトに Firestore データベースを作成します。&lt;/p>
&lt;ol>
&lt;li>&lt;a href="https://console.firebase.google.com/">Firebase コンソール&lt;/a> にサインインして、対象のプロジェクトを開く。&lt;/li>
&lt;li>サイドバーから &lt;strong>&lt;code>Firestore Database&lt;/code>&lt;/strong> を選択し、&lt;strong>&lt;code>データベースの作成&lt;/code>&lt;/strong> をクリックする。
&lt;ul>
&lt;li>保護ルールは &lt;code>本番環境モード&lt;/code> を選んでおけば OK&lt;/li>
&lt;li>ロケーションは &lt;code>asia-northeast1&lt;/code>（東京）を選んでおけば OK&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>次のように空っぽのデータベースが作成されれば準備 OK です。&lt;/p></description></item><item><title>Next.js で Firebase: Authentication 機能でユーザー認証できるようにする</title><link>https://maku.blog/p/8t6gq2b/</link><pubDate>Sun, 26 Dec 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/8t6gq2b/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>&lt;a href="https://firebase.google.com/docs/auth">Firebase の Authentication 機能&lt;/a> を使用すると、ウェブアプリ（やモバイルアプリ）にユーザー認証機能を付けて、各種リソースへのアクセスを制御できるようになります。
例えば、「Firestore に格納されているユーザー情報の編集は、そのユーザーにのみ許可する」といったことができます。
Firebase のクライアントアプリでユーザーデータを扱う場合は、Firebase Authentication はほぼ必須の機能だといえます。&lt;/p>
&lt;p>ここでは、Next.js (React) アプリで Firebase Authentication を使い、ユーザー認証を行えるようにしてみます。
ユーザー認証に使う UI は、Firebase が用意している &lt;a href="https://firebase.google.com/docs/auth/web/firebaseui">FirebaseUI&lt;/a> を使って表示します。&lt;/p>
&lt;p>事前準備として、Firebase プロジェクトの作成は済んでおり、Next.js アプリから各種 Firestore 関連インスタンスを取得できるようになっていると想定します。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/73eq2cm">Next.js で Firebase: プロジェクトの作成と接続準備&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="ログインプロバイダの設定">ログインプロバイダの設定&lt;/h2>
&lt;p>Firebase Authentication では、サインイン方法として、新規に登録するメールアドレスや電話番号を使う方法（ネイティブプロバイダ）と、既存の Google アカウントや Facebook アカウントなどを使う方法（追加のプロバイダ）が準備されています。
まずは、シンプルに「メールアドレス」でユーザー登録できるようにしてみます。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;a href="https://console.firebase.google.com/">Firebase コンソール&lt;/a> の &lt;strong>Authentication&lt;/strong> タブを選択して機能を有効化する。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ログインプロバイダ (Sign-in method) で &lt;strong>メール／パスワード&lt;/strong> を選択する。&lt;/p>

 
 &lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="700" height="343" src="../../p/8t6gq2b/img-001_hu14103644858394531459.png" alt="/p/8t6gq2b/img-001.png" />
 &lt;/figure>

&lt;/li>
&lt;li>
&lt;p>&lt;strong>有効にする&lt;/strong> にチェックを入れて &lt;strong>保存&lt;/strong> をクリック。&lt;/p>

 
 &lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="500" height="194" src="../../p/8t6gq2b/img-002_hu3421018065957438752.png" alt="/p/8t6gq2b/img-002.png" />
 &lt;/figure>

&lt;/li>
&lt;/ol>
&lt;p>これで、Firebase Authentication で「メールアドレス」による認証を行えるようになります。&lt;/p>
&lt;h2 id="サインイン状態を扱う-react-フックを作成する">サインイン状態を扱う React フックを作成する&lt;/h2>
&lt;p>Next.js (React) アプリから Firebase Authentication を使う場合は、サインイン状態を扱うためのカスタムフックを作成しておくと便利です。
サインインボタンなどの UI を先に作りたいところですが、ボタンを表示すべきかどうかの判断のために結局このカスタムフックが必要になるので、先にカスタムフックを作成します。&lt;/p></description></item><item><title>Next.js で Firebase: プロジェクトの作成と接続準備</title><link>https://maku.blog/p/73eq2cm/</link><pubDate>Sun, 26 Dec 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/73eq2cm/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>ここでは、&lt;strong>Firebase を Next.js (React) ウェブアプリから使用するための準備&lt;/strong> として、「Firebase プロジェクトの作成」「Next.js アプリの作成」「&lt;code>FirebaseApp&lt;/code> インスタンスの初期化」までを行います。
なお、ここでは Firebase JS SDK ver.9 以降を対象とします（ver.8 以前は初期化方法が若干異なります）。&lt;/p>
&lt;p>Firebase サービスを使うと、Web アプリやモバイルアプリに必要なバックエンド環境を簡単に整えることができます。
例えば、Firebase は次のような機能を提供しており、小規模のアプリであれば無料の Spark プランで動かすことができます（参考: &lt;a href="https://firebase.google.com/pricing">Firebase の料金プラン&lt;/a>）。&lt;/p>
&lt;ul>
&lt;li>Firebase Authentication &amp;hellip; ユーザー管理と認証（ログイン UI もある）&lt;/li>
&lt;li>Firebase Hosting &amp;hellip; Web アプリのホスティング（独自ドメインにも対応）&lt;/li>
&lt;li>Cloud Firestore &amp;hellip; NoSQL データベース&lt;/li>
&lt;li>Cloud Function &amp;hellip; サーバレス関数&lt;/li>
&lt;li>Cloud Storage for Firebase &amp;hellip; ファイル管理&lt;/li>
&lt;/ul>
&lt;p>Web アプリから上記のような機能にアクセスするには、まずは &lt;code>FirebaseApp&lt;/code> インスタンスの設定（初期化）が必要になります。
以下では、Next.js アプリから各種 Firebase インスタンスにアクセスするところまでの準備を行います。&lt;/p>
&lt;h2 id="firebase-プロジェクトの作成">Firebase プロジェクトの作成&lt;/h2>
&lt;ol>
&lt;li>&lt;a href="https://console.firebase.google.com">Firebase コンソールにサインイン&lt;/a> して、Firebase のプロジェクトを作成します。&lt;/li>
&lt;/ol>
&lt;p>プロジェクト名は、自分の Google アカウント内で一意の名前になっていれば OK です。
例えば、&lt;code>MyApp&lt;/code> のような名前を付けて作成してください。
Google アナリティクスは有効にしなくても OK です。&lt;/p></description></item><item><title>Next.js で useState とローカルストレージ (localStorage) を連動させる</title><link>https://maku.blog/p/cwdyhec/</link><pubDate>Wed, 01 Dec 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/cwdyhec/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>React (Next.js) の &lt;code>useState&lt;/code> フックは、Web ページの状態を保持するものですが、ページのリロードや、ブラウザの再起動を行うと、その状態はリセットされてしまいます。&lt;/p>
&lt;p>一方、Web ブラウザに搭載されている &lt;a href="https://developer.mozilla.org/ja/docs/Web/API/Window/localStorage">localStorage&lt;/a> や &lt;a href="https://developer.mozilla.org/ja/docs/Web/API/Window/sessionStorage">sessionStorage&lt;/a> を使用すると、キー＆バリュー（両方とも文字列のみ）の形でデータを保存することができます。&lt;/p>
&lt;p>ここでは、これらを一緒に使うことで、&lt;code>useState&lt;/code> で管理している状態をローカルストレージに保存・復帰できるようにしてみます。&lt;/p>
&lt;h2 id="使い方のイメージ">使い方のイメージ&lt;/h2>
&lt;p>例えば、Web サイト上でダークモードの On/Off を行うスイッチがあるとして、その状態をローカルストレージに保存できるようにしたいとします。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="438" height="82" src="../../p/cwdyhec/img-001.png" alt="/p/cwdyhec/img-001.png" />
 &lt;figcaption>図: ダークモード切り替えのイメージ&lt;/figcaption>
&lt;/figure>

&lt;p>ダークモードの状態は &lt;code>useDarkMode&lt;/code> のようなカスタムフックを作成して、次のように扱えると便利です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">src/pages/sample.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">NextPage&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">useDarkMode&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;../hooks/useDarkMode&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">SamplePage&lt;/span>: &lt;span class="kt">NextPage&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 一見 useState と同様だが localStorage と連動している
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">isDark&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setDark&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useDarkMode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">style&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">width&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;100vw&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">height&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;100vh&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">color&lt;/span>: &lt;span class="kt">isDark&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s1">&amp;#39;white&amp;#39;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;black&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">background&lt;/span>: &lt;span class="kt">isDark&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s1">&amp;#39;black&amp;#39;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;white&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">label&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">input&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;checkbox&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">checked&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">isDark&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">onChange&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{(&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">setDark&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">target&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">checked&lt;/span>&lt;span class="p">)}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nx">isDark&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s1">&amp;#39;DARKモードです&amp;#39;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;LIGHTモードです&amp;#39;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">label&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="nx">SamplePage&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="usedarkmode-の実装">useDarkMode の実装&lt;/h2>
&lt;p>&lt;code>useState&lt;/code> による状態をローカルストレージと連動させるには、状態の初期化時に &lt;code>localStorage.getItem&lt;/code> で値をロード、状態の変更時に &lt;code>localStorage.setItem&lt;/code> で値をセーブ、とすればよさそうです。
ただし、&lt;code>localStorage&lt;/code> オブジェクトは、クライアントサイド JS でしか参照できないため、Next.js などのサーバーサイドレンダリング時に値を参照しようとするとエラーになってしまいます。
&lt;code>localStorage&lt;/code> の参照タイミングをうまく制御しながら、&lt;code>useState&lt;/code> フックと連携させなければいけません。&lt;/p></description></item><item><title>Next.js で開発環境で実行しているときに Web サイト上に dev 表示する (TargetEnvIndicator)</title><link>https://maku.blog/p/d4p4fr4/</link><pubDate>Fri, 29 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/d4p4fr4/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="590" height="168" src="../../p/d4p4fr4/img-001.png" alt="/p/d4p4fr4/img-001.png" />
&lt;/figure>

&lt;p>Next.js (React) などで Web サイトの開発を行うとき、その開発フェーズに応じて、開発環境 (dev)、ステージング環境 (stg)、本番環境 (prod) などを分けてリリースしていくことが多いと思います。
このとき、ブラウザ上でどのフェーズのサイトを表示しているのかが分かるように、画面上に &lt;strong>dev 環境&lt;/strong> のようなインジケーターを表示すると便利です（上図）。&lt;/p>
&lt;p>ここでは、環境変数 &lt;strong>&lt;code>NEXT_PUBLIC_TARGET_ENV&lt;/code>&lt;/strong> の値が &lt;strong>&lt;code>prod&lt;/code>&lt;/strong> 以外のときに、上記のような表示をすることにします。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/gbpeyov">Next.js で環境変数を扱う (.env, NEXT_PUBLIC, NODE_ENV)&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="実装例">実装例&lt;/h2>
&lt;p>次のコンポーネント &lt;code>TargetEnvIndicator&lt;/code> は、画面右下に環境名（例: &lt;code>dev 環境&lt;/code>）を表示します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">components/common/TargetEnvIndicator.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">FC&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * ビルド時のターゲット環境が `prod` 以外のときに、画面右下に環境名を表示します。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">TargetEnvIndicator&lt;/span>: &lt;span class="kt">FC&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">target&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">process&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">env&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">NEXT_PUBLIC_TARGET_ENV&lt;/span> &lt;span class="o">??&lt;/span> &lt;span class="s1">&amp;#39;dev&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 本番環境 (prod) の場合は何も表示しない
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">target&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="s1">&amp;#39;prod&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="kc">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">style&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">position&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;fixed&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">right&lt;/span>: &lt;span class="kt">10&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">bottom&lt;/span>: &lt;span class="kt">10&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">padding&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;0.2em 0.6em&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">borderRadius&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;0.2em&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fontSize&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;16pt&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">background&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;#f008&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">color&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;#fffd&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">zIndex&lt;/span>: &lt;span class="kt">1000&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nx">target&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="err">環境&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ターゲット環境は環境変数 &lt;code>NEXT_PUBLIC_TARGET_ENV&lt;/code> で指定しますが、この環境変数が設定されていない場合は、デフォルトで「dev 環境」と表示します。&lt;/p></description></item><item><title>Next.js で src からの相対パスで import できるようにする (tsconfig.json)</title><link>https://maku.blog/p/qgvamzc/</link><pubDate>Thu, 26 Aug 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/qgvamzc/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>Next.js (TypeScript) のプロジェクトで、&lt;code>src&lt;/code> ディレクトリ以下の階層構造が深くなってくると、別のディレクトリのモジュールをインポートするときの相対パスがわかりにくくなってきます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">sleep&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;../../../../../utils/timeUtil&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>このような場合は、次に説明するような &lt;strong>&lt;code>tsconfig.json&lt;/code>&lt;/strong> の設定をしておくと、シンプルなパスでインポートできるようになります。&lt;/p>
&lt;h2 id="compileroptionspaths-プロパティ-module-alias">compilerOptions.paths プロパティ (module alias)&lt;/h2>
&lt;p>&lt;code>tsconfig.json&lt;/code> の &lt;strong>&lt;code>compilerOptions.paths&lt;/code>&lt;/strong> プロパティ（と &lt;strong>&lt;code>baseUrl&lt;/code>&lt;/strong> プロパティ）を設定すると、特定のパスに配置されたモジュール（.ts ファイル）を、エイリアス名（ここでは &lt;code>@&lt;/code>）を使って参照できるようになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">tsconfig.json&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;compilerOptions&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="s2">&amp;#34;baseUrl&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;paths&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;@/*&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;./src/*&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記のように設定すると、プロジェクトルートの &lt;code>src&lt;/code> ディレクトリ以下のモジュールを、どの階層にあるコードからでも、&lt;strong>&lt;code>@/moduleName&lt;/code>&lt;/strong> という名前で参照できるようになります。
例えば、&lt;code>src/utils/timeUtil.ts&lt;/code> というモジュールをインポートするとき、これまでは、次のようにカレントディレクトリからの相対パスで指定しなければいけなかったところを、&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">sleep&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;../../../../../utils/timeUtil&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>次のように &lt;code>src&lt;/code> ディレクトリを示すエイリアス名 &lt;code>@&lt;/code> を使って指定できるようになります。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">sleep&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@/utils/timeUtil&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ ワンポイント&lt;/span>
 &lt;span class="xNote_body">上記のようなエイリアス名を使った場合でも正しくモジュールを参照できるのは、Next.js のビルドシステムが JavaScript へのトランスパイル時に本来のモジュールのパスに変換してくれるおかげです（おそらく webpack などによるバンドル時に処理されています）。
このあたりにも、Next.js のゼロコンフィグ思想が垣間見えます。&lt;/span>
&lt;/div>
&lt;p>ちなみに、一緒に設定している &lt;code>&amp;quot;baseUrl&amp;quot;: &amp;quot;.&amp;quot;&lt;/code> というオプションは、本来は次のように &lt;code>./&lt;/code> プレフィックスを付けない名前でインポートしたときに、プロジェクトルートからの相対パスでモジュールを検索してくれるようにするためのオプションです。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">sleep&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;src/utils/timeUtil&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>この &lt;code>baseUrl&lt;/code> の設定は &lt;code>paths&lt;/code> の設定とは関係なさそうに見えますが、一緒に設定しておかないとビルド時のパス解決に失敗するので、必ず &lt;code>baseUrl&lt;/code> と &lt;code>paths&lt;/code> の両方の設定が必要です。
&lt;code>baseUrl&lt;/code> を設定すると、3rd パーティ製の npm モジュールとの見分けがつきにくくなるという弊害があるため、このあたりは将来的に改善されそうな気がします。&lt;/p></description></item><item><title>Next.js のページコンポーネントが Client と Server どちらで実行されているか調べる (isServer, isClient, NoSsr)</title><link>https://maku.blog/p/m7is4dn/</link><pubDate>Fri, 13 Aug 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/m7is4dn/</guid><description>&lt;p>Next.js のページコンポネント (&lt;code>src/pages/*.tsx&lt;/code>) の関数は、静的な HTML ファイルを生成するためにビルド時にも実行されます（参考: &lt;a href="../../p/iv4agnt">Next.js のプリレンダリング機能を使用する&lt;/a>）。
従来の React による SPA アプリはクライアントサイド JavaScript でしか実行されないので、同じような感覚で実装していると振る舞いの違いでハマることがあります。
例えば、ページコンポーネントから次のように &lt;code>window&lt;/code> オブジェクトを参照しようとすると、Next.js によるプリレンダリング時にエラーになります。
これは、&lt;code>window&lt;/code> オブジェクトは、Web ブラウザ上で JavaScript を実行しているときにしか存在しないからです。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">src/pages/hello.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">FC&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">HelloPage&lt;/span>: &lt;span class="kt">FC&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">location&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// ReferenceError: window is not defined
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Hello&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>逆に言うと、実行時に &lt;code>window&lt;/code> オブジェクトが存在しているかどうかを調べることによって、ページコンポーネント内のコードが、どのタイミングで実行されているかを判別できます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line hl">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">isClient&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">typeof&lt;/span> &lt;span class="nb">window&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="s1">&amp;#39;undefined&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// const isServer = () =&amp;gt; typeof window === &amp;#39;undefined&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">HelloPage&lt;/span>: &lt;span class="kt">FC&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">isClient&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;これはクライアントサイド JS として実行されているよ！&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">location&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">alert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;だから alert も使えるよ！&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Hello&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ちなみに、React フックの &lt;code>useEffect&lt;/code> で設定したコールバック関数は、DOM 要素のレンダリング後に実行されるものなので、クライアントサイドでのみ実行されることが保証されています。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">HelloPage&lt;/span>: &lt;span class="kt">FC&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ここであれば window オブジェクトは確実に参照できる
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">window&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">location&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="p">[])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Hello&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>JSX コードで記述した部分も、Next.js のサーバーサイドビルド時と、クライアントサイド JS の両方で実行されます。
クライアントサイドでのみレンダリングしたい部分は、上記で定義した &lt;code>isClient&lt;/code> 関数を使って次のように記述します。&lt;/p></description></item><item><title>Next.js アプリでのリンク方法まとめ（mui/Material-UI との連携なども） (next/link, next/router)</title><link>https://maku.blog/p/vgs4dnw/</link><pubDate>Tue, 10 Aug 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/vgs4dnw/</guid><description>&lt;h2 id="アプリ内ページへのリンク基本">アプリ内ページへのリンク（基本）&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// import Link from &amp;#39;next/link&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Link&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/about&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">About&lt;/span> &lt;span class="nx">us&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Link&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>Next.js でアプリ内部で閉じるページリンクを張るには、&lt;a href="https://nextjs.org/docs/api-reference/next/link">next/link&lt;/a> モジュールを使用します。
上記のようにすると、&lt;code>pages/about.tsx&lt;/code> ページコンポーネントが生成するページへのリンクになります。&lt;/p>
&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ a 要素は必要ない&lt;/span>
 &lt;span class="xNote_body">Next.js 12 以前は &lt;code>Link&lt;/code> 要素の下に明示的に &lt;code>a&lt;/code> 要素を配置する必要がありました。
これは、HTML 的に正しく &lt;code>a&lt;/code> 要素を配置するためでしたが、Next.js 13 では自動的に &lt;code>a&lt;/code> 要素を挿入するようになったので、&lt;code>a&lt;/code> 要素の記述は必要ありません。&lt;/span>
&lt;/div>
&lt;h3 id="遷移前の履歴を置き換える-replace-オプション">遷移前の履歴を置き換える replace オプション&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Link&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/about&amp;#34;&lt;/span> &lt;span class="na">replace&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記のように &lt;strong>&lt;code>replace&lt;/code>&lt;/strong> オプションを指定すると、ページ遷移前の URL がブラウザの履歴に残りません（戻るキーで戻らなくなります）。&lt;/p>
&lt;h2 id="外部リンク">外部リンク&lt;/h2>
&lt;p>&lt;code>https://&lt;/code> で始まる外部リンクを出力したい場合は、&lt;code>&amp;lt;a&amp;gt;&lt;/code> コンポーネントをそのまま使用します。
&lt;code>next/link&lt;/code>（や &lt;code>react-router&lt;/code>) が提供する &lt;code>Link&lt;/code> コンポーネントは、アプリ内のルーティング用なので使えません。
外部リンクを開く場合は、安全性のために一律で &lt;code>rel=&amp;quot;noopener noreferrer&amp;quot;&lt;/code> を付けましょう。
リンククリック時に必ず別タブで開きたいときは、&lt;code>target=&amp;quot;_blank&amp;quot;&lt;/code> を指定してください。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">a&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://example.com/&amp;#34;&lt;/span> &lt;span class="na">target&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;_blank&amp;#34;&lt;/span> &lt;span class="na">rel&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;noopener noreferrer&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Website&lt;/span> &lt;span class="nx">title&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">a&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>mui (Material-UI) を採用したサイトの場合は、&lt;code>a&lt;/code> の代わりに mui が提供する &lt;code>Link&lt;/code> コンポーネントを使用することで、サイト内のデザインを統一することができます。
&lt;code>next/link&lt;/code> が提供する &lt;code>Link&lt;/code> コンポーネントと混同しないように、次のように別名 (&lt;code>MuiLink&lt;/code>) を付けて使用すると分かりやすくなります。&lt;/p></description></item><item><title>Next.js の public 以下のファイルのパスを正しく扱う</title><link>https://maku.blog/p/xjjbwes/</link><pubDate>Fri, 30 Jul 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/xjjbwes/</guid><description>&lt;p>Next.js アプリでは、&lt;code>/public&lt;/code> ディレクトリ以下に配置した静的リソースファイル（画像ファイルなど）は、次のような感じで URL のドメイン直下に配置されたファイルとして参照できるようになります。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// import Image from &amp;#39;next/image&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Image&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/me.png&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">alt&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Picture of the author&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">500&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">height&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">500&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">/&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>仮に、作成した Web サイトを GitHub Pages の「プロジェクトサイト」として公開する場合は、&lt;code>https://username.github.io/reponame/&lt;/code> のように一階層深い URL パスがアプリのルートになりますが、&lt;code>next.config.js&lt;/code> で次のようにベースパスを設定しておけば、Next.js の &lt;code>Image&lt;/code> コンポーネントは正しいパス (&lt;code>/reponame/me.png&lt;/code>) に補正して画像ファイルを参照してくれます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">next.config.js&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">urlPrefix&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;/reponame&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">module&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">exports&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">assetPrefix&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">urlPrefix&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">basePath&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">urlPrefix&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">trailingSlash&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;ul>
&lt;li>参考: &lt;a href="../../p/au8ju6g">Next.js アプリを GitHub Actions でビルドして GitHub Pages で公開する&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>一方で、Next.js が提供する &lt;code>Image&lt;/code> コンポーネントなどを使わず、&lt;code>img&lt;/code> 要素をそのまま使った場合、このような URL プレフィックスの付加は自動では行われず、画像が参照できなくなるという問題が発生します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">画像が参照できなくなる&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">img&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/me.png&amp;#34;&lt;/span> &lt;span class="na">alt&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Picture of the author&amp;#34;&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>Vercel 以外のサーバーで Web サイトをホスティングする場合、&lt;code>Image&lt;/code> コンポーネント (next/image) は使えないことが多いので、この問題には意外とよく遭遇します。
次のユーティリティ関数 &lt;code>url()&lt;/code> は、&lt;code>public&lt;/code> ディレクトリ以下のファイルを参照するときに、正しい URL に補正するための関数です。&lt;/p></description></item><item><title>Next.js アプリのディレクトリ構成を考える（Atomic Design と Presentational and Container Components）</title><link>https://maku.blog/p/4is2ahp/</link><pubDate>Tue, 13 Jul 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/4is2ahp/</guid><description>&lt;p>Web サイトを構築するにあたって、よく参照されるコンポーネントの分類手法として、&lt;strong>Atomic Design&lt;/strong> と &lt;strong>Presetational and Container Components&lt;/strong> があります。&lt;/p>
&lt;ul>
&lt;li>Atomic Design &amp;hellip; UI の粒度と具体性によって 5 レベルに分類する&lt;/li>
&lt;li>Presentational and Container Components &amp;hellip; 「表示」と「振る舞い」の役割で分類する&lt;/li>
&lt;/ul>
&lt;p>ここでは、それぞれに関して概要をざっと眺めた上で、Next.js プロジェクトにどんな形で適用していけばいいかを考えてみます。&lt;/p>
&lt;h2 id="atomic-design-とは">Atomic Design とは&lt;/h2>
&lt;p>Web デザインにおける UI コンポーネントの分割粒度の考え方として、Brad Frost 氏の &lt;strong>Atomic Design&lt;/strong> があります。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://bradfrost.com/blog/post/atomic-web-design/">Atomic Design - Brad Frost 氏のブログ記事&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://atomicdesign.bradfrost.com/table-of-contents/">Atomic Design - 書籍版（Webで読めます）&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Atomic Design では、UI コンポーネントを粒度の小さい順に次のように分類します。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="700" height="191" src="../../p/4is2ahp/img-001_hu4688837743272608693.png" alt="/p/4is2ahp/img-001.png" />
 &lt;figcaption>図: Atomic Design の 5 つのレベル（Brad Frost 氏のブログより）&lt;/figcaption>
&lt;/figure>

&lt;ul>
&lt;li>&lt;strong>Atoms（原子）&lt;/strong> &amp;hellip; これ以上分割できない単位（例: ラベル、入力、ボタン）&lt;/li>
&lt;li>&lt;strong>Molecules（分子）&lt;/strong> &amp;hellip; 意味のある UI パーツ単位 （例: 検索フォーム (ラベル + 入力 + ボタン)）&lt;/li>
&lt;li>&lt;strong>Organisms（有機体、生物）&lt;/strong> &amp;hellip; ページの一部分を構成する。Molecules をどう組み合わせるべきかという、アプリドメインの知識が入ってくる。&lt;/li>
&lt;li>&lt;strong>Templates（テンプレート）&lt;/strong> &amp;hellip; ページ全体のレイアウト。最初はプレースホルダーだらけかもしれないが、徐々に具体的な Organisms が配置されて最終形態に近づいていく。&lt;/li>
&lt;li>&lt;strong>Pages（ページ）&lt;/strong> &amp;hellip; Templates に具体的なデータを入れたもの（特定のページ）。&lt;/li>
&lt;/ul>
&lt;p>よく Organisms の扱いで迷うようですが、汎用性の側面から次のような感じで分類すると、プロジェクト内でコンポーネントを整理しやすくなります。
Pages に関しては、Templates に対してデータを流し込んだものなので、ここでは省略しています。&lt;/p></description></item><item><title>Next.js でハッシュフラグメントを扱う（useHash カスタムフック）</title><link>https://maku.blog/p/k2ahpw5/</link><pubDate>Mon, 28 Jun 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/k2ahpw5/</guid><description>&lt;h2 id="ハッシュフラグメントとは">ハッシュフラグメントとは&lt;/h2>
&lt;p>URL のハッシュフラグメントというのは、下記のような URL の末尾の &lt;code>#&lt;/code> 以降の部分を指します。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">https://examle.com/sample#AAA&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>似たようなものにクエリパラメーター（&lt;code>?key=val&lt;/code> のみたいなの）もありますが、ハッシュフラグメントは HTTP リクエスト時に、その文字列（上記の例では &lt;code>AAA&lt;/code>）がサーバーに送られないという違いがあります。
つまり、ハッシュフラグメントの値は、クライアントサイドで使用することが意図されています。&lt;/p>
&lt;h2 id="usehash-フックの実装">useHash フックの実装&lt;/h2>
&lt;p>下記の &lt;code>useHash&lt;/code> 関数は、Next.js でハッシュフラグメントを簡単に扱えるようにするカスタムフックの例です。
&lt;code>useState&lt;/code> フックと同じ感覚で使えるように、ハッシュフラグメントの現在値と、設定用の関数をペアで返します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">src/libs/useHash.ts&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">useCallback&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">useRouter&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next/router&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * URL のハッシュフラグメント部分を扱うためのフックです。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * 次のようにすると、`hash` 変数に URL の `#` 以降の値が格納されます。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * URL の `#` 以降の値を変更したいときは、`setHash` 関数を使用します。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * const [hash, setHash] = useHash()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * ```
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">useHash&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">newHash&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="k">void&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">router&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useRouter&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">hash&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">extractHash&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">router&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">asPath&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">setHash&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useCallback&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">newHash&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ブラウザの履歴に残すなら、ここを router.push に変えれば OK
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">router&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">replace&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">hash&lt;/span>: &lt;span class="kt">newHash&lt;/span> &lt;span class="p">},&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">shallow&lt;/span>: &lt;span class="kt">true&lt;/span> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="p">[])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">hash&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setHash&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// URL の # 以降の文字列を取り出すユーティリティ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="nx">extractHash&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">url&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">url&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#&amp;#39;&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">??&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>やっていることは簡単で、&lt;code>router.asPath&lt;/code> から抽出したハッシュフラグメントの値を返しているだけです。
レンダリングのたびに値を抽出して返そうとしますが、まぁこれくらいはよいかなと(^^;&lt;/p></description></item><item><title>Next.js で環境変数を扱う (.env, NEXT_PUBLIC, NODE_ENV)</title><link>https://maku.blog/p/gbpeyov/</link><pubDate>Mon, 28 Jun 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/gbpeyov/</guid><description>&lt;h2 id="nextjs-アプリ内での環境変数の振る舞い">Next.js アプリ内での環境変数の振る舞い&lt;/h2>
&lt;h3 id="processenv-の振る舞い">process.env の振る舞い&lt;/h3>
&lt;p>Node.js の &lt;strong>&lt;code>process.env&lt;/code>&lt;/strong> による環境変数の参照が有効なのは、基本的には次のようなサーバーサイドで実行されるコード内のみです。&lt;/p>
&lt;ul>
&lt;li>ビルド時あるいはアクセス時に呼び出される &lt;code>getStaticPaths&lt;/code> や &lt;code>getStaticProps&lt;/code>&lt;/li>
&lt;li>必ずアクセス時に呼び出される &lt;code>getServerSideProps&lt;/code>&lt;/li>
&lt;li>必ずアクセス時に呼び出される API ルートのハンドラ関数 (&lt;code>handler&lt;/code>)&lt;/li>
&lt;/ul>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">src/pages/sample.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">getStaticProps&lt;/span>: &lt;span class="kt">GetStaticProps&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">PageProps&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="nx">context&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// このコードはビルド時に実行されるので環境変数を参照できる
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">process&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">env&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">VAR_NAME&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">props&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{}&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="next_public-プレフィックス">NEXT_PUBLIC プレフィックス&lt;/h3>
&lt;p>ただし、例外として、&lt;strong>&lt;code>NEXT_PUBLIC_&lt;/code>&lt;/strong> で始まる環境変数を &lt;code>process.env.NEXT_PUBLIC_XXX&lt;/code> のように参照すると、&lt;code>next build&lt;/code> によるビルド時に変数値がインライン展開されるので、クライアントサイドで実行されるコード（コンポーネントの実装内）から参照できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">src/pages/sample.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">SamplePage&lt;/span>: &lt;span class="kt">FC&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">&amp;lt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Public&lt;/span> &lt;span class="nx">env&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">process&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">env&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">NEXT_PUBLIC_ANALYTICS_ID&lt;/span>&lt;span class="p">}&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Private&lt;/span> &lt;span class="nx">env&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">process&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">env&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">API_SECRET_KEY&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="err">（必ず空っぽ）&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記のようにすると、&lt;code>process.env.NEXT_PUBLIC_ANALYTICS_ID&lt;/code> の部分には、ビルド時の環境変数 &lt;code>NEXT_PUBLIC_ANALYTICS_ID&lt;/code> の値がそこに埋め込まれ、&lt;code>process.env.API_SECRET_KEY&lt;/code> の方は必ず &lt;code>undefined&lt;/code> になります（何も表示されない）。&lt;/p>
&lt;p>サーバーサイドでしか参照しない環境変数（シークレットキーなど）には、&lt;code>NEXT_PUBLIC_&lt;/code> プレフィックスを付けないように注意してください。&lt;/p>
&lt;h2 id="env-envlocal-ファイル">.env (.env.local) ファイル&lt;/h2>
&lt;p>Next.js サーバーは、デフォルトでプロジェクトルートに配置した &lt;strong>&lt;code>.env&lt;/code>&lt;/strong> や &lt;strong>&lt;code>.env.local&lt;/code>&lt;/strong> といった名前のファイルを読み込んで、&lt;code>process.env.XXX&lt;/code> で参照可能な状態にしてくれます。
ローカル開発中に、一時的にテスト用のリソースサーバーに繋ぎたいときなどに便利です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">.env.local&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">DB_HOST=localhost
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DB_USER=myuser
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DB_PASS=mypassword&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これらの設定ファイルの中では、次のように &lt;code>$VAR&lt;/code> という形の変数展開を行えるようになっています。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">HOSTNAME=localhost
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PORT=8080
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">HOST=http://$HOSTNAME:$PORT&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>.local&lt;/code> サフィックスが付いている方のファイルは、「Git などにコミットしないファイルですよ」という Next.js での取り決めですね。
Next.js は他にも実行環境に応じて色々な名前の環境設定ファイルを読み込むようになっています。
下記は、どのファイルがどの環境で読み込まれるかの一覧です。&lt;/p></description></item><item><title>Next.js のコンポーネント内でクエリ文字列を取得する (next/router, useRouter)</title><link>https://maku.blog/p/r7fou3a/</link><pubDate>Sun, 27 Jun 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/r7fou3a/</guid><description>&lt;h2 id="クエリ文字列とは">クエリ文字列とは&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">https://example.com/todos?sortby=title&amp;amp;order=asc&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>URL のクエリ文字列（クエリパラメーター）というのは、上記のような URL の末尾の &lt;code>?&lt;/code> 以降の、&lt;code>sortby=title&amp;amp;order=asc&lt;/code> の部分のことを指します。
この部分を参照する方法としては、主に次の 2 種類の方法があります。&lt;/p>
&lt;ul>
&lt;li>クライアントサイド JS &amp;hellip; &lt;code>useRouter&lt;/code> フックを使う&lt;/li>
&lt;li>サーバーサイド JS &amp;hellip; &lt;code>getServerSideProps&lt;/code> に渡されるパラメーターを使う&lt;/li>
&lt;/ul>
&lt;h2 id="クライアントサイド-js-からクエリパラメーターを参照する-routerquery">クライアントサイド JS からクエリパラメーターを参照する (router.query)&lt;/h2>
&lt;p>Next.js の &lt;a href="https://nextjs.org/docs/api-reference/next/router">useRouter フック&lt;/a> を使うと、上記のようなクエリパラメーター部分を簡単に抽出することができます。
次の例では、クエリパラメーターとして渡された &lt;code>sortby&lt;/code> と &lt;code>order&lt;/code> の値を取得しています。
値が省略された場合は、それぞれの値は &lt;code>undefined&lt;/code> になります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">src/pages/todos.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">NextPage&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">useRouter&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next/router&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">TodosPage&lt;/span>: &lt;span class="kt">NextPage&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">router&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useRouter&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">sortby&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">order&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">router&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">query&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">sortby&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 指定されていなければ undefined
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">order&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 指定されていなければ undefined
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;{&lt;/span> &lt;span class="nx">sortby&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="err">で&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">order&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="s1">&amp;#39;asc&amp;#39;&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="s1">&amp;#39;昇順&amp;#39;&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;降順&amp;#39;&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="err">ソートします&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="nx">TodosPage&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ プリレンダリングと hydrate 処理の考慮&lt;/span>
 &lt;span class="xNote_body">&lt;p>Next.js にはページコンポーネントのプリレンダリングの仕組み（あらかじめ JS 部分まで実行して静的な HTML を生成しておく仕組み）があり、その時点では URL のクエリ文字列は参照できないので、&lt;code>router.query&lt;/code> オブジェクトも空っぽになっています。
上記の例で言えば、プリレンダリング時の &lt;code>sortby&lt;/code> や &lt;code>order&lt;/code> の値は &lt;code>undefined&lt;/code> になっているということです。
もちろん、実際にクエリパラメーター付きの URL で Web サイトにアクセスするタイミングでは、クライアントサイドで実行される JavaScript で &lt;code>router.query&lt;/code> の値を参照できるようになっていますが、ページコンポーネントの実装では、クエリ文字列が指定されていない場合のことを考えておくべきです。&lt;/p></description></item><item><title>MUI コンポーネント (v4) に独自のスタイルを設定する (makeStyles)</title><link>https://maku.blog/p/cw9ju6f/</link><pubDate>Sun, 06 Jun 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/cw9ju6f/</guid><description>&lt;p>この記事では、MUI v4 以前の &lt;code>makeStyles()&lt;/code> 関数を使ったカスタムスタイル設定方法を説明しています。
MUI v5 以降のカスタムスタイル設定では &lt;code>sx prop&lt;/code> や &lt;code>styled()&lt;/code> 関数を使用しますので、下記の記事を参照してください。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/87p5o2d/">MUI コンポーネントに独自のスタイルを設定する（v5 以降の sx prop、styled 関数を使う方法）&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="material-ui-コンポーネントのスタイル設定">Material-UI コンポーネントのスタイル設定&lt;/h2>
&lt;p>Material-UI が提供する各種コンポーネントには、表示スタイルを切り替えるためのプロパティが用意されています。
例えば、&lt;a href="https://material-ui.com/components/buttons/">Button コンポーネント&lt;/a> は &lt;code>variant&lt;/code> や &lt;code>color&lt;/code> プロパティで見た目を切り替えることができます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Default&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Button&lt;/span> &lt;span class="na">variant&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;contained&amp;#34;&lt;/span> &lt;span class="na">color&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;primary&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Primary&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Button&lt;/span> &lt;span class="na">variant&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;contained&amp;#34;&lt;/span> &lt;span class="na">color&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;secondary&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Secondary&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Button&lt;/span> &lt;span class="na">variant&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;outlined&amp;#34;&lt;/span> &lt;span class="na">disabled&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Disabled&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>多くのケースでは、この仕組みで十分にスタイル設定できるのですが、デフォルトのスタイルから外れた表示をしたり、&lt;code>div&lt;/code> 要素など Material-UI 以外のコンポーネントに対して独自の CSS を適用したいことがあります。
このような場合、コンポーネントの実装ファイル内に直接 CSS コードを記述してスタイルをカスタマイズできます（JavaScript 内に記述するので &lt;strong>CSS-in-JS&lt;/strong> と呼びます）。
React の世界では色々な CSS 参照方法がありますが、Material-UI は次のような理由で CSS-in-JS な記述方法を採用しています。&lt;/p>
&lt;ul>
&lt;li>現在のテーマ設定に基づいたスタイル設定を行える（例: 基準スペースの2倍のマージンを設定する）&lt;/li>
&lt;li>コンポーネントの &lt;code>props&lt;/code> の値を使って動的にスタイル設定できる（例: &lt;code>&amp;lt;MyButton color=&amp;quot;vivid&amp;quot;&amp;gt;&lt;/code> で派手な色のスタイルを設定する）&lt;/li>
&lt;/ul>
&lt;h2 id="フックによるスタイル設定-makestyle">フックによるスタイル設定 (makeStyle)&lt;/h2>
&lt;p>Material-UI で、コンポーネントに独自スタイルを設定する方法としては、主に次の 3 種類の方法が用意されています。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://material-ui.com/styles/basics/#hook-api">Hook API&lt;/a>
&lt;ul>
&lt;li>&lt;code>makeStyle&lt;/code> 関数で生成したフック関数をコンポーネント内で呼び出す方法。一番よく使われてる。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://material-ui.com/styles/basics/#styled-components-api">Styled components API&lt;/a>
&lt;ul>
&lt;li>既存のコンポーネント (&lt;code>Button&lt;/code> など）をラップする形で、スタイルを適用したコンポーネント（&lt;code>MyButton&lt;/code> など）を作成する方法。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://material-ui.com/styles/basics/#higher-order-component-api">Higher-order component API&lt;/a>
&lt;ul>
&lt;li>Styled components に似てるけど、HoC の仕組みでスタイル設定したコンポーネントを作成する方法。ちょっとわかりにくい。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>ここでは、一番メジャーで分かりやすい、フックを利用したスタイル設定方法を紹介します。
次の例では、Material-UI の &lt;code>Button&lt;/code> コンポーネントに、独自の CSS スタイル（&lt;code>customButton&lt;/code> クラス）を適用しています。&lt;/p></description></item><item><title>Next.js で Material-UI を使う</title><link>https://maku.blog/p/s6djqw3/</link><pubDate>Wed, 02 Jun 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/s6djqw3/</guid><description>&lt;figure class="xImage">
 &lt;img style="" width="1832" height="442" src="../../p/s6djqw3/img-001.png" alt="/p/s6djqw3/img-001.png" />
&lt;/figure>

&lt;p>&lt;a href="https://material-ui.com/">Material-UI&lt;/a> は、マテリアルデザインを提供する React コンポーネントライブラリです。&lt;/p>
&lt;h2 id="material-ui-のインストール">Material-UI のインストール&lt;/h2>
&lt;p>Material-UI のコアパッケージ (&lt;code>@material-ui/core&lt;/code>) は、&lt;code>npm&lt;/code> コマンドで簡単にインストールできます。
&lt;a href="https://material-ui.com/components/icons/">マテリアルデザイン系のアイコン&lt;/a> を使いたい場合は、&lt;code>@material-ui/icons&lt;/code> パッケージもインストールしておきます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">### yarn の場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ yarn add @material-ui/core
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ yarn add @material-ui/icons
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">### npm の場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ npm install @material-ui/core
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ npm install @material-ui/icons&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>Next.js の &lt;code>create-next-app&lt;/code> コマンドでプロジェクトを作成済みであれば、これだけで Material-UI コンポーネントを使う準備は完了です。
Material-UI のデフォルトテーマは &lt;a href="https://material-ui.com/components/typography/#general">Roboto フォントを使用する&lt;/a> ので、次のようなコードを &lt;code>head&lt;/code> 要素内に記述する必要がありますが、これは後述の &lt;code>_document.tsx&lt;/code> で設定します。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">link&lt;/span> &lt;span class="na">rel&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;stylesheet&amp;#34;&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&amp;amp;display=swap&amp;#34;&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>Material-UI は font weight に 300/400/500/700 のいずれかを使用するので、上記のように読み込むデータを制限することで、ロード時間を削減できます。&lt;/p>
&lt;h2 id="material-ui-のコンポーネントを使ってみる">Material-UI のコンポーネントを使ってみる&lt;/h2>
&lt;p>Material-UI のインストールができたら、あとは、各コンポーネントの実装ファイルから &lt;code>import&lt;/code> するだけで使用できます。
次の例では、&lt;a href="https://material-ui.com/components/buttons/">Button&lt;/a> コンポーネントと、&lt;a href="https://material-ui.com/components/button-group/">ButtonGroup&lt;/a> コンポーネントを使っています。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="524" height="97" src="../../p/s6djqw3/img-002_hu17258122955497817817.png" alt="/p/s6djqw3/img-002.png" />
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">pages/index.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">Button&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ButtonGroup&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@material-ui/core&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">Home() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">style&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{{&lt;/span> &lt;span class="nx">margin&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;0.5em&amp;#39;&lt;/span> &lt;span class="p">}}&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Button&lt;/span> &lt;span class="na">variant&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;contained&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Default&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;{&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Button&lt;/span> &lt;span class="na">variant&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;contained&amp;#34;&lt;/span> &lt;span class="na">color&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;primary&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Primary&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;{&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Button&lt;/span> &lt;span class="na">variant&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;contained&amp;#34;&lt;/span> &lt;span class="na">color&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;secondary&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Secondary&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;{&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Button&lt;/span> &lt;span class="na">variant&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;contained&amp;#34;&lt;/span> &lt;span class="na">disabled&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Disabled&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;{&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Button&lt;/span> &lt;span class="na">variant&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;contained&amp;#34;&lt;/span> &lt;span class="na">color&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;primary&amp;#34;&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://google.com/&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">LINK&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">style&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{{&lt;/span> &lt;span class="nx">margin&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;0.5em&amp;#39;&lt;/span> &lt;span class="p">}}&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">ButtonGroup&lt;/span> &lt;span class="na">variant&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;contained&amp;#34;&lt;/span> &lt;span class="na">color&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;primary&amp;#34;&lt;/span> &lt;span class="na">aria-label&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;contained primary button group&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">One&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Two&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nx">Three&lt;/span>&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Button&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">ButtonGroup&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="nextjs-用の-app--document-コンポーネント設定">Next.js 用の App / Document コンポーネント設定&lt;/h2>
&lt;p>Material-UI を Next.js アプリから使用する場合は、サーバーサイドレンダリングとの兼ね合いで、&lt;strong>&lt;code>pages/_app.tsx&lt;/code>&lt;/strong> と &lt;strong>&lt;code>pages/_document.tsx&lt;/code>&lt;/strong> を作成して、スタイル定義の処理順序を制御しておく必要があります。
これを入れておかないと、&lt;a href="../../p/cw9ju6f">makeStyle などを使ったスタイル設定&lt;/a> がうまく反映されず、次のようなエラーになったりします。&lt;/p></description></item><item><title>Next.js で Bootstrap と React Bootstrap を使う</title><link>https://maku.blog/p/k8mxakw/</link><pubDate>Mon, 10 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/k8mxakw/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>Next.js アプリから、CSS フレームワークの Bootstrap を使えるようにする方法を説明します。&lt;/p>
&lt;ol>
&lt;li>&lt;a href="https://getbootstrap.com/">Bootstrap&lt;/a> を導入
&lt;ul>
&lt;li>各コンポーネントの実装で、Bootstrap の CSS クラスを参照できるようにします&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://react-bootstrap.github.io/">React Bootstrap&lt;/a> を導入
&lt;ul>
&lt;li>Bootstrap を React コンポーネントの形で使えるようにします&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="bootstrap-を導入する">Bootstrap を導入する&lt;/h2>
&lt;h3 id="bootstrap-モジュールをインストールする方法">bootstrap モジュールをインストールする方法&lt;/h3>
&lt;p>Bootstrap は &lt;code>npm install&lt;/code> で簡単にインストールできます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ npm install bootstrap@next --save&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>あとは、次のような &lt;strong>&lt;code>pages/_app.tsx&lt;/code>&lt;/strong> ファイルを作成して、グローバル CSS としてインポートすれば OK です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">pages/_app.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="kr">type&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">AppProps&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next/app&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="s1">&amp;#39;bootstrap/dist/css/bootstrap.min.css&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">MyApp&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">Component&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">pageProps&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">AppProps&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Component&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="na">...pageProps&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これで、各ページコンポーネントから Bootstrap の CSS クラスを参照できるようになります。&lt;/p>
&lt;h3 id="cdn-上のファイルを参照する方法">CDN 上のファイルを参照する方法&lt;/h3>
&lt;p>CDN 上で公開されている Bootstrap ファイルを参照することもできます。
&lt;strong>&lt;code>pages/_app.tsx&lt;/code>&lt;/strong> ファイルを作成して、次のように Bootstrap の CSS ファイルを読み込みます。
これで、各ページの &lt;code>head&lt;/code> 要素内に &lt;code>link&lt;/code> 要素が追加されます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">pages/_app.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="kr">type&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">AppProps&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next/app&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">Head&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next/head&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">MyApp&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">Component&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">pageProps&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">AppProps&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">&amp;lt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Head&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">&amp;lt;!-- Bootstrap CSS --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">link&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">rel&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;stylesheet&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">integrity&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">crossOrigin&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;anonymous&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">link&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Head&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Component&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="na">...pageProps&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>最新の CDN アドレスは、&lt;a href="https://getbootstrap.jp/docs/5.0/getting-started/introduction/">Bootstrap のサイト&lt;/a> で確認してください。
一点注意なのは、JSX では &lt;code>crossorigin&lt;/code> 属性は &lt;strong>&lt;code>crossOrigin&lt;/code>&lt;/strong> のように &lt;code>O&lt;/code> を大文字にしないといけないというところです。
Bootstrap の高度なコンポーネントを使うときは、JavaScript ファイルも必要なことがあります。
その場合は、&lt;code>Component&lt;/code> 要素の後ろあたりに &lt;code>script&lt;/code> 要素を追加すれば OK です。&lt;/p></description></item><item><title>Next.js でサーバーサイドで JSON や YAML ファイルを読み込む (fs.readFileSync)</title><link>https://maku.blog/p/iz8fnu3/</link><pubDate>Sun, 09 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/iz8fnu3/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>Next.js アプリのページコンポーネントの &lt;code>getStaticProps&lt;/code> / &lt;code>getServerSideProps&lt;/code> 関数や、API ルート (&lt;code>pages/api/*.ts&lt;/code>) の &lt;code>handler&lt;/code> 関数は、クライアントからのアクセス時やビルド時に、サーバーサイドで呼び出されます。
つまり、これらの関数の中では、Node.js の &lt;code>fs&lt;/code> モジュールを使った（サーバー上の）ローカルファイルの読み込みが可能です。&lt;/p>
&lt;p>ここでは、例として、&lt;/p>
&lt;ol>
&lt;li>ページコンポーネントの &lt;code>getStaticProps&lt;/code> 関数から JSON ファイルを読み込む方法&lt;/li>
&lt;li>API ルートの &lt;code>handler&lt;/code> 関数から YAML ファイルを読み込む方法&lt;/li>
&lt;/ol>
&lt;p>を紹介します。&lt;/p>
&lt;h2 id="json-ファイルを読み込むin-getstaticprops-関数">JSON ファイルを読み込む（in getStaticProps 関数）&lt;/h2>
&lt;h3 id="使用する-json-ファイル">使用する JSON ファイル&lt;/h3>
&lt;p>サンプルデータとして次のような JSON ファイルをプロジェクト内に配置します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">src/data/games.json&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span> &lt;span class="nt">&amp;#34;id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;dq1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nt">&amp;#34;title&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;ドラゴンクエスト&amp;#34;&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span> &lt;span class="nt">&amp;#34;id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;dq2&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nt">&amp;#34;title&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;ドラゴンクエスト2&amp;#34;&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span> &lt;span class="nt">&amp;#34;id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;dq3&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nt">&amp;#34;title&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;ドラゴンクエスト3&amp;#34;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="json-ファイルを読み込む">JSON ファイルを読み込む&lt;/h3>
&lt;p>次のコードでは、&lt;code>getStaticProps&lt;/code> 関数の中で &lt;code>src/data/games.json&lt;/code> ファイルを読み込んで、ページコンポーネントに渡す &lt;code>props&lt;/code> データを作成しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">src/pages/games.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">fs&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;fs&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">path&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;path&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">GetStaticProps&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">NextPage&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">type&lt;/span> &lt;span class="nx">Game&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">id&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">title&lt;/span>: &lt;span class="kt">string&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">type&lt;/span> &lt;span class="nx">PageProps&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">games&lt;/span>: &lt;span class="kt">Game&lt;/span>&lt;span class="p">[]&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">getStaticProps&lt;/span>: &lt;span class="kt">GetStaticProps&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">PageProps&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// JSON ファイルを読み込む
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">jsonPath&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">path&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">process&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">cwd&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="s1">&amp;#39;src&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;data&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;games.json&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">jsonText&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">fs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">readFileSync&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">jsonPath&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">games&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">JSON&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">jsonText&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">Game&lt;/span>&lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ページコンポーネントに渡す props オブジェクトを設定する
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">props&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">games&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">GamesPage&lt;/span>: &lt;span class="kt">NextPage&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">PageProps&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">({&lt;/span> &lt;span class="nx">games&lt;/span> &lt;span class="p">}&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">PageProps&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="nx">GamesPage&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>JSON 形式のテキストは、JavaScript 標準の &lt;code>JSON.parse&lt;/code> 関数でオブジェクトに変換することができるので、プログラム内での扱いはお手軽です。&lt;/p></description></item><item><title>Next.js の Image コンポーネントで画像を表示する (next/image)</title><link>https://maku.blog/p/fw7gpx7/</link><pubDate>Thu, 06 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/fw7gpx7/</guid><description>&lt;h2 id="image-コンポーネントの特徴">Image コンポーネントの特徴&lt;/h2>
&lt;p>Next.js が提供している &lt;a href="https://nextjs.org/docs/api-reference/next/image">Image コンポーネント (&lt;code>next/image&lt;/code>)&lt;/a> を使用すると、&lt;code>image&lt;/code> 要素をそのまま配置するのに比べて次のような恩恵を受けられます。&lt;/p>
&lt;ul>
&lt;li>遅延ロード (Lazy loading)
&lt;ul>
&lt;li>Web ブラウザでその画像がビューポート内（画面内）に入って来たときに初めてダウンロードされるようになります。大きなページの末尾部分に配置された画像が、無駄にダウンロードされてしまうのを防ぐことができます。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>画像の最適化
&lt;ul>
&lt;li>アクセスしてきたクライアントに応じて画像ファイルを最適化して配信します。例えば、圧縮効率のよい WebP フォーマットなどに変換してくれます。リクエスト時にサーバーサイドでオンデマンドで最適化するため、&lt;code>Image&lt;/code> コンポーネントを使うことでビルド時間が伸びてしまうことはありません。外部サーバーの画像を間接的に表示する場合も最適化できます。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>レスポンシブ
&lt;ul>
&lt;li>画面サイズに応じたレスポンシブ表示 (CSS) がデフォルトで行われます。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>画像最適化に関しては、Next.js サーバー上でホスティングしているときしか動作しないといった制約がありますが、遅延ローディングがデフォルトで有効になるのは便利です。&lt;/p>
&lt;h2 id="image-コンポーネントの基本的な使い方">Image コンポーネントの基本的な使い方&lt;/h2>
&lt;p>次のサンプルコンポーネントでは、&lt;code>Image&lt;/code> コンポーネントを使って &lt;strong>&lt;code>/public/images/avatar.png&lt;/code>&lt;/strong> ファイルを表示しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">components/Avatar.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-tsx" data-lang="tsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">Image&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;next/image&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">Avatar&lt;/span>: &lt;span class="kt">React.FC&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Image&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/images/avatar.png&amp;#34;&lt;/span> &lt;span class="na">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="na">height&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="na">alt&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;My avatar&amp;#34;&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ public ディレクトリ&lt;/span>
 &lt;span class="xNote_body">&lt;code>public&lt;/code> ディレクトリ以下に配置したファイルは、Web サイトへのアクセス時には、ルートパス (&lt;code>/&lt;/code>) からの相対パスで参照できるようになります。
&lt;code>public&lt;/code> ディレクトリは、必ず Next.js プロジェクトのルートディレクトリに配置する必要があります。
&lt;code>.ts&lt;/code>、&lt;code>.tsx&lt;/code> ファイルは &lt;code>src&lt;/code> ディレクトリ以下にも配置できますが、&lt;code>public&lt;/code> ディレクトリは必ずルートに置かなければいけません。&lt;/span>
&lt;/div>
&lt;p>&lt;code>width&lt;/code> や &lt;code>height&lt;/code> プロパティを明示しておくと、画像のロード前にそのサイズの枠が確保されることになります。
これは、&lt;a href="https://web.dev/cls/">CLS (Cumulative Layout Shift)&lt;/a> を発生させないために重要です。
表示サイズがあらかじめ決まっていないと、画像ロード後にレイアウトがガクッとずれたりして UX が低下します。
Google によるサイト評価でも CLS スコアは重要視されています。&lt;/p>
&lt;h2 id="image-コンポーネントによる画像の拡大縮小">Image コンポーネントによる画像の拡大・縮小&lt;/h2>
&lt;h3 id="指定したサイズに拡大縮小-width-height">指定したサイズに拡大・縮小 (width, height)&lt;/h3>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="300" height="150" src="../../p/fw7gpx7/img-001_hu1780983531491017964.png" alt="/p/fw7gpx7/img-001.png" />
&lt;/figure>


&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Image&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/images/sample.png&amp;#34;&lt;/span> &lt;span class="na">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">300&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="na">height&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="mi">150&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>一番基本的な使い方です。
&lt;code>Image&lt;/code> コンポーネント内に表示される画像は、デフォルトで &lt;code>Image&lt;/code> コンポーネント自体のサイズ、つまり、&lt;code>width&lt;/code>、&lt;code>height&lt;/code> プロパティで指定したサイズに拡大・縮小されて表示されます。
画像ファイルのアスペクト比を考慮して指定しないと、上の例のように変形して表示されてしまうので注意してください。&lt;/p></description></item></channel></rss>