<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>YAML on まくろぐ</title><link>https://maku.blog/tags/yaml/</link><description>Recent content in YAML on まくろぐ</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Mon, 25 Sep 2023 00:00:00 +0900</lastBuildDate><atom:link href="https://maku.blog/tags/yaml/index.xml" rel="self" type="application/rss+xml"/><item><title>Svelte 入門: YAML ファイルをインポートして使う</title><link>https://maku.blog/p/umhwooq/</link><pubDate>Mon, 25 Sep 2023 00:00:00 +0900</pubDate><guid>https://maku.blog/p/umhwooq/</guid><description>&lt;h2 id="svelte-で-yaml-ファイルをインポートして使う方法">Svelte で YAML ファイルをインポートして使う方法&lt;/h2>
&lt;p>Svelte (SvelteKit) には YAML ファイルを直接インポートして JavaScript オブジェクトして扱う仕組みはありませんが、&lt;code>raw&lt;/code> インポートの仕組みを使えば、YAML ファイルを文字列データとしてそのまま読み込むことができます（これは SvelteKit がビルドに使っている Vite の仕組みです）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">YAML ファイルを文字列としてインポートする&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">gamesYaml&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s1">&amp;#39;$lib/assets/games.yaml?raw&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>このようにして読み込んだ YAML テキストを、Node.js の YAML ライブラリなどでパースすれば、YAML ファイルの内容を JavaScript オブジェクトとして扱うことができます。
ビルド時に処理を完結させることができるので、例えば、&lt;a href="../../p/4oudmxy/">static-adapter を使った静的ビルド (SSG)&lt;/a> が必要な環境でも利用できます。&lt;/p>
&lt;h2 id="実装例">実装例&lt;/h2>
&lt;p>YAML ファイルを扱うために &lt;code>js-yaml&lt;/code> ライブラリを使うので、次のようにしてインストールしておきます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">js-yaml（およびその型ファイル）のインストール&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> npm install --save-dev js-yaml @types/js-yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>サンプルの YAML ファイルとして、下記のようなゲームソフト情報を含んだ &lt;code>games.yaml&lt;/code> を使います。
この YAML ファイルはビルド時にインポートするので、&lt;code>static&lt;/code> ディレクトリではなく &lt;code>src&lt;/code> ディレクトリのどこかに配置します（ここでは、&lt;code>lib/assets&lt;/code> というディレクトリに配置しています）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">src/lib/assets/games.yaml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">- &lt;span class="nt">title&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">シャドウラン&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">date&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="ld">1996-02-23&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">price&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">7800&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">title&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">トムキャットアレイ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">date&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="ld">1994-12-22&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">price&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">7800&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">title&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">真・女神転生&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">date&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="ld">1994-02-25&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>次の Svelte コンポーネントでは、ビルド時に YAML ファイルを読み込んで、JavaScript オブジェクトと扱えるようにしていします。
実装には TypeScript を使っていますが、&lt;code>raw&lt;/code> インポートした YAML ファイルからは型情報を推測してくれないようなので、自分で &lt;code>Game&lt;/code> 型を定義しています。&lt;/p></description></item><item><title>VS Code で YAML ファイルの構文をチェックする（YAML 拡張）</title><link>https://maku.blog/p/c7sp7ut/</link><pubDate>Wed, 19 Apr 2023 00:00:00 +0900</pubDate><guid>https://maku.blog/p/c7sp7ut/</guid><description>&lt;h2 id="yaml-拡張とは">YAML 拡張とは？&lt;/h2>
&lt;p>VS Code の &lt;a href="https://marketplace.visualstudio.com/items?itemName=redhat.vscode-yaml">YAML 拡張 (redhat.vscode-yaml)&lt;/a> をインストールすると、スキーマ定義に基づいて、YAML ファイルの記述内容が正しいかをチェックすることができます。
スキーマ定義を &lt;a href="https://json-schema.org/">JSON スキーマファイル&lt;/a> の形で作成し、YAML ファイルの先頭に次のようなコメントを記述することで適用できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">YAML ファイルの先頭に追加&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># yaml-language-server: $schema=./schema.json&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>YAML ファイルの構文チェックなのに JSON スキーマ？と思うかもしれませんが、YAML と JSON のデータ形式には互換性があるので、スキーマは JSON スキーマでよいんですね。&lt;/p>
&lt;h2 id="スキーマによる-yaml-ファイルの構文チェック">スキーマによる YAML ファイルの構文チェック&lt;/h2>
&lt;h3 id="公開スキーマファイルを参照する">公開スキーマファイルを参照する&lt;/h3>
&lt;p>スキーマファイルは、インターネット上に公開されているものを URL で指定できるようになっています。
有名どころの設定ファイルのスキーマは、下記のサイトに一覧があるので、いろいろなプロジェクトからそのまま利用できます。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.schemastore.org/json/">JSON Schema Store&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Ansible Playbook など、内容が複雑になりがちな YAML ファイルに設定しておくと役に立ちそうです。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">playbook.yml（の先頭に記述する）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># yaml-language-server: $schema=https://raw.githubusercontent.com/ansible/ansible-lint/main/src/ansiblelint/schemas/ansible.json&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>GitHub Actions のワークフローファイル (&lt;code>.github/workflows/*.yml&lt;/code>) などは、そのファイルパスから、どのスキーマを使用すればいいかを推測できるので、上記のようなコメント行すら記述せずに自動的に &lt;a href="https://json.schemastore.org/github-workflow.json">GitHub Actions 用のスキーマ&lt;/a> を適用してくれます。
つまり、VS Code に YAML 拡張をインストールするだけで、GitHub Actions のワークフローファイルの構文チェックが有効になります。
便利！&lt;/p>
&lt;h3 id="独自定義したスキーマファイルを参照する">独自定義したスキーマファイルを参照する&lt;/h3>
&lt;p>アプリケーション独自の設定ファイルやデータファイルを YAML 形式で作成する場合は、そのスキーマも独自であることが多いので、専用の JSON スキーマファイルを作成することになるでしょう。
例えば、次の JSON スキーマファイルでは、ユーザー情報を表現するためのスキーマを定義しています（コメントを記述できるようにするために、拡張子を &lt;code>.jsonc&lt;/code> としています）。&lt;/p></description></item><item><title>VS Code で YAML ファイルをソートする（YAML Sort 拡張）</title><link>https://maku.blog/p/2apzood/</link><pubDate>Wed, 19 Apr 2023 00:00:00 +0900</pubDate><guid>https://maku.blog/p/2apzood/</guid><description>&lt;h2 id="yaml-sort-の概要">YAML Sort の概要&lt;/h2>
&lt;p>VS Code に &lt;a href="https://marketplace.visualstudio.com/items?itemName=PascalReitermann93.vscode-yaml-sort">YAML Sort 拡張&lt;/a> をインストールすると、YAML ファイルの内容をキー名でソートすることができます。
主にソート用に使うものですが、YAML フォーマッターとしても利用できます。
次のような簡単なカスタマイズを行うこともできます。&lt;/p>
&lt;ul>
&lt;li>指定したキーを優先的に上から並べる&lt;/li>
&lt;li>1 階層目の各キーの間に空白行を入れる&lt;/li>
&lt;li>リスト要素をソートする&lt;/li>
&lt;/ul>
&lt;h2 id="yaml-sort-の使い方">YAML Sort の使い方&lt;/h2>
&lt;p>&lt;a href="https://marketplace.visualstudio.com/items?itemName=PascalReitermann93.vscode-yaml-sort">YAML Sort&lt;/a> のページで &lt;code>Install&lt;/code> ボタンを押すだけで、VS Code への拡張のインストールは完了です。
ここでは、次のような YAML ファイルをソートしてみます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.yml（ソート前）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">root2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ccc&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">300&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">aaa&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">100&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">bbb&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">200&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">root1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fruits&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">grape&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">apple&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">banana&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">animals&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;wolf&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;fox&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;dolphin&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;eagle&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>VS Code で YAML ファイルを開いた状態で、コマンドパレットを開いて (&lt;strong>&lt;code>Ctrl/Cmd + Shift + P&lt;/code>&lt;/strong>)、&lt;strong>&lt;code>YAML Sort: Sort YAML&lt;/code>&lt;/strong> を選択すると、YAML ファイルの内容がソートされます。&lt;/p></description></item></channel></rss>