<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>AWS on まくろぐ</title><link>https://maku.blog/tags/aws/</link><description>Recent content in AWS on まくろぐ</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Sun, 05 Jan 2025 00:00:00 +0900</lastBuildDate><atom:link href="https://maku.blog/tags/aws/index.xml" rel="self" type="application/rss+xml"/><item><title>Amazon Cognito (1) サインイン可能な Web サイトを作る (Cognito User Pool)</title><link>https://maku.blog/p/pufs8kx/</link><pubDate>Fri, 28 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/pufs8kx/</guid><description>&lt;h2 id="cognito-とは">Cognito とは？&lt;/h2>
&lt;p>&lt;a href="https://aws.amazon.com/jp/cognito/">Amazon Cognito&lt;/a> は、各種アプリケーションにユーザーの概念を取り入れて、サインアップやサインインなどを行えるようにするサービスです（OpenID Connect 準拠の Identity Provider (IdP) のひとつです）。
Cognito は大きく下記の 2 つの機能から成ります。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ユーザープール&lt;/strong>: ユーザーを管理する。任意のアプリに、ユーザー登録（サインアップ）や、認証（サインイン）の機能を付けることができる。&lt;/li>
&lt;li>&lt;strong>ID プール&lt;/strong>: 上記の仕組みでサインインしたユーザーに対して、AWS サービスへのアクセス権限を付加する。&lt;/li>
&lt;/ul>
&lt;p>単純にユーザー管理だけをしたいのであれば、前者の「ユーザープール」の機能だけを使うことができます。
実際には、認証後に AWS のリソースにアクセスさせることが多いと思いますので、後者の「ID プール」の仕組みを使って IAM の権限割り当てを行うことになります。&lt;/p>
&lt;p>認証の仕組みに関しては、5 万 MAU（月間アクティブユーザー）まで無料で使えるので、個人で作成しているアプリでも使いやすいと思います。
ただし、無料枠を超えると 1 ユーザーあたり 1 円くらいかかり、多要素認証などを使おうとするともう少しお金がかかります。
詳しくは、&lt;a href="https://aws.amazon.com/jp/cognito/pricing/">Cognito の料金&lt;/a>）のページを参照してください。&lt;/p>
&lt;p>通常、Web サイトに認証機能を付けたいと思うと、ユーザー管理の仕組みや、サインイン画面などの UI を作成する必要がありますが、Cognito はこれらをまとめて提供してくれます。
ここでは、Cognito のユーザープールの作成から、React アプリでの認証までを説明します。&lt;/p>
&lt;h2 id="cognito-にユーザープールを作成する">Cognito にユーザープールを作成する&lt;/h2>
&lt;p>準備として、Cognito のユーザープールを作成しておきます。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="600" height="248" src="../../p/pufs8kx/img-001_hu3076329424299191530.png" alt="/p/pufs8kx/img-001.png" />
&lt;/figure>

&lt;ol>
&lt;li>&lt;a href="https://console.aws.amazon.com/cognito/home">Cognito のマネージメントコンソール&lt;/a>にアクセス&lt;/li>
&lt;li>&lt;code>ユーザープールの管理&lt;/code> → &lt;code>ユーザープールを作成する&lt;/code> を選択します&lt;/li>
&lt;li>ユーザー作成時の条件 (Attribute) などを設定して作成ボタンを押します&lt;/li>
&lt;/ol>
&lt;p>プール名は、適当に &lt;strong>&lt;code>myapp-test&lt;/code>&lt;/strong> とでも付けておけば大丈夫です。
本番環境用のユーザープールと、開発／テスト用のユーザープールは分けて作っておくのがよいので、ここではサフィックスとして &lt;code>-test&lt;/code> を付けておきました。
デフォルト設定でサクッと作成してしまうこともできるし、いろいろな条件（メールアドレス必須とかパスワード強度とか）を指定することもできます。
ここでは、とりあえずデフォルト設定で適当に作成してしまいましょう。
ユーザー名でなく、メールアドレスでもログインできるようにしたいときは、&lt;code>属性 (Attribte)&lt;/code> のタブで、&lt;strong>&lt;code>ユーザー名 - 検証済みの E メールアドレスでのサインインも許可&lt;/code>&lt;/strong> にチェックをいれておきます。&lt;/p></description></item><item><title>Amazon Cognito (1) サインイン可能な Web サイトを作る (Cognito User Pool)</title><link>https://maku.blog/p/pufs8kx/</link><pubDate>Fri, 28 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/pufs8kx/</guid><description>&lt;h2 id="cognito-とは">Cognito とは？&lt;/h2>
&lt;p>&lt;a href="https://aws.amazon.com/jp/cognito/">Amazon Cognito&lt;/a> は、各種アプリケーションにユーザーの概念を取り入れて、サインアップやサインインなどを行えるようにするサービスです（OpenID Connect 準拠の Identity Provider (IdP) のひとつです）。
Cognito は大きく下記の 2 つの機能から成ります。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>ユーザープール&lt;/strong>: ユーザーを管理する。任意のアプリに、ユーザー登録（サインアップ）や、認証（サインイン）の機能を付けることができる。&lt;/li>
&lt;li>&lt;strong>ID プール&lt;/strong>: 上記の仕組みでサインインしたユーザーに対して、AWS サービスへのアクセス権限を付加する。&lt;/li>
&lt;/ul>
&lt;p>単純にユーザー管理だけをしたいのであれば、前者の「ユーザープール」の機能だけを使うことができます。
実際には、認証後に AWS のリソースにアクセスさせることが多いと思いますので、後者の「ID プール」の仕組みを使って IAM の権限割り当てを行うことになります。&lt;/p>
&lt;p>認証の仕組みに関しては、5 万 MAU（月間アクティブユーザー）まで無料で使えるので、個人で作成しているアプリでも使いやすいと思います。
ただし、無料枠を超えると 1 ユーザーあたり 1 円くらいかかり、多要素認証などを使おうとするともう少しお金がかかります。
詳しくは、&lt;a href="https://aws.amazon.com/jp/cognito/pricing/">Cognito の料金&lt;/a>）のページを参照してください。&lt;/p>
&lt;p>通常、Web サイトに認証機能を付けたいと思うと、ユーザー管理の仕組みや、サインイン画面などの UI を作成する必要がありますが、Cognito はこれらをまとめて提供してくれます。
ここでは、Cognito のユーザープールの作成から、React アプリでの認証までを説明します。&lt;/p>
&lt;h2 id="cognito-にユーザープールを作成する">Cognito にユーザープールを作成する&lt;/h2>
&lt;p>準備として、Cognito のユーザープールを作成しておきます。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="600" height="248" src="../../p/pufs8kx/img-001_hu3076329424299191530.png" alt="/p/pufs8kx/img-001.png" />
&lt;/figure>

&lt;ol>
&lt;li>&lt;a href="https://console.aws.amazon.com/cognito/home">Cognito のマネージメントコンソール&lt;/a>にアクセス&lt;/li>
&lt;li>&lt;code>ユーザープールの管理&lt;/code> → &lt;code>ユーザープールを作成する&lt;/code> を選択します&lt;/li>
&lt;li>ユーザー作成時の条件 (Attribute) などを設定して作成ボタンを押します&lt;/li>
&lt;/ol>
&lt;p>プール名は、適当に &lt;strong>&lt;code>myapp-test&lt;/code>&lt;/strong> とでも付けておけば大丈夫です。
本番環境用のユーザープールと、開発／テスト用のユーザープールは分けて作っておくのがよいので、ここではサフィックスとして &lt;code>-test&lt;/code> を付けておきました。
デフォルト設定でサクッと作成してしまうこともできるし、いろいろな条件（メールアドレス必須とかパスワード強度とか）を指定することもできます。
ここでは、とりあえずデフォルト設定で適当に作成してしまいましょう。
ユーザー名でなく、メールアドレスでもログインできるようにしたいときは、&lt;code>属性 (Attribte)&lt;/code> のタブで、&lt;strong>&lt;code>ユーザー名 - 検証済みの E メールアドレスでのサインインも許可&lt;/code>&lt;/strong> にチェックをいれておきます。&lt;/p></description></item><item><title>AWS CloudFormation 入門 (Hello World)</title><link>https://maku.blog/p/h7arpdj/</link><pubDate>Thu, 01 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/h7arpdj/</guid><description>&lt;h2 id="cloudformation-とは">CloudFormation とは&lt;/h2>
&lt;p>AWS CloudFormation を使用すると、テンプレートファイル (YAML or JSON) で定義した AWS リソース群をまとめて生成（更新）することができます。
いわゆる IaC (Infrastructure as Code) 環境を提供するものであり、Ansible や Chef を使ったことがあれば、それの AWS リソース構築用だと考えると分かりやすいです。&lt;/p>
&lt;p>テンプレートから生成されるインフラ（AWS リソース群）は &lt;strong>スタック&lt;/strong> と呼ばれ、テンプレートがあればスタックは何度でも生成することができます。
これはオブジェクト指向プログラミングにおける、クラスとインスタンスの関係に似ています。
必要のなくなったリソース群は、スタック単位でまとめて削除することができます。&lt;/p>
&lt;p>CloudFormation の主な特徴は次の通りです。&lt;/p>
&lt;ul>
&lt;li>何度でも同じ構成でリソースをセットアップできる（他のリージョンに複製したり、一時的に使うインフラを自動生成できる）&lt;/li>
&lt;li>テンプレートはテキストファイル (YAML/JSON) なので、GitHub などでバージョン管理することができ、PullRequest ベースのコードレビューを行える&lt;/li>
&lt;li>冪等性が考慮されており、テンプレートには最終的な結果だけを定義しておけばよい（構成のアップデート時に差分を意識する必要はない）&lt;/li>
&lt;/ul>
&lt;p>例えば、次のようなテンプレートを使用すると、S3 サービスのバケットリソースを自動で作成することができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;2010-09-09&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">HelloBucket&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::S3::Bucket&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>必須のルートプロパティは &lt;strong>&lt;code>Resources&lt;/code>&lt;/strong> だけですが、テンプレートフォーマットのバージョンを示す &lt;strong>&lt;code>AWSTemplateFormatVersion&lt;/code>&lt;/strong> は最低限指定しておくのがよいでしょう（2021年時点で、&lt;code>2010-09-09&lt;/code> が最新バージョンです）。&lt;/p>
&lt;h2 id="cloudformation-コンソールからスタックを生成する">CloudFormation コンソールからスタックを生成する&lt;/h2>
&lt;p>&lt;a href="https://console.aws.amazon.com/cloudformation/">CloudFormation マネージメントコンソール&lt;/a> を使うと、Web サイト上でスタックを生成することができます。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="1362" height="305" src="../../p/h7arpdj/img-001.png" alt="/p/h7arpdj/img-001.png" />
&lt;/figure>

&lt;p>CloudFormation マネージメントコンソールを使ったスタックの生成手順は以下の通りです。&lt;/p>
&lt;ol>
&lt;li>サイドバーから &lt;strong>&lt;code>Stacks&lt;/code>&lt;/strong>（スタック）を選択する
&lt;ul>
&lt;li>CloudFormation で管理されているスタックの一覧が表示されます。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>（スタックの作成）ボタンを押す&lt;/li>
&lt;li>テンプレートを指定する
&lt;ul>
&lt;li>S3 上に置いたファイルを指定することもできますが、ここではローカルに作成した YAML ファイルをアップロードします。そのためには、&lt;strong>&lt;code>Template is ready&lt;/code>&lt;/strong>（テンプレートの準備完了） → &lt;strong>&lt;code>Upload a template file&lt;/code>&lt;/strong>（テンプレートファイルのアップロード）を選択し、YAML ファイルを選択します。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>任意のスタック名（&lt;code>mystack&lt;/code> など）を入力します
&lt;ul>
&lt;li>テンプレートファイル内にパラメータ (Parameters) を定義している場合は、ここで具体的な値を入力できます。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>あとはそのまま進めていって、&lt;strong>&lt;code>Create stack&lt;/code>&lt;/strong>（スタックの作成）を押せば、スタックの生成処理が始まります。&lt;/li>
&lt;/ol>
&lt;p>スタックの一覧画面に戻ると、作成中のスタックのステータスが &lt;code>CREATE_IN_PROGRESS&lt;/code> となって表示されます。
しばらくしてスタックの生成処理が完了すると、ステータスが &lt;code>CREATE_COMPLETE&lt;/code> に変わります。
これで、テンプレートで定義した AWS リソース群が使用できる状態になります。&lt;/p></description></item><item><title>AWS CloudFormation 入門 (Hello World)</title><link>https://maku.blog/p/h7arpdj/</link><pubDate>Thu, 01 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/h7arpdj/</guid><description>&lt;h2 id="cloudformation-とは">CloudFormation とは&lt;/h2>
&lt;p>AWS CloudFormation を使用すると、テンプレートファイル (YAML or JSON) で定義した AWS リソース群をまとめて生成（更新）することができます。
いわゆる IaC (Infrastructure as Code) 環境を提供するものであり、Ansible や Chef を使ったことがあれば、それの AWS リソース構築用だと考えると分かりやすいです。&lt;/p>
&lt;p>テンプレートから生成されるインフラ（AWS リソース群）は &lt;strong>スタック&lt;/strong> と呼ばれ、テンプレートがあればスタックは何度でも生成することができます。
これはオブジェクト指向プログラミングにおける、クラスとインスタンスの関係に似ています。
必要のなくなったリソース群は、スタック単位でまとめて削除することができます。&lt;/p>
&lt;p>CloudFormation の主な特徴は次の通りです。&lt;/p>
&lt;ul>
&lt;li>何度でも同じ構成でリソースをセットアップできる（他のリージョンに複製したり、一時的に使うインフラを自動生成できる）&lt;/li>
&lt;li>テンプレートはテキストファイル (YAML/JSON) なので、GitHub などでバージョン管理することができ、PullRequest ベースのコードレビューを行える&lt;/li>
&lt;li>冪等性が考慮されており、テンプレートには最終的な結果だけを定義しておけばよい（構成のアップデート時に差分を意識する必要はない）&lt;/li>
&lt;/ul>
&lt;p>例えば、次のようなテンプレートを使用すると、S3 サービスのバケットリソースを自動で作成することができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;2010-09-09&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">HelloBucket&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::S3::Bucket&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>必須のルートプロパティは &lt;strong>&lt;code>Resources&lt;/code>&lt;/strong> だけですが、テンプレートフォーマットのバージョンを示す &lt;strong>&lt;code>AWSTemplateFormatVersion&lt;/code>&lt;/strong> は最低限指定しておくのがよいでしょう（2021年時点で、&lt;code>2010-09-09&lt;/code> が最新バージョンです）。&lt;/p>
&lt;h2 id="cloudformation-コンソールからスタックを生成する">CloudFormation コンソールからスタックを生成する&lt;/h2>
&lt;p>&lt;a href="https://console.aws.amazon.com/cloudformation/">CloudFormation マネージメントコンソール&lt;/a> を使うと、Web サイト上でスタックを生成することができます。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="1362" height="305" src="../../p/h7arpdj/img-001.png" alt="/p/h7arpdj/img-001.png" />
&lt;/figure>

&lt;p>CloudFormation マネージメントコンソールを使ったスタックの生成手順は以下の通りです。&lt;/p>
&lt;ol>
&lt;li>サイドバーから &lt;strong>&lt;code>Stacks&lt;/code>&lt;/strong>（スタック）を選択する
&lt;ul>
&lt;li>CloudFormation で管理されているスタックの一覧が表示されます。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>（スタックの作成）ボタンを押す&lt;/li>
&lt;li>テンプレートを指定する
&lt;ul>
&lt;li>S3 上に置いたファイルを指定することもできますが、ここではローカルに作成した YAML ファイルをアップロードします。そのためには、&lt;strong>&lt;code>Template is ready&lt;/code>&lt;/strong>（テンプレートの準備完了） → &lt;strong>&lt;code>Upload a template file&lt;/code>&lt;/strong>（テンプレートファイルのアップロード）を選択し、YAML ファイルを選択します。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>任意のスタック名（&lt;code>mystack&lt;/code> など）を入力します
&lt;ul>
&lt;li>テンプレートファイル内にパラメータ (Parameters) を定義している場合は、ここで具体的な値を入力できます。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>あとはそのまま進めていって、&lt;strong>&lt;code>Create stack&lt;/code>&lt;/strong>（スタックの作成）を押せば、スタックの生成処理が始まります。&lt;/li>
&lt;/ol>
&lt;p>スタックの一覧画面に戻ると、作成中のスタックのステータスが &lt;code>CREATE_IN_PROGRESS&lt;/code> となって表示されます。
しばらくしてスタックの生成処理が完了すると、ステータスが &lt;code>CREATE_COMPLETE&lt;/code> に変わります。
これで、テンプレートで定義した AWS リソース群が使用できる状態になります。&lt;/p></description></item><item><title>AWS S3 をコマンドライン (CLI) で操作する</title><link>https://maku.blog/p/4ju5eow/</link><pubDate>Tue, 16 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/4ju5eow/</guid><description>&lt;p>AWS CLI で S3 バケットの操作を行う場合、大きく分けて以下の 2 種類のコマンドがあります。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>&lt;code>aws s3&lt;/code>&lt;/strong> &amp;hellip; 高レベルコマンド&lt;/li>
&lt;li>&lt;strong>&lt;code>aws s3api&lt;/code>&lt;/strong> &amp;hellip; API レベルコマンド&lt;/li>
&lt;/ul>
&lt;p>基本的には、&lt;code>aws s3&lt;/code> コマンドでカバーできない操作が出てきたときに &lt;code>aws s3api&lt;/code> コマンドの方を調べてみるというやり方でいいと思います。
&lt;code>aws s3&lt;/code> コマンドの方は、OS のコマンドラインシェルのファイル操作コマンドのような体系になっています（&lt;code>aws s3 ls&lt;/code> とか &lt;code>aws s3 rm&lt;/code> とか）。&lt;/p>
&lt;p>S3 バケットの操作を行うには、IAM ユーザーに適切な権限が割り当てられている必要がありますが、&lt;strong>&lt;code>AmazonS3FulAccess&lt;/code>&lt;/strong> 管理ポリシーがあればほとんどの操作が可能です。&lt;/p>
&lt;h2 id="s3-バケットを作成する-s3-mb">S3 バケットを作成する (s3 mb)&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws s3 mb s3://&amp;lt;バケット名&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws s3 mb s3://makutemp-123456789012-bucket-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make_bucket: makutemp-123456789012-bucket-1&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ 同名バケットの再生成でエラー&lt;/span>
 &lt;span class="xNote_body">&lt;p>バケットの削除後に、同名のバケットを再生成しようとすると、次のような &lt;strong>conflicting conditional operation&lt;/strong> のエラーになることがあります。
この場合は、バケットの削除処理が完了するまでしばらく待つ必要があります。&lt;/p>
&lt;figure class="xCodeBlock">
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">make_bucket failed: s3://makutemp-123456789012-bucket-1 An error occurred (OperationAborted) when calling the CreateBucket operation: A conflicting conditional operation is currently in progress against this resource. Please try again.&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>
&lt;p>このような待ち時間を防ぐためには、&lt;code>s3 rb&lt;/code> でバケットを削除した後で再生成するのではなく、&lt;code>s3 rm --recursive&lt;/code> でバケット内のオブジェクトだけをすべて削除します。&lt;/p></description></item><item><title>AWS の初期設定: AWS CLI と認証情報の設定</title><link>https://maku.blog/p/j5iu7it/</link><pubDate>Sun, 07 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/j5iu7it/</guid><description>&lt;h2 id="aws-cli-とは">AWS CLI とは？&lt;/h2>
&lt;p>AWS CLI (Command Line Interface) を使うと、AWS の各種サービスをコマンドラインから操作することができます。
例えば、次のように様々な処理を実行できます。&lt;/p>
&lt;ul>
&lt;li>S3 にファイルをコピーする
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws s3 cp ローカルファイル s3://バケット名/ディレクトリ名
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>IAM ユーザーのアクセスキーを表示する
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws iam list-access-keys --user-name&lt;span class="o">=&lt;/span>ユーザー名
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>DynamoDB にテーブルを作成する
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws dynamodb create-table --table-name テーブル名 ...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;p>AWS の各種サービスの設定は、それぞれのマネージメントコンソール（Web サイト）上で設定することができますが、AWS CLI を使うことで、Web ブラウザを開かずに設定を済ませられます。
頻繁に行う処理などは、シェルスクリプトなどにして自動化することができます。&lt;/p>
&lt;p>AWS CLI を使用するには、下記のような IAM ユーザーのアクセスキー（及びシークレットアクセスキー）が必要です。
以降の説明では、これらの情報が取得できていることを前提とします。&lt;/p>
&lt;ul>
&lt;li>API 用アクセスキー（例）: &lt;code>INMCAKIAQX77PNSXQAGP&lt;/code>&lt;/li>
&lt;li>API 用シークレットアクセスキー（例）: &lt;code>2ufOA3Q2KAmpNTo2GHPDXFJK7Jiv9yfZGegIdbCW&lt;/code>&lt;/li>
&lt;/ul>
&lt;aside style="display: flex; border: thin dashed gray;">
&lt;div style="align-self: stretch; writing-mode: vertical-lr; text-align: center; letter-spacing: 0.2em; color: #666; border-right: thin dashed gray; padding: 0.4em 0; line-height: 1.5;">参考&lt;/div>
&lt;div style="align-self: center; padding: 0.6em 0; line-height: 1.2 !important;">&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-creds">IAM ユーザーのアクセスキーを作成するには - AWS CLI&lt;/a>&lt;/li>
&lt;/ul>
&lt;/div>
&lt;/aside>
&lt;h2 id="aws-cli-のインストール">AWS CLI のインストール&lt;/h2>
&lt;h3 id="インストール方法">インストール方法&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-mac.html">macOS の場合&lt;/a> &amp;hellip; &lt;a href="https://awscli.amazonaws.com/AWSCLIV2.pkg">AWSCLIV2.pkg&lt;/a> をダウンロードしてインストールできます。&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-windows.html">Windows の場合&lt;/a> &amp;hellip; &lt;a href="https://awscli.amazonaws.com/AWSCLIV2.msi">AWSCLIV2.msi&lt;/a> をダウンロードしてインストールできます。&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html">Linux の場合&lt;/a> &amp;hellip; &lt;code>curl&lt;/code> コマンドでインストール用スクリプトをダウンロードしてインストールできます。&lt;/li>
&lt;/ul>
&lt;h3 id="インストール後の確認">インストール後の確認&lt;/h3>
&lt;p>何らかの &lt;code>aws&lt;/code> コマンドが実行できるようになっていれば成功です。&lt;/p></description></item><item><title>AWS の初期設定: AWS CLI と認証情報の設定</title><link>https://maku.blog/p/j5iu7it/</link><pubDate>Sun, 07 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/j5iu7it/</guid><description>&lt;h2 id="aws-cli-とは">AWS CLI とは？&lt;/h2>
&lt;p>AWS CLI (Command Line Interface) を使うと、AWS の各種サービスをコマンドラインから操作することができます。
例えば、次のように様々な処理を実行できます。&lt;/p>
&lt;ul>
&lt;li>S3 にファイルをコピーする
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws s3 cp ローカルファイル s3://バケット名/ディレクトリ名
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>IAM ユーザーのアクセスキーを表示する
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws iam list-access-keys --user-name&lt;span class="o">=&lt;/span>ユーザー名
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>DynamoDB にテーブルを作成する
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws dynamodb create-table --table-name テーブル名 ...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;p>AWS の各種サービスの設定は、それぞれのマネージメントコンソール（Web サイト）上で設定することができますが、AWS CLI を使うことで、Web ブラウザを開かずに設定を済ませられます。
頻繁に行う処理などは、シェルスクリプトなどにして自動化することができます。&lt;/p>
&lt;p>AWS CLI を使用するには、下記のような IAM ユーザーのアクセスキー（及びシークレットアクセスキー）が必要です。
以降の説明では、これらの情報が取得できていることを前提とします。&lt;/p>
&lt;ul>
&lt;li>API 用アクセスキー（例）: &lt;code>INMCAKIAQX77PNSXQAGP&lt;/code>&lt;/li>
&lt;li>API 用シークレットアクセスキー（例）: &lt;code>2ufOA3Q2KAmpNTo2GHPDXFJK7Jiv9yfZGegIdbCW&lt;/code>&lt;/li>
&lt;/ul>
&lt;aside style="display: flex; border: thin dashed gray;">
&lt;div style="align-self: stretch; writing-mode: vertical-lr; text-align: center; letter-spacing: 0.2em; color: #666; border-right: thin dashed gray; padding: 0.4em 0; line-height: 1.5;">参考&lt;/div>
&lt;div style="align-self: center; padding: 0.6em 0; line-height: 1.2 !important;">&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-creds">IAM ユーザーのアクセスキーを作成するには - AWS CLI&lt;/a>&lt;/li>
&lt;/ul>
&lt;/div>
&lt;/aside>
&lt;h2 id="aws-cli-のインストール">AWS CLI のインストール&lt;/h2>
&lt;h3 id="インストール方法">インストール方法&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-mac.html">macOS の場合&lt;/a> &amp;hellip; &lt;a href="https://awscli.amazonaws.com/AWSCLIV2.pkg">AWSCLIV2.pkg&lt;/a> をダウンロードしてインストールできます。&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-windows.html">Windows の場合&lt;/a> &amp;hellip; &lt;a href="https://awscli.amazonaws.com/AWSCLIV2.msi">AWSCLIV2.msi&lt;/a> をダウンロードしてインストールできます。&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html">Linux の場合&lt;/a> &amp;hellip; &lt;code>curl&lt;/code> コマンドでインストール用スクリプトをダウンロードしてインストールできます。&lt;/li>
&lt;/ul>
&lt;h3 id="インストール後の確認">インストール後の確認&lt;/h3>
&lt;p>何らかの &lt;code>aws&lt;/code> コマンドが実行できるようになっていれば成功です。&lt;/p></description></item><item><title>Next.js から AWS DynamoDB にアクセスする</title><link>https://maku.blog/p/xp8o5k2/</link><pubDate>Tue, 02 Nov 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/xp8o5k2/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>Next.js アプリの API routes (&lt;code>pages/*.ts&lt;/code>) や、&lt;code>getServerSideProps&lt;/code> などのサーバーサイドで実行される関数では、通常の Node.js モジュールを使うことができるため、AWS の DynamoDB からデータを取得する、といったことも自由に行えます。
ここでは、Next.js の API routes 機能を使って、DynamoDB から情報を取得する Web API を作ってみます。
具体的には次のようなことをします。&lt;/p>
&lt;ul>
&lt;li>テスト用の DynamoDB テーブル (&lt;code>Books&lt;/code>) を作成する&lt;/li>
&lt;li>&lt;code>Books&lt;/code> テーブルを参照するためのアクセスキー（IAM ユーザー）を作成する&lt;/li>
&lt;li>Next.js の API routes の実装 (&lt;code>pages/api/books.ts&lt;/code>) を行う
&lt;ul>
&lt;li>AWS SDK を使って DynamoDB から情報を取得する&lt;/li>
&lt;li>&lt;code>/api/books/001&lt;/code> のような URL にアクセスすると JSON データを返す&lt;/li>
&lt;li>アクセスキーは環境変数で設定する&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ アクセスキーを使った AWS リソースのアクセスについて&lt;/span>
 &lt;span class="xNote_body">&lt;p>AWS のアクセスキーは、IAM ユーザーに設定されるものであり、このアクセスキーが漏洩すると、&lt;strong>そのユーザーの権限で何でもできる&lt;/strong> ということになります。
そのため、アクセスキーを使用するときは、IAM ユーザーの権限を適切に絞ることが大切で、そもそも本当に必要なケースでのみアクセスキーを使うようにすべきです。
アクセスキーが必要になるのは、AWS の外から AWS リソースに直接アクセスするケースです。
例えば、AWS CLI のコマンドで AWS の制御を行う場合や、今回の例のように AWS 外のサーバーから AWS へアクセスするようなケースです。&lt;/p></description></item><item><title>Amazon Cognito (2) サインイン後に AWS リソースへのアクセス権限を与える (Cognito Identity Pool)</title><link>https://maku.blog/p/3mx8hr2/</link><pubDate>Mon, 31 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/3mx8hr2/</guid><description>&lt;h2 id="何をやるか">何をやるか？&lt;/h2>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/pufs8kx">Amazon Cognito (1) サインイン可能な Web サイトを作る (with React)&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>上記記事では、Cognito のユーザープール機能を使って、Web サイトにサインイン（サインアップ）機能を付けるところまでを説明しています。
ここでは、さらに Cognito の ID プール機能を使い、認証後のユーザーに AWS リソースへのアクセス権限を割り当てる方法を説明します。&lt;/p>
&lt;p>Amazon Cognito サービスは、大きくわけて下記の 2 つの機能を提供しています。&lt;/p>
&lt;ul>
&lt;li>User Pool &amp;hellip; &lt;strong>認証 (Authentication)&lt;/strong>&lt;/li>
&lt;li>Identity Pool &amp;hellip; 認証後のユーザーに対する &lt;strong>認可 (Authorization)&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>「認証」の方は、Cognito の User Pool を使う方法以外にも、Amazon、Facebook、Google など、様々な認証サービス（これらを &lt;strong>認証プロバイダー (IdP)&lt;/strong> と呼びます）を使用することができますが、ここでは Cognito の User Pool でユーザー認証することを前提とします。&lt;/p>
&lt;p>ここから先の説明は、「認可」に関しての説明になります。
Cognito Identity Pool は、何らかの認証プロバイダーによる認証済みユーザーに対して、IAM ロールを割り当てることによって、任意の AWS リソースへのアクセスを許可します。
また、認証していないユーザー（いわゆるゲストユーザー）に対して、リードオンリーな IAM ロールを割り当てたり、User Pool の方でユーザーをグループに登録しておいて、そのグループの IAM ロールをアクセス権限として割り当てるといったことも可能です。&lt;/p>
&lt;h2 id="id-プールフェデレーティッドアイデンティティ">ID プール（フェデレーティッドアイデンティティ）&lt;/h2>
&lt;p>Cognito の ID プールを使うと、各種認証プロバイダーサービス（Cognito の場合は「ユーザープール」）でサインインしたユーザーに対して、AWS リソース（API Gateway や DynamoDB など）へのアクセス権限を割り当てることができます。
ざっくり言うと、ID プールは、&lt;strong>ユーザーに対して IAM ロールを割り当てる仕組み&lt;/strong> です。&lt;/p></description></item><item><title>Amazon Cognito (2) サインイン後に AWS リソースへのアクセス権限を与える (Cognito Identity Pool)</title><link>https://maku.blog/p/3mx8hr2/</link><pubDate>Mon, 31 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/3mx8hr2/</guid><description>&lt;h2 id="何をやるか">何をやるか？&lt;/h2>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/pufs8kx">Amazon Cognito (1) サインイン可能な Web サイトを作る (with React)&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>上記記事では、Cognito のユーザープール機能を使って、Web サイトにサインイン（サインアップ）機能を付けるところまでを説明しています。
ここでは、さらに Cognito の ID プール機能を使い、認証後のユーザーに AWS リソースへのアクセス権限を割り当てる方法を説明します。&lt;/p>
&lt;p>Amazon Cognito サービスは、大きくわけて下記の 2 つの機能を提供しています。&lt;/p>
&lt;ul>
&lt;li>User Pool &amp;hellip; &lt;strong>認証 (Authentication)&lt;/strong>&lt;/li>
&lt;li>Identity Pool &amp;hellip; 認証後のユーザーに対する &lt;strong>認可 (Authorization)&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>「認証」の方は、Cognito の User Pool を使う方法以外にも、Amazon、Facebook、Google など、様々な認証サービス（これらを &lt;strong>認証プロバイダー (IdP)&lt;/strong> と呼びます）を使用することができますが、ここでは Cognito の User Pool でユーザー認証することを前提とします。&lt;/p>
&lt;p>ここから先の説明は、「認可」に関しての説明になります。
Cognito Identity Pool は、何らかの認証プロバイダーによる認証済みユーザーに対して、IAM ロールを割り当てることによって、任意の AWS リソースへのアクセスを許可します。
また、認証していないユーザー（いわゆるゲストユーザー）に対して、リードオンリーな IAM ロールを割り当てたり、User Pool の方でユーザーをグループに登録しておいて、そのグループの IAM ロールをアクセス権限として割り当てるといったことも可能です。&lt;/p>
&lt;h2 id="id-プールフェデレーティッドアイデンティティ">ID プール（フェデレーティッドアイデンティティ）&lt;/h2>
&lt;p>Cognito の ID プールを使うと、各種認証プロバイダーサービス（Cognito の場合は「ユーザープール」）でサインインしたユーザーに対して、AWS リソース（API Gateway や DynamoDB など）へのアクセス権限を割り当てることができます。
ざっくり言うと、ID プールは、&lt;strong>ユーザーに対して IAM ロールを割り当てる仕組み&lt;/strong> です。&lt;/p></description></item><item><title>AWS CLI: Windows で HOME 環境変数を設定したときに credentials が見つからなくなる場合の対処</title><link>https://maku.blog/p/2td9ouj/</link><pubDate>Mon, 29 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/2td9ouj/</guid><description>&lt;p>AWS CLI や AWS SDK が参照する共有認証ファイル（&lt;code>credentials&lt;/code> および &lt;code>config&lt;/code>）は、デフォルトでは下記のようなディレクトリになっています。&lt;/p>
&lt;ul>
&lt;li>Linux の場合: &lt;code>~/.aws/credentials&lt;/code>&lt;/li>
&lt;li>Windows の場合: &lt;code>~/%USERPROFILE%/.aws/credentials&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ところが、Windows を使用している場合に、環境変数 &lt;strong>&lt;code>%HOME%&lt;/code>&lt;/strong> を設定していると、CLI や SDK が &lt;code>%HOME%/.aws/credentials&lt;/code> を見に行ったりして、credentials が見つからない系のエラーが出ることがあります。
一貫して &lt;strong>&lt;code>%USERPROFILE%&lt;/code>&lt;/strong> の方を見に行ってくれれればよいのですが、このあたりの振る舞いは結構ルーズなようです。&lt;/p>
&lt;p>そこで、&lt;strong>Windows のジャンクション機能&lt;/strong> で、両方の &lt;code>.aws&lt;/code> ディレクトリが同じディレクトリを指すようにしてみました。
ジャンクション生成のコマンドは、&lt;strong>&lt;code>mklink /j &amp;lt;fromDir&amp;gt; &amp;lt;toDir&amp;gt;&lt;/code>&lt;/strong> です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">ジャンクションで 2 つの .aws を同一にする&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">C:\&amp;gt; mklink /j %HOME%\.aws %USERPROFILE%\.aws
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:\home\.aws &amp;lt;&amp;lt;===&amp;gt;&amp;gt; C:\Users\maku\.aws のジャンクションが作成されました&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これで、&lt;code>%HOME%\.aws&lt;/code> ディレクトリを参照したときの実体として、&lt;code>%USERPROFILE%\.aws&lt;/code> ディレクトリが使われるようになります。
今のところ快適に動作しています。&lt;/p>
&lt;p>ちなみに、ジャンクションを削除したいときは、ジャンクション元の &lt;code>%HOME%\.aws&lt;/code> ディレクトリを削除するだけです。
実体の方の &lt;code>%USERPROFILET%\.aws&lt;/code> は削除されないので安全です。&lt;/p></description></item><item><title>AWS CLI: Windows で HOME 環境変数を設定したときに credentials が見つからなくなる場合の対処</title><link>https://maku.blog/p/2td9ouj/</link><pubDate>Mon, 29 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/2td9ouj/</guid><description>&lt;p>AWS CLI や AWS SDK が参照する共有認証ファイル（&lt;code>credentials&lt;/code> および &lt;code>config&lt;/code>）は、デフォルトでは下記のようなディレクトリになっています。&lt;/p>
&lt;ul>
&lt;li>Linux の場合: &lt;code>~/.aws/credentials&lt;/code>&lt;/li>
&lt;li>Windows の場合: &lt;code>~/%USERPROFILE%/.aws/credentials&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ところが、Windows を使用している場合に、環境変数 &lt;strong>&lt;code>%HOME%&lt;/code>&lt;/strong> を設定していると、CLI や SDK が &lt;code>%HOME%/.aws/credentials&lt;/code> を見に行ったりして、credentials が見つからない系のエラーが出ることがあります。
一貫して &lt;strong>&lt;code>%USERPROFILE%&lt;/code>&lt;/strong> の方を見に行ってくれれればよいのですが、このあたりの振る舞いは結構ルーズなようです。&lt;/p>
&lt;p>そこで、&lt;strong>Windows のジャンクション機能&lt;/strong> で、両方の &lt;code>.aws&lt;/code> ディレクトリが同じディレクトリを指すようにしてみました。
ジャンクション生成のコマンドは、&lt;strong>&lt;code>mklink /j &amp;lt;fromDir&amp;gt; &amp;lt;toDir&amp;gt;&lt;/code>&lt;/strong> です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">ジャンクションで 2 つの .aws を同一にする&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">C:\&amp;gt; mklink /j %HOME%\.aws %USERPROFILE%\.aws
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:\home\.aws &amp;lt;&amp;lt;===&amp;gt;&amp;gt; C:\Users\maku\.aws のジャンクションが作成されました&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これで、&lt;code>%HOME%\.aws&lt;/code> ディレクトリを参照したときの実体として、&lt;code>%USERPROFILE%\.aws&lt;/code> ディレクトリが使われるようになります。
今のところ快適に動作しています。&lt;/p>
&lt;p>ちなみに、ジャンクションを削除したいときは、ジャンクション元の &lt;code>%HOME%\.aws&lt;/code> ディレクトリを削除するだけです。
実体の方の &lt;code>%USERPROFILET%\.aws&lt;/code> は削除されないので安全です。&lt;/p></description></item><item><title>Node.js で Amazon S3 を操作する (AWS SDK)</title><link>https://maku.blog/p/m8kv8it/</link><pubDate>Sun, 21 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/m8kv8it/</guid><description>&lt;p>ここでは、Node.js 用の AWS SDK を使って Amazon S3 を操作する方法を説明します。
&lt;a href="../../p/taiqx6d">TypeScript の基本的な環境構築&lt;/a> は終わっているものとします。&lt;/p>
&lt;h2 id="s3-用の-nodejs-sdk-をインストールする">S3 用の Node.js SDK をインストールする&lt;/h2>
&lt;p>AWS SDK version 3 の S3 用パッケージをインストールするには次のようにします。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">### npm の場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ npm install @aws-sdk/client-s3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">### yarn の場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ yarn add @aws-sdk/client-s3&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これで、TypeScript コードから次のようにパッケージ内のクラスをインポートできるようになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">main.ts&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-typescript" data-lang="typescript">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">S3Client&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ListBucketsCommand&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@aws-sdk/client-s3&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="s3client-インスタンスの生成">S3Client インスタンスの生成&lt;/h2>
&lt;p>AWS SDK で S3 の操作を行うには、&lt;a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/clients/client-s3/classes/s3client.html">S3Client&lt;/a> オブジェクトを使って各種コマンドを送ります。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="k">new&lt;/span> &lt;span class="nx">S3Client&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">configuration&lt;/span>: &lt;span class="kt">S3ClientConfig&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">S3Client&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>S3Client&lt;/code> コンストラクタには &lt;a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/clients/client-s3/globals.html#s3clientconfig">S3ClientConfig&lt;/a> オブジェクトを渡すようになっており、接続情報などを指定できます。
空オブジェクト (&lt;code>{}&lt;/code>) を渡すと、現在の環境の default プロファイルの設定が使用されます（&lt;code>~/.aws/config&lt;/code> と &lt;code>~/.aws/credentials&lt;/code> に設定されたもの）。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// default プロファイルで接続する場合
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="nx">s3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">S3Client&lt;/span>&lt;span class="p">({});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 接続情報をカスタマイズする場合
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="nx">s3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">S3Client&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">region&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;ap-northeast-1&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">credentials&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">accessKeyId&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;QABCSCRHWJAKIAQXINMC&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">secretAccessKey&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;TTey3DVmbrILhTforDDa8kR6+SL+47htmoJ+Vimv&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>一時的にプロファイルを切り替えて実行したいときは、環境変数 &lt;strong>&lt;code>AWS_PROFILE&lt;/code>&lt;/strong> でプロファイル名を指定します。&lt;/p></description></item><item><title>Amazon Cognito: Amplify SDK による認証まわりの UI 表示あれこれ</title><link>https://maku.blog/p/24p8jjx/</link><pubDate>Wed, 09 Jun 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/24p8jjx/</guid><description>&lt;h2 id="認証済みユーザーが-admin-グループに属しているか調べて-ui-を切り替える">認証済みユーザーが admin グループに属しているか調べて UI を切り替える&lt;/h2>
&lt;p>Cognito ユーザープールの「グループ」機能を使うと、既存のユーザーをグループ単位でまとめて、特別な IAM ロールを割り当てたりすることができます。
例えば、&lt;code>admin&lt;/code> グループを作っておいて、そのグループに所属するユーザーに、DynamoDB の書き込み権限 (IAM role) を与える、といったことができます。&lt;/p>
&lt;p>React アプリのレイヤでは、このような IAM ロールの権限うんぬんの前に、カレントユーザーがどのようなグループに所属しているかに応じて UI の表示分けをしたいことがあります。
例えば、&lt;code>admin&lt;/code> グループのユーザーが Web ページを表示しているときは、管理者向けのメニュー表示をする、といったケースです。&lt;/p>
&lt;p>幸い、&lt;code>aws-amplify&lt;/code> モジュールの &lt;code>Auth&lt;/code> オブジェクトが提供する認証情報を参照することで、認証済みのユーザーがどの Cognito グループに属しているかを調べることができます。
具体的には、&lt;code>Auth.currentAuthenticatedUser()&lt;/code> などが返すユーザー情報のアクセストークンのペイロードに &lt;strong>&lt;code>cognito:groups&lt;/code>&lt;/strong> というプロパティがあり、そこに Cognito グループ名のリストが格納されています。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-access-token.html">Using the Access Token - Amazon Cognito&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>次のようなカスタムフック &lt;code>useAuthState&lt;/code> を定義しておくと、戻り値の &lt;code>isAdmin&lt;/code> プロパティを見るだけで、現在のユーザーが admin グループに属しているかを確認できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">src/hooks/useAuthState.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">useState&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">Auth&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;aws-amplify&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">AuthState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">CognitoUserInterface&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">onAuthUIStateChange&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@aws-amplify/ui-components&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ユーザーがこのグループ名の Cognito グループに所属しているときに、
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// useAuthState フックが返す isAdmin プロパティを true にします。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="nx">ADMIN_GROUP_NAME&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;admin&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/** useAuthState フックの戻り値の型 */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">type&lt;/span> &lt;span class="nx">UseAuthStateOutput&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isSignedIn&lt;/span>: &lt;span class="kt">boolean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isAdmin&lt;/span>: &lt;span class="kt">boolean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">user&lt;/span>: &lt;span class="kt">CognitoUserInterface&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="kc">undefined&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/** 現在の認証状態を取得するためのフック関数です。 */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">useAuthState&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">UseAuthStateOutput&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Cognito によるサインイン状態やユーザー情報を保持するステート
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">authState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setAuthState&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">AuthState&lt;/span> &lt;span class="err">|&lt;/span> &lt;span class="na">undefined&lt;/span>&lt;span class="p">&amp;gt;()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">user&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setUser&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">CognitoUserInterface&lt;/span> &lt;span class="err">|&lt;/span> &lt;span class="na">undefined&lt;/span>&lt;span class="p">&amp;gt;()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 画面遷移時に onAuthUIStateChange が呼ばれないことへの対応
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// https://github.com/aws-amplify/docs/issues/2895
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">authState&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Auth&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentAuthenticatedUser&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="nx">then&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">authData&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setAuthState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">AuthState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">SignedIn&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setUser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">authData&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="cm">/* Nothing to do */&lt;/span> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">onAuthUIStateChange&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">nextAuthState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">authData&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setAuthState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">nextAuthState&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setUser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">authData&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">CognitoUserInterface&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">authState&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isSignedIn&lt;/span>: &lt;span class="kt">authState&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="nx">AuthState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">SignedIn&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isAdmin&lt;/span>: &lt;span class="kt">isAdmin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">user&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">user&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// アクセストークン内のグループ名リストに &amp;#34;admin&amp;#34; があるかを調べます。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="nx">isAdmin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">user&lt;/span>: &lt;span class="kt">CognitoUserInterface&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kr">boolean&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">groups&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">user&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">signInUserSession&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">accessToken&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">payload&lt;/span>&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;cognito:groups&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nb">Array&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">string&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">groups&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">includes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ADMIN_GROUP_NAME&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">??&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記のフック実装では、戻り値の &lt;code>user&lt;/code> プロパティで &lt;code>CognitoUserInterface&lt;/code> 情報を返すようにしていますが、Cognito に依存する情報はできるだけフック内に隠蔽してしまった方がいいですね。
下記は、このフック関数の使用例です。
&lt;code>useAuthState()&lt;/code> が返す &lt;code>isAdmin&lt;/code> の値が true のときに、管理者用のメニューを表示するという処理を想定しています。&lt;/p></description></item><item><title>Amazon Cognito: Amplify SDK による認証まわりの UI 表示あれこれ</title><link>https://maku.blog/p/24p8jjx/</link><pubDate>Wed, 09 Jun 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/24p8jjx/</guid><description>&lt;h2 id="認証済みユーザーが-admin-グループに属しているか調べて-ui-を切り替える">認証済みユーザーが admin グループに属しているか調べて UI を切り替える&lt;/h2>
&lt;p>Cognito ユーザープールの「グループ」機能を使うと、既存のユーザーをグループ単位でまとめて、特別な IAM ロールを割り当てたりすることができます。
例えば、&lt;code>admin&lt;/code> グループを作っておいて、そのグループに所属するユーザーに、DynamoDB の書き込み権限 (IAM role) を与える、といったことができます。&lt;/p>
&lt;p>React アプリのレイヤでは、このような IAM ロールの権限うんぬんの前に、カレントユーザーがどのようなグループに所属しているかに応じて UI の表示分けをしたいことがあります。
例えば、&lt;code>admin&lt;/code> グループのユーザーが Web ページを表示しているときは、管理者向けのメニュー表示をする、といったケースです。&lt;/p>
&lt;p>幸い、&lt;code>aws-amplify&lt;/code> モジュールの &lt;code>Auth&lt;/code> オブジェクトが提供する認証情報を参照することで、認証済みのユーザーがどの Cognito グループに属しているかを調べることができます。
具体的には、&lt;code>Auth.currentAuthenticatedUser()&lt;/code> などが返すユーザー情報のアクセストークンのペイロードに &lt;strong>&lt;code>cognito:groups&lt;/code>&lt;/strong> というプロパティがあり、そこに Cognito グループ名のリストが格納されています。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-access-token.html">Using the Access Token - Amazon Cognito&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>次のようなカスタムフック &lt;code>useAuthState&lt;/code> を定義しておくと、戻り値の &lt;code>isAdmin&lt;/code> プロパティを見るだけで、現在のユーザーが admin グループに属しているかを確認できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">src/hooks/useAuthState.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">useState&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">Auth&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;aws-amplify&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">AuthState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">CognitoUserInterface&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">onAuthUIStateChange&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@aws-amplify/ui-components&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ユーザーがこのグループ名の Cognito グループに所属しているときに、
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// useAuthState フックが返す isAdmin プロパティを true にします。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="nx">ADMIN_GROUP_NAME&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;admin&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/** useAuthState フックの戻り値の型 */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">type&lt;/span> &lt;span class="nx">UseAuthStateOutput&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isSignedIn&lt;/span>: &lt;span class="kt">boolean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isAdmin&lt;/span>: &lt;span class="kt">boolean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">user&lt;/span>: &lt;span class="kt">CognitoUserInterface&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="kc">undefined&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/** 現在の認証状態を取得するためのフック関数です。 */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">useAuthState&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">UseAuthStateOutput&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Cognito によるサインイン状態やユーザー情報を保持するステート
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">authState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setAuthState&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">AuthState&lt;/span> &lt;span class="err">|&lt;/span> &lt;span class="na">undefined&lt;/span>&lt;span class="p">&amp;gt;()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">user&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setUser&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">CognitoUserInterface&lt;/span> &lt;span class="err">|&lt;/span> &lt;span class="na">undefined&lt;/span>&lt;span class="p">&amp;gt;()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 画面遷移時に onAuthUIStateChange が呼ばれないことへの対応
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// https://github.com/aws-amplify/docs/issues/2895
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">authState&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Auth&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentAuthenticatedUser&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="nx">then&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">authData&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setAuthState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">AuthState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">SignedIn&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setUser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">authData&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="cm">/* Nothing to do */&lt;/span> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">onAuthUIStateChange&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">nextAuthState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">authData&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setAuthState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">nextAuthState&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setUser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">authData&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">CognitoUserInterface&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">authState&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isSignedIn&lt;/span>: &lt;span class="kt">authState&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="nx">AuthState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">SignedIn&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isAdmin&lt;/span>: &lt;span class="kt">isAdmin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">user&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">user&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// アクセストークン内のグループ名リストに &amp;#34;admin&amp;#34; があるかを調べます。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="nx">isAdmin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">user&lt;/span>: &lt;span class="kt">CognitoUserInterface&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kr">boolean&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">groups&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">user&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">signInUserSession&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">accessToken&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">payload&lt;/span>&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;cognito:groups&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nb">Array&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">string&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">groups&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">includes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ADMIN_GROUP_NAME&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">??&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記のフック実装では、戻り値の &lt;code>user&lt;/code> プロパティで &lt;code>CognitoUserInterface&lt;/code> 情報を返すようにしていますが、Cognito に依存する情報はできるだけフック内に隠蔽してしまった方がいいですね。
下記は、このフック関数の使用例です。
&lt;code>useAuthState()&lt;/code> が返す &lt;code>isAdmin&lt;/code> の値が true のときに、管理者用のメニューを表示するという処理を想定しています。&lt;/p></description></item><item><title>Amazon Cognito: Amplify SDK による認証まわりの UI 表示あれこれ</title><link>https://maku.blog/p/24p8jjx/</link><pubDate>Wed, 09 Jun 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/24p8jjx/</guid><description>&lt;h2 id="認証済みユーザーが-admin-グループに属しているか調べて-ui-を切り替える">認証済みユーザーが admin グループに属しているか調べて UI を切り替える&lt;/h2>
&lt;p>Cognito ユーザープールの「グループ」機能を使うと、既存のユーザーをグループ単位でまとめて、特別な IAM ロールを割り当てたりすることができます。
例えば、&lt;code>admin&lt;/code> グループを作っておいて、そのグループに所属するユーザーに、DynamoDB の書き込み権限 (IAM role) を与える、といったことができます。&lt;/p>
&lt;p>React アプリのレイヤでは、このような IAM ロールの権限うんぬんの前に、カレントユーザーがどのようなグループに所属しているかに応じて UI の表示分けをしたいことがあります。
例えば、&lt;code>admin&lt;/code> グループのユーザーが Web ページを表示しているときは、管理者向けのメニュー表示をする、といったケースです。&lt;/p>
&lt;p>幸い、&lt;code>aws-amplify&lt;/code> モジュールの &lt;code>Auth&lt;/code> オブジェクトが提供する認証情報を参照することで、認証済みのユーザーがどの Cognito グループに属しているかを調べることができます。
具体的には、&lt;code>Auth.currentAuthenticatedUser()&lt;/code> などが返すユーザー情報のアクセストークンのペイロードに &lt;strong>&lt;code>cognito:groups&lt;/code>&lt;/strong> というプロパティがあり、そこに Cognito グループ名のリストが格納されています。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-access-token.html">Using the Access Token - Amazon Cognito&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>次のようなカスタムフック &lt;code>useAuthState&lt;/code> を定義しておくと、戻り値の &lt;code>isAdmin&lt;/code> プロパティを見るだけで、現在のユーザーが admin グループに属しているかを確認できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">src/hooks/useAuthState.tsx&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">useState&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;react&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">Auth&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;aws-amplify&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">AuthState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">CognitoUserInterface&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">onAuthUIStateChange&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@aws-amplify/ui-components&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ユーザーがこのグループ名の Cognito グループに所属しているときに、
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// useAuthState フックが返す isAdmin プロパティを true にします。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="nx">ADMIN_GROUP_NAME&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;admin&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/** useAuthState フックの戻り値の型 */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">type&lt;/span> &lt;span class="nx">UseAuthStateOutput&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isSignedIn&lt;/span>: &lt;span class="kt">boolean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isAdmin&lt;/span>: &lt;span class="kt">boolean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">user&lt;/span>: &lt;span class="kt">CognitoUserInterface&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="kc">undefined&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/** 現在の認証状態を取得するためのフック関数です。 */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">useAuthState&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">UseAuthStateOutput&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Cognito によるサインイン状態やユーザー情報を保持するステート
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">authState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setAuthState&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">AuthState&lt;/span> &lt;span class="err">|&lt;/span> &lt;span class="na">undefined&lt;/span>&lt;span class="p">&amp;gt;()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">user&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setUser&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useState&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">CognitoUserInterface&lt;/span> &lt;span class="err">|&lt;/span> &lt;span class="na">undefined&lt;/span>&lt;span class="p">&amp;gt;()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 画面遷移時に onAuthUIStateChange が呼ばれないことへの対応
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// https://github.com/aws-amplify/docs/issues/2895
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">authState&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Auth&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">currentAuthenticatedUser&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="nx">then&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">authData&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setAuthState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">AuthState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">SignedIn&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setUser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">authData&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="cm">/* Nothing to do */&lt;/span> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">onAuthUIStateChange&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">nextAuthState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">authData&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setAuthState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">nextAuthState&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setUser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">authData&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">CognitoUserInterface&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">authState&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isSignedIn&lt;/span>: &lt;span class="kt">authState&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="nx">AuthState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">SignedIn&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isAdmin&lt;/span>: &lt;span class="kt">isAdmin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">user&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">user&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// アクセストークン内のグループ名リストに &amp;#34;admin&amp;#34; があるかを調べます。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="nx">isAdmin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">user&lt;/span>: &lt;span class="kt">CognitoUserInterface&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kr">boolean&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">groups&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">user&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">signInUserSession&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">accessToken&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">payload&lt;/span>&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;cognito:groups&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nb">Array&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">string&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">groups&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">includes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ADMIN_GROUP_NAME&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">??&lt;/span> &lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記のフック実装では、戻り値の &lt;code>user&lt;/code> プロパティで &lt;code>CognitoUserInterface&lt;/code> 情報を返すようにしていますが、Cognito に依存する情報はできるだけフック内に隠蔽してしまった方がいいですね。
下記は、このフック関数の使用例です。
&lt;code>useAuthState()&lt;/code> が返す &lt;code>isAdmin&lt;/code> の値が true のときに、管理者用のメニューを表示するという処理を想定しています。&lt;/p></description></item><item><title>Amazon Cognito をコマンドライン (CLI) から操作する</title><link>https://maku.blog/p/yzjj4c7/</link><pubDate>Wed, 06 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/yzjj4c7/</guid><description>&lt;p>AWS CLI による Cognito 操作用のコマンドには、&lt;code>cognito-idp&lt;/code> と &lt;code>cognito-identity&lt;/code> があります。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>&lt;code>aws cognito-idp&lt;/code>&lt;/strong> &amp;hellip; Cognito User Pools の操作（ユーザープール／ID プロバイダー）
&lt;ul>
&lt;li>ユーザープール自体の作成や、ユーザーの追加・削除などを行えます。ユーザープールでの認証に成功すると、ユーザー情報を参照するためのトークンが発行されます。一般的にいうところの ID プロバイダー (IdP) です。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>&lt;code>aws cognito-identity&lt;/code>&lt;/strong> &amp;hellip; Cognito Federated Identities の操作（フェデレーテッドアイデンティティー／ID プール）
&lt;ul>
&lt;li>何らかの ID プロバイダー (IdP) で認証されたユーザーに対して、AWS サービスにアクセスするための一時的なアクセストークンを発行します。ID プロバイダーは上記の Cognito ユーザープールでもよいし、Google や Facebook などのサードパーティ ID プロバイダーでもかまいません。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="ユーザープールの操作-cognito-idp">ユーザープールの操作 (cognito-idp)&lt;/h2>
&lt;p>&lt;code>aws cognito-idp&lt;/code> のサブコマンドには、&lt;code>admin-&lt;/code> プレフィックスが付くものと付かないバージョンがあったりしますが、プレフィックスがない方は、ユーザー認証後に取得できるトークンの指定 (&lt;code>--access-token&lt;/code>) が必要です。&lt;/p>
&lt;h3 id="ユーザープールを作成する-cognito-idp-create-user-pool">ユーザープールを作成する (cognito-idp create-user-pool)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws cognito-idp create-user-pool --pool-name &lt;span class="s2">&amp;#34;Test user pool&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ユーザープールの作成に成功すると、初期設定の内容（パスワードのルールなど）が出力されます。&lt;/p>
&lt;h3 id="ユーザープールを削除する-cognito-idp-delete-user-pool">ユーザープールを削除する (cognito-idp delete-user-pool)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws cognito-idp delete-user-pool --user-pool-id ap-northeast-1_5O6lfqrqN
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>--user-pool-id&lt;/code> オプションには、ユーザープール名ではなく、ユーザープール ID を指定することに注意してください。
ユーザープール ID は、&lt;code>cognito-idp list-user-pools&lt;/code> コマンドで確認できます。&lt;/p></description></item><item><title>Amazon Cognito をコマンドライン (CLI) から操作する</title><link>https://maku.blog/p/yzjj4c7/</link><pubDate>Wed, 06 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/yzjj4c7/</guid><description>&lt;p>AWS CLI による Cognito 操作用のコマンドには、&lt;code>cognito-idp&lt;/code> と &lt;code>cognito-identity&lt;/code> があります。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>&lt;code>aws cognito-idp&lt;/code>&lt;/strong> &amp;hellip; Cognito User Pools の操作（ユーザープール／ID プロバイダー）
&lt;ul>
&lt;li>ユーザープール自体の作成や、ユーザーの追加・削除などを行えます。ユーザープールでの認証に成功すると、ユーザー情報を参照するためのトークンが発行されます。一般的にいうところの ID プロバイダー (IdP) です。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>&lt;code>aws cognito-identity&lt;/code>&lt;/strong> &amp;hellip; Cognito Federated Identities の操作（フェデレーテッドアイデンティティー／ID プール）
&lt;ul>
&lt;li>何らかの ID プロバイダー (IdP) で認証されたユーザーに対して、AWS サービスにアクセスするための一時的なアクセストークンを発行します。ID プロバイダーは上記の Cognito ユーザープールでもよいし、Google や Facebook などのサードパーティ ID プロバイダーでもかまいません。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="ユーザープールの操作-cognito-idp">ユーザープールの操作 (cognito-idp)&lt;/h2>
&lt;p>&lt;code>aws cognito-idp&lt;/code> のサブコマンドには、&lt;code>admin-&lt;/code> プレフィックスが付くものと付かないバージョンがあったりしますが、プレフィックスがない方は、ユーザー認証後に取得できるトークンの指定 (&lt;code>--access-token&lt;/code>) が必要です。&lt;/p>
&lt;h3 id="ユーザープールを作成する-cognito-idp-create-user-pool">ユーザープールを作成する (cognito-idp create-user-pool)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws cognito-idp create-user-pool --pool-name &lt;span class="s2">&amp;#34;Test user pool&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ユーザープールの作成に成功すると、初期設定の内容（パスワードのルールなど）が出力されます。&lt;/p>
&lt;h3 id="ユーザープールを削除する-cognito-idp-delete-user-pool">ユーザープールを削除する (cognito-idp delete-user-pool)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws cognito-idp delete-user-pool --user-pool-id ap-northeast-1_5O6lfqrqN
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>--user-pool-id&lt;/code> オプションには、ユーザープール名ではなく、ユーザープール ID を指定することに注意してください。
ユーザープール ID は、&lt;code>cognito-idp list-user-pools&lt;/code> コマンドで確認できます。&lt;/p></description></item><item><title>AWS CloudFormation をコマンドライン (CLI) で操作する</title><link>https://maku.blog/p/zkxamw9/</link><pubDate>Thu, 11 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/zkxamw9/</guid><description>&lt;h2 id="テンプレートファイルが正しく記述できているか確認する-cloudformation-validate-template">テンプレートファイルが正しく記述できているか確認する (cloudformation validate-template)&lt;/h2>
&lt;p>YAML や JSON 形式で作成した CloudFormation 用のテンプレートファイルが、正しく記述できているかを調べることができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">正しく記述できている場合&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation validate-template --template-body file://template.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Description: Sample template
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Parameters: []&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">不正なフォーマットの場合&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">An error occurred (ValidationError) when calling the ValidateTemplate operation: Template format error: JSON not well-formed. (line 5, column 2)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">不正なプロパティがある場合&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">An error occurred (ValidationError) when calling the ValidateTemplate operation: Invalid template property or properties [ABC]&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="スタックを作成する-cloudformation-create-stack">スタックを作成する (cloudformation create-stack)&lt;/h2>
&lt;h3 id="ローカルの-yaml-テンプレートから生成">ローカルの YAML テンプレートから生成&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation create-stack --stack-name mystack \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --template-body file://template.yml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;div class="xAccordion">
 &lt;input id="id-764891235" type="checkbox">
 &lt;label class="xAccordion_title" for="id-764891235">実行結果&lt;/label>
 &lt;div class="xAccordion_body">
 

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">StackId: arn:aws:cloudformation:ap-northeast-1:123456789012:stack/mystack/b810c3cd-e492-eb11-6cab-b7f82d02a2e5&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


 &lt;/div>
&lt;/div>


&lt;h3 id="s3-バケット上の-yaml-テンプレートから生成">S3 バケット上の YAML テンプレートから生成&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation create-stack --stack-name mystack \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --template-url https://s3.xxx.xxx/.../template.yaml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="パラメーターを指定する場合">パラメーターを指定する場合&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation create-stack --stack-name mystack \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --template-body file://template.yml \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --parameters &amp;#34;ParameterKey=Key1,ParameterValue=Value1&amp;#34; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;ParameterKey=Key2,ParameterValue=Value2&amp;#34; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;ParameterKey=Key3,ParameterValue=Value3&amp;#34;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="スタックの情報を取得する-cloudformation-describe-stacks-describe-stack-resources">スタックの情報を取得する (cloudformation describe-stacks, describe-stack-resources)&lt;/h2>
&lt;h3 id="スタックの一覧を取得する">スタックの一覧を取得する&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation describe-stacks&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="指定したスタックの情報を取得する">指定したスタックの情報を取得する&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation describe-stacks --stack-name &amp;lt;スタック名&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;div class="xAccordion">
 &lt;input id="id-298473165" type="checkbox">
 &lt;label class="xAccordion_title" for="id-298473165">実行結果&lt;/label>
 &lt;div class="xAccordion_body">
 

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Stacks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">CreationTime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2021-04-01T12:21:20.064000+00:00&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">DisableRollback&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">DriftInformation&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">StackDriftStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">NOT_CHECKED&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">EnableTerminationProtection&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">NotificationARNs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RollbackConfiguration&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">StackId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">arn:aws:cloudformation:ap-northeast-1:123456789012:stack/mystack/b810c3cd-e492-eb11-6cab-b7f82d02a2e5&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">StackName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mystack&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">StackStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CREATE_COMPLETE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Tags&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[]&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


 &lt;/div>
&lt;/div>


&lt;h3 id="指定したスタック内のリソースリストを取得する">指定したスタック内のリソースリストを取得する&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation describe-stack-resources --stack-name &amp;lt;スタック名&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;div class="xAccordion">
 &lt;input id="id-463189275" type="checkbox">
 &lt;label class="xAccordion_title" for="id-463189275">実行結果（1つのS3バケットがある場合）&lt;/label>
 &lt;div class="xAccordion_body">
 

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">StackResources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">DriftInformation&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">StackResourceDriftStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">NOT_CHECKED&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">LogicalResourceId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">HelloBucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">PhysicalResourceId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mystack-hellobucket-npd68k1m8ut8a&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ResourceStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CREATE_COMPLETE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ResourceType&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::S3::Bucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">StackId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">arn:aws:cloudformation:ap-northeast-1:123456789012:stack/mystack/de70c0f6-f192-eb11-1b8b-55dc1106bc7d&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">StackName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mystack&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Timestamp&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2021-04-01T13:54:43.857000+00:00&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


 &lt;/div>
&lt;/div>


&lt;h2 id="スタックを削除する-cloudformation-delete-stack">スタックを削除する (cloudformation delete-stack)&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation delete-stack --stack-name &amp;lt;STACK_NAME&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="スタックが特定のステータスになるまで待機する-cloudformation-wait">スタックが特定のステータスになるまで待機する (cloudformation wait)&lt;/h2>
&lt;h3 id="スタックが-create_complete-になるまで待機する">スタックが CREATE_COMPLETE になるまで待機する&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation wait stack-create-complete --stack-name &amp;lt;STACK_NAME&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="チェンジセットが-create_complete-になるまで待機する">チェンジセットが CREATE_COMPLETE になるまで待機する&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation wait change-set-create-complete \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --stack-name &amp;lt;STACK_NAME&amp;gt; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --change-set-name &amp;lt;CHANGE_SET_NAME&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>AWS CloudFormation をコマンドライン (CLI) で操作する</title><link>https://maku.blog/p/zkxamw9/</link><pubDate>Thu, 11 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/zkxamw9/</guid><description>&lt;h2 id="テンプレートファイルが正しく記述できているか確認する-cloudformation-validate-template">テンプレートファイルが正しく記述できているか確認する (cloudformation validate-template)&lt;/h2>
&lt;p>YAML や JSON 形式で作成した CloudFormation 用のテンプレートファイルが、正しく記述できているかを調べることができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">正しく記述できている場合&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation validate-template --template-body file://template.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Description: Sample template
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Parameters: []&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">不正なフォーマットの場合&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">An error occurred (ValidationError) when calling the ValidateTemplate operation: Template format error: JSON not well-formed. (line 5, column 2)&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">不正なプロパティがある場合&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">An error occurred (ValidationError) when calling the ValidateTemplate operation: Invalid template property or properties [ABC]&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="スタックを作成する-cloudformation-create-stack">スタックを作成する (cloudformation create-stack)&lt;/h2>
&lt;h3 id="ローカルの-yaml-テンプレートから生成">ローカルの YAML テンプレートから生成&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation create-stack --stack-name mystack \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --template-body file://template.yml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;div class="xAccordion">
 &lt;input id="id-764891235" type="checkbox">
 &lt;label class="xAccordion_title" for="id-764891235">実行結果&lt;/label>
 &lt;div class="xAccordion_body">
 

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">StackId: arn:aws:cloudformation:ap-northeast-1:123456789012:stack/mystack/b810c3cd-e492-eb11-6cab-b7f82d02a2e5&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


 &lt;/div>
&lt;/div>


&lt;h3 id="s3-バケット上の-yaml-テンプレートから生成">S3 バケット上の YAML テンプレートから生成&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation create-stack --stack-name mystack \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --template-url https://s3.xxx.xxx/.../template.yaml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="パラメーターを指定する場合">パラメーターを指定する場合&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation create-stack --stack-name mystack \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --template-body file://template.yml \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --parameters &amp;#34;ParameterKey=Key1,ParameterValue=Value1&amp;#34; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;ParameterKey=Key2,ParameterValue=Value2&amp;#34; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;ParameterKey=Key3,ParameterValue=Value3&amp;#34;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="スタックの情報を取得する-cloudformation-describe-stacks-describe-stack-resources">スタックの情報を取得する (cloudformation describe-stacks, describe-stack-resources)&lt;/h2>
&lt;h3 id="スタックの一覧を取得する">スタックの一覧を取得する&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation describe-stacks&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="指定したスタックの情報を取得する">指定したスタックの情報を取得する&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation describe-stacks --stack-name &amp;lt;スタック名&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;div class="xAccordion">
 &lt;input id="id-298473165" type="checkbox">
 &lt;label class="xAccordion_title" for="id-298473165">実行結果&lt;/label>
 &lt;div class="xAccordion_body">
 

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Stacks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">CreationTime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2021-04-01T12:21:20.064000+00:00&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">DisableRollback&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">DriftInformation&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">StackDriftStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">NOT_CHECKED&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">EnableTerminationProtection&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">NotificationARNs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RollbackConfiguration&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">StackId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">arn:aws:cloudformation:ap-northeast-1:123456789012:stack/mystack/b810c3cd-e492-eb11-6cab-b7f82d02a2e5&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">StackName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mystack&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">StackStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CREATE_COMPLETE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Tags&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[]&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


 &lt;/div>
&lt;/div>


&lt;h3 id="指定したスタック内のリソースリストを取得する">指定したスタック内のリソースリストを取得する&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation describe-stack-resources --stack-name &amp;lt;スタック名&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;div class="xAccordion">
 &lt;input id="id-463189275" type="checkbox">
 &lt;label class="xAccordion_title" for="id-463189275">実行結果（1つのS3バケットがある場合）&lt;/label>
 &lt;div class="xAccordion_body">
 

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">StackResources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">DriftInformation&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">StackResourceDriftStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">NOT_CHECKED&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">LogicalResourceId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">HelloBucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">PhysicalResourceId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mystack-hellobucket-npd68k1m8ut8a&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ResourceStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CREATE_COMPLETE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ResourceType&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::S3::Bucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">StackId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">arn:aws:cloudformation:ap-northeast-1:123456789012:stack/mystack/de70c0f6-f192-eb11-1b8b-55dc1106bc7d&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">StackName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mystack&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Timestamp&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2021-04-01T13:54:43.857000+00:00&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


 &lt;/div>
&lt;/div>


&lt;h2 id="スタックを削除する-cloudformation-delete-stack">スタックを削除する (cloudformation delete-stack)&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation delete-stack --stack-name &amp;lt;STACK_NAME&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="スタックが特定のステータスになるまで待機する-cloudformation-wait">スタックが特定のステータスになるまで待機する (cloudformation wait)&lt;/h2>
&lt;h3 id="スタックが-create_complete-になるまで待機する">スタックが CREATE_COMPLETE になるまで待機する&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation wait stack-create-complete --stack-name &amp;lt;STACK_NAME&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="チェンジセットが-create_complete-になるまで待機する">チェンジセットが CREATE_COMPLETE になるまで待機する&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation wait change-set-create-complete \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --stack-name &amp;lt;STACK_NAME&amp;gt; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --change-set-name &amp;lt;CHANGE_SET_NAME&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Amazon EC2 で Hello World (1) キーペアの作成</title><link>https://maku.blog/p/pcp3doy/</link><pubDate>Tue, 02 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/pcp3doy/</guid><description>&lt;h2 id="ec2-を使う前に-ssh-キーペアを作成しておく">EC2 を使う前に SSH キーペアを作成しておく&lt;/h2>
&lt;p>立ち上げた EC2 インスタンスは SSH で接続して操作するため、まずはキーペア（公開鍵＋秘密鍵）を作成して、その公開鍵を EC2 に登録しておく必要があります。
一度公開鍵を登録すると、EC2 インスタンスを作成するときに、割り当てる公開鍵をプルダウンから選択できるようになります。&lt;/p>
&lt;h2 id="ec2-コンソールからキーペアを作成する">EC2 コンソールからキーペアを作成する&lt;/h2>
&lt;p>SSH 接続用のキーペアは、ローカルで作成して EC2 に登録することもできますし、EC2 コンソール上で新規作成することもできます。
EC2 上で作成すると、公開鍵が自動的に EC2 に登録された状態になるのでちょっとだけ楽です。
ここでは、次のように EC2 上でキーペアを作成します。&lt;/p>
&lt;ol>
&lt;li>&lt;a href="https://console.aws.amazon.com/ec2/v2/home">EC2 マネージメントコンソール&lt;/a> を開く&lt;/li>
&lt;li>サイドバーから &lt;strong>&lt;code>キーペア&lt;/code>&lt;/strong> を選択し、&lt;strong>&lt;code>キーペアを作成&lt;/code>&lt;/strong> をクリック&lt;/li>
&lt;li>キーペアの作成画面で名前とファイル形式を入力し、&lt;strong>&lt;code>キーペアを作成&lt;/code>&lt;/strong> をクリック
&lt;ul>
&lt;li>名前: &lt;strong>&lt;code>ec2key&lt;/code>&lt;/strong> など自由に入力&lt;/li>
&lt;li>ファイル形式:（使用する SSH クライアントに合わせて選択）
&lt;ul>
&lt;li>&lt;code>pem&lt;/code> 形式 &amp;hellip; OpenSSH を使う場合（主に Linux/macOS）&lt;/li>
&lt;li>&lt;code>ppk&lt;/code> 形式 &amp;hellip; PuTTY を使う場合（主に Windows）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>すると、自動的に &lt;code>ec2key.pem&lt;/code>（秘密鍵）のダウンロードが始まるので、&lt;code>~/.ssh&lt;/code> ディレクトリなどに確実に保存します。
この &lt;strong>キーファイルを再度ダウンロードすることはできないので注意してください&lt;/strong>。&lt;/p>
&lt;p>EC2 コンソール上に次のように表示されていれば、今後 EC2 インスタンスを生成するときにこのキーを選択できます。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="1910" height="484" src="../../p/pcp3doy/img-001.png" alt="/p/pcp3doy/img-001.png" />
&lt;/figure>

&lt;h2 id="秘密鍵ファイルのパーミッションを設定する">秘密鍵ファイルのパーミッションを設定する&lt;/h2>
&lt;p>ローカル PC に保存した秘密鍵ファイル (&lt;code>.pem&lt;/code>) には、自分だけを読み取り可能にするよう、適切なパーミッションを設定しておく必要があります。
これをやっておかないと、&lt;code>ssh&lt;/code> コマンドを実行するときに、&lt;code>WARNING: UNPROTECTED PRIVATE KEY FILE!&lt;/code> といった警告が出て接続ができません。&lt;/p></description></item><item><title>DynamoDB を Node.js で操作する（SDK ver.3 の場合）</title><link>https://maku.blog/p/5mv5dkt/</link><pubDate>Tue, 02 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/5mv5dkt/</guid><description>&lt;p>ここでは、Node.js 用の AWS SDK ver.3 を使って Amazon DynamoDB を操作する方法を説明します。
&lt;a href="../../p/taiqx6d">TypeScript の基本的な環境構築&lt;/a> は終わっているものとします。&lt;/p>
&lt;h2 id="dynamodb-用の-nodejs-sdk-ver3-をインストールする">DynamoDB 用の Node.js SDK (ver.3) をインストールする&lt;/h2>
&lt;p>まずは、AWS SDK version 3 の DynamoDB 用パッケージをインストールします。
DynamoDB を操作するときに主に次のようなクライアントクラスを使用するのですが、後者の &lt;code>DynamoDBDocumentClient&lt;/code> の方は、前者の &lt;code>DynamoDBClient&lt;/code> インスタンスをラップして扱いやすくするためのクラスなので、必要に応じてインストールしてください（主にテーブル内のアイテムを扱うときに便利です）。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/clients/client-dynamodb/index.html">DynamoDBClient&lt;/a>
&lt;ul>
&lt;li>DynamoDB を扱うための基本クラス（DB クライアントと呼ばれる）&lt;/li>
&lt;li>&lt;strong>&lt;code>@aws-sdk/client-dynamodb&lt;/code>&lt;/strong> パッケージが必要&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/modules/_aws_sdk_lib_dynamodb.html">DynamoDBDocumentClient&lt;/a>
&lt;ul>
&lt;li>上記を扱いやすくするためのクラス（Document クライアントと呼ばれる）&lt;/li>
&lt;li>&lt;strong>&lt;code>@aws-sdk/lib-dynamodb&lt;/code>&lt;/strong> パッケージが必要&lt;/li>
&lt;li>&lt;strong>&lt;code>@aws-sdk/util-dynamodb&lt;/code>&lt;/strong> パッケージも必要っぽい&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">### yarn の場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ yarn add @aws-sdk/client-dynamodb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ yarn add @aws-sdk/lib-dynamodb @aws-sdk/util-dynamodb # Document クライアント
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">### npm の場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ npm install @aws-sdk/client-dynamodb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ npm install @aws-sdk/lib-dynamodb @aws-sdk/util-dynamodb # Document クライアント&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これで、TypeScript コードから次のようにパッケージ内のクラスをインポートできるようになります。&lt;/p></description></item><item><title>DynamoDB を Node.js で操作する（SDK ver.3 の場合）</title><link>https://maku.blog/p/5mv5dkt/</link><pubDate>Tue, 02 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/5mv5dkt/</guid><description>&lt;p>ここでは、Node.js 用の AWS SDK ver.3 を使って Amazon DynamoDB を操作する方法を説明します。
&lt;a href="../../p/taiqx6d">TypeScript の基本的な環境構築&lt;/a> は終わっているものとします。&lt;/p>
&lt;h2 id="dynamodb-用の-nodejs-sdk-ver3-をインストールする">DynamoDB 用の Node.js SDK (ver.3) をインストールする&lt;/h2>
&lt;p>まずは、AWS SDK version 3 の DynamoDB 用パッケージをインストールします。
DynamoDB を操作するときに主に次のようなクライアントクラスを使用するのですが、後者の &lt;code>DynamoDBDocumentClient&lt;/code> の方は、前者の &lt;code>DynamoDBClient&lt;/code> インスタンスをラップして扱いやすくするためのクラスなので、必要に応じてインストールしてください（主にテーブル内のアイテムを扱うときに便利です）。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/clients/client-dynamodb/index.html">DynamoDBClient&lt;/a>
&lt;ul>
&lt;li>DynamoDB を扱うための基本クラス（DB クライアントと呼ばれる）&lt;/li>
&lt;li>&lt;strong>&lt;code>@aws-sdk/client-dynamodb&lt;/code>&lt;/strong> パッケージが必要&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/modules/_aws_sdk_lib_dynamodb.html">DynamoDBDocumentClient&lt;/a>
&lt;ul>
&lt;li>上記を扱いやすくするためのクラス（Document クライアントと呼ばれる）&lt;/li>
&lt;li>&lt;strong>&lt;code>@aws-sdk/lib-dynamodb&lt;/code>&lt;/strong> パッケージが必要&lt;/li>
&lt;li>&lt;strong>&lt;code>@aws-sdk/util-dynamodb&lt;/code>&lt;/strong> パッケージも必要っぽい&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">### yarn の場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ yarn add @aws-sdk/client-dynamodb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ yarn add @aws-sdk/lib-dynamodb @aws-sdk/util-dynamodb # Document クライアント
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">### npm の場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ npm install @aws-sdk/client-dynamodb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ npm install @aws-sdk/lib-dynamodb @aws-sdk/util-dynamodb # Document クライアント&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これで、TypeScript コードから次のようにパッケージ内のクラスをインポートできるようになります。&lt;/p></description></item><item><title>AWS の初期設定: 管理者用の IAM ユーザーを作成する</title><link>https://maku.blog/p/xbipv39/</link><pubDate>Sun, 07 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/xbipv39/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>AWS のベストプラクティスでは、管理者であっても普段の作業では AWS アカウントのルートユーザーを直接使うべきではないとされています。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/4c7sdwg">AWS アカウント、IAM ユーザー、グループ、ポリシーの違い&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>そこで、まずは管理者の普段の作業用に IAM ユーザーを作成します。
この作成作業は、AWS アカウントのルートユーザーで行う必要があります（初期状態ではユーザー作成の権限がルートユーザーにしかないため）。&lt;/p>
&lt;p>ここでは、下記のような名前の IAM ユーザーとグループを作成することにします。&lt;/p>
&lt;ul>
&lt;li>IAM ユーザー: &lt;code>admin&lt;/code>&lt;/li>
&lt;li>IAM グループ: &lt;code>Admins&lt;/code> &amp;hellip; （&lt;code>AdministratorAccess&lt;/code> ポリシーを割り当てます）&lt;/li>
&lt;/ul>
&lt;h2 id="管理者用-iam-ユーザーの作成">管理者用 IAM ユーザーの作成&lt;/h2>
&lt;p>&lt;a href="https://console.aws.amazon.com/iam/">AWS IAM コンソール&lt;/a> にサインインし、次のような感じで IAM ユーザーを作成します。&lt;/p>
&lt;ol>
&lt;li>&lt;code>アクセス管理&lt;/code> → &lt;code>ユーザー&lt;/code> → &lt;strong>&lt;code>ユーザーを追加&lt;/code>&lt;/strong> を選択し、次のように入力
&lt;ul>
&lt;li>ユーザー名: &lt;strong>&lt;code>admin&lt;/code>&lt;/strong>&lt;/li>
&lt;li>アクセスの種類: CLI などで操作するなら &lt;strong>&lt;code>プログラムによるアクセス&lt;/code>&lt;/strong> にチェック&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>ユーザーをグループに追加&lt;/code> → &lt;strong>&lt;code>グループの作成&lt;/code>&lt;/strong> を選択し、次のように入力
&lt;ul>
&lt;li>グループ名: &lt;strong>&lt;code>Admins&lt;/code>&lt;/strong>&lt;/li>
&lt;li>ポリシー: &lt;strong>&lt;code>AdministratorAccess&lt;/code>&lt;/strong> を選択&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>アクセスキーや、シークレットアクセスキーを作成したのであれば、このタイミングで表示されるので、なくさないよう厳重に保存します（後から確認することはできません）。&lt;/p>
&lt;p>これで、管理者用の普段の作業も、ルートユーザーではなく、&lt;code>admin&lt;/code> という IAM ユーザーで行えるようになります。&lt;/p>
&lt;h2 id="応用開発者用の-iam-ユーザーの作成">（応用）開発者用の IAM ユーザーの作成&lt;/h2>
&lt;p>上記では管理者用の IAM ユーザーを作成しましたが、それ以外の IAM ユーザー（開発者用など）も同様に作成することができます。
AWS は開発者用の IAM ポリシーをいくつか定義しています。
&lt;code>AdministratorAccess&lt;/code> ポリシーとの大きな違いは、IAM 関連の操作（つまりユーザー管理）をするための権限を持っていないことです。&lt;/p></description></item><item><title>DynamoDB を Node.js で操作する（SDK ver.2 の場合）</title><link>https://maku.blog/p/8t7iu6g/</link><pubDate>Sat, 01 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/8t7iu6g/</guid><description>&lt;p>ここでは、Node.js 用の AWS SDK ver.2 を使って Amazon DynamoDB を操作する方法を説明します。
&lt;a href="../../p/taiqx6d">TypeScript の基本的な環境構築&lt;/a> は終わっているものとします。&lt;/p>
&lt;p>&lt;a href="../../p/5mv5dkt">SDK ver.3 を使う方法はこちらの記事&lt;/a> を参照してください。
基本的には ver.3 の使用が推奨されていますが、AWS の Lambda 実行環境は現時点（2021年5月）でも ver.2 がインストールされていたりするので、ver.2 の需要はまだあると思います。&lt;/p>
&lt;h2 id="dynamo-db-用の-sdk-ver2-をインストールする">Dynamo DB 用の SDK (ver.2) をインストールする&lt;/h2>
&lt;p>AWS SDK version 2 で DynamoDB を扱うには、次のように AWS SDK パッケージ全体をインストールする必要があります（version 3 では DynamoDB サービスなどのパッケージを個別にインストールできます）。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ npm install aws-sdk --save&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これで、TypeScript コードから次のように SDK モジュールをインポートできるようになります。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-typescript" data-lang="typescript">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">AWS&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;aws-sdk&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>AWS.DynamoDB&lt;/code> だけ参照したければ、次のようにインポートできます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">DynamoDB&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;aws-sdk&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="dynamodb-インスタンスの生成">DynamoDB インスタンスの生成&lt;/h2>
&lt;h3 id="基本">基本&lt;/h3>
&lt;p>DynamoDB の API を呼び出すには、まずは &lt;a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB.html">AWS.DynamoDB&lt;/a> インスタンスを生成する必要があります。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">AWS&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;aws-sdk&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">dynamoDb&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">AWS&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">DynamoDB&lt;/span>&lt;span class="p">();&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="接続設定-config">接続設定 (config)&lt;/h3>
&lt;p>&lt;a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB.html#constructor-property">DynamoDB コンストランクタ&lt;/a> の引数でオプションオブジェクトを渡すと、接続先のリージョンやエンドポイントを設定することができます。
例えば、エンドポイントを &lt;code>http://localhost:8000&lt;/code> に設定すれば、&lt;a href="../../p/rdq4eq2">DynamoDB Local&lt;/a> によるテスト用サーバに接続できます。&lt;/p></description></item><item><title>DynamoDB を Node.js で操作する（SDK ver.2 の場合）</title><link>https://maku.blog/p/8t7iu6g/</link><pubDate>Sat, 01 May 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/8t7iu6g/</guid><description>&lt;p>ここでは、Node.js 用の AWS SDK ver.2 を使って Amazon DynamoDB を操作する方法を説明します。
&lt;a href="../../p/taiqx6d">TypeScript の基本的な環境構築&lt;/a> は終わっているものとします。&lt;/p>
&lt;p>&lt;a href="../../p/5mv5dkt">SDK ver.3 を使う方法はこちらの記事&lt;/a> を参照してください。
基本的には ver.3 の使用が推奨されていますが、AWS の Lambda 実行環境は現時点（2021年5月）でも ver.2 がインストールされていたりするので、ver.2 の需要はまだあると思います。&lt;/p>
&lt;h2 id="dynamo-db-用の-sdk-ver2-をインストールする">Dynamo DB 用の SDK (ver.2) をインストールする&lt;/h2>
&lt;p>AWS SDK version 2 で DynamoDB を扱うには、次のように AWS SDK パッケージ全体をインストールする必要があります（version 3 では DynamoDB サービスなどのパッケージを個別にインストールできます）。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ npm install aws-sdk --save&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これで、TypeScript コードから次のように SDK モジュールをインポートできるようになります。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-typescript" data-lang="typescript">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">AWS&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;aws-sdk&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>AWS.DynamoDB&lt;/code> だけ参照したければ、次のようにインポートできます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">DynamoDB&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;aws-sdk&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="dynamodb-インスタンスの生成">DynamoDB インスタンスの生成&lt;/h2>
&lt;h3 id="基本">基本&lt;/h3>
&lt;p>DynamoDB の API を呼び出すには、まずは &lt;a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB.html">AWS.DynamoDB&lt;/a> インスタンスを生成する必要があります。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">AWS&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;aws-sdk&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">dynamoDb&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">AWS&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">DynamoDB&lt;/span>&lt;span class="p">();&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="接続設定-config">接続設定 (config)&lt;/h3>
&lt;p>&lt;a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB.html#constructor-property">DynamoDB コンストランクタ&lt;/a> の引数でオプションオブジェクトを渡すと、接続先のリージョンやエンドポイントを設定することができます。
例えば、エンドポイントを &lt;code>http://localhost:8000&lt;/code> に設定すれば、&lt;a href="../../p/rdq4eq2">DynamoDB Local&lt;/a> によるテスト用サーバに接続できます。&lt;/p></description></item><item><title>Amazon EC2 で Hello World (2) EC2 インスタンスの起動と接続</title><link>https://maku.blog/p/whu7hr3/</link><pubDate>Tue, 02 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/whu7hr3/</guid><description>&lt;h2 id="ec2-インスタンスの起動">EC2 インスタンスの起動&lt;/h2>
&lt;p>EC2 インスタンスに接続するための &lt;a href="../../p/pcp3doy">キーペアを作成&lt;/a> したら、実際に EC2 インスタンスを起動してみます。
ここでは、マシンイメージ (AMI) として EC2 用に最適化された Amazon Linux 2 を選択することにします。&lt;/p>
&lt;ol>
&lt;li>&lt;a href="https://console.aws.amazon.com/ec2/v2/home">EC2 マネージメントコンソール&lt;/a> を開く&lt;/li>
&lt;li>サイドバーの &lt;code>インスタンス&lt;/code> を選択し、&lt;strong>&lt;code>インスタンスを起動&lt;/code>&lt;/strong> ボタンを押す&lt;/li>
&lt;li>Amazon マシンイメージ (AMI) の選択画面で、&lt;strong>&lt;code>Amazon Linux 2&lt;/code>&lt;/strong> を選択&lt;/li>
&lt;li>インスタンスタイプの選択画面で、一番安い &lt;strong>&lt;code>t2.nano&lt;/code>&lt;/strong> や、一年間の無料枠がある &lt;strong>&lt;code>t2.micro&lt;/code>&lt;/strong> を選択（料金の参考: &lt;a href="https://instances.vantage.sh/?selected=t2.nano">EC2Instances.info&lt;/a>）&lt;/li>
&lt;li>&lt;strong>&lt;code>確認と作成&lt;/code>&lt;/strong> ボタンを押す&lt;/li>
&lt;li>使用するキーペアを選択する画面が表示されるので、&lt;a href="">あらかじめ設定しておいた&lt;/a> キーペアを選択して、&lt;strong>&lt;code>インスタンスの作成&lt;/code>&lt;/strong> ボタンを押す

 
 &lt;figure class="xImage">
 &lt;img style="border: solid #ccc 2px;" width="500" height="319" src="../../p/whu7hr3/img-001_hu2770963068247443711.png" alt="/p/whu7hr3/img-001.png" />
 &lt;figcaption>図: キーペアの選択&lt;/figcaption>
 &lt;/figure>
&lt;/li>
&lt;/ol>
&lt;p>あとは数分待てば、EC2 インスタンスが起動します。&lt;/p>
&lt;h2 id="ec2-インスタンスへの-ssh-接続">EC2 インスタンスへの SSH 接続&lt;/h2>
&lt;p>EC2 インスタンスが無事起動したら、SSH で接続してみます。
接続用のユーザー名やアドレスは、次のようにして確認することができます。&lt;/p>
&lt;ol>
&lt;li>&lt;a href="https://console.aws.amazon.com/ec2/v2/home">EC2 マネージメントコンソール&lt;/a> を開く&lt;/li>
&lt;li>サイドバーの &lt;code>インスタンス&lt;/code> を選択し、対象の EC2 インスタンスを選択&lt;/li>
&lt;li>&lt;strong>&lt;code>接続&lt;/code>&lt;/strong> ボタンを押す&lt;/li>
&lt;/ol>
&lt;p>すると、次のような感じで接続先のユーザー名（&lt;code>ec2-user&lt;/code>）や DNS アドレス（&lt;code>ec2-XXXXX&lt;/code>) を確認することができます。&lt;/p></description></item><item><title>TypeScript で AWS SDK を使う開発環境を整える</title><link>https://maku.blog/p/taiqx6d/</link><pubDate>Thu, 25 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/taiqx6d/</guid><description>&lt;h2 id="typescript-のプロジェクトを作成する">TypeScript のプロジェクトを作成する&lt;/h2>
&lt;h3 id="何をできるようにするか">何をできるようにするか？&lt;/h3>
&lt;p>ここでは、Node.js はインストール済みであるという前提で、次のようなことを行える TypeScript 環境を整えます。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>&lt;code>npm run build&lt;/code>&lt;/strong> で &lt;code>src&lt;/code> ディレクトリ以下の &lt;code>.ts&lt;/code> ファイルをコンパイルする&lt;br>
（&lt;code>.js&lt;/code> ファイルが &lt;code>build&lt;/code> ディレクトリ以下に出力される）&lt;/li>
&lt;li>&lt;strong>&lt;code>npm start&lt;/code>&lt;/strong> でコンパイルされた &lt;code>build/main.js&lt;/code> を起動する&lt;/li>
&lt;/ul>
&lt;p>下記のセットアップ手順の &lt;a href="../../p/ak7u3h3">詳しい意味はこちらを参照&lt;/a> していただくとして、ここでは一気にセットアップを終わらせてしまいます。&lt;/p>
&lt;h3 id="セットアップ">セットアップ&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># アプリ用のディレクトリを作成&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ mkdir myapp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">cd&lt;/span> myapp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Node.js アプリの設定ファイル (package.json) を生成&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ npm init -y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># TypeScript および Node 型情報をインストール&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ npm install typescript -D
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ npm install @types/node -D
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># TypeScript の設定ファイル (tsconfig.json) を生成&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ npx tsc --init&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>package.json&lt;/code> を次のような感じで修正します。
主に &lt;code>scripts&lt;/code> の定義です。&lt;/p></description></item><item><title>AWS CloudFormation で Lambda 関数のリソースを生成する</title><link>https://maku.blog/p/w8s8kx9/</link><pubDate>Mon, 05 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/w8s8kx9/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>AWS CloudFormation を使うと Lambda 関数を含むインフラ（AWS リソース群）をまとめて生成することができますが、AWS CloudFormation の拡張である AWS SAM を使うと、もっと簡潔に Lambda 関数のリソースを生成することができます。&lt;/p>
&lt;p>例えば、CloudFormation テンプレートの &lt;code>AWS::Lambda::Function&lt;/code> リソースでは、&lt;code>Role&lt;/code> プロパティが必須でしたが、SAM テンプレートの &lt;code>AWS::Serverless::Function&lt;/code> リソースでは、&lt;code>Role&lt;/code> プロパティはオプショナルになっています。
&lt;code>Role&lt;/code> プロパティを省略すると、Lambda 関数に付けた論理 ID (Logical ID) をもとに、&lt;code>&amp;lt;論理ID&amp;gt;Role&lt;/code> という名前のロールが自動生成されます。&lt;/p>
&lt;p>ここでは、AWS SAM を使った Lambda 関数生成の基本として、次のようなパターンで CloudFormation スタックを生成してみます。&lt;/p>
&lt;ol>
&lt;li>SAM テンプレートに関数コードを埋め込んでデプロイ&lt;/li>
&lt;li>S3 バケット上の関数の ZIP ファイルを使ってデプロイ&lt;/li>
&lt;/ol>
&lt;h2 id="sam-テンプレートに関数コードを埋め込んでデプロイ">SAM テンプレートに関数コードを埋め込んでデプロイ&lt;/h2>
&lt;p>まずは、一番シンプルな例として、SAM テンプレート内に Lambda 関数の実装をハードコーディングしてしまい、それをデプロイ（CloudFormation スタックの生成）してみます。&lt;/p>
&lt;p>下記が SAM テンプレートです。
SAM で Lambda 関数のリソースを定義するときは、リソースタイプとして &lt;strong>&lt;code>AWS::Serverless::Function&lt;/code>&lt;/strong> を指定します（CloudFormation では &lt;code>AWS::Lambda::Function&lt;/code> です）。
ここでは関数の実装を &lt;strong>&lt;code>InlineCode&lt;/code>&lt;/strong> プロパティでハードコーディングし、単純な &lt;code>Hello World!&lt;/code> メッセージをレスポンスとして返すようにしています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Description&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Simple Lambda Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">HelloFunction&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Runtime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">python3.7&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">index.handler&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">InlineCode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> def handler(event, context):
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> return {&amp;#39;body&amp;#39;: &amp;#39;Hello World!&amp;#39;, &amp;#39;statusCode&amp;#39;: 200}&lt;/span>&lt;span class="w"> &lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>この例では省略していますが、&lt;code>Function&lt;/code> リソースのプロパティ &lt;code>PackageType&lt;/code> はデフォルトで &lt;code>Zip&lt;/code> となっており、この場合は、関数の実体を &lt;code>CodeUri&lt;/code>（ZIP ファイルのパス）か、&lt;code>InlineCode&lt;/code>（ハードコーディング）のどちらかで指定します。
この例では、&lt;code>InlineCode&lt;/code> で関数の内容を埋め込んでいます。&lt;/p></description></item><item><title>AWS CloudFormation で Lambda 関数のリソースを生成する</title><link>https://maku.blog/p/w8s8kx9/</link><pubDate>Mon, 05 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/w8s8kx9/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>AWS CloudFormation を使うと Lambda 関数を含むインフラ（AWS リソース群）をまとめて生成することができますが、AWS CloudFormation の拡張である AWS SAM を使うと、もっと簡潔に Lambda 関数のリソースを生成することができます。&lt;/p>
&lt;p>例えば、CloudFormation テンプレートの &lt;code>AWS::Lambda::Function&lt;/code> リソースでは、&lt;code>Role&lt;/code> プロパティが必須でしたが、SAM テンプレートの &lt;code>AWS::Serverless::Function&lt;/code> リソースでは、&lt;code>Role&lt;/code> プロパティはオプショナルになっています。
&lt;code>Role&lt;/code> プロパティを省略すると、Lambda 関数に付けた論理 ID (Logical ID) をもとに、&lt;code>&amp;lt;論理ID&amp;gt;Role&lt;/code> という名前のロールが自動生成されます。&lt;/p>
&lt;p>ここでは、AWS SAM を使った Lambda 関数生成の基本として、次のようなパターンで CloudFormation スタックを生成してみます。&lt;/p>
&lt;ol>
&lt;li>SAM テンプレートに関数コードを埋め込んでデプロイ&lt;/li>
&lt;li>S3 バケット上の関数の ZIP ファイルを使ってデプロイ&lt;/li>
&lt;/ol>
&lt;h2 id="sam-テンプレートに関数コードを埋め込んでデプロイ">SAM テンプレートに関数コードを埋め込んでデプロイ&lt;/h2>
&lt;p>まずは、一番シンプルな例として、SAM テンプレート内に Lambda 関数の実装をハードコーディングしてしまい、それをデプロイ（CloudFormation スタックの生成）してみます。&lt;/p>
&lt;p>下記が SAM テンプレートです。
SAM で Lambda 関数のリソースを定義するときは、リソースタイプとして &lt;strong>&lt;code>AWS::Serverless::Function&lt;/code>&lt;/strong> を指定します（CloudFormation では &lt;code>AWS::Lambda::Function&lt;/code> です）。
ここでは関数の実装を &lt;strong>&lt;code>InlineCode&lt;/code>&lt;/strong> プロパティでハードコーディングし、単純な &lt;code>Hello World!&lt;/code> メッセージをレスポンスとして返すようにしています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Description&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Simple Lambda Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">HelloFunction&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Runtime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">python3.7&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">index.handler&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">InlineCode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> def handler(event, context):
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> return {&amp;#39;body&amp;#39;: &amp;#39;Hello World!&amp;#39;, &amp;#39;statusCode&amp;#39;: 200}&lt;/span>&lt;span class="w"> &lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>この例では省略していますが、&lt;code>Function&lt;/code> リソースのプロパティ &lt;code>PackageType&lt;/code> はデフォルトで &lt;code>Zip&lt;/code> となっており、この場合は、関数の実体を &lt;code>CodeUri&lt;/code>（ZIP ファイルのパス）か、&lt;code>InlineCode&lt;/code>（ハードコーディング）のどちらかで指定します。
この例では、&lt;code>InlineCode&lt;/code> で関数の内容を埋め込んでいます。&lt;/p></description></item><item><title>AWS CloudFormation で Lambda 関数のリソースを生成する</title><link>https://maku.blog/p/w8s8kx9/</link><pubDate>Mon, 05 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/w8s8kx9/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>AWS CloudFormation を使うと Lambda 関数を含むインフラ（AWS リソース群）をまとめて生成することができますが、AWS CloudFormation の拡張である AWS SAM を使うと、もっと簡潔に Lambda 関数のリソースを生成することができます。&lt;/p>
&lt;p>例えば、CloudFormation テンプレートの &lt;code>AWS::Lambda::Function&lt;/code> リソースでは、&lt;code>Role&lt;/code> プロパティが必須でしたが、SAM テンプレートの &lt;code>AWS::Serverless::Function&lt;/code> リソースでは、&lt;code>Role&lt;/code> プロパティはオプショナルになっています。
&lt;code>Role&lt;/code> プロパティを省略すると、Lambda 関数に付けた論理 ID (Logical ID) をもとに、&lt;code>&amp;lt;論理ID&amp;gt;Role&lt;/code> という名前のロールが自動生成されます。&lt;/p>
&lt;p>ここでは、AWS SAM を使った Lambda 関数生成の基本として、次のようなパターンで CloudFormation スタックを生成してみます。&lt;/p>
&lt;ol>
&lt;li>SAM テンプレートに関数コードを埋め込んでデプロイ&lt;/li>
&lt;li>S3 バケット上の関数の ZIP ファイルを使ってデプロイ&lt;/li>
&lt;/ol>
&lt;h2 id="sam-テンプレートに関数コードを埋め込んでデプロイ">SAM テンプレートに関数コードを埋め込んでデプロイ&lt;/h2>
&lt;p>まずは、一番シンプルな例として、SAM テンプレート内に Lambda 関数の実装をハードコーディングしてしまい、それをデプロイ（CloudFormation スタックの生成）してみます。&lt;/p>
&lt;p>下記が SAM テンプレートです。
SAM で Lambda 関数のリソースを定義するときは、リソースタイプとして &lt;strong>&lt;code>AWS::Serverless::Function&lt;/code>&lt;/strong> を指定します（CloudFormation では &lt;code>AWS::Lambda::Function&lt;/code> です）。
ここでは関数の実装を &lt;strong>&lt;code>InlineCode&lt;/code>&lt;/strong> プロパティでハードコーディングし、単純な &lt;code>Hello World!&lt;/code> メッセージをレスポンスとして返すようにしています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Description&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Simple Lambda Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">HelloFunction&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Runtime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">python3.7&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">index.handler&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">InlineCode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> def handler(event, context):
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> return {&amp;#39;body&amp;#39;: &amp;#39;Hello World!&amp;#39;, &amp;#39;statusCode&amp;#39;: 200}&lt;/span>&lt;span class="w"> &lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>この例では省略していますが、&lt;code>Function&lt;/code> リソースのプロパティ &lt;code>PackageType&lt;/code> はデフォルトで &lt;code>Zip&lt;/code> となっており、この場合は、関数の実体を &lt;code>CodeUri&lt;/code>（ZIP ファイルのパス）か、&lt;code>InlineCode&lt;/code>（ハードコーディング）のどちらかで指定します。
この例では、&lt;code>InlineCode&lt;/code> で関数の内容を埋め込んでいます。&lt;/p></description></item><item><title>AWS CloudFormation の設定例: Lambda 関数の設定いろいろ</title><link>https://maku.blog/p/pbo2dpy/</link><pubDate>Thu, 08 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/pbo2dpy/</guid><description>&lt;h2 id="タイムアウト時間-timeout">タイムアウト時間 (Timeout)&lt;/h2>
&lt;p>Lambda 関数のタイムアウト時間（最大実行可能時間）を設定するには、&lt;code>Timeout&lt;/code> プロパティで秒単位の指定を行います。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: タイムアウトを 15 秒にする&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyLambda&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Runtime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nodejs14.x&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CodeUri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">function.zip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">index.handler&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">15&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>すべての Lambda 関数の Timeout 値をまとめて設定したいときは、&lt;code>Globals&lt;/code> セクションを使います。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Globals&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Function&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Runtime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nodejs14.x&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CodeUri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">function.zip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">15&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyLambda1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">index.handler1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyLambda2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">index.handler2&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="環境変数-environment">環境変数 (Environment)&lt;/h2>
&lt;p>Lambda 関数の中から参照可能な環境変数を設定するには、&lt;strong>&lt;code>Variables&lt;/code>&lt;/strong> プロパティに、キーと値のペアを指定します。
すべての Lambda 関数に共通で設定する環境変数は、&lt;code>Globals&lt;/code> セクションで定義します。&lt;/p></description></item><item><title>AWS CloudFormation の設定例: Lambda 関数の設定いろいろ</title><link>https://maku.blog/p/pbo2dpy/</link><pubDate>Thu, 08 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/pbo2dpy/</guid><description>&lt;h2 id="タイムアウト時間-timeout">タイムアウト時間 (Timeout)&lt;/h2>
&lt;p>Lambda 関数のタイムアウト時間（最大実行可能時間）を設定するには、&lt;code>Timeout&lt;/code> プロパティで秒単位の指定を行います。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: タイムアウトを 15 秒にする&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyLambda&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Runtime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nodejs14.x&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CodeUri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">function.zip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">index.handler&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">15&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>すべての Lambda 関数の Timeout 値をまとめて設定したいときは、&lt;code>Globals&lt;/code> セクションを使います。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Globals&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Function&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Runtime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nodejs14.x&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CodeUri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">function.zip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">15&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyLambda1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">index.handler1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyLambda2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">index.handler2&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="環境変数-environment">環境変数 (Environment)&lt;/h2>
&lt;p>Lambda 関数の中から参照可能な環境変数を設定するには、&lt;strong>&lt;code>Variables&lt;/code>&lt;/strong> プロパティに、キーと値のペアを指定します。
すべての Lambda 関数に共通で設定する環境変数は、&lt;code>Globals&lt;/code> セクションで定義します。&lt;/p></description></item><item><title>AWS CloudFormation の設定例: Lambda 関数の設定いろいろ</title><link>https://maku.blog/p/pbo2dpy/</link><pubDate>Thu, 08 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/pbo2dpy/</guid><description>&lt;h2 id="タイムアウト時間-timeout">タイムアウト時間 (Timeout)&lt;/h2>
&lt;p>Lambda 関数のタイムアウト時間（最大実行可能時間）を設定するには、&lt;code>Timeout&lt;/code> プロパティで秒単位の指定を行います。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: タイムアウトを 15 秒にする&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyLambda&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Runtime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nodejs14.x&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CodeUri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">function.zip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">index.handler&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">15&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>すべての Lambda 関数の Timeout 値をまとめて設定したいときは、&lt;code>Globals&lt;/code> セクションを使います。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Globals&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Function&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Runtime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nodejs14.x&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CodeUri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">function.zip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">15&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyLambda1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">index.handler1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyLambda2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">index.handler2&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="環境変数-environment">環境変数 (Environment)&lt;/h2>
&lt;p>Lambda 関数の中から参照可能な環境変数を設定するには、&lt;strong>&lt;code>Variables&lt;/code>&lt;/strong> プロパティに、キーと値のペアを指定します。
すべての Lambda 関数に共通で設定する環境変数は、&lt;code>Globals&lt;/code> セクションで定義します。&lt;/p></description></item><item><title>AWS CloudFormation の設定例: Lambda 関数の設定いろいろ</title><link>https://maku.blog/p/pbo2dpy/</link><pubDate>Thu, 08 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/pbo2dpy/</guid><description>&lt;h2 id="タイムアウト時間-timeout">タイムアウト時間 (Timeout)&lt;/h2>
&lt;p>Lambda 関数のタイムアウト時間（最大実行可能時間）を設定するには、&lt;code>Timeout&lt;/code> プロパティで秒単位の指定を行います。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: タイムアウトを 15 秒にする&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyLambda&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Runtime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nodejs14.x&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CodeUri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">function.zip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">index.handler&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">15&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>すべての Lambda 関数の Timeout 値をまとめて設定したいときは、&lt;code>Globals&lt;/code> セクションを使います。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Globals&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Function&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Runtime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nodejs14.x&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CodeUri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">function.zip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">15&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyLambda1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">index.handler1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyLambda2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">index.handler2&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="環境変数-environment">環境変数 (Environment)&lt;/h2>
&lt;p>Lambda 関数の中から参照可能な環境変数を設定するには、&lt;strong>&lt;code>Variables&lt;/code>&lt;/strong> プロパティに、キーと値のペアを指定します。
すべての Lambda 関数に共通で設定する環境変数は、&lt;code>Globals&lt;/code> セクションで定義します。&lt;/p></description></item><item><title>AWS CloudFormation の設定例: Lambda 関数から S3 にアクセスできるようにする</title><link>https://maku.blog/p/dzdq3ep/</link><pubDate>Mon, 12 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/dzdq3ep/</guid><description>&lt;p>CloudFormation (SAM) を利用して、Lambda 関数および S3 バケットを作成し、Lambda 関数から S3 バケットにアクセスできるようにポリシー設定するテンプレートの例です。
参考までに Lambda 関数の TypeScript コードも載せましたが、あくまで SAM テンプレートの記述例を示すことを目的としています。&lt;/p>
&lt;h2 id="sam-テンプレートの記述例">SAM テンプレートの記述例&lt;/h2>
&lt;p>次の SAM テンプレートでは、AWS リソースとして S3 バケット (&lt;code>MyBucket&lt;/code>) と Lambda 関数 (&lt;code>MyFunction&lt;/code>) を定義しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># S3 バケットの定義&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyBucket&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::S3::Bucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># Lambda 関数の定義&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyFunction&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Runtime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nodejs14.x&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">build/index.handler&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CodeUri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">function.zip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Policies&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">S3CrudPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BucketName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Ref MyBucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Variables&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BUCKET_NAME&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Ref MyBucket&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>S3 バケットは単純にスタック内に新規作成するだけなので、何もプロパティ設定していません。
ポイントは、Lambda 関数側のポリシー設定（&lt;code>Policies&lt;/code> プロパティ）です。&lt;/p></description></item><item><title>AWS CloudFormation の設定例: Lambda 関数から S3 にアクセスできるようにする</title><link>https://maku.blog/p/dzdq3ep/</link><pubDate>Mon, 12 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/dzdq3ep/</guid><description>&lt;p>CloudFormation (SAM) を利用して、Lambda 関数および S3 バケットを作成し、Lambda 関数から S3 バケットにアクセスできるようにポリシー設定するテンプレートの例です。
参考までに Lambda 関数の TypeScript コードも載せましたが、あくまで SAM テンプレートの記述例を示すことを目的としています。&lt;/p>
&lt;h2 id="sam-テンプレートの記述例">SAM テンプレートの記述例&lt;/h2>
&lt;p>次の SAM テンプレートでは、AWS リソースとして S3 バケット (&lt;code>MyBucket&lt;/code>) と Lambda 関数 (&lt;code>MyFunction&lt;/code>) を定義しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># S3 バケットの定義&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyBucket&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::S3::Bucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># Lambda 関数の定義&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyFunction&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Runtime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nodejs14.x&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">build/index.handler&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CodeUri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">function.zip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Policies&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">S3CrudPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BucketName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Ref MyBucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Variables&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BUCKET_NAME&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Ref MyBucket&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>S3 バケットは単純にスタック内に新規作成するだけなので、何もプロパティ設定していません。
ポイントは、Lambda 関数側のポリシー設定（&lt;code>Policies&lt;/code> プロパティ）です。&lt;/p></description></item><item><title>AWS CloudFormation の設定例: Lambda 関数から S3 にアクセスできるようにする</title><link>https://maku.blog/p/dzdq3ep/</link><pubDate>Mon, 12 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/dzdq3ep/</guid><description>&lt;p>CloudFormation (SAM) を利用して、Lambda 関数および S3 バケットを作成し、Lambda 関数から S3 バケットにアクセスできるようにポリシー設定するテンプレートの例です。
参考までに Lambda 関数の TypeScript コードも載せましたが、あくまで SAM テンプレートの記述例を示すことを目的としています。&lt;/p>
&lt;h2 id="sam-テンプレートの記述例">SAM テンプレートの記述例&lt;/h2>
&lt;p>次の SAM テンプレートでは、AWS リソースとして S3 バケット (&lt;code>MyBucket&lt;/code>) と Lambda 関数 (&lt;code>MyFunction&lt;/code>) を定義しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># S3 バケットの定義&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyBucket&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::S3::Bucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># Lambda 関数の定義&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyFunction&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Runtime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nodejs14.x&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">build/index.handler&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CodeUri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">function.zip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Policies&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">S3CrudPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BucketName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Ref MyBucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Variables&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BUCKET_NAME&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Ref MyBucket&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>S3 バケットは単純にスタック内に新規作成するだけなので、何もプロパティ設定していません。
ポイントは、Lambda 関数側のポリシー設定（&lt;code>Policies&lt;/code> プロパティ）です。&lt;/p></description></item><item><title>AWS CloudFormation の設定例: Lambda 関数から S3 にアクセスできるようにする</title><link>https://maku.blog/p/dzdq3ep/</link><pubDate>Mon, 12 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/dzdq3ep/</guid><description>&lt;p>CloudFormation (SAM) を利用して、Lambda 関数および S3 バケットを作成し、Lambda 関数から S3 バケットにアクセスできるようにポリシー設定するテンプレートの例です。
参考までに Lambda 関数の TypeScript コードも載せましたが、あくまで SAM テンプレートの記述例を示すことを目的としています。&lt;/p>
&lt;h2 id="sam-テンプレートの記述例">SAM テンプレートの記述例&lt;/h2>
&lt;p>次の SAM テンプレートでは、AWS リソースとして S3 バケット (&lt;code>MyBucket&lt;/code>) と Lambda 関数 (&lt;code>MyFunction&lt;/code>) を定義しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># S3 バケットの定義&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyBucket&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::S3::Bucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># Lambda 関数の定義&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyFunction&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::Function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Runtime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nodejs14.x&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Handler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">build/index.handler&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CodeUri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">function.zip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Policies&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">S3CrudPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BucketName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Ref MyBucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Variables&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BUCKET_NAME&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Ref MyBucket&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>S3 バケットは単純にスタック内に新規作成するだけなので、何もプロパティ設定していません。
ポイントは、Lambda 関数側のポリシー設定（&lt;code>Policies&lt;/code> プロパティ）です。&lt;/p></description></item><item><title>AWS CloudFormation で S3 バケットのリソースを作成する</title><link>https://maku.blog/p/ugt6gr4/</link><pubDate>Fri, 09 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/ugt6gr4/</guid><description>&lt;h2 id="s3-バケット定義の基本">S3 バケット定義の基本&lt;/h2>
&lt;p>AWS CloudFormation で S3 バケットを作成・設定するには、次のようにテンプレートファイル内で &lt;strong>&lt;code>AWS::S3::Bucket&lt;/code>&lt;/strong> タイプのリソースを定義します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyBucket&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::S3::Bucket&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記の例では、論理 ID (Logical ID) が &lt;code>MyBucket&lt;/code> の S3 バケットを定義しています。
論理 ID はこのテンプレートで生成するスタック内で一意の ID です。
実際に生成される S3 バケット名（物理 ID）は CloudFormation が自動で生成します（後述）。&lt;/p>
&lt;p>このテンプレートを使って、CloudFormation スタック（ここでは S3 バケットのみ含まれる）を生成するには、次のように &lt;strong>&lt;code>aws cloudformation deploy&lt;/code>&lt;/strong> コマンドを実行します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">mystack スタックを生成&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation deploy --template-file template.yml --stack-name mystack&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>スタック内に生成された AWS リソースの一覧は次のように確認できます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation describe-stack-resources --stack-name mystack
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">StackResources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DriftInformation:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> StackResourceDriftStatus: NOT_CHECKED
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LogicalResourceId: MyBucket
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PhysicalResourceId: mystack-mybucket-bq8iux8uepew
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ResourceStatus: CREATE_COMPLETE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ResourceType: AWS::S3::Bucket
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> StackId: arn:aws:cloudformation:ap-northeast-1:123456789012:stack/mystack/c7e06a46-9902-11eb-9a29-8b1f770a16f7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> StackName: mystack
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Timestamp: &amp;#39;2021-04-09T07:09:13.622000+00:00&amp;#39;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>PhysicalResourceId&lt;/code> のところを見ると、実際に作成された S3 バケットの物理 ID (Physical ID) が分かります。&lt;/p></description></item><item><title>AWS CloudFormation で S3 バケットのリソースを作成する</title><link>https://maku.blog/p/ugt6gr4/</link><pubDate>Fri, 09 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/ugt6gr4/</guid><description>&lt;h2 id="s3-バケット定義の基本">S3 バケット定義の基本&lt;/h2>
&lt;p>AWS CloudFormation で S3 バケットを作成・設定するには、次のようにテンプレートファイル内で &lt;strong>&lt;code>AWS::S3::Bucket&lt;/code>&lt;/strong> タイプのリソースを定義します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyBucket&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::S3::Bucket&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記の例では、論理 ID (Logical ID) が &lt;code>MyBucket&lt;/code> の S3 バケットを定義しています。
論理 ID はこのテンプレートで生成するスタック内で一意の ID です。
実際に生成される S3 バケット名（物理 ID）は CloudFormation が自動で生成します（後述）。&lt;/p>
&lt;p>このテンプレートを使って、CloudFormation スタック（ここでは S3 バケットのみ含まれる）を生成するには、次のように &lt;strong>&lt;code>aws cloudformation deploy&lt;/code>&lt;/strong> コマンドを実行します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">mystack スタックを生成&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation deploy --template-file template.yml --stack-name mystack&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>スタック内に生成された AWS リソースの一覧は次のように確認できます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation describe-stack-resources --stack-name mystack
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">StackResources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DriftInformation:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> StackResourceDriftStatus: NOT_CHECKED
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LogicalResourceId: MyBucket
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PhysicalResourceId: mystack-mybucket-bq8iux8uepew
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ResourceStatus: CREATE_COMPLETE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ResourceType: AWS::S3::Bucket
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> StackId: arn:aws:cloudformation:ap-northeast-1:123456789012:stack/mystack/c7e06a46-9902-11eb-9a29-8b1f770a16f7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> StackName: mystack
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Timestamp: &amp;#39;2021-04-09T07:09:13.622000+00:00&amp;#39;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>PhysicalResourceId&lt;/code> のところを見ると、実際に作成された S3 バケットの物理 ID (Physical ID) が分かります。&lt;/p></description></item><item><title>AWS CloudFormation で S3 バケットのリソースを作成する</title><link>https://maku.blog/p/ugt6gr4/</link><pubDate>Fri, 09 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/ugt6gr4/</guid><description>&lt;h2 id="s3-バケット定義の基本">S3 バケット定義の基本&lt;/h2>
&lt;p>AWS CloudFormation で S3 バケットを作成・設定するには、次のようにテンプレートファイル内で &lt;strong>&lt;code>AWS::S3::Bucket&lt;/code>&lt;/strong> タイプのリソースを定義します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyBucket&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::S3::Bucket&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記の例では、論理 ID (Logical ID) が &lt;code>MyBucket&lt;/code> の S3 バケットを定義しています。
論理 ID はこのテンプレートで生成するスタック内で一意の ID です。
実際に生成される S3 バケット名（物理 ID）は CloudFormation が自動で生成します（後述）。&lt;/p>
&lt;p>このテンプレートを使って、CloudFormation スタック（ここでは S3 バケットのみ含まれる）を生成するには、次のように &lt;strong>&lt;code>aws cloudformation deploy&lt;/code>&lt;/strong> コマンドを実行します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">mystack スタックを生成&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation deploy --template-file template.yml --stack-name mystack&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>スタック内に生成された AWS リソースの一覧は次のように確認できます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation describe-stack-resources --stack-name mystack
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">StackResources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DriftInformation:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> StackResourceDriftStatus: NOT_CHECKED
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LogicalResourceId: MyBucket
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PhysicalResourceId: mystack-mybucket-bq8iux8uepew
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ResourceStatus: CREATE_COMPLETE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ResourceType: AWS::S3::Bucket
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> StackId: arn:aws:cloudformation:ap-northeast-1:123456789012:stack/mystack/c7e06a46-9902-11eb-9a29-8b1f770a16f7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> StackName: mystack
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Timestamp: &amp;#39;2021-04-09T07:09:13.622000+00:00&amp;#39;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>PhysicalResourceId&lt;/code> のところを見ると、実際に作成された S3 バケットの物理 ID (Physical ID) が分かります。&lt;/p></description></item><item><title>AWS CloudFormation で DyanamoDB のリソースを作成する</title><link>https://maku.blog/p/h3gsjs2/</link><pubDate>Wed, 07 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/h3gsjs2/</guid><description>&lt;h2 id="sam-で簡単な-dynamodb-テーブルを生成してみる">SAM で簡単な DynamoDB テーブルを生成してみる&lt;/h2>
&lt;p>DynamoDB のテーブルリソースも、Lambda 関数などのリソースと同様に AWS SAM で自動生成＆更新することができます。
CloudFormation のテンプレートをそのまま記述するより、拡張された SAM テンプレートの形式で記述することで、シンプルにリソースを定義することができます。&lt;/p>
&lt;p>SAM テンプレート内で DynamoDB のテーブルを定義するときは、リソースタイプとして &lt;strong>&lt;code>AWS::Serverless::SimpleTable&lt;/code>&lt;/strong> を指定します（CloudFormation スタック内に実際に生成されるリソースのタイプは &lt;code>AWS::DynamoDB::Table&lt;/code> になります）。&lt;/p>
&lt;p>DynamoDB テーブルを作成するための最低限の SAM テンプレートはとてもシンプルです。
次の例では、&lt;code>MyTable&lt;/code> という 論理 ID (Logical ID) で DynamoDB のテーブルを定義しています。
論理 ID はスタック内でリソースを特定するための名前です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Description&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">My sample app&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyTable&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::SimpleTable&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ひとつもプライマリキーを指定していませんが、その場合はデフォルトで &lt;code>id&lt;/code> という名前のプライマリキー（&lt;code>String&lt;/code> 型）が定義されます。
&lt;a href="../../p/zkxamw9">AWS CLI&lt;/a> で次のように実行すると、CloudFormation のスタックを作成することができます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation deploy --stack-name mystack \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --template-file template.yml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>CloudFormation スタック内に、実際にどのような AWS リソースが作成されたかを調べるには以下のようにします。
ここではリソースタイプと、その物理 ID (Pysical ID) を table 形式で出力してみました。&lt;/p></description></item><item><title>AWS CloudFormation で DyanamoDB のリソースを作成する</title><link>https://maku.blog/p/h3gsjs2/</link><pubDate>Wed, 07 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/h3gsjs2/</guid><description>&lt;h2 id="sam-で簡単な-dynamodb-テーブルを生成してみる">SAM で簡単な DynamoDB テーブルを生成してみる&lt;/h2>
&lt;p>DynamoDB のテーブルリソースも、Lambda 関数などのリソースと同様に AWS SAM で自動生成＆更新することができます。
CloudFormation のテンプレートをそのまま記述するより、拡張された SAM テンプレートの形式で記述することで、シンプルにリソースを定義することができます。&lt;/p>
&lt;p>SAM テンプレート内で DynamoDB のテーブルを定義するときは、リソースタイプとして &lt;strong>&lt;code>AWS::Serverless::SimpleTable&lt;/code>&lt;/strong> を指定します（CloudFormation スタック内に実際に生成されるリソースのタイプは &lt;code>AWS::DynamoDB::Table&lt;/code> になります）。&lt;/p>
&lt;p>DynamoDB テーブルを作成するための最低限の SAM テンプレートはとてもシンプルです。
次の例では、&lt;code>MyTable&lt;/code> という 論理 ID (Logical ID) で DynamoDB のテーブルを定義しています。
論理 ID はスタック内でリソースを特定するための名前です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Description&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">My sample app&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyTable&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::SimpleTable&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ひとつもプライマリキーを指定していませんが、その場合はデフォルトで &lt;code>id&lt;/code> という名前のプライマリキー（&lt;code>String&lt;/code> 型）が定義されます。
&lt;a href="../../p/zkxamw9">AWS CLI&lt;/a> で次のように実行すると、CloudFormation のスタックを作成することができます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation deploy --stack-name mystack \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --template-file template.yml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>CloudFormation スタック内に、実際にどのような AWS リソースが作成されたかを調べるには以下のようにします。
ここではリソースタイプと、その物理 ID (Pysical ID) を table 形式で出力してみました。&lt;/p></description></item><item><title>AWS CloudFormation で DyanamoDB のリソースを作成する</title><link>https://maku.blog/p/h3gsjs2/</link><pubDate>Wed, 07 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/h3gsjs2/</guid><description>&lt;h2 id="sam-で簡単な-dynamodb-テーブルを生成してみる">SAM で簡単な DynamoDB テーブルを生成してみる&lt;/h2>
&lt;p>DynamoDB のテーブルリソースも、Lambda 関数などのリソースと同様に AWS SAM で自動生成＆更新することができます。
CloudFormation のテンプレートをそのまま記述するより、拡張された SAM テンプレートの形式で記述することで、シンプルにリソースを定義することができます。&lt;/p>
&lt;p>SAM テンプレート内で DynamoDB のテーブルを定義するときは、リソースタイプとして &lt;strong>&lt;code>AWS::Serverless::SimpleTable&lt;/code>&lt;/strong> を指定します（CloudFormation スタック内に実際に生成されるリソースのタイプは &lt;code>AWS::DynamoDB::Table&lt;/code> になります）。&lt;/p>
&lt;p>DynamoDB テーブルを作成するための最低限の SAM テンプレートはとてもシンプルです。
次の例では、&lt;code>MyTable&lt;/code> という 論理 ID (Logical ID) で DynamoDB のテーブルを定義しています。
論理 ID はスタック内でリソースを特定するための名前です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Transform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless-2016-10-31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Description&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">My sample app&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyTable&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Serverless::SimpleTable&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ひとつもプライマリキーを指定していませんが、その場合はデフォルトで &lt;code>id&lt;/code> という名前のプライマリキー（&lt;code>String&lt;/code> 型）が定義されます。
&lt;a href="../../p/zkxamw9">AWS CLI&lt;/a> で次のように実行すると、CloudFormation のスタックを作成することができます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation deploy --stack-name mystack \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --template-file template.yml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>CloudFormation スタック内に、実際にどのような AWS リソースが作成されたかを調べるには以下のようにします。
ここではリソースタイプと、その物理 ID (Pysical ID) を table 形式で出力してみました。&lt;/p></description></item><item><title>AWS CloudFormation で SNS トピックのリソースを生成する</title><link>https://maku.blog/p/ymzbmx9/</link><pubDate>Tue, 13 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/ymzbmx9/</guid><description>&lt;h2 id="cloudformation-で-sns-トピックを作成する">CloudFormation で SNS トピックを作成する&lt;/h2>
&lt;p>CloudFormation スタック内に SNS トピックを生成するには、CloudFormation テンプレートで &lt;a href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-properties-sns-topic.html">AWS::SNS::Topic&lt;/a> というタイプのリソースを定義します。&lt;/p>
&lt;p>このリソースのプロパティはすべてオプショナル（省略可能）なので、最低限のリソース定義は次のようになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyTopic&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::SNS::Topic&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>トピック名 (&lt;code>Properties.TopicName&lt;/code>) すら指定していませんが、その場合は、CloudFormation のスタック名と、トピックの論理 ID（上記の場合は &lt;code>MyTopic&lt;/code>）の組み合わせから、自動的にトピック名が割り当てられるようになっています（例: &lt;code>mystack-MyTopic-WMD9B9WWLEXN&lt;/code>）。&lt;/p>
&lt;p>上記のテンプレートから CloudFormation スタックを生成するには、AWS CLI を使って次のように実行します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">mystack スタックの生成&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation deploy --stack-name mystack \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --template-file template.yml \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --capabilities CAPABILITY_IAM&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>無事スタックが生成されたら、次のようにして生成された SNS トピックの物理 ID (ARN) を調べることができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">SNS トピックの ARN を調べる&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation describe-stack-resources \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --stack-name mystack \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --output text \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --query &amp;#34;StackResources[].PhysicalResourceId&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">arn:aws:sns:ap-northeast-1:123456789012:mystack-MyTopic-WMD9B9WWLEXN&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>Lambda 関数や S3 バケットから SNS トピックに対して publish するときは、この ARN を指定することになります。&lt;/p></description></item><item><title>AWS CloudFormation で SNS トピックのリソースを生成する</title><link>https://maku.blog/p/ymzbmx9/</link><pubDate>Tue, 13 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/ymzbmx9/</guid><description>&lt;h2 id="cloudformation-で-sns-トピックを作成する">CloudFormation で SNS トピックを作成する&lt;/h2>
&lt;p>CloudFormation スタック内に SNS トピックを生成するには、CloudFormation テンプレートで &lt;a href="https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-properties-sns-topic.html">AWS::SNS::Topic&lt;/a> というタイプのリソースを定義します。&lt;/p>
&lt;p>このリソースのプロパティはすべてオプショナル（省略可能）なので、最低限のリソース定義は次のようになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyTopic&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::SNS::Topic&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>トピック名 (&lt;code>Properties.TopicName&lt;/code>) すら指定していませんが、その場合は、CloudFormation のスタック名と、トピックの論理 ID（上記の場合は &lt;code>MyTopic&lt;/code>）の組み合わせから、自動的にトピック名が割り当てられるようになっています（例: &lt;code>mystack-MyTopic-WMD9B9WWLEXN&lt;/code>）。&lt;/p>
&lt;p>上記のテンプレートから CloudFormation スタックを生成するには、AWS CLI を使って次のように実行します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">mystack スタックの生成&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation deploy --stack-name mystack \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --template-file template.yml \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --capabilities CAPABILITY_IAM&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>無事スタックが生成されたら、次のようにして生成された SNS トピックの物理 ID (ARN) を調べることができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">SNS トピックの ARN を調べる&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws cloudformation describe-stack-resources \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --stack-name mystack \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --output text \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --query &amp;#34;StackResources[].PhysicalResourceId&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">arn:aws:sns:ap-northeast-1:123456789012:mystack-MyTopic-WMD9B9WWLEXN&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>Lambda 関数や S3 バケットから SNS トピックに対して publish するときは、この ARN を指定することになります。&lt;/p></description></item><item><title>AWS CloudFormation の設定例: SNS トピックを Lambda 関数からサブスクライブする</title><link>https://maku.blog/p/5q4epyb/</link><pubDate>Mon, 19 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/5q4epyb/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>ここでは、CloudFormation (SAM) のテンプレートを使って、SNS トピックをサブスクライブする Lambda 関数を定義してみます。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="" height="auto" src="../../p/5q4epyb/img-sns-to-lambda.svg" alt="/p/5q4epyb/img-sns-to-lambda.svg" />
&lt;/figure>

&lt;p>サブスクライブ対象とする SNS トピック自体は、あらかじめ何らかの方法で作成済みであり、次のような ARN を取得できているものとします。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">SNS トピックの ARN&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">arn:aws:sns:ap-northeast-1:123456789012:mytopic&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記のような CloudFormation スタックが完成すると、マネージメントコンソールや CLI で SNS トピックのメッセージを発行して、Lambda 関数にイベントが届くことを確認できます。&lt;/p>
&lt;aside style="display: flex; border: thin dashed gray;">
&lt;div style="align-self: stretch; writing-mode: vertical-lr; text-align: center; letter-spacing: 0.2em; color: #666; border-right: thin dashed gray; padding: 0.4em 0; line-height: 1.5;">参考&lt;/div>
&lt;div style="align-self: center; padding: 0.6em 0; line-height: 1.2 !important;">&lt;ul>
&lt;li>&lt;a href="../../p/ymzbmx9">CloudFormation で SNS トピックの作成&lt;/a>&lt;/li>
&lt;li>&lt;a href="../../p/3o2dpyb">CloudFormation の設定例: S3 通知を SNS トピックに Publish する&lt;/a>&lt;/li>
&lt;/ul>
&lt;/div>
&lt;/aside>
&lt;h2 id="テンプレートの記述例">テンプレートの記述例&lt;/h2>
&lt;p>次の SAM テンプレートでは、Lambda 関数を定義しつつ、そのイベントソースとして SNS トピックを設定しています。
イベントソースの指定は、実際には、SNS トピックに Lambda 関数をサブスクライブすることを意味しています。
SNS トピックの ARN は、入力パラメータ &lt;code>TopicArn&lt;/code> のデフォルト値として指定しています。&lt;/p></description></item><item><title>AWS CloudFormation の設定例: SNS トピックを Lambda 関数からサブスクライブする</title><link>https://maku.blog/p/5q4epyb/</link><pubDate>Mon, 19 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/5q4epyb/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>ここでは、CloudFormation (SAM) のテンプレートを使って、SNS トピックをサブスクライブする Lambda 関数を定義してみます。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="" height="auto" src="../../p/5q4epyb/img-sns-to-lambda.svg" alt="/p/5q4epyb/img-sns-to-lambda.svg" />
&lt;/figure>

&lt;p>サブスクライブ対象とする SNS トピック自体は、あらかじめ何らかの方法で作成済みであり、次のような ARN を取得できているものとします。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">SNS トピックの ARN&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">arn:aws:sns:ap-northeast-1:123456789012:mytopic&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記のような CloudFormation スタックが完成すると、マネージメントコンソールや CLI で SNS トピックのメッセージを発行して、Lambda 関数にイベントが届くことを確認できます。&lt;/p>
&lt;aside style="display: flex; border: thin dashed gray;">
&lt;div style="align-self: stretch; writing-mode: vertical-lr; text-align: center; letter-spacing: 0.2em; color: #666; border-right: thin dashed gray; padding: 0.4em 0; line-height: 1.5;">参考&lt;/div>
&lt;div style="align-self: center; padding: 0.6em 0; line-height: 1.2 !important;">&lt;ul>
&lt;li>&lt;a href="../../p/ymzbmx9">CloudFormation で SNS トピックの作成&lt;/a>&lt;/li>
&lt;li>&lt;a href="../../p/3o2dpyb">CloudFormation の設定例: S3 通知を SNS トピックに Publish する&lt;/a>&lt;/li>
&lt;/ul>
&lt;/div>
&lt;/aside>
&lt;h2 id="テンプレートの記述例">テンプレートの記述例&lt;/h2>
&lt;p>次の SAM テンプレートでは、Lambda 関数を定義しつつ、そのイベントソースとして SNS トピックを設定しています。
イベントソースの指定は、実際には、SNS トピックに Lambda 関数をサブスクライブすることを意味しています。
SNS トピックの ARN は、入力パラメータ &lt;code>TopicArn&lt;/code> のデフォルト値として指定しています。&lt;/p></description></item><item><title>AWS CDK 入門: cdk コマンドのインストールから Hello World まで</title><link>https://maku.blog/p/nujyfsy/</link><pubDate>Mon, 04 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/nujyfsy/</guid><description>&lt;h2 id="cdk-とは">CDK とは&lt;/h2>
&lt;p>&lt;a href="https://aws.amazon.com/jp/cdk/">AWS CDK (Cloud Development Kit)&lt;/a> を使うと、TypeScript や Python を使って AWS リソースの生成を自動化することができます。
大きなプロジェクトでは、CloudFormation や SAM によるスタック生成用のテンプレートが長大になりがちですが、CDK を使うことで CloudFormation テンプレートの生成処理を隠蔽し、効率的にインフラ定義を行うことができます。
&lt;strong>CDK の利点&lt;/strong> をざっと挙げると以下のような感じです。&lt;/p>
&lt;ul>
&lt;li>TypeScript、Python などのパワフルな言語機能を使ってインフラ定義を行うことができる。&lt;/li>
&lt;li>各種リソース間の参照を、オブジェクトのプロパティ参照という自然な形で表現できる。&lt;/li>
&lt;li>コンストラクト (Construct Library) という再利用可能なライブラリの提供により、様々なユースケースに対応した AWS リソース群を短いコードで定義できる。&lt;/li>
&lt;li>VS Code (TypeScript) 、PyCharm (Python) などで型情報の補完が効くため、AWS リソースに設定可能なプロパティを見つけやすい。明らかに間違った設定はコンパイル時に気付くことができる。&lt;/li>
&lt;li>Lambda 関数デプロイ時などに必要になる ZIP パッケージング、および S3 一時バケットの生成を自動で行ってくれる。&lt;/li>
&lt;/ul>
&lt;p>一方、&lt;strong>CDK の欠点&lt;/strong> としては、基本的に AWS に特化したツールであるため、Terraform や Serverless Framework のように様々なクラウド (Azure, AWS, GCP) に対応できないという点が挙げられます。
Terraform などの汎用ツールに比べて、CDK は学習コストも比較的高いです。
Azure なども同じツールで構築したいとか、それほど細かい制御は必要ないということであれば、Terraform などを使った方がいいかもしれません。
ただ、CDK を使っている限り、AWS の最新のリソースにも即対応できることが保証されますし、AWS CloudFormation に関しての知識は身につけやすいでしょう。&lt;/p>
&lt;h2 id="cdk-toolkit-のインストール">CDK Toolkit のインストール&lt;/h2>
&lt;p>CDK によるデプロイには &lt;strong>&lt;code>cdk&lt;/code>&lt;/strong> コマンドを使用します。
まずはこのコマンドを使えるようにするため、&lt;strong>&lt;code>aws-cdk&lt;/code>&lt;/strong> パッケージをインストールします（CDK 本体の実行には Node.js が必要です）。&lt;/p></description></item><item><title>AWS CDK 入門: cdk コマンドのインストールから Hello World まで</title><link>https://maku.blog/p/nujyfsy/</link><pubDate>Mon, 04 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/nujyfsy/</guid><description>&lt;h2 id="cdk-とは">CDK とは&lt;/h2>
&lt;p>&lt;a href="https://aws.amazon.com/jp/cdk/">AWS CDK (Cloud Development Kit)&lt;/a> を使うと、TypeScript や Python を使って AWS リソースの生成を自動化することができます。
大きなプロジェクトでは、CloudFormation や SAM によるスタック生成用のテンプレートが長大になりがちですが、CDK を使うことで CloudFormation テンプレートの生成処理を隠蔽し、効率的にインフラ定義を行うことができます。
&lt;strong>CDK の利点&lt;/strong> をざっと挙げると以下のような感じです。&lt;/p>
&lt;ul>
&lt;li>TypeScript、Python などのパワフルな言語機能を使ってインフラ定義を行うことができる。&lt;/li>
&lt;li>各種リソース間の参照を、オブジェクトのプロパティ参照という自然な形で表現できる。&lt;/li>
&lt;li>コンストラクト (Construct Library) という再利用可能なライブラリの提供により、様々なユースケースに対応した AWS リソース群を短いコードで定義できる。&lt;/li>
&lt;li>VS Code (TypeScript) 、PyCharm (Python) などで型情報の補完が効くため、AWS リソースに設定可能なプロパティを見つけやすい。明らかに間違った設定はコンパイル時に気付くことができる。&lt;/li>
&lt;li>Lambda 関数デプロイ時などに必要になる ZIP パッケージング、および S3 一時バケットの生成を自動で行ってくれる。&lt;/li>
&lt;/ul>
&lt;p>一方、&lt;strong>CDK の欠点&lt;/strong> としては、基本的に AWS に特化したツールであるため、Terraform や Serverless Framework のように様々なクラウド (Azure, AWS, GCP) に対応できないという点が挙げられます。
Terraform などの汎用ツールに比べて、CDK は学習コストも比較的高いです。
Azure なども同じツールで構築したいとか、それほど細かい制御は必要ないということであれば、Terraform などを使った方がいいかもしれません。
ただ、CDK を使っている限り、AWS の最新のリソースにも即対応できることが保証されますし、AWS CloudFormation に関しての知識は身につけやすいでしょう。&lt;/p>
&lt;h2 id="cdk-toolkit-のインストール">CDK Toolkit のインストール&lt;/h2>
&lt;p>CDK によるデプロイには &lt;strong>&lt;code>cdk&lt;/code>&lt;/strong> コマンドを使用します。
まずはこのコマンドを使えるようにするため、&lt;strong>&lt;code>aws-cdk&lt;/code>&lt;/strong> パッケージをインストールします（CDK 本体の実行には Node.js が必要です）。&lt;/p></description></item><item><title>AWS CDK メモ: ブートストラップ処理を実行する (cdk bootstrap)</title><link>https://maku.blog/p/q7q8p6m/</link><pubDate>Sun, 17 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/q7q8p6m/</guid><description>&lt;p>CloudFormation のスタックを生成するときに、一時的なファイル置き場として S3 バケットが必要になることがあります。
例えば、Lambda 関数をデプロイするときに、ZIP パッケージを置くためのステージングバケットが必要になります。
このステージングバケットへの実際のアップロード処理は CDK が自動でやってくれるのですが、バケットの準備だけはあらかじめ手動で行っておく必要があります。
このためのコマンドが &lt;strong>&lt;code>cdk bootstrap&lt;/code>&lt;/strong> コマンドです。
AWS アカウント（およびリージョン）内で一度だけ実行しておけばよいので、このタイミングで実行しておきます。
実行時には次のように「アカウント番号」と「リージョン名」を指定する必要があります。&lt;/p>
&lt;pre tabindex="0">&lt;code>cdk bootstrap aws://&amp;lt;アカウント番号&amp;gt;/&amp;lt;リージョン名&amp;gt;
&lt;/code>&lt;/pre>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実際の実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> cdk bootstrap aws://123456789012/ap-northeast-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> ⏳ Bootstrapping environment aws://123456789012/ap-northeast-1...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">CDKToolkit: creating CloudFormation changeset...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> ✅ Environment aws://123456789012/ap-northeast-1 bootstrapped.
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これにより、ステージング用のバケットを含む &lt;code>CDKToolkit&lt;/code> という名前のブートストラップ・スタックが生成されます。&lt;/p>
&lt;p>ちなみに、現在使用している「アカウント番号」と「リージョン名」は、AWS CLI を使って次のように確認できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">アカウント番号の確認&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws sts get-caller-identity --output text --query Account &lt;span class="o">[&lt;/span>--profile xxxx&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">123456789012
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">リージョン名の確認&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws configure get region &lt;span class="o">[&lt;/span>--profile xxxx&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">ap-northeast-1
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>AWS CDK メモ: ブートストラップ処理を実行する (cdk bootstrap)</title><link>https://maku.blog/p/q7q8p6m/</link><pubDate>Sun, 17 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/q7q8p6m/</guid><description>&lt;p>CloudFormation のスタックを生成するときに、一時的なファイル置き場として S3 バケットが必要になることがあります。
例えば、Lambda 関数をデプロイするときに、ZIP パッケージを置くためのステージングバケットが必要になります。
このステージングバケットへの実際のアップロード処理は CDK が自動でやってくれるのですが、バケットの準備だけはあらかじめ手動で行っておく必要があります。
このためのコマンドが &lt;strong>&lt;code>cdk bootstrap&lt;/code>&lt;/strong> コマンドです。
AWS アカウント（およびリージョン）内で一度だけ実行しておけばよいので、このタイミングで実行しておきます。
実行時には次のように「アカウント番号」と「リージョン名」を指定する必要があります。&lt;/p>
&lt;pre tabindex="0">&lt;code>cdk bootstrap aws://&amp;lt;アカウント番号&amp;gt;/&amp;lt;リージョン名&amp;gt;
&lt;/code>&lt;/pre>
&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実際の実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> cdk bootstrap aws://123456789012/ap-northeast-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> ⏳ Bootstrapping environment aws://123456789012/ap-northeast-1...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">CDKToolkit: creating CloudFormation changeset...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> ✅ Environment aws://123456789012/ap-northeast-1 bootstrapped.
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これにより、ステージング用のバケットを含む &lt;code>CDKToolkit&lt;/code> という名前のブートストラップ・スタックが生成されます。&lt;/p>
&lt;p>ちなみに、現在使用している「アカウント番号」と「リージョン名」は、AWS CLI を使って次のように確認できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">アカウント番号の確認&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws sts get-caller-identity --output text --query Account &lt;span class="o">[&lt;/span>--profile xxxx&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">123456789012
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">リージョン名の確認&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws configure get region &lt;span class="o">[&lt;/span>--profile xxxx&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">ap-northeast-1
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>AWS CDK メモ: コンストラクトの概念を理解する</title><link>https://maku.blog/p/nqkav2m/</link><pubDate>Mon, 04 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/nqkav2m/</guid><description>&lt;h2 id="コンストラクトツリー-construct-tree">コンストラクト・ツリー (Construct Tree)&lt;/h2>
&lt;p>AWS CDK を使って CloudFormation スタックを作成するとき、そのリソース構成は、論理的な &lt;strong>コンストラクト (construct)&lt;/strong> のツリー構造によって表現します。
下記は、典型的な CDK アプリケーションにおけるコンストラクト・ツリー構造です。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">App
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- Stack
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +-- Construct
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +-- Construct
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +-- ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- Stack
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- Construct
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +-- Construct
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +-- Construct
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- Construct
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- ...&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>App&lt;/code>、&lt;code>Stack&lt;/code>、&lt;code>Construct&lt;/code> はそれぞれ抽象度の異なるオブジェクトですが、すべて &lt;a href="https://docs.aws.amazon.com/cdk/api/latest/docs/@aws-cdk_core.IConstruct.html">IConstruct インタフェース&lt;/a> を実装したコンストラクトの一種です。
CDK アプリ―ケーションには、構成のエントリポイントとなる &lt;strong>&lt;code>App&lt;/code> コンストラクト&lt;/strong> が 1 つあり、複数の &lt;code>Stack&lt;/code> コンストラクトを含むことができます。&lt;/p>
&lt;p>&lt;strong>&lt;code>Stack&lt;/code> コンストラクト&lt;/strong> は、その名の通り CloudFormation スタックを表現するコンストラクトです。
&lt;code>App&lt;/code> が複数の &lt;code>Stack&lt;/code> から構成されている場合、&lt;code>cdk deploy&lt;/code> コマンドでデプロイを実行したときに複数の CloudFormation スタックが生成されることになります。
&lt;code>cdk deploy &amp;lt;Stack名&amp;gt;&lt;/code> とすれば、特定のスタックのみをデプロイすることも可能です。
指定可能な Stack 名の一覧を確認したいときは、&lt;code>cdk ls&lt;/code> コマンドを使います。&lt;/p></description></item><item><title>AWS CDK メモ: コンストラクトの概念を理解する</title><link>https://maku.blog/p/nqkav2m/</link><pubDate>Mon, 04 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/nqkav2m/</guid><description>&lt;h2 id="コンストラクトツリー-construct-tree">コンストラクト・ツリー (Construct Tree)&lt;/h2>
&lt;p>AWS CDK を使って CloudFormation スタックを作成するとき、そのリソース構成は、論理的な &lt;strong>コンストラクト (construct)&lt;/strong> のツリー構造によって表現します。
下記は、典型的な CDK アプリケーションにおけるコンストラクト・ツリー構造です。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">App
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- Stack
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +-- Construct
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +-- Construct
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +-- ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- Stack
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- Construct
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +-- Construct
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | +-- Construct
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- Construct
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- ...&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>App&lt;/code>、&lt;code>Stack&lt;/code>、&lt;code>Construct&lt;/code> はそれぞれ抽象度の異なるオブジェクトですが、すべて &lt;a href="https://docs.aws.amazon.com/cdk/api/latest/docs/@aws-cdk_core.IConstruct.html">IConstruct インタフェース&lt;/a> を実装したコンストラクトの一種です。
CDK アプリ―ケーションには、構成のエントリポイントとなる &lt;strong>&lt;code>App&lt;/code> コンストラクト&lt;/strong> が 1 つあり、複数の &lt;code>Stack&lt;/code> コンストラクトを含むことができます。&lt;/p>
&lt;p>&lt;strong>&lt;code>Stack&lt;/code> コンストラクト&lt;/strong> は、その名の通り CloudFormation スタックを表現するコンストラクトです。
&lt;code>App&lt;/code> が複数の &lt;code>Stack&lt;/code> から構成されている場合、&lt;code>cdk deploy&lt;/code> コマンドでデプロイを実行したときに複数の CloudFormation スタックが生成されることになります。
&lt;code>cdk deploy &amp;lt;Stack名&amp;gt;&lt;/code> とすれば、特定のスタックのみをデプロイすることも可能です。
指定可能な Stack 名の一覧を確認したいときは、&lt;code>cdk ls&lt;/code> コマンドを使います。&lt;/p></description></item><item><title>AWS CDK メモ: CDK アプリのパッケージ管理に Yarn を使う方法</title><link>https://maku.blog/p/4h3jygw/</link><pubDate>Sun, 17 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/4h3jygw/</guid><description>&lt;p>&lt;code>cdk init app --language typescript&lt;/code> で CDK アプリのひな型を生成すると、デフォルトではパッケージマネージャーとして NPM を使う想定になっています（&lt;code>package-lock.json&lt;/code> などが作成されます）。
NPM の代わりに Yarn を使いたい場合は、次のように &lt;code>package-lock.json&lt;/code> を削除して、&lt;code>yarn.lock&lt;/code> ファイルを生成します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> git rm package-lock.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> yarn install
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>生成された &lt;code>yarn.lock&lt;/code> は忘れずに Git へコミットしてください。&lt;/p>
&lt;p>ちなみに、&lt;code>package-lock.json&lt;/code> が残っている状態で &lt;code>yarn install&lt;/code> しようとすると、次のような感じの Warning が表示されます。&lt;/p>
&lt;blockquote>
&lt;p>warning package-lock.json found. Your project contains lock files generated by tools other than Yarn. It is advised not to mix package managers in order to avoid resolution inconsistencies caused by unsynchronized lock files. To clear this warning, remove package-lock.json.&lt;/p></description></item><item><title>AWS CDK メモ: CDK アプリのパッケージ管理に Yarn を使う方法</title><link>https://maku.blog/p/4h3jygw/</link><pubDate>Sun, 17 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/4h3jygw/</guid><description>&lt;p>&lt;code>cdk init app --language typescript&lt;/code> で CDK アプリのひな型を生成すると、デフォルトではパッケージマネージャーとして NPM を使う想定になっています（&lt;code>package-lock.json&lt;/code> などが作成されます）。
NPM の代わりに Yarn を使いたい場合は、次のように &lt;code>package-lock.json&lt;/code> を削除して、&lt;code>yarn.lock&lt;/code> ファイルを生成します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> git rm package-lock.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> yarn install
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>生成された &lt;code>yarn.lock&lt;/code> は忘れずに Git へコミットしてください。&lt;/p>
&lt;p>ちなみに、&lt;code>package-lock.json&lt;/code> が残っている状態で &lt;code>yarn install&lt;/code> しようとすると、次のような感じの Warning が表示されます。&lt;/p>
&lt;blockquote>
&lt;p>warning package-lock.json found. Your project contains lock files generated by tools other than Yarn. It is advised not to mix package managers in order to avoid resolution inconsistencies caused by unsynchronized lock files. To clear this warning, remove package-lock.json.&lt;/p></description></item><item><title>AWS CDK メモ: 謎の CDKMetadata を生成しないようにする</title><link>https://maku.blog/p/2asq4k4/</link><pubDate>Mon, 04 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/2asq4k4/</guid><description>&lt;p>AWS CDK で CloudFormation スタックを生成すると、デフォルトで &lt;code>CDKMetadata&lt;/code> というリソースが生成されます（&lt;code>cdk synth&lt;/code> コマンドで CloudFormation テンプレートを出力してみると確認できます）。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CDKMetadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::CDK::Metadata&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Analytics&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v2:deflate64:IsH4AAAAAAAA/L9ZNTs....9mAAAA&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">aws:cdk:path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CdkStack/CDKMetadata/Default&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Condition&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CDKMetadataAvailable&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Conditions&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CDKMetadataAvailable&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Fn::Or&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Fn::Or&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Fn::Equals&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Ref&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Region&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">af-south-1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Fn::Equals&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Ref&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Region&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">ap-east-1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">...&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>自分で何もリソース生成していないのにテンプレートが汚されて邪魔だなぁと思っていたら、この情報は、CDK を開発しているチームが利用状況などを把握して今後の改善のために使うようです。
下記、&lt;a href="https://docs.aws.amazon.com/ja_jp/cdk/latest/guide/hello_world.html#hello_world_tutorial_synth">CDK のドキュメント&lt;/a> より抜粋。&lt;/p>
&lt;blockquote>
&lt;p>Every generated template contains a AWS::CDK::Metadata resource by default. (We haven&amp;rsquo;t shown it here.) The AWS CDK team uses this metadata to gain insight into how the AWS CDK is used, so we can continue to improve it. For details, including how to opt out of version reporting, see Version reporting.&lt;/p></description></item><item><title>AWS CDK メモ: 謎の CDKMetadata を生成しないようにする</title><link>https://maku.blog/p/2asq4k4/</link><pubDate>Mon, 04 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/2asq4k4/</guid><description>&lt;p>AWS CDK で CloudFormation スタックを生成すると、デフォルトで &lt;code>CDKMetadata&lt;/code> というリソースが生成されます（&lt;code>cdk synth&lt;/code> コマンドで CloudFormation テンプレートを出力してみると確認できます）。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CDKMetadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::CDK::Metadata&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Analytics&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v2:deflate64:IsH4AAAAAAAA/L9ZNTs....9mAAAA&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">aws:cdk:path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CdkStack/CDKMetadata/Default&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Condition&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">CDKMetadataAvailable&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Conditions&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CDKMetadataAvailable&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Fn::Or&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Fn::Or&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Fn::Equals&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Ref&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Region&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">af-south-1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Fn::Equals&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Ref&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::Region&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">ap-east-1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">...&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>自分で何もリソース生成していないのにテンプレートが汚されて邪魔だなぁと思っていたら、この情報は、CDK を開発しているチームが利用状況などを把握して今後の改善のために使うようです。
下記、&lt;a href="https://docs.aws.amazon.com/ja_jp/cdk/latest/guide/hello_world.html#hello_world_tutorial_synth">CDK のドキュメント&lt;/a> より抜粋。&lt;/p>
&lt;blockquote>
&lt;p>Every generated template contains a AWS::CDK::Metadata resource by default. (We haven&amp;rsquo;t shown it here.) The AWS CDK team uses this metadata to gain insight into how the AWS CDK is used, so we can continue to improve it. For details, including how to opt out of version reporting, see Version reporting.&lt;/p></description></item><item><title>AWS CDK で TypeScript で実装した Lambda 関数をデプロイする (NodejsFunction)</title><link>https://maku.blog/p/cj9i4m3/</link><pubDate>Wed, 06 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/cj9i4m3/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>ここでは、CDK アプリとして作成した CloudFormation スタック内に、&lt;strong>TypeScript で実装した Lambda 関数&lt;/strong> を追加してみます。
Lambda 関数のビルドもデプロイ時に自動で行われるようにします。&lt;/p>
&lt;p>以降の説明では、CDK プロジェクトの作成自体は済んでいるものとします。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/nujyfsy">AWS CDK 入門: cdk コマンドのインストールから Hello World まで&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="typescript-で-lambda-関数を実装する">TypeScript で Lambda 関数を実装する&lt;/h2>
&lt;p>Lambda 関数のコードは、プロジェクトのルートに &lt;code>lambda&lt;/code> ディレクトリを作成して、そこに配置していくことにします。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">myapp/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- bin/ ... CDK の App コンストラクト (.ts)
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> +-- lambda/ ... ラムダ関数の実装コード (.ts) ★これを追加
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> | +-- index.ts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- lib/ ... CDK の Stack コンストラクトなど (.ts)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>Lambda 関数実装用の TypeScript 型情報をインストールします。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> npm install @types/aws-lambda --save-dev &lt;span class="c1"># npm の場合&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> yarn add @types/aws-lambda --dev &lt;span class="c1"># yarn の場合&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>最低限の Hello World 的なラムダ関数を作成します。&lt;/p></description></item><item><title>AWS CDK で TypeScript で実装した Lambda 関数をデプロイする (NodejsFunction)</title><link>https://maku.blog/p/cj9i4m3/</link><pubDate>Wed, 06 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/cj9i4m3/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>ここでは、CDK アプリとして作成した CloudFormation スタック内に、&lt;strong>TypeScript で実装した Lambda 関数&lt;/strong> を追加してみます。
Lambda 関数のビルドもデプロイ時に自動で行われるようにします。&lt;/p>
&lt;p>以降の説明では、CDK プロジェクトの作成自体は済んでいるものとします。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/nujyfsy">AWS CDK 入門: cdk コマンドのインストールから Hello World まで&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="typescript-で-lambda-関数を実装する">TypeScript で Lambda 関数を実装する&lt;/h2>
&lt;p>Lambda 関数のコードは、プロジェクトのルートに &lt;code>lambda&lt;/code> ディレクトリを作成して、そこに配置していくことにします。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">myapp/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- bin/ ... CDK の App コンストラクト (.ts)
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> +-- lambda/ ... ラムダ関数の実装コード (.ts) ★これを追加
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> | +-- index.ts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- lib/ ... CDK の Stack コンストラクトなど (.ts)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>Lambda 関数実装用の TypeScript 型情報をインストールします。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> npm install @types/aws-lambda --save-dev &lt;span class="c1"># npm の場合&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> yarn add @types/aws-lambda --dev &lt;span class="c1"># yarn の場合&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>最低限の Hello World 的なラムダ関数を作成します。&lt;/p></description></item><item><title>AWS CDK で Go 言語で実装した Lambda 関数をデプロイする (GoFunction)</title><link>https://maku.blog/p/38jt3cm/</link><pubDate>Sun, 17 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/38jt3cm/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>ここでは、CDK アプリとして作成した CloudFormation スタック内に、&lt;strong>Go 言語で実装した Lambda 関数&lt;/strong> を追加してみます。
Lambda 関数のビルドもデプロイ時に自動で行われるようにします。&lt;/p>
&lt;p>CDK のプロジェクト自体（スタックを定義する CDK コード）は TypeScript で作成します。
以降の説明では、CDK プロジェクトの作成自体は済んでいるものとします。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/nujyfsy">AWS CDK 入門: cdk コマンドのインストールから Hello World まで&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="go-言語で-lambda-関数を実装する">Go 言語で Lambda 関数を実装する&lt;/h2>
&lt;p>Lambda 関数のコードは、プロジェクトのルートに &lt;code>lambda&lt;/code> ディレクトリを作成して、そこに配置していくことにします。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">myapp/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- bin/ ... CDK の App コンストラクト (.ts)
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> +-- lambda/ ... ラムダ関数用のディレクトリ (.go)
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> | +-- go.mod
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> | +-- go.sum
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> | +-- main.go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- lib/ ... CDK の Stack コンストラクトなど (.ts)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>lambda&lt;/code> ディレクトリの下で、Go パッケージの依存情報 (&lt;code>go.mod&lt;/code>、&lt;code>go.sum&lt;/code>) を追加します。&lt;/p></description></item><item><title>AWS CDK で Go 言語で実装した Lambda 関数をデプロイする (GoFunction)</title><link>https://maku.blog/p/38jt3cm/</link><pubDate>Sun, 17 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/38jt3cm/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>ここでは、CDK アプリとして作成した CloudFormation スタック内に、&lt;strong>Go 言語で実装した Lambda 関数&lt;/strong> を追加してみます。
Lambda 関数のビルドもデプロイ時に自動で行われるようにします。&lt;/p>
&lt;p>CDK のプロジェクト自体（スタックを定義する CDK コード）は TypeScript で作成します。
以降の説明では、CDK プロジェクトの作成自体は済んでいるものとします。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/nujyfsy">AWS CDK 入門: cdk コマンドのインストールから Hello World まで&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="go-言語で-lambda-関数を実装する">Go 言語で Lambda 関数を実装する&lt;/h2>
&lt;p>Lambda 関数のコードは、プロジェクトのルートに &lt;code>lambda&lt;/code> ディレクトリを作成して、そこに配置していくことにします。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">myapp/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- bin/ ... CDK の App コンストラクト (.ts)
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> +-- lambda/ ... ラムダ関数用のディレクトリ (.go)
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> | +-- go.mod
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> | +-- go.sum
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> | +-- main.go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- lib/ ... CDK の Stack コンストラクトなど (.ts)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>lambda&lt;/code> ディレクトリの下で、Go パッケージの依存情報 (&lt;code>go.mod&lt;/code>、&lt;code>go.sum&lt;/code>) を追加します。&lt;/p></description></item><item><title>AWS CDK のサンプルコード集（TypeScript 版）</title><link>https://maku.blog/p/gzkzbny/</link><pubDate>Mon, 04 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/gzkzbny/</guid><description>&lt;p>AWS CDK を使った TypeScript サンプルコードいろいろです。&lt;/p>
&lt;h2 id="リソースにタグを付ける">リソースにタグを付ける&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">cdk&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@aws-cdk/core&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">MyappStack&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;../lib/myapp-stack&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">app&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">cdk&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">App&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">new&lt;/span> &lt;span class="nx">MyappStack&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">app&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;MyappStack&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">tags&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Owner&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;TeamA&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Purpose&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;Project1&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">})&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>AWS リソース用のコンストラクトの props パラメーターで、&lt;strong>&lt;code>tags&lt;/code>&lt;/strong> プロパティを指定することで、そのリソースにタグを設定できます。&lt;/p>
&lt;p>タグの設定方法は、どの AWS リソース用のコンストラクトでも同様です。
上記のように &lt;code>Stack&lt;/code> コンストラクトに対してタグを設定すると、その中に配置した AWS リソースにもそのタグが設定されます。&lt;/p>
&lt;h2 id="s3-バケットや-dynamodb-テーブルをスタック削除時に自動削除する">S3 バケットや DynamoDB テーブルをスタック削除時に自動削除する&lt;/h2>
&lt;h3 id="バケットが空のときだけ自動削除する">バケットが空のときだけ自動削除する&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">cdk&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@aws-cdk/core&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">s3&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@aws-cdk/aws-s3&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">new&lt;/span> &lt;span class="nx">s3&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Bucket&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;MyBucket&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">removalPolicy&lt;/span>: &lt;span class="kt">cdk.RemovalPolicy.DESTROY&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">})&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>CDK で作成した S3 バケットや DynamoDB テーブルは、デフォルトでは、（内容が空であっても）スタック削除時にそのまま残るようになっています。
つまり、スタックから独立したリソースとして S3 バケットだけが残ります。
これは、CloudFormation の DeletionPolicy のデフォルトの挙動とは逆なので注意してください。
スタックの削除 (&lt;code>cdk destroy&lt;/code>) と同時に S3 バケットや DynamoDB テーブルを削除したいときは、上記のように &lt;strong>&lt;code>removalPolicy&lt;/code>&lt;/strong> を設定します。&lt;/p>
&lt;h3 id="バケットが空じゃなくても自動削除する">バケットが空じゃなくても自動削除する&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">cdk&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@aws-cdk/core&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">s3&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@aws-cdk/aws-s3&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">new&lt;/span> &lt;span class="nx">s3&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Bucket&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;MyBucket&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">removalPolicy&lt;/span>: &lt;span class="kt">cdk.RemovalPolicy.DESTROY&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">autoDeleteObjects&lt;/span>: &lt;span class="kt">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">})&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>removalPolicy&lt;/code> を &lt;code>RemovalPolicy.DESTROY&lt;/code> に設定しても、S3 バケットにオブジェクト含まれているときは、スタック削除時に連動して自動削除してくれません。
スタック削除時に、バケット内のオブジェクトを自動削除してバケットの削除までやってしまいたいときは、&lt;code>removalPolicy&lt;/code> に加えて、&lt;strong>&lt;code>autoDeleteObjects&lt;/code>&lt;/strong> プロパティを設定します。
この設定を行うと、たとえ S3 バケットのバージョニングが有効 (&lt;code>versioned: true&lt;/code>) になっていても、問答無用で削除されるので注意してください。
&lt;code>autoDeleteObjects&lt;/code> の機能を実現するために、内部的に Lambda 関数が自動生成されるので、CDK のブートストラッピング (&lt;code>cdk bootstrap&lt;/code>) をあらかじめ実行しておく必要があります。&lt;/p></description></item><item><title>AWS CDK のサンプルコード集（TypeScript 版）</title><link>https://maku.blog/p/gzkzbny/</link><pubDate>Mon, 04 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/gzkzbny/</guid><description>&lt;p>AWS CDK を使った TypeScript サンプルコードいろいろです。&lt;/p>
&lt;h2 id="リソースにタグを付ける">リソースにタグを付ける&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">cdk&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@aws-cdk/core&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">MyappStack&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;../lib/myapp-stack&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">app&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">cdk&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">App&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">new&lt;/span> &lt;span class="nx">MyappStack&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">app&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;MyappStack&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">tags&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Owner&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;TeamA&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Purpose&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;Project1&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">})&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>AWS リソース用のコンストラクトの props パラメーターで、&lt;strong>&lt;code>tags&lt;/code>&lt;/strong> プロパティを指定することで、そのリソースにタグを設定できます。&lt;/p>
&lt;p>タグの設定方法は、どの AWS リソース用のコンストラクトでも同様です。
上記のように &lt;code>Stack&lt;/code> コンストラクトに対してタグを設定すると、その中に配置した AWS リソースにもそのタグが設定されます。&lt;/p>
&lt;h2 id="s3-バケットや-dynamodb-テーブルをスタック削除時に自動削除する">S3 バケットや DynamoDB テーブルをスタック削除時に自動削除する&lt;/h2>
&lt;h3 id="バケットが空のときだけ自動削除する">バケットが空のときだけ自動削除する&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">cdk&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@aws-cdk/core&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">s3&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@aws-cdk/aws-s3&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">new&lt;/span> &lt;span class="nx">s3&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Bucket&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;MyBucket&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">removalPolicy&lt;/span>: &lt;span class="kt">cdk.RemovalPolicy.DESTROY&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">})&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>CDK で作成した S3 バケットや DynamoDB テーブルは、デフォルトでは、（内容が空であっても）スタック削除時にそのまま残るようになっています。
つまり、スタックから独立したリソースとして S3 バケットだけが残ります。
これは、CloudFormation の DeletionPolicy のデフォルトの挙動とは逆なので注意してください。
スタックの削除 (&lt;code>cdk destroy&lt;/code>) と同時に S3 バケットや DynamoDB テーブルを削除したいときは、上記のように &lt;strong>&lt;code>removalPolicy&lt;/code>&lt;/strong> を設定します。&lt;/p>
&lt;h3 id="バケットが空じゃなくても自動削除する">バケットが空じゃなくても自動削除する&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">cdk&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@aws-cdk/core&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">s3&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;@aws-cdk/aws-s3&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">new&lt;/span> &lt;span class="nx">s3&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Bucket&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;MyBucket&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">removalPolicy&lt;/span>: &lt;span class="kt">cdk.RemovalPolicy.DESTROY&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">autoDeleteObjects&lt;/span>: &lt;span class="kt">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">})&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>removalPolicy&lt;/code> を &lt;code>RemovalPolicy.DESTROY&lt;/code> に設定しても、S3 バケットにオブジェクト含まれているときは、スタック削除時に連動して自動削除してくれません。
スタック削除時に、バケット内のオブジェクトを自動削除してバケットの削除までやってしまいたいときは、&lt;code>removalPolicy&lt;/code> に加えて、&lt;strong>&lt;code>autoDeleteObjects&lt;/code>&lt;/strong> プロパティを設定します。
この設定を行うと、たとえ S3 バケットのバージョニングが有効 (&lt;code>versioned: true&lt;/code>) になっていても、問答無用で削除されるので注意してください。
&lt;code>autoDeleteObjects&lt;/code> の機能を実現するために、内部的に Lambda 関数が自動生成されるので、CDK のブートストラッピング (&lt;code>cdk bootstrap&lt;/code>) をあらかじめ実行しておく必要があります。&lt;/p></description></item><item><title>Amazon API Gateway で API キーでアクセス制限された Web API を作成する</title><link>https://maku.blog/p/j2ij4dv/</link><pubDate>Sun, 05 Jan 2025 00:00:00 +0900</pubDate><guid>https://maku.blog/p/j2ij4dv/</guid><description>&lt;p>Amazon API Gateway で作成した Web API には、&lt;strong>独自の API キーによるアクセス制限&lt;/strong> をかけることができます。
これにより、&lt;strong>&lt;code>x-api-key&lt;/code>&lt;/strong> ヘッダーが含まれていない HTTP リクエストを拒否することができます。
例えば、AWS 外の特定のバックエンドサービスからのアクセスのみを許可して連携させたいときに便利です。
ここでは、簡単な Hello World API を作成して、API キーによるアクセス制限をかけてみます。&lt;/p>
&lt;h2 id="lambda-関数を作成する">Lambda 関数を作成する&lt;/h2>
&lt;p>最初に、API 実装として Lambda 関数を作成しておきます。&lt;/p>
&lt;ol>
&lt;li>&lt;a href="https://aws.amazon.com/console/">AWS マネジメントコンソール&lt;/a> にサインインして、&lt;strong>Lambda&lt;/strong> サービスを開きます。&lt;/li>
&lt;li>&lt;strong>&lt;code>関数の作成&lt;/code>&lt;/strong> をクリックして、&lt;code>一から作成 (Author from scratch)&lt;/code> で次のように作成します。
&lt;ul>
&lt;li>関数名 (Function name): &lt;code>hello&lt;/code>&lt;/li>
&lt;li>ランタイム (Runtime): &lt;code>Node.js 22.x&lt;/code>&lt;/li>
&lt;li>アーキテクチャ (Architecture): &lt;code>arm64&lt;/code> （intel アーキテクチャより少し安い）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>次のような Lambda 関数のコードが生成されたら成功です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">index.mjs&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">handler&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">event&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// TODO implement
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">response&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">statusCode&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">body&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">JSON&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">stringify&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Hello from Lambda!&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">response&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="api-gateway-で-web-api-を作成する">API Gateway で Web API を作成する&lt;/h2>
&lt;p>次に、API Gateway で API を作成して、上記の Lambda 関数を HTTP 経由で呼び出せるようにします。&lt;/p></description></item><item><title>Amazon API Gateway で API キーでアクセス制限された Web API を作成する</title><link>https://maku.blog/p/j2ij4dv/</link><pubDate>Sun, 05 Jan 2025 00:00:00 +0900</pubDate><guid>https://maku.blog/p/j2ij4dv/</guid><description>&lt;p>Amazon API Gateway で作成した Web API には、&lt;strong>独自の API キーによるアクセス制限&lt;/strong> をかけることができます。
これにより、&lt;strong>&lt;code>x-api-key&lt;/code>&lt;/strong> ヘッダーが含まれていない HTTP リクエストを拒否することができます。
例えば、AWS 外の特定のバックエンドサービスからのアクセスのみを許可して連携させたいときに便利です。
ここでは、簡単な Hello World API を作成して、API キーによるアクセス制限をかけてみます。&lt;/p>
&lt;h2 id="lambda-関数を作成する">Lambda 関数を作成する&lt;/h2>
&lt;p>最初に、API 実装として Lambda 関数を作成しておきます。&lt;/p>
&lt;ol>
&lt;li>&lt;a href="https://aws.amazon.com/console/">AWS マネジメントコンソール&lt;/a> にサインインして、&lt;strong>Lambda&lt;/strong> サービスを開きます。&lt;/li>
&lt;li>&lt;strong>&lt;code>関数の作成&lt;/code>&lt;/strong> をクリックして、&lt;code>一から作成 (Author from scratch)&lt;/code> で次のように作成します。
&lt;ul>
&lt;li>関数名 (Function name): &lt;code>hello&lt;/code>&lt;/li>
&lt;li>ランタイム (Runtime): &lt;code>Node.js 22.x&lt;/code>&lt;/li>
&lt;li>アーキテクチャ (Architecture): &lt;code>arm64&lt;/code> （intel アーキテクチャより少し安い）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>次のような Lambda 関数のコードが生成されたら成功です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">index.mjs&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">handler&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">event&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// TODO implement
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">response&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">statusCode&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">body&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">JSON&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">stringify&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Hello from Lambda!&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">response&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="api-gateway-で-web-api-を作成する">API Gateway で Web API を作成する&lt;/h2>
&lt;p>次に、API Gateway で API を作成して、上記の Lambda 関数を HTTP 経由で呼び出せるようにします。&lt;/p></description></item><item><title>Amazon Cognito の ID トークンを使った認証付き API の仕組み</title><link>https://maku.blog/p/p4462y2/</link><pubDate>Wed, 14 Jun 2023 00:00:00 +0900</pubDate><guid>https://maku.blog/p/p4462y2/</guid><description>&lt;p>Amazon Cognito サービスを使うと、アプリケーションにユーザー認証（サインイン）の仕組みを提供し、認証されたユーザーだけが呼び出し可能な Web API などを実現できます。
その際に内部的に使用される ID トークンやアクセストークンなどの関係が若干複雑なのでメモしておきます。&lt;/p>
&lt;h2 id="cognito-で認証が必要な-api-を実現する仕組み">Cognito で認証が必要な API を実現する仕組み&lt;/h2>
&lt;figure style="text-align: center">
&lt;div class="mermaid">
graph LR;
 browser[Web ブラウザ] --サインイン--> cognito[Cognito&lt;br>ユーザープール];
 cognito --ID トークン--> browser
 browser --"認証が必要な API の呼び出し&lt;br>（with ID トークン）"--> gateway["API Gateway&lt;br>（ユーザープールと連携させておく）"]
&lt;/div>
&lt;/figure>

&lt;script>
(function() {
 
 if (window.isMermaidLoaded) return;
 window.isMermaidLoaded = true;

 
 const script = document.createElement('script');
 script.src = 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js';
 script.onload = () => { mermaid.initialize({startOnLoad: true}); };
 document.body.appendChild(script);
})();
&lt;/script>


&lt;p>Web アプリなどで Amazon Cognito の &lt;strong>ユーザープール&lt;/strong> を使って認証（サインイン）すると、Cognito は &lt;strong>ID トークン&lt;/strong> を返します（JWT: JSON Web Token）。
この ID トークンは、サービスの正式なユーザーであるということを証明するものです。
この ID トークンを API 呼び出し時に検証することで、認証が必要な API を実現することができます。&lt;/p></description></item><item><title>Amazon Cognito の ID トークンを使った認証付き API の仕組み</title><link>https://maku.blog/p/p4462y2/</link><pubDate>Wed, 14 Jun 2023 00:00:00 +0900</pubDate><guid>https://maku.blog/p/p4462y2/</guid><description>&lt;p>Amazon Cognito サービスを使うと、アプリケーションにユーザー認証（サインイン）の仕組みを提供し、認証されたユーザーだけが呼び出し可能な Web API などを実現できます。
その際に内部的に使用される ID トークンやアクセストークンなどの関係が若干複雑なのでメモしておきます。&lt;/p>
&lt;h2 id="cognito-で認証が必要な-api-を実現する仕組み">Cognito で認証が必要な API を実現する仕組み&lt;/h2>
&lt;figure style="text-align: center">
&lt;div class="mermaid">
graph LR;
 browser[Web ブラウザ] --サインイン--> cognito[Cognito&lt;br>ユーザープール];
 cognito --ID トークン--> browser
 browser --"認証が必要な API の呼び出し&lt;br>（with ID トークン）"--> gateway["API Gateway&lt;br>（ユーザープールと連携させておく）"]
&lt;/div>
&lt;/figure>

&lt;script>
(function() {
 
 if (window.isMermaidLoaded) return;
 window.isMermaidLoaded = true;

 
 const script = document.createElement('script');
 script.src = 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js';
 script.onload = () => { mermaid.initialize({startOnLoad: true}); };
 document.body.appendChild(script);
})();
&lt;/script>


&lt;p>Web アプリなどで Amazon Cognito の &lt;strong>ユーザープール&lt;/strong> を使って認証（サインイン）すると、Cognito は &lt;strong>ID トークン&lt;/strong> を返します（JWT: JSON Web Token）。
この ID トークンは、サービスの正式なユーザーであるということを証明するものです。
この ID トークンを API 呼び出し時に検証することで、認証が必要な API を実現することができます。&lt;/p></description></item><item><title>AWS CDK で API Gateway に Cognito 認証によるアクセス制御を追加する</title><link>https://maku.blog/p/vujw9jv/</link><pubDate>Mon, 18 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/vujw9jv/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>ここでは、API Gateway で提供している REST API にアクセス制御を追加するため、既存の Cognito ユーザープールによるオーソライザーを API Gateway に設定してみます。
これにより、Cognito のユーザープールで認証済みのユーザーのみが REST API を呼び出せるようになります。&lt;/p>
&lt;p>後述の CDK コードでは、API Gateway と Lambda 関数、オーソライザーを生成していますが、Cognito ユーザープールは既存のものを参照しています（こういったユースケースは多いと思います）。&lt;/p>
&lt;p>なお、CDK による API Gateway の作成方法（Lambda プロキシ統合）については下記の記事を参考にしてください。
ここでは、Cognito ユーザープールによるオーソライザーの作成方法にフォーカスします。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="../../p/k7eoer5">AWS CDK で API Gateway の REST API を作成する&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="lambda-関数を作成する">Lambda 関数を作成する&lt;/h2>
&lt;p>REST API のバックエンドである Lambda 関数は最低限の実装で用意します。
ユーザー認証後に、API Gateway 経由で正しくこのハンドラを呼び出せるかの確認用です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">lambda/info.ts&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">APIGatewayProxyHandler&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s2">&amp;#34;aws-lambda&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/** GET /info */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">handler&lt;/span>: &lt;span class="kt">APIGatewayProxyHandler&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">event&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;headers: &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">JSON&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">stringify&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">headers&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">statusCode&lt;/span>: &lt;span class="kt">200&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">body&lt;/span>: &lt;span class="kt">JSON.stringify&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">message&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;Hello, API Gateway!&amp;#34;&lt;/span> &lt;span class="p">}),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">headers&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Access-Control-Allow-Origin&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="cognito-ユーザープールによるオーソライザーの追加">Cognito ユーザープールによるオーソライザーの追加&lt;/h2>
&lt;p>下記は、&lt;code>cdk init app&lt;/code> で作成した CDK アプリのスタック生成コードに手を入れたものです。&lt;/p></description></item><item><title>AWS CDK で API Gateway に Cognito 認証によるアクセス制御を追加する</title><link>https://maku.blog/p/vujw9jv/</link><pubDate>Mon, 18 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/vujw9jv/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>ここでは、API Gateway で提供している REST API にアクセス制御を追加するため、既存の Cognito ユーザープールによるオーソライザーを API Gateway に設定してみます。
これにより、Cognito のユーザープールで認証済みのユーザーのみが REST API を呼び出せるようになります。&lt;/p>
&lt;p>後述の CDK コードでは、API Gateway と Lambda 関数、オーソライザーを生成していますが、Cognito ユーザープールは既存のものを参照しています（こういったユースケースは多いと思います）。&lt;/p>
&lt;p>なお、CDK による API Gateway の作成方法（Lambda プロキシ統合）については下記の記事を参考にしてください。
ここでは、Cognito ユーザープールによるオーソライザーの作成方法にフォーカスします。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="../../p/k7eoer5">AWS CDK で API Gateway の REST API を作成する&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="lambda-関数を作成する">Lambda 関数を作成する&lt;/h2>
&lt;p>REST API のバックエンドである Lambda 関数は最低限の実装で用意します。
ユーザー認証後に、API Gateway 経由で正しくこのハンドラを呼び出せるかの確認用です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">lambda/info.ts&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">APIGatewayProxyHandler&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s2">&amp;#34;aws-lambda&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/** GET /info */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">handler&lt;/span>: &lt;span class="kt">APIGatewayProxyHandler&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">event&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;headers: &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">JSON&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">stringify&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">headers&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">statusCode&lt;/span>: &lt;span class="kt">200&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">body&lt;/span>: &lt;span class="kt">JSON.stringify&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">message&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;Hello, API Gateway!&amp;#34;&lt;/span> &lt;span class="p">}),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">headers&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Access-Control-Allow-Origin&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="cognito-ユーザープールによるオーソライザーの追加">Cognito ユーザープールによるオーソライザーの追加&lt;/h2>
&lt;p>下記は、&lt;code>cdk init app&lt;/code> で作成した CDK アプリのスタック生成コードに手を入れたものです。&lt;/p></description></item><item><title>AWS CDK で API Gateway に Cognito 認証によるアクセス制御を追加する</title><link>https://maku.blog/p/vujw9jv/</link><pubDate>Mon, 18 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/vujw9jv/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>ここでは、API Gateway で提供している REST API にアクセス制御を追加するため、既存の Cognito ユーザープールによるオーソライザーを API Gateway に設定してみます。
これにより、Cognito のユーザープールで認証済みのユーザーのみが REST API を呼び出せるようになります。&lt;/p>
&lt;p>後述の CDK コードでは、API Gateway と Lambda 関数、オーソライザーを生成していますが、Cognito ユーザープールは既存のものを参照しています（こういったユースケースは多いと思います）。&lt;/p>
&lt;p>なお、CDK による API Gateway の作成方法（Lambda プロキシ統合）については下記の記事を参考にしてください。
ここでは、Cognito ユーザープールによるオーソライザーの作成方法にフォーカスします。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="../../p/k7eoer5">AWS CDK で API Gateway の REST API を作成する&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="lambda-関数を作成する">Lambda 関数を作成する&lt;/h2>
&lt;p>REST API のバックエンドである Lambda 関数は最低限の実装で用意します。
ユーザー認証後に、API Gateway 経由で正しくこのハンドラを呼び出せるかの確認用です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">lambda/info.ts&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">APIGatewayProxyHandler&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s2">&amp;#34;aws-lambda&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/** GET /info */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">handler&lt;/span>: &lt;span class="kt">APIGatewayProxyHandler&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">event&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;headers: &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">JSON&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">stringify&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">headers&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">statusCode&lt;/span>: &lt;span class="kt">200&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">body&lt;/span>: &lt;span class="kt">JSON.stringify&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">message&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;Hello, API Gateway!&amp;#34;&lt;/span> &lt;span class="p">}),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">headers&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Access-Control-Allow-Origin&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="cognito-ユーザープールによるオーソライザーの追加">Cognito ユーザープールによるオーソライザーの追加&lt;/h2>
&lt;p>下記は、&lt;code>cdk init app&lt;/code> で作成した CDK アプリのスタック生成コードに手を入れたものです。&lt;/p></description></item><item><title>AWS CDK で API Gateway に Cognito 認証によるアクセス制御を追加する</title><link>https://maku.blog/p/vujw9jv/</link><pubDate>Mon, 18 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/vujw9jv/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>ここでは、API Gateway で提供している REST API にアクセス制御を追加するため、既存の Cognito ユーザープールによるオーソライザーを API Gateway に設定してみます。
これにより、Cognito のユーザープールで認証済みのユーザーのみが REST API を呼び出せるようになります。&lt;/p>
&lt;p>後述の CDK コードでは、API Gateway と Lambda 関数、オーソライザーを生成していますが、Cognito ユーザープールは既存のものを参照しています（こういったユースケースは多いと思います）。&lt;/p>
&lt;p>なお、CDK による API Gateway の作成方法（Lambda プロキシ統合）については下記の記事を参考にしてください。
ここでは、Cognito ユーザープールによるオーソライザーの作成方法にフォーカスします。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="../../p/k7eoer5">AWS CDK で API Gateway の REST API を作成する&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="lambda-関数を作成する">Lambda 関数を作成する&lt;/h2>
&lt;p>REST API のバックエンドである Lambda 関数は最低限の実装で用意します。
ユーザー認証後に、API Gateway 経由で正しくこのハンドラを呼び出せるかの確認用です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">lambda/info.ts&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">APIGatewayProxyHandler&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s2">&amp;#34;aws-lambda&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/** GET /info */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">handler&lt;/span>: &lt;span class="kt">APIGatewayProxyHandler&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">async&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">event&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;headers: &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">JSON&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">stringify&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">headers&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">undefined&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">statusCode&lt;/span>: &lt;span class="kt">200&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">body&lt;/span>: &lt;span class="kt">JSON.stringify&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">message&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;Hello, API Gateway!&amp;#34;&lt;/span> &lt;span class="p">}),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">headers&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Access-Control-Allow-Origin&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="cognito-ユーザープールによるオーソライザーの追加">Cognito ユーザープールによるオーソライザーの追加&lt;/h2>
&lt;p>下記は、&lt;code>cdk init app&lt;/code> で作成した CDK アプリのスタック生成コードに手を入れたものです。&lt;/p></description></item><item><title>AWS CDK で API Gateway の REST API を作成する</title><link>https://maku.blog/p/k7eoer5/</link><pubDate>Mon, 18 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/k7eoer5/</guid><description>&lt;h2 id="概要">概要&lt;/h2>
&lt;h3 id="api-gateway-は-https-で-lambda-関数を呼び出す">API Gateway は HTTPS で Lambda 関数を呼び出す&lt;/h3>
&lt;p>API Gateway で REST API のエンドポイントを定義すると、HTTPS リクエストで Lambda 関数を呼び出せるようになります。&lt;/p>
&lt;div style="text-align:center; font-weight:bold;">クライアント ─(HTTPS)─&amp;gt; API Gateway ─(AWS API)─&amp;gt; Lambda 関数&lt;/div>

&lt;p>API Gateway には Cognito のユーザープールと連携する機能を備えており、認証済みのユーザーにのみ API 呼び出しを許可するといったことが可能です（具体的に言うと、API Gateway が見えないところで ID トークンの正当性を確認してくれたりします）。&lt;/p>
&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ 新しい Lambda 関数 URL&lt;/span>
 &lt;span class="xNote_body">2022 年 4 月に公開された &lt;a href="https://aws.amazon.com/jp/about-aws/whats-new/2022/04/aws-lambda-function-urls-built-in-https-endpoints/">Lambda 関数 URL&lt;/a> の仕組みを使うと、直接 Lambda 関数にエンドポイント URL を割り当てて呼び出すことができます。
Cognito 連携などを使わないシンプルな Web API であれば、Lambda 関数 URL の仕組みで作ってしまうのが手っ取り早いかもしれません。&lt;/span>
&lt;/div>
&lt;h3 id="lambda-プロキシ統合">Lambda プロキシ統合&lt;/h3>
&lt;p>Lambda 関数は様々な AWS サービスからのイベント通知によって起動する仕組みになっており、API Gateway からの HTTPS リクエストもそのうちのひとつです。
Lambda 関数のハンドラが呼び出されるとき、そのパラメーターとして「イベントオブジェクト」を受け取ることができるのですが、このイベントオブジェクトの中身は発生源によって異なります。&lt;/p></description></item><item><title>AWS CDK で API Gateway の REST API を作成する</title><link>https://maku.blog/p/k7eoer5/</link><pubDate>Mon, 18 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/k7eoer5/</guid><description>&lt;h2 id="概要">概要&lt;/h2>
&lt;h3 id="api-gateway-は-https-で-lambda-関数を呼び出す">API Gateway は HTTPS で Lambda 関数を呼び出す&lt;/h3>
&lt;p>API Gateway で REST API のエンドポイントを定義すると、HTTPS リクエストで Lambda 関数を呼び出せるようになります。&lt;/p>
&lt;div style="text-align:center; font-weight:bold;">クライアント ─(HTTPS)─&amp;gt; API Gateway ─(AWS API)─&amp;gt; Lambda 関数&lt;/div>

&lt;p>API Gateway には Cognito のユーザープールと連携する機能を備えており、認証済みのユーザーにのみ API 呼び出しを許可するといったことが可能です（具体的に言うと、API Gateway が見えないところで ID トークンの正当性を確認してくれたりします）。&lt;/p>
&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ 新しい Lambda 関数 URL&lt;/span>
 &lt;span class="xNote_body">2022 年 4 月に公開された &lt;a href="https://aws.amazon.com/jp/about-aws/whats-new/2022/04/aws-lambda-function-urls-built-in-https-endpoints/">Lambda 関数 URL&lt;/a> の仕組みを使うと、直接 Lambda 関数にエンドポイント URL を割り当てて呼び出すことができます。
Cognito 連携などを使わないシンプルな Web API であれば、Lambda 関数 URL の仕組みで作ってしまうのが手っ取り早いかもしれません。&lt;/span>
&lt;/div>
&lt;h3 id="lambda-プロキシ統合">Lambda プロキシ統合&lt;/h3>
&lt;p>Lambda 関数は様々な AWS サービスからのイベント通知によって起動する仕組みになっており、API Gateway からの HTTPS リクエストもそのうちのひとつです。
Lambda 関数のハンドラが呼び出されるとき、そのパラメーターとして「イベントオブジェクト」を受け取ることができるのですが、このイベントオブジェクトの中身は発生源によって異なります。&lt;/p></description></item><item><title>AWS CDK で API Gateway の REST API を作成する</title><link>https://maku.blog/p/k7eoer5/</link><pubDate>Mon, 18 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/k7eoer5/</guid><description>&lt;h2 id="概要">概要&lt;/h2>
&lt;h3 id="api-gateway-は-https-で-lambda-関数を呼び出す">API Gateway は HTTPS で Lambda 関数を呼び出す&lt;/h3>
&lt;p>API Gateway で REST API のエンドポイントを定義すると、HTTPS リクエストで Lambda 関数を呼び出せるようになります。&lt;/p>
&lt;div style="text-align:center; font-weight:bold;">クライアント ─(HTTPS)─&amp;gt; API Gateway ─(AWS API)─&amp;gt; Lambda 関数&lt;/div>

&lt;p>API Gateway には Cognito のユーザープールと連携する機能を備えており、認証済みのユーザーにのみ API 呼び出しを許可するといったことが可能です（具体的に言うと、API Gateway が見えないところで ID トークンの正当性を確認してくれたりします）。&lt;/p>
&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ 新しい Lambda 関数 URL&lt;/span>
 &lt;span class="xNote_body">2022 年 4 月に公開された &lt;a href="https://aws.amazon.com/jp/about-aws/whats-new/2022/04/aws-lambda-function-urls-built-in-https-endpoints/">Lambda 関数 URL&lt;/a> の仕組みを使うと、直接 Lambda 関数にエンドポイント URL を割り当てて呼び出すことができます。
Cognito 連携などを使わないシンプルな Web API であれば、Lambda 関数 URL の仕組みで作ってしまうのが手っ取り早いかもしれません。&lt;/span>
&lt;/div>
&lt;h3 id="lambda-プロキシ統合">Lambda プロキシ統合&lt;/h3>
&lt;p>Lambda 関数は様々な AWS サービスからのイベント通知によって起動する仕組みになっており、API Gateway からの HTTPS リクエストもそのうちのひとつです。
Lambda 関数のハンドラが呼び出されるとき、そのパラメーターとして「イベントオブジェクト」を受け取ることができるのですが、このイベントオブジェクトの中身は発生源によって異なります。&lt;/p></description></item><item><title>Go 言語で AWS CDK V2 を使う (1) 導入編</title><link>https://maku.blog/p/54s6es8/</link><pubDate>Wed, 13 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/54s6es8/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>CDK プロジェクトでは多くのケースでは TypeScript を使ってコード記述されていると思いますが、Go 言語の勢いが出てきていることもあり、ここでは Go 言語を使った CDK プロジェクトを作成してみます。&lt;/p>
&lt;p>CDK 自体の概要については下記に簡単にまとまっています。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/nujyfsy">AWS CDK 入門 (1) インストールから Hello World まで&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>以下、Go 言語のインストールや、AWS の認証情報の設定 (&lt;code>~/.aws/credentials&lt;/code>, &lt;code>~/.aws/config&lt;/code>) はできているものとします。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/xnogqgm">Go 言語で AWS SDK を使う開発環境を整える&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="aws-cdk-のインストール">AWS CDK のインストール&lt;/h2>
&lt;p>Go 言語で CDK のコードを記述する場合でも、AWS CDK のコマンドラインツール (&lt;code>cdk&lt;/code>) 自体は、Node.js の NPM パッケージで提供されているものを使います。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> npm install -g aws-cdk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> cdk --version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">2.20.0 (build 738ef49)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="cdk-プロジェクトを作成する-cdk-init">CDK プロジェクトを作成する (cdk init)&lt;/h2>
&lt;p>CDK の Scaffold 機能を使って、Go 言語用の CDK プロジェクトを生成します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> mkdir cdk-with-go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">cd&lt;/span> cdk-with-go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> cdk init --language&lt;span class="o">=&lt;/span>go
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>cdk init&lt;/code> すると、次のようなファイルが生成されます。
TypeScript 用のプロジェクトと比べてとってもシンプルです！&lt;/p></description></item><item><title>Go 言語で AWS CDK V2 を使う (1) 導入編</title><link>https://maku.blog/p/54s6es8/</link><pubDate>Wed, 13 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/54s6es8/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>CDK プロジェクトでは多くのケースでは TypeScript を使ってコード記述されていると思いますが、Go 言語の勢いが出てきていることもあり、ここでは Go 言語を使った CDK プロジェクトを作成してみます。&lt;/p>
&lt;p>CDK 自体の概要については下記に簡単にまとまっています。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/nujyfsy">AWS CDK 入門 (1) インストールから Hello World まで&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>以下、Go 言語のインストールや、AWS の認証情報の設定 (&lt;code>~/.aws/credentials&lt;/code>, &lt;code>~/.aws/config&lt;/code>) はできているものとします。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/xnogqgm">Go 言語で AWS SDK を使う開発環境を整える&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="aws-cdk-のインストール">AWS CDK のインストール&lt;/h2>
&lt;p>Go 言語で CDK のコードを記述する場合でも、AWS CDK のコマンドラインツール (&lt;code>cdk&lt;/code>) 自体は、Node.js の NPM パッケージで提供されているものを使います。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> npm install -g aws-cdk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> cdk --version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">2.20.0 (build 738ef49)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="cdk-プロジェクトを作成する-cdk-init">CDK プロジェクトを作成する (cdk init)&lt;/h2>
&lt;p>CDK の Scaffold 機能を使って、Go 言語用の CDK プロジェクトを生成します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> mkdir cdk-with-go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">cd&lt;/span> cdk-with-go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> cdk init --language&lt;span class="o">=&lt;/span>go
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>cdk init&lt;/code> すると、次のようなファイルが生成されます。
TypeScript 用のプロジェクトと比べてとってもシンプルです！&lt;/p></description></item><item><title>Amazon API Gateway をコマンドライン (CLI) から操作する</title><link>https://maku.blog/p/qwb6v89/</link><pubDate>Mon, 11 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/qwb6v89/</guid><description>&lt;p>AWS CLI（コマンドラインkツール）で Amazon API Gateway を操作するには、&lt;strong>&lt;code>aws apigatewayv2&lt;/code>&lt;/strong> コマンドを使用します。
API Gateway の作成や更新を行うためには、IAM ユーザーに適切な権限が必要ですが、&lt;strong>&lt;code>AmazonAPIGatewayAdministrator&lt;/code>&lt;/strong> 管理ポリシーを付けるとほとんどの操作が可能になります。
通常、REST API を作成する場合は、バックエンドの Lambda 関数も合わせて必要になるので、&lt;strong>&lt;code>AWSLambdaFullAccess&lt;/code>&lt;/strong> などの管理ポリシーも必要になります。&lt;/p>
&lt;h2 id="rest-api-を作成する-apigateway-create-rest-api">REST API を作成する (apigateway create-rest-api)&lt;/h2>
&lt;p>リファレンス: &lt;a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/apigateway/create-rest-api.html">apigateway create-rest-api&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws apigateway create-rest-api --name &lt;span class="s2">&amp;#34;My First API&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&lt;span class="go"> --description &amp;#34;This is my first API&amp;#34; \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --region ap-northeast-1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">apiKeySource: HEADER
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">createdDate: &amp;#39;2022-04-18T15:46:00+09:00&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">description: This is my first API
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">disableExecuteApiEndpoint: false
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">endpointConfiguration:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> types:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> - EDGE
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">id: mk6mj65po6
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">name: My First API
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>--name&lt;/code> オプションのみが必須です。
API の作成に成功すると、上記のように ID (&lt;code>mk6mj65po6&lt;/code>) が返されます。&lt;/p></description></item><item><title>Amazon API Gateway をコマンドライン (CLI) から操作する</title><link>https://maku.blog/p/qwb6v89/</link><pubDate>Mon, 11 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/qwb6v89/</guid><description>&lt;p>AWS CLI（コマンドラインkツール）で Amazon API Gateway を操作するには、&lt;strong>&lt;code>aws apigatewayv2&lt;/code>&lt;/strong> コマンドを使用します。
API Gateway の作成や更新を行うためには、IAM ユーザーに適切な権限が必要ですが、&lt;strong>&lt;code>AmazonAPIGatewayAdministrator&lt;/code>&lt;/strong> 管理ポリシーを付けるとほとんどの操作が可能になります。
通常、REST API を作成する場合は、バックエンドの Lambda 関数も合わせて必要になるので、&lt;strong>&lt;code>AWSLambdaFullAccess&lt;/code>&lt;/strong> などの管理ポリシーも必要になります。&lt;/p>
&lt;h2 id="rest-api-を作成する-apigateway-create-rest-api">REST API を作成する (apigateway create-rest-api)&lt;/h2>
&lt;p>リファレンス: &lt;a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/apigateway/create-rest-api.html">apigateway create-rest-api&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws apigateway create-rest-api --name &lt;span class="s2">&amp;#34;My First API&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&lt;span class="go"> --description &amp;#34;This is my first API&amp;#34; \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --region ap-northeast-1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">apiKeySource: HEADER
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">createdDate: &amp;#39;2022-04-18T15:46:00+09:00&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">description: This is my first API
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">disableExecuteApiEndpoint: false
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">endpointConfiguration:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> types:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> - EDGE
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">id: mk6mj65po6
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">name: My First API
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>--name&lt;/code> オプションのみが必須です。
API の作成に成功すると、上記のように ID (&lt;code>mk6mj65po6&lt;/code>) が返されます。&lt;/p></description></item><item><title>Amazon API Gateway をコマンドライン (CLI) から操作する</title><link>https://maku.blog/p/qwb6v89/</link><pubDate>Mon, 11 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/qwb6v89/</guid><description>&lt;p>AWS CLI（コマンドラインkツール）で Amazon API Gateway を操作するには、&lt;strong>&lt;code>aws apigatewayv2&lt;/code>&lt;/strong> コマンドを使用します。
API Gateway の作成や更新を行うためには、IAM ユーザーに適切な権限が必要ですが、&lt;strong>&lt;code>AmazonAPIGatewayAdministrator&lt;/code>&lt;/strong> 管理ポリシーを付けるとほとんどの操作が可能になります。
通常、REST API を作成する場合は、バックエンドの Lambda 関数も合わせて必要になるので、&lt;strong>&lt;code>AWSLambdaFullAccess&lt;/code>&lt;/strong> などの管理ポリシーも必要になります。&lt;/p>
&lt;h2 id="rest-api-を作成する-apigateway-create-rest-api">REST API を作成する (apigateway create-rest-api)&lt;/h2>
&lt;p>リファレンス: &lt;a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/apigateway/create-rest-api.html">apigateway create-rest-api&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws apigateway create-rest-api --name &lt;span class="s2">&amp;#34;My First API&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&lt;span class="go"> --description &amp;#34;This is my first API&amp;#34; \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --region ap-northeast-1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">apiKeySource: HEADER
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">createdDate: &amp;#39;2022-04-18T15:46:00+09:00&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">description: This is my first API
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">disableExecuteApiEndpoint: false
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">endpointConfiguration:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> types:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> - EDGE
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">id: mk6mj65po6
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">name: My First API
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>--name&lt;/code> オプションのみが必須です。
API の作成に成功すると、上記のように ID (&lt;code>mk6mj65po6&lt;/code>) が返されます。&lt;/p></description></item><item><title>Go 言語で AWS SDK を使う開発環境を整える</title><link>https://maku.blog/p/xnogqgm/</link><pubDate>Mon, 11 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/xnogqgm/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>ここでは、Go 言語用の AWS SDK V2 をセットアップして、各種 AWS サービス用の API を呼び出す準備をします。&lt;/p>
&lt;p>Go 言語は Google が開発したプログラミング言語で、ライブラリインポートの手軽さや、生成された実行バイナリの実行速度に定評があるため、今後も利用ユーザーは増えていきそうです。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="https://maku77.github.io/hugo/go/what-is-go.html">Go 言語とは？／Go をインストールする | まくまくHugo/Goノート&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Go の実行環境は &lt;a href="https://go.dev/doc/install">Go のインストーラー&lt;/a> で簡単にインストールできます。
これ以降の説明では、Go の実行環境はインストール済みであると想定しています。&lt;/p>
&lt;h2 id="テスト用の-go-プロジェクトを作成する">テスト用の Go プロジェクトを作成する&lt;/h2>
&lt;p>Go プロジェクト用に適当なディレクトリを作成し、その中で &lt;strong>&lt;code>go mod init&lt;/code>&lt;/strong> コマンドを実行して &lt;strong>&lt;code>go.mod&lt;/code>&lt;/strong> （依存関係などが保存されるファイル）を作成しておきます。
このファイルが存在するディレクトリを、Go はモジュールとして認識します。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> mkdir aws-study
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> &lt;span class="nb">cd&lt;/span> aws-study
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go mod init aws-study
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上記の例では、&lt;code>go mod init&lt;/code> の引数（モジュールパス）を &lt;code>aws-study&lt;/code> としましたが、GitHub リポジトリで管理する前提であれば、&lt;strong>&lt;code>github.com/&amp;lt;user&amp;gt;/aws-study&lt;/code>&lt;/strong> のようなモジュールパスを指定するようにしてください。
これで、Go 言語プロジェクトの準備完了です。&lt;/p>
&lt;h2 id="aws-sdk-でコンフィグ情報を参照してみる">AWS SDK でコンフィグ情報を参照してみる&lt;/h2>
&lt;p>AWS SDK を使って AWS のサービスにアクセスするには、認証情報として IAM ユーザーの「アクセスキー ID」や「シークレットアクセスキー」などが必要になります。
これらは、一般的には AWS CLI の &lt;code>aws configure&lt;/code> コマンドによって、&lt;code>~/.aws/credentials&lt;/code> や &lt;code>~/.aws/config&lt;/code> に保存された情報です。&lt;/p></description></item><item><title>Go 言語と AWS SDK V2 で Amazon Cognito を操作する</title><link>https://maku.blog/p/nej9wjb/</link><pubDate>Mon, 11 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/nej9wjb/</guid><description>&lt;p>ここでは、AWS SDK for Go V2 を使って、Go 言語から Amazon Cognito を操作するサンプルコードを示します。
&lt;a href="../../p/xnogqgm">Go 言語で AWS SDK を使うための開発環境&lt;/a> は構築済みとします。&lt;/p>
&lt;h2 id="指定したユーザープール内のユーザーリストを取得する-listusers">指定したユーザープール内のユーザーリストを取得する (ListUsers)&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">list_users.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;context&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;github.com/aws/aws-sdk-go-v2/aws&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;github.com/aws/aws-sdk-go-v2/config&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;github.com/aws/aws-sdk-go-v2/service/cognitoidentityprovider&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">userPoolId&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;ap-northeast-1_XXXXXXXXX&amp;#34;&lt;/span> &lt;span class="c1">// ユーザープールの ID
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nf">listUsers&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">listUsers&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">client&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">cognitoidentityprovider&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewFromConfig&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">loadAwsConfig&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">input&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">cognitoidentityprovider&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ListUsersInput&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">UserPoolId&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">userPoolId&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">output&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ListUsers&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">TODO&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nx">input&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">user&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">output&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Users&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%s, %s\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">user&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">UserCreateDate&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">user&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Username&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Found %d users\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">output&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Users&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 外部リソース（~/.aws/config など）からコンフィグ情報 (aws.Config) を生成します。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">loadAwsConfig&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="nx">aws&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Config&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">cfg&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">LoadDefaultConfig&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">TODO&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">return&lt;/span> &lt;span class="nx">cfg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go run list_users.go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">2021-11-25 06:37:28.751 +0000 UTC, user-name-1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">2021-10-28 02:34:29.485 +0000 UTC, user-name-2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">2021-11-30 13:49:28.566 +0000 UTC, user-name-3
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Found 3 users
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="ユーザーのパスワードを変更する-adminsetuserpassword">ユーザーのパスワードを変更する (AdminSetUserPassword)&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;context&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;github.com/aws/aws-sdk-go-v2/aws&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;github.com/aws/aws-sdk-go-v2/config&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;github.com/aws/aws-sdk-go-v2/service/cognitoidentityprovider&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">userPoolId&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;ap-northeast-1_XXXXXXXXX&amp;#34;&lt;/span> &lt;span class="c1">// ユーザープールの ID
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nf">adminSetUserPassword&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">adminSetUserPassword&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">client&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">cognitoidentityprovider&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewFromConfig&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">loadAwsConfig&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">user&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;user1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">pass&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;Password#123&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">input&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">cognitoidentityprovider&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">AdminSetUserPasswordInput&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">UserPoolId&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">userPoolId&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">Username&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">user&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">Password&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">pass&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">AdminSetUserPassword&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">TODO&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nx">input&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Password changed&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="ユーザー名とパスワードで認証して-id-トークンとアクセストークンを取得する-admininitiateauth">ユーザー名とパスワードで認証して ID トークンとアクセストークンを取得する (AdminInitiateAuth)&lt;/h2>
&lt;p>下記のように &lt;code>AdminInitiateAuth&lt;/code> API でユーザー認証を行うには、Cognito ユーザープールの設定で対象のクライアントを選択し、&lt;strong>&lt;code>ALLOW_ADMIN_USER_PASSWORD_AUTH&lt;/code>&lt;/strong> にチェックを入れておく必要があります。&lt;/p></description></item><item><title>Go 言語と AWS SDK V2 で Amazon Cognito を操作する</title><link>https://maku.blog/p/nej9wjb/</link><pubDate>Mon, 11 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/nej9wjb/</guid><description>&lt;p>ここでは、AWS SDK for Go V2 を使って、Go 言語から Amazon Cognito を操作するサンプルコードを示します。
&lt;a href="../../p/xnogqgm">Go 言語で AWS SDK を使うための開発環境&lt;/a> は構築済みとします。&lt;/p>
&lt;h2 id="指定したユーザープール内のユーザーリストを取得する-listusers">指定したユーザープール内のユーザーリストを取得する (ListUsers)&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">list_users.go&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;context&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;github.com/aws/aws-sdk-go-v2/aws&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;github.com/aws/aws-sdk-go-v2/config&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;github.com/aws/aws-sdk-go-v2/service/cognitoidentityprovider&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">userPoolId&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;ap-northeast-1_XXXXXXXXX&amp;#34;&lt;/span> &lt;span class="c1">// ユーザープールの ID
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nf">listUsers&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">listUsers&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">client&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">cognitoidentityprovider&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewFromConfig&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">loadAwsConfig&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">input&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">cognitoidentityprovider&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ListUsersInput&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">UserPoolId&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">userPoolId&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">output&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ListUsers&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">TODO&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nx">input&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">for&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">user&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="k">range&lt;/span> &lt;span class="nx">output&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Users&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%s, %s\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">user&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">UserCreateDate&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">user&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Username&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Found %d users\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">output&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Users&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 外部リソース（~/.aws/config など）からコンフィグ情報 (aws.Config) を生成します。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">loadAwsConfig&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="nx">aws&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Config&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">cfg&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">LoadDefaultConfig&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">TODO&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">return&lt;/span> &lt;span class="nx">cfg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> go run list_users.go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">2021-11-25 06:37:28.751 +0000 UTC, user-name-1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">2021-10-28 02:34:29.485 +0000 UTC, user-name-2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">2021-11-30 13:49:28.566 +0000 UTC, user-name-3
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Found 3 users
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="ユーザーのパスワードを変更する-adminsetuserpassword">ユーザーのパスワードを変更する (AdminSetUserPassword)&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;context&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;github.com/aws/aws-sdk-go-v2/aws&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;github.com/aws/aws-sdk-go-v2/config&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="s">&amp;#34;github.com/aws/aws-sdk-go-v2/service/cognitoidentityprovider&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">var&lt;/span> &lt;span class="nx">userPoolId&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;ap-northeast-1_XXXXXXXXX&amp;#34;&lt;/span> &lt;span class="c1">// ユーザープールの ID
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nf">adminSetUserPassword&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">adminSetUserPassword&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">client&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">cognitoidentityprovider&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewFromConfig&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">loadAwsConfig&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">user&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;user1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">pass&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="s">&amp;#34;Password#123&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">input&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">cognitoidentityprovider&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">AdminSetUserPasswordInput&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">UserPoolId&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">userPoolId&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">Username&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">user&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nx">Password&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">pass&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">AdminSetUserPassword&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">TODO&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nx">input&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">		&lt;span class="nb">panic&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">	&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Password changed&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="ユーザー名とパスワードで認証して-id-トークンとアクセストークンを取得する-admininitiateauth">ユーザー名とパスワードで認証して ID トークンとアクセストークンを取得する (AdminInitiateAuth)&lt;/h2>
&lt;p>下記のように &lt;code>AdminInitiateAuth&lt;/code> API でユーザー認証を行うには、Cognito ユーザープールの設定で対象のクライアントを選択し、&lt;strong>&lt;code>ALLOW_ADMIN_USER_PASSWORD_AUTH&lt;/code>&lt;/strong> にチェックを入れておく必要があります。&lt;/p></description></item><item><title>DynamoDB を Python で操作する (boto3)</title><link>https://maku.blog/p/wht5epz/</link><pubDate>Tue, 02 Nov 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/wht5epz/</guid><description>&lt;p>（AWS SDK を使うときは、&lt;a href="https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/cli-configure-quickstart.html">aws configure&lt;/a> によるアクセスキーの設定は完了しているものと想定します）&lt;/p>
&lt;h2 id="boto3-のインストール">Boto3 のインストール&lt;/h2>
&lt;p>Python 用の AWS SDK として &lt;a href="https://aws.amazon.com/jp/sdk-for-python/">Boto3&lt;/a> が用意されているので、これをインストールして使います。
PC のグローバル環境を汚さないように、&lt;a href="https://maku77.github.io/python/env/venv.html">venv による仮想環境を作って作業する&lt;/a> ことをオススメします。&lt;/p>
&lt;p>まず、仮想環境を作ってそこに入ります。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ mkdir myapp &amp;amp;&amp;amp; cd myapp # アプリ用のディレクトリを作成
$ python3 -m venv .venv # 仮想環境の作成
$ source .venv/bin/activate # 仮想環境に入る
&lt;/code>&lt;/pre>&lt;p>仮想環境 (&lt;code>.venv&lt;/code>) 内に &lt;strong>&lt;code>boto3&lt;/code>&lt;/strong> パッケージをインストールします。&lt;/p>
&lt;pre tabindex="0">&lt;code>(.venv) $ python3 -m pip install boto3
&lt;/code>&lt;/pre>&lt;p>これで準備完了です。簡単！&lt;/p>
&lt;h2 id="高レベル-api-と低レベル-api">高レベル API と低レベル API&lt;/h2>
&lt;p>Boto3 の API は、抽象度の高い API と、低い API の二種類が用意されています。&lt;/p>
&lt;dl>
&lt;dt>高レベル API（リソース API）&lt;/dt>
&lt;dd>各 AWS リソースを、オブジェクト指向なコードで扱うことができる。&lt;code>boto3.resource(リソース名)&lt;/code> でインスタンスを取得できる。（参考: &lt;a href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/resources.html">Resources&lt;/a>）&lt;/dd>
&lt;dt>低レベル API（クライアント API）&lt;/dt>
&lt;dd>AWS のサービス API と 1:1 で対応する構成になっており、各種 API の戻り値は単純な dict オブジェクト。&lt;code>boto3.client(リソース名)&lt;/code> でインスタンスを取得できる。（参考: &lt;a href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/clients.html">Low-level clients&lt;/a>、&lt;a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/core/session.html#boto3.session.Session.client">client 関数&lt;/a>）&lt;/dd>
&lt;/dl>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">boto3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 高レベル API を使うとき&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dynamodb&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">boto3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">resource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;dynamodb&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 低レベル API を使うとき&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dynamodb_client&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">boto3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;dynamodb&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>リソース API は、内部でクライアント API を使って実装されています。&lt;/p></description></item><item><title>DynamoDB を Python で操作する (boto3)</title><link>https://maku.blog/p/wht5epz/</link><pubDate>Tue, 02 Nov 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/wht5epz/</guid><description>&lt;p>（AWS SDK を使うときは、&lt;a href="https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/cli-configure-quickstart.html">aws configure&lt;/a> によるアクセスキーの設定は完了しているものと想定します）&lt;/p>
&lt;h2 id="boto3-のインストール">Boto3 のインストール&lt;/h2>
&lt;p>Python 用の AWS SDK として &lt;a href="https://aws.amazon.com/jp/sdk-for-python/">Boto3&lt;/a> が用意されているので、これをインストールして使います。
PC のグローバル環境を汚さないように、&lt;a href="https://maku77.github.io/python/env/venv.html">venv による仮想環境を作って作業する&lt;/a> ことをオススメします。&lt;/p>
&lt;p>まず、仮想環境を作ってそこに入ります。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ mkdir myapp &amp;amp;&amp;amp; cd myapp # アプリ用のディレクトリを作成
$ python3 -m venv .venv # 仮想環境の作成
$ source .venv/bin/activate # 仮想環境に入る
&lt;/code>&lt;/pre>&lt;p>仮想環境 (&lt;code>.venv&lt;/code>) 内に &lt;strong>&lt;code>boto3&lt;/code>&lt;/strong> パッケージをインストールします。&lt;/p>
&lt;pre tabindex="0">&lt;code>(.venv) $ python3 -m pip install boto3
&lt;/code>&lt;/pre>&lt;p>これで準備完了です。簡単！&lt;/p>
&lt;h2 id="高レベル-api-と低レベル-api">高レベル API と低レベル API&lt;/h2>
&lt;p>Boto3 の API は、抽象度の高い API と、低い API の二種類が用意されています。&lt;/p>
&lt;dl>
&lt;dt>高レベル API（リソース API）&lt;/dt>
&lt;dd>各 AWS リソースを、オブジェクト指向なコードで扱うことができる。&lt;code>boto3.resource(リソース名)&lt;/code> でインスタンスを取得できる。（参考: &lt;a href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/resources.html">Resources&lt;/a>）&lt;/dd>
&lt;dt>低レベル API（クライアント API）&lt;/dt>
&lt;dd>AWS のサービス API と 1:1 で対応する構成になっており、各種 API の戻り値は単純な dict オブジェクト。&lt;code>boto3.client(リソース名)&lt;/code> でインスタンスを取得できる。（参考: &lt;a href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/clients.html">Low-level clients&lt;/a>、&lt;a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/core/session.html#boto3.session.Session.client">client 関数&lt;/a>）&lt;/dd>
&lt;/dl>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">boto3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 高レベル API を使うとき&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dynamodb&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">boto3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">resource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;dynamodb&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 低レベル API を使うとき&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dynamodb_client&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">boto3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;dynamodb&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>リソース API は、内部でクライアント API を使って実装されています。&lt;/p></description></item><item><title>AWS SSM のポリシーステートメントの記述例</title><link>https://maku.blog/p/s3o57jv/</link><pubDate>Fri, 15 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/s3o57jv/</guid><description>&lt;p>参考: &lt;a href="../../p/cexcpyc/">AppSync&lt;/a> / &lt;a href="../../p/yn7hqx8/">Lambda&lt;/a>&lt;/p>
&lt;h2 id="パラメーターの説明情報の取得">パラメーターの説明情報の取得&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">すべてのパラメーターの説明情報を取得できるようにする&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ssm:DescribeParameters&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;strong>&lt;code>ssm:DescribeParameters&lt;/code>&lt;/strong> は、SSM パラメーターストアに格納されたパラメーターの説明情報を取得する権限です。
この権限だけでは、パラメーターの「値」自体は取得できないことに注意してください。&lt;/p>
&lt;h2 id="パラメーターの値の取得">パラメーターの値の取得&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">prod- で始まるパラメーターの値を取得できるようにする&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ssm:GetParameter*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;arn:aws:ssm:&amp;lt;Region&amp;gt;:&amp;lt;Account&amp;gt;:parameter/prod-*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>パラメーターの Get 系アクションには、GetParameter/GetParameters/GetParameterHistory/GetParametersByPath など &lt;a href="https://docs.aws.amazon.com/ja_jp/systems-manager/latest/userguide/sysman-paramstore-access.html">いろいろある&lt;/a> ため、上記のように &lt;strong>&lt;code>ssm:GetParameter*&lt;/code>&lt;/strong> とワイルドカード指定しておくと確実に取得できるようになります。
&lt;code>GetParameter&lt;/code> だけだと、パラメーターの一覧取得などが許可されません。&lt;/p>
&lt;h2 id="パラメーターの追加削除">パラメーターの追加・削除&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">prod- で始まるパラメーターの追加と削除を許可する&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ssm:PutParameter&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ssm:DeleteParameter&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ssm:DeleteParameters&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;arn:aws:ssm:&amp;lt;Region&amp;gt;:&amp;lt;Account&amp;gt;:parameter/prod-*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="暗号化されたパラメーター-securestring-の取得">暗号化されたパラメーター (SecureString) の取得&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">暗号化された prod- で始まるパラメーターを読み込む&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ssm:GetParameter*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;arn:aws:ssm:&amp;lt;Region&amp;gt;:&amp;lt;Account&amp;gt;:parameter/prod-*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;kms:Decrypt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;arn:aws:kms:&amp;lt;Region&amp;gt;:&amp;lt;Account&amp;gt;:key/&amp;lt;KmsKey&amp;gt;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>SSM パラメーターストアに SecureString タイプとして格納されたパラメーターは、KMS キーによって暗号化されています。
このパラメーターの値を取得するには、&lt;strong>&lt;code>ssm:GetParameter*&lt;/code>&lt;/strong> によるパラメーター読み取り権限と、&lt;strong>&lt;code>kms:Decrypt&lt;/code>&lt;/strong> による複合化の権限が必要です。&lt;/p></description></item><item><title>AWS KMS をコマンドライン (CLI) で操作する</title><link>https://maku.blog/p/m8jv7hr/</link><pubDate>Thu, 14 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/m8jv7hr/</guid><description>&lt;h2 id="ssm-パラメーターストア用の-aws-マネージドキーを確認する">SSM パラメーターストア用の AWS マネージドキーを確認する&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws kms describe-key --key-id alias/aws/ssm&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;div class="xAccordion">
 &lt;input id="id-354916278" type="checkbox">
 &lt;label class="xAccordion_title" for="id-354916278">実行結果&lt;/label>
 &lt;div class="xAccordion_body">
&lt;figure class="xCodeBlock">
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">KeyMetadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AWSAccountId: &amp;#39;123456789012&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Arn: arn:aws:kms:ap-northeast-1:123456789012:key/d7ce1afa-a7d4-fe43-2da2-4ddd769480d7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CreationDate: &amp;#39;2021-10-14T03:34:31.467000+09:00&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CustomerMasterKeySpec: SYMMETRIC_DEFAULT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Description: Default key that protects my SSM parameters when no other key is defined
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Enabled: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> EncryptionAlgorithms:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - SYMMETRIC_DEFAULT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> KeyId: d7ce1afa-a7d4-fe43-2da2-4ddd769480d7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> KeyManager: AWS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> KeyState: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> KeyUsage: ENCRYPT_DECRYPT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Origin: AWS_KMS&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>
 &lt;/div>
&lt;/div>
&lt;h2 id="kms-キーを作成する-kms-create-key">KMS キーを作成する (kms create-key)&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">aws kms create-key&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>KMS キー (CMK: Customer Master Key) は作成は一瞬でできますが、削除は最低 7 日かかるので注意してください。&lt;/p></description></item><item><title>AWS KMS をコマンドライン (CLI) で操作する</title><link>https://maku.blog/p/m8jv7hr/</link><pubDate>Thu, 14 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/m8jv7hr/</guid><description>&lt;h2 id="ssm-パラメーターストア用の-aws-マネージドキーを確認する">SSM パラメーターストア用の AWS マネージドキーを確認する&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws kms describe-key --key-id alias/aws/ssm&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;div class="xAccordion">
 &lt;input id="id-354916278" type="checkbox">
 &lt;label class="xAccordion_title" for="id-354916278">実行結果&lt;/label>
 &lt;div class="xAccordion_body">
&lt;figure class="xCodeBlock">
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">KeyMetadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AWSAccountId: &amp;#39;123456789012&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Arn: arn:aws:kms:ap-northeast-1:123456789012:key/d7ce1afa-a7d4-fe43-2da2-4ddd769480d7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CreationDate: &amp;#39;2021-10-14T03:34:31.467000+09:00&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CustomerMasterKeySpec: SYMMETRIC_DEFAULT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Description: Default key that protects my SSM parameters when no other key is defined
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Enabled: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> EncryptionAlgorithms:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - SYMMETRIC_DEFAULT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> KeyId: d7ce1afa-a7d4-fe43-2da2-4ddd769480d7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> KeyManager: AWS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> KeyState: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> KeyUsage: ENCRYPT_DECRYPT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Origin: AWS_KMS&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>
 &lt;/div>
&lt;/div>
&lt;h2 id="kms-キーを作成する-kms-create-key">KMS キーを作成する (kms create-key)&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">aws kms create-key&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>KMS キー (CMK: Customer Master Key) は作成は一瞬でできますが、削除は最低 7 日かかるので注意してください。&lt;/p></description></item><item><title>AWS SSM をコマンドライン (CLI) で操作する</title><link>https://maku.blog/p/aug76s5/</link><pubDate>Wed, 13 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/aug76s5/</guid><description>&lt;h2 id="パラメーターストアにパラメーターを格納する-ssm-put-parameter">パラメーターストアにパラメーターを格納する (ssm put-parameter)&lt;/h2>
&lt;h3 id="string文字列">String（文字列）&lt;/h3>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">/myapp/param1 という名前のパラメーターとして value1 を格納&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws ssm put-parameter --name /myapp/param1 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --value &amp;#34;value1&amp;#34; --type String \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --tags &amp;#34;Key=key1,Value=value1&amp;#34;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>既存のパラメーターの値を更新する場合は、&lt;strong>&lt;code>--overwrite&lt;/code>&lt;/strong> オプションが必要です（Version 情報がインクリメントされます）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">/myapp/param1 の値を value2 に書き換え&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws ssm put-parameter --name /myapp/param1 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --value &amp;#34;value2&amp;#34; --type String --overwrite
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tier: Standard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Version: 2&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="securestring暗号化された文字列">SecureString（暗号化された文字列）&lt;/h3>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">デフォルトの AWS マネージドキーを使って暗号化&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws ssm put-parameter --name /myapp/param1 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --value &amp;#34;secret_value&amp;#34; --type SecureString&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>デフォルトのキーは、アカウントで共通のものになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">作成した KMS キーを使って暗号化&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws ssm put-parameter --name /myapp/param1 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --value &amp;#34;secret_value&amp;#34; --type SecureString \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --key-id &amp;#34;&amp;lt;KeyId&amp;gt;&amp;#34; \&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>KeyId&lt;/code> は次のいずれかの形式で指定できます。&lt;/p></description></item><item><title>AWS SSM をコマンドライン (CLI) で操作する</title><link>https://maku.blog/p/aug76s5/</link><pubDate>Wed, 13 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/aug76s5/</guid><description>&lt;h2 id="パラメーターストアにパラメーターを格納する-ssm-put-parameter">パラメーターストアにパラメーターを格納する (ssm put-parameter)&lt;/h2>
&lt;h3 id="string文字列">String（文字列）&lt;/h3>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">/myapp/param1 という名前のパラメーターとして value1 を格納&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws ssm put-parameter --name /myapp/param1 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --value &amp;#34;value1&amp;#34; --type String \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --tags &amp;#34;Key=key1,Value=value1&amp;#34;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>既存のパラメーターの値を更新する場合は、&lt;strong>&lt;code>--overwrite&lt;/code>&lt;/strong> オプションが必要です（Version 情報がインクリメントされます）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">/myapp/param1 の値を value2 に書き換え&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws ssm put-parameter --name /myapp/param1 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --value &amp;#34;value2&amp;#34; --type String --overwrite
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tier: Standard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Version: 2&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="securestring暗号化された文字列">SecureString（暗号化された文字列）&lt;/h3>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">デフォルトの AWS マネージドキーを使って暗号化&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws ssm put-parameter --name /myapp/param1 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --value &amp;#34;secret_value&amp;#34; --type SecureString&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>デフォルトのキーは、アカウントで共通のものになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">作成した KMS キーを使って暗号化&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws ssm put-parameter --name /myapp/param1 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --value &amp;#34;secret_value&amp;#34; --type SecureString \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --key-id &amp;#34;&amp;lt;KeyId&amp;gt;&amp;#34; \&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>KeyId&lt;/code> は次のいずれかの形式で指定できます。&lt;/p></description></item><item><title>AWS CDK で外部パラメーターを扱う（コンテキスト・バリューと環境変数）</title><link>https://maku.blog/p/vx5ta85/</link><pubDate>Mon, 11 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/vx5ta85/</guid><description>&lt;h2 id="cdk-コードに外部パラメーターを与える方法">CDK コードに外部パラメーターを与える方法&lt;/h2>
&lt;p>AWS CDK による CloudFormation スタックの構築時に、外部からキー＆バリューの形でパラメーターを設定したいときは、主に次の 3 つの方法があります（クラウド上に値を保存するパラメーターストアなどは対象外とします）。&lt;/p>
&lt;ol>
&lt;li>&lt;strong>Context values&lt;/strong> （コンテキスト・バリュー）&lt;/li>
&lt;li>&lt;strong>Environment variables&lt;/strong> （環境変数）&lt;/li>
&lt;li>&lt;strong>CloudFormation parameters&lt;/strong> （CloudFormation パラメーター）&lt;/li>
&lt;/ol>
&lt;p>S3 バケットの名前をパラメーター化したり、デプロイターゲットを &lt;code>staging&lt;/code> と &lt;code>production&lt;/code> の間で切り替えたりするときに使えます。&lt;/p>
&lt;h2 id="context-valuesコンテキストバリュー">Context values（コンテキスト・バリュー）&lt;/h2>
&lt;p>コンテキスト・バリューは、CDK 特有の仕組みで、&lt;strong>&lt;code>cdk deploy&lt;/code>&lt;/strong> 実行時のコマンドライン引数や、&lt;strong>&lt;code>cdk.json&lt;/code>&lt;/strong> ファイルの中で、キー＆バリューのペアを設定することができます。
キーの型は &lt;code>string&lt;/code> で、バリューの型は JSON がサポートするデータ型のいずれかです（&lt;code>string&lt;/code>、&lt;code>number&lt;/code>、オブジェクト、およびそれらの配列）。
コンテキスト・バリューは CDK の仕組みなので、CDK コードの中からしか参照できません。
Lambda 関数の中から値を参照したい場合は、Lambda 関数のコンストラクトを生成するときに、&lt;code>environment&lt;/code> props などで間接的に渡す必要があります。&lt;/p>
&lt;h3 id="コマンドライン引数で指定する方法">コマンドライン引数で指定する方法&lt;/h3>
&lt;p>&lt;code>cdk deploy&lt;/code> コマンド（あるいは &lt;code>diff&lt;/code>、&lt;code>synth&lt;/code>）を実行するときに、&lt;strong>&lt;code>--context (-c)&lt;/code>&lt;/strong> オプションで、コンテキスト・バリューを設定できます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ cdk deploy --context key=value&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>複数のキー＆バリューペアを設定したいときは、単純にオプション指定を繰り返します。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ cdk deploy -c key1=value1 -c key2=value2&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>コンテキスト・バリューは CDK アプリ内の全スタックに渡されますが、特定のスタックにのみ反映させることもできます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ cdk deploy -c Stack1:key1=value1 -c Stack2:key2=value2&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="cdkjson-で指定する方法">cdk.json で指定する方法&lt;/h3>
&lt;p>&lt;code>cdk init app&lt;/code> コマンドで CDK アプリを生成すると、&lt;strong>&lt;code>cdk.json&lt;/code>&lt;/strong> というファイルがプロジェクトのルートに配置されます。
このファイルの中の、&lt;strong>&lt;code>context&lt;/code>&lt;/strong> プロパティで、コンテキスト・バリュー用のキー＆バリューを記述しておくことができます。
ホームディレクトリの &lt;code>~/cdk.json&lt;/code> に記述しておくこともできます。&lt;/p></description></item><item><title>AWS CDK で外部パラメーターを扱う（コンテキスト・バリューと環境変数）</title><link>https://maku.blog/p/vx5ta85/</link><pubDate>Mon, 11 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/vx5ta85/</guid><description>&lt;h2 id="cdk-コードに外部パラメーターを与える方法">CDK コードに外部パラメーターを与える方法&lt;/h2>
&lt;p>AWS CDK による CloudFormation スタックの構築時に、外部からキー＆バリューの形でパラメーターを設定したいときは、主に次の 3 つの方法があります（クラウド上に値を保存するパラメーターストアなどは対象外とします）。&lt;/p>
&lt;ol>
&lt;li>&lt;strong>Context values&lt;/strong> （コンテキスト・バリュー）&lt;/li>
&lt;li>&lt;strong>Environment variables&lt;/strong> （環境変数）&lt;/li>
&lt;li>&lt;strong>CloudFormation parameters&lt;/strong> （CloudFormation パラメーター）&lt;/li>
&lt;/ol>
&lt;p>S3 バケットの名前をパラメーター化したり、デプロイターゲットを &lt;code>staging&lt;/code> と &lt;code>production&lt;/code> の間で切り替えたりするときに使えます。&lt;/p>
&lt;h2 id="context-valuesコンテキストバリュー">Context values（コンテキスト・バリュー）&lt;/h2>
&lt;p>コンテキスト・バリューは、CDK 特有の仕組みで、&lt;strong>&lt;code>cdk deploy&lt;/code>&lt;/strong> 実行時のコマンドライン引数や、&lt;strong>&lt;code>cdk.json&lt;/code>&lt;/strong> ファイルの中で、キー＆バリューのペアを設定することができます。
キーの型は &lt;code>string&lt;/code> で、バリューの型は JSON がサポートするデータ型のいずれかです（&lt;code>string&lt;/code>、&lt;code>number&lt;/code>、オブジェクト、およびそれらの配列）。
コンテキスト・バリューは CDK の仕組みなので、CDK コードの中からしか参照できません。
Lambda 関数の中から値を参照したい場合は、Lambda 関数のコンストラクトを生成するときに、&lt;code>environment&lt;/code> props などで間接的に渡す必要があります。&lt;/p>
&lt;h3 id="コマンドライン引数で指定する方法">コマンドライン引数で指定する方法&lt;/h3>
&lt;p>&lt;code>cdk deploy&lt;/code> コマンド（あるいは &lt;code>diff&lt;/code>、&lt;code>synth&lt;/code>）を実行するときに、&lt;strong>&lt;code>--context (-c)&lt;/code>&lt;/strong> オプションで、コンテキスト・バリューを設定できます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ cdk deploy --context key=value&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>複数のキー＆バリューペアを設定したいときは、単純にオプション指定を繰り返します。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ cdk deploy -c key1=value1 -c key2=value2&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>コンテキスト・バリューは CDK アプリ内の全スタックに渡されますが、特定のスタックにのみ反映させることもできます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ cdk deploy -c Stack1:key1=value1 -c Stack2:key2=value2&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="cdkjson-で指定する方法">cdk.json で指定する方法&lt;/h3>
&lt;p>&lt;code>cdk init app&lt;/code> コマンドで CDK アプリを生成すると、&lt;strong>&lt;code>cdk.json&lt;/code>&lt;/strong> というファイルがプロジェクトのルートに配置されます。
このファイルの中の、&lt;strong>&lt;code>context&lt;/code>&lt;/strong> プロパティで、コンテキスト・バリュー用のキー＆バリューを記述しておくことができます。
ホームディレクトリの &lt;code>~/cdk.json&lt;/code> に記述しておくこともできます。&lt;/p></description></item><item><title>AWS CDK メモ: Lambda 関数コードだけ高速デプロイする (cdk deploy --hotswap)</title><link>https://maku.blog/p/ap8p7n4/</link><pubDate>Wed, 06 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/ap8p7n4/</guid><description>&lt;p>AWS CDK によるデプロイ (&lt;code>cdk deploy&lt;/code>) の実行には結構時間がかかりますが、Lambda 関数のコードだけ更新したいときは、&lt;strong>&lt;code>hotswap&lt;/code>&lt;/strong> オプションを付けて実行することで高速にデプロイできます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Lambda 関数だけ高速更新&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ cdk deploy --hotswap&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ただし、これは開発時のみ使うべき機能として提供されており、Production 環境においては、通常通り CDK アプリ全体のデプロイを行うことが推奨されています。&lt;/p></description></item><item><title>AWS CDK メモ: Lambda 関数コードだけ高速デプロイする (cdk deploy --hotswap)</title><link>https://maku.blog/p/ap8p7n4/</link><pubDate>Wed, 06 Oct 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/ap8p7n4/</guid><description>&lt;p>AWS CDK によるデプロイ (&lt;code>cdk deploy&lt;/code>) の実行には結構時間がかかりますが、Lambda 関数のコードだけ更新したいときは、&lt;strong>&lt;code>hotswap&lt;/code>&lt;/strong> オプションを付けて実行することで高速にデプロイできます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Lambda 関数だけ高速更新&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ cdk deploy --hotswap&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ただし、これは開発時のみ使うべき機能として提供されており、Production 環境においては、通常通り CDK アプリ全体のデプロイを行うことが推奨されています。&lt;/p></description></item><item><title>DynamoDB 用のポリシー設定例</title><link>https://maku.blog/p/gk6jx9k/</link><pubDate>Mon, 28 Jun 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/gk6jx9k/</guid><description>&lt;h2 id="あるテーブルに対するすべての操作を可能にする">あるテーブルに対するすべての操作を可能にする&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Sid&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;AllAPIActionsOnBooks&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;dynamodb:*&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;arn:aws:dynamodb:us-west-2:123456789012:table/Books&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>Action&lt;/code> に &lt;code>dynamodb:*&lt;/code> というワイルド―カードを指定することで、DynamoDB のすべての API を使った操作を可能にしています。
通常は、特定のアクションのみを許可すべきです。&lt;/p>
&lt;h2 id="あるテーブルの読み取りを行えるようにする">あるテーブルの読み取りを行えるようにする&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Sid&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;DescribeQueryScanBooksTable&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:DescribeTable&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:Query&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:Scan&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;arn:aws:dynamodb:us-west-2:123456789012:table/Books&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>このポリシーステートメントは、アカウント &lt;code>123456789012&lt;/code> が所有する &lt;code>Books&lt;/code> テーブルの読み取り（Query や Scan）が可能であることを示します。&lt;/p>
&lt;p>下記は、もう少し可能な操作を増やしたバージョンです。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Sid&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;ReadOnlyAPIActionsOnBooks&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:GetItem&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:BatchGetItem&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:DescribeTable&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:Query&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:Scan&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:ConditionCheckItem&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;arn:aws:dynamodb:us-west-2:123456789012:table/Books&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>DynamoDB 用のポリシー設定例</title><link>https://maku.blog/p/gk6jx9k/</link><pubDate>Mon, 28 Jun 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/gk6jx9k/</guid><description>&lt;h2 id="あるテーブルに対するすべての操作を可能にする">あるテーブルに対するすべての操作を可能にする&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Sid&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;AllAPIActionsOnBooks&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;dynamodb:*&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;arn:aws:dynamodb:us-west-2:123456789012:table/Books&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>&lt;code>Action&lt;/code> に &lt;code>dynamodb:*&lt;/code> というワイルド―カードを指定することで、DynamoDB のすべての API を使った操作を可能にしています。
通常は、特定のアクションのみを許可すべきです。&lt;/p>
&lt;h2 id="あるテーブルの読み取りを行えるようにする">あるテーブルの読み取りを行えるようにする&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Sid&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;DescribeQueryScanBooksTable&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:DescribeTable&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:Query&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:Scan&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;arn:aws:dynamodb:us-west-2:123456789012:table/Books&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>このポリシーステートメントは、アカウント &lt;code>123456789012&lt;/code> が所有する &lt;code>Books&lt;/code> テーブルの読み取り（Query や Scan）が可能であることを示します。&lt;/p>
&lt;p>下記は、もう少し可能な操作を増やしたバージョンです。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Sid&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;ReadOnlyAPIActionsOnBooks&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:GetItem&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:BatchGetItem&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:DescribeTable&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:Query&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:Scan&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;dynamodb:ConditionCheckItem&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;arn:aws:dynamodb:us-west-2:123456789012:table/Books&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Amazon S3: 未整理・雑多メモ</title><link>https://maku.blog/p/8cygv9k/</link><pubDate>Wed, 16 Jun 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/8cygv9k/</guid><description>&lt;ul>
&lt;li>S3 のストレージクラスの例
&lt;ul>
&lt;li>汎用ストレージ &amp;hellip; S3 STANDARD&lt;/li>
&lt;li>アクセス頻度小 &amp;hellip; S3 STANDARD_IA&lt;/li>
&lt;li>長期アーカイブ &amp;hellip; S3 Glacier&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>S3 のバケットポリシーでは、プレフィックスとか拡張子などを指定してアクセスコントロールが可能。&lt;/li>
&lt;li>S3 へのアクセスは ACL（アクセスコントロールリスト）でもコントロールできるが、古い仕組みなので非推奨。今は IAM を使う。&lt;/li>
&lt;li>S3 のバージョニング設定を有効にすると、オブジェクトの複数バージョンを管理できるようになる。&lt;/li>
&lt;li>S3 のバケット名は世界で一意になるように命名する。
&lt;ul>
&lt;li>3～63 文字で、大文字は使えない。&lt;/li>
&lt;li>先頭文字は小文字の英数字。
_ 2文字目以降は、小文字の英数字、ハイフン、ドットのいずれかで構成する。ただし、ドットは通常は使わない方がよい（ドメインの区切り文字と混ざるので、HTTPS の証明書検証などに影響が出る）。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>DynamoDB の未整理・雑多メモ</title><link>https://maku.blog/p/38bpqjp/</link><pubDate>Wed, 16 Jun 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/38bpqjp/</guid><description>&lt;ul>
&lt;li>DynamoDB のテーブルは &lt;strong>リージョンごとに独立&lt;/strong> して存在する。例えば、&lt;code>us-east-2&lt;/code> リージョンの People テーブルと、&lt;code>us-west-2&lt;/code> リージョンの People テーブルは別物として扱われる。&lt;/li>
&lt;li>DyanmoDB のテーブル名、&lt;strong>属性名は &lt;code>CamelCase&lt;/code>&lt;/strong> にするのが公式っぽい（&lt;code>-&lt;/code>、&lt;code>_&lt;/code>、&lt;code>.&lt;/code> といった記号も使える）&lt;/li>
&lt;li>プライマリキー
&lt;ul>
&lt;li>DynamoDB の &lt;strong>プライマリキーの型&lt;/strong> は、文字列／数値／バイナリ、といったスカラ値のみが使える。&lt;/li>
&lt;li>DynamoDB のプライマリキーは 1 つ or 2 つ
&lt;ul>
&lt;li>1 つの場合 &amp;hellip; パーティションキーのみ（一意な ID）&lt;/li>
&lt;li>2 つの場合 &amp;hellip; パーティションキー + ソートキー（パーティションが同じであれば、同じ物理ストレージ内にソートキー値でソートされた形で項目が保持される）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>DynamoDB のテーブルは、プライマリキーとなる属性以外はスキーマレスなので、テーブル作成時はプライマリーキー属性のみ定義すればよい。それ以外の部分には入れ子構造のデータも自由に入れられる。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>DynamoDB に項目を追加するときに &lt;strong>バイナリ型属性&lt;/strong> の値を渡すときは、&lt;strong>Base64&lt;/strong> エンコードして渡す必要がある。&lt;/li>
&lt;li>RCU の消費
&lt;ul>
&lt;li>基本的にクエリ (Query) は合計サイズ &lt;strong>4KB ごとに 1RCU&lt;/strong> 消費する。&lt;/li>
&lt;li>GetItem の場合は、&lt;strong>1 件ごとに 1RCU&lt;/strong> 消費する。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>100 件以上とか大量に PutItem するときは、BatchWrite の仕組みを使うとめっちゃ速くなる。複数の要求をバッファリングして通信回数を減らしてくれるぽい。具体的な使い方は、各 SDK の API ドキュメントを参照。&lt;/li>
&lt;/ul></description></item><item><title>DynamoDB の未整理・雑多メモ</title><link>https://maku.blog/p/38bpqjp/</link><pubDate>Wed, 16 Jun 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/38bpqjp/</guid><description>&lt;ul>
&lt;li>DynamoDB のテーブルは &lt;strong>リージョンごとに独立&lt;/strong> して存在する。例えば、&lt;code>us-east-2&lt;/code> リージョンの People テーブルと、&lt;code>us-west-2&lt;/code> リージョンの People テーブルは別物として扱われる。&lt;/li>
&lt;li>DyanmoDB のテーブル名、&lt;strong>属性名は &lt;code>CamelCase&lt;/code>&lt;/strong> にするのが公式っぽい（&lt;code>-&lt;/code>、&lt;code>_&lt;/code>、&lt;code>.&lt;/code> といった記号も使える）&lt;/li>
&lt;li>プライマリキー
&lt;ul>
&lt;li>DynamoDB の &lt;strong>プライマリキーの型&lt;/strong> は、文字列／数値／バイナリ、といったスカラ値のみが使える。&lt;/li>
&lt;li>DynamoDB のプライマリキーは 1 つ or 2 つ
&lt;ul>
&lt;li>1 つの場合 &amp;hellip; パーティションキーのみ（一意な ID）&lt;/li>
&lt;li>2 つの場合 &amp;hellip; パーティションキー + ソートキー（パーティションが同じであれば、同じ物理ストレージ内にソートキー値でソートされた形で項目が保持される）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>DynamoDB のテーブルは、プライマリキーとなる属性以外はスキーマレスなので、テーブル作成時はプライマリーキー属性のみ定義すればよい。それ以外の部分には入れ子構造のデータも自由に入れられる。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>DynamoDB に項目を追加するときに &lt;strong>バイナリ型属性&lt;/strong> の値を渡すときは、&lt;strong>Base64&lt;/strong> エンコードして渡す必要がある。&lt;/li>
&lt;li>RCU の消費
&lt;ul>
&lt;li>基本的にクエリ (Query) は合計サイズ &lt;strong>4KB ごとに 1RCU&lt;/strong> 消費する。&lt;/li>
&lt;li>GetItem の場合は、&lt;strong>1 件ごとに 1RCU&lt;/strong> 消費する。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>100 件以上とか大量に PutItem するときは、BatchWrite の仕組みを使うとめっちゃ速くなる。複数の要求をバッファリングして通信回数を減らしてくれるぽい。具体的な使い方は、各 SDK の API ドキュメントを参照。&lt;/li>
&lt;/ul></description></item><item><title>AWS AppSync のポリシーステートメントの記述例</title><link>https://maku.blog/p/cexcpyc/</link><pubDate>Sun, 06 Jun 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/cexcpyc/</guid><description>&lt;p>参考: &lt;a href="../../p/yn7hqx8/">Lambda&lt;/a> / &lt;a href="../../p/s3o57jv/">SSM&lt;/a>&lt;/p>
&lt;h2 id="特定アカウントからのアクセスのみ許可する">特定アカウントからのアクセスのみ許可する&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">アカウント 123456789012 からのアクセスのみ許可&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Principal&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Service&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;appsync.amazonaws.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;sts:AssumeRole&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Condition&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;StringEquals&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;aws:SourceAccount&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;123456789012&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="特定の-api-へのアクセスのみ許可する">特定の API へのアクセスのみ許可する&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">abcdefg API のみ許可&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Principal&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Service&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;appsync.amazonaws.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;sts:AssumeRole&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Condition&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ArnEquals&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;aws:SourceArn&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;arn:aws:appsync:us-west-2:123456789012:apis/abcdefg&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="特定-のリージョンからのアクセスのみ許可する">特定 のリージョンからのアクセスのみ許可する&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">us-east-1 のみ許可&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Principal&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Service&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;appsync.amazonaws.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;sts:AssumeRole&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Condition&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;ArnEquals&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;aws:SourceArn&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;arn:aws:appsync:us-east-1:123456789012:apis/*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>AWS Lambda のポリシーステートメントの記述例</title><link>https://maku.blog/p/yn7hqx8/</link><pubDate>Sun, 06 Jun 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/yn7hqx8/</guid><description>&lt;p>参考: &lt;a href="../../p/cexcpyc/">AppSync&lt;/a> / &lt;a href="../../p/s3o57jv/">SSM&lt;/a>&lt;/p>
&lt;h2 id="lambda-関数の呼び出しを許可する">Lambda 関数の呼び出しを許可する&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span> &lt;span class="s2">&amp;#34;lambda:invokeFunction&amp;#34;&lt;/span> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;arn:aws:lambda:us-west-2:123456789012:function:my-function&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;arn:aws:lambda:us-west-2:123456789012:function:my-function:*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>AWS CLI でアクセスできるのに AWS SDK で Access Denied (403) になるとき</title><link>https://maku.blog/p/7tds7bw/</link><pubDate>Mon, 26 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/7tds7bw/</guid><description>&lt;h2 id="認証情報の食い違いを調べる">認証情報の食い違いを調べる&lt;/h2>
&lt;p>例えば、ローカルで AWS CLI を使って S3 の情報にアクセスできているのに、AWS SDK 使った Node.js プログラムで S3 にアクセスしたときに Access Denied (403) になるときは、&lt;strong>異なる認証情報 (credentials) を使ってアクセスしている可能性&lt;/strong> があります。&lt;/p>
&lt;p>AWS CLI が、どのようなユーザーでアクセスしているかは、下記のようにして確認できます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws sts get-caller-identity
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Account: &amp;#39;123456789012&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Arn: arn:aws:sts::123456789012:assumed-role/MyDeveloperRole/botocore-session-9876543210
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">UserId: A6B3EVWX58AR9AVTXAP5T:botocore-session-9876543210&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>次に、Node.js のプログラムなどで、AWS SDK を使って上記と同様の情報を取得します。
Node.js 用の SDK ver.2 では、&lt;code>AWS.STS.getCallerIdentity()&lt;/code>、SDK ver.3 では &lt;code>STSClient.send()&lt;/code> を使います。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/STS.html#getCallerIdentity-property">AWS.STS.getCallerIdentity() - AWS SDK v2&lt;/a>&lt;/li>
&lt;li>参考: &lt;a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/clients/client-sts/classes/getcalleridentitycommand.html">GetCallerIdentityCommand() - AWS SDK v3&lt;/a>&lt;/li>
&lt;/ul>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">printCallerIdentity.ts（SDK ver.2 の場合）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">STS&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;aws-sdk&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">async&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">printCallerIdentity() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">sts&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">STS&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">await&lt;/span> &lt;span class="nx">sts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getCallerIdentity&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="nx">promise&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">printCallerIdentity&lt;/span>&lt;span class="p">();&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;div class="xAccordion">
 &lt;input id="id-296543178" type="checkbox">
 &lt;label class="xAccordion_title" for="id-296543178">SDK ver.3 の場合&lt;/label>
 &lt;div class="xAccordion_body">
 

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">STSClient&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">GetCallerIdentityCommand&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">GetCallerIdentityCommandInput&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">GetCallerIdentityCommandOutput&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s2">&amp;#34;@aws-sdk/client-sts&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">async&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">printCallerIdentity() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">client&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">STSClient&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">region&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;ap-northeast-1&amp;#34;&lt;/span> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">input&lt;/span>: &lt;span class="kt">GetCallerIdentityCommandInput&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">command&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">GetCallerIdentityCommand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">input&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">output&lt;/span>: &lt;span class="kt">GetCallerIdentityCommandOutput&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">await&lt;/span> &lt;span class="nx">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">command&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">output&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">printCallerIdentity&lt;/span>&lt;span class="p">();&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


 &lt;/div>
&lt;/div>



&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行結果&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ ts-node printCallerIdentity.ts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ResponseMetadata: { RequestId: &amp;#39;2ce10620-9158-4e5e-8bca-8258bfd02927&amp;#39; },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UserId: &amp;#39;MWUCVBID75KAC5PB68LSP&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Account: &amp;#39;777888999000&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Arn: &amp;#39;arn:aws:iam::777888999000:user/your-user-name&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>上記の結果と &lt;code>aws sts get-caller-identity&lt;/code> の結果を比べると、別のユーザー (credential) でアクセスしていることが分かります。
つまり、AWS SDK 対して、正しく認証情報 (credentails) を設定してやれば問題は解決するはずです。&lt;/p></description></item><item><title>Lambda 実装例: S3 へのアップロードを SNS で通知して Lambda から読み込む</title><link>https://maku.blog/p/f2fq2cn/</link><pubDate>Mon, 19 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/f2fq2cn/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>


&lt;figure class="xImage">
 &lt;img style="" width="" height="auto" src="../../p/f2fq2cn/img-s3-sns-lambda.svg" alt="/p/f2fq2cn/img-s3-sns-lambda.svg" />
&lt;/figure>

&lt;p>ここでは Lambda 関数の実装例として、SNS トピックから S3 バケットの PutObject イベント通知を受けて、アップロードされたファイルを読み込む例を示します。
S3 バケット、および SNS トピックの作成と、S3 → SNS の通知設定は完了していると想定します。&lt;/p>
&lt;aside style="display: flex; border: thin dashed gray;">
&lt;div style="align-self: stretch; writing-mode: vertical-lr; text-align: center; letter-spacing: 0.2em; color: #666; border-right: thin dashed gray; padding: 0.4em 0; line-height: 1.5;">参考&lt;/div>
&lt;div style="align-self: center; padding: 0.6em 0; line-height: 1.2 !important;">&lt;ul>
&lt;li>&lt;a href="../../p/3o2dpyb">CloudFormation の設定例: S3 通知を SNS トピックに Publish する&lt;/a>&lt;/li>
&lt;li>&lt;a href="../../p/5q4epyb">CloudFormation の設定例: SNS トピックを Lambda 関数からサブスクライブする&lt;/a>&lt;/li>
&lt;/ul>
&lt;/div>
&lt;/aside>
&lt;h2 id="lambda-関数の実装">Lambda 関数の実装&lt;/h2>
&lt;h3 id="aws-sdk-のインストール">AWS SDK のインストール&lt;/h3>
&lt;p>ここでは、Node.js 用の AWS SDK ver.2 を使っているので、先にインストールしておく必要があります。
AWS 側の Lambda 実行環境には標準でインストールされているので、&lt;code>--save-dev&lt;/code>（開発用）でインストールしておけば OK です。
ついでに TypeScript 用の型定義もインストールしておくと、Lambda ハンドラのパラメータを &lt;code>any&lt;/code> 型ではなく、&lt;code>SNSEvent&lt;/code> 型などで参照できて便利です。&lt;/p></description></item><item><title>AWS SNS トピックから通知されるイベントデータの例</title><link>https://maku.blog/p/qcpybnx/</link><pubDate>Mon, 19 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/qcpybnx/</guid><description>&lt;p>AWS SNS トピックからメッセージが発行されたときに、サブスクライバー（Lambda 関数など）にどのようなイベントデータが配信されるかの例です。&lt;/p>
&lt;h2 id="基本的なメッセージの構造">基本的なメッセージの構造&lt;/h2>
&lt;h3 id="lambda-関数で受け取る場合">Lambda 関数で受け取る場合&lt;/h3>
&lt;p>SNS トピックに対して Lambda 関数をサブスクライブしておくと、Lambda 関数の第一引数 (event) で、次のようなオブジェクトを受信できます。
重要な情報は、&lt;code>Records[0].Sns&lt;/code> の下に格納されています。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Records&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;EventSource&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;aws:sns&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;EventVersion&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;1.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;EventSubscriptionArn&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;arn:aws:sns:ap-northeast-1:123456789012:mytopic:0884-5d81c0db-4e13-829f-596f7ea9f8ad&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Sns&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Type&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;Notification&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Subject&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;Message Title&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Message&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;Message Body&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="メールで受け取る場合">メールで受け取る場合&lt;/h3>
&lt;p>SNS トピックに「JSON 形式のメール」をサブスクライブしておくと、SNS のメッセージが発行されたときに、次のような内容のメールが届きます。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Type&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;Notification&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Subject&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;Message Title&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Message&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;Message Body&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>Lambda 関数の第一引数で渡される &lt;code>event&lt;/code> オブジェクトで表現すると、&lt;strong>&lt;code>event.Records[0].Sns&lt;/code>&lt;/strong> に相当する部分の情報がメールで送られてきます。&lt;/p>
&lt;h2 id="具体的な-sns-メッセージの例">具体的な SNS メッセージの例&lt;/h2>
&lt;p>下記の例では、&lt;code>Records[0].Sns&lt;/code> 以下の情報のみを示しています（JSON 形式のメールで送られる内容です）。&lt;/p>
&lt;h3 id="sns-のマネージメントコンソールからメッセージ発行したとき">SNS のマネージメントコンソールからメッセージ発行したとき&lt;/h3>
&lt;p>件名に &lt;code>Message Title&lt;/code>、本文に &lt;code>Message Body&lt;/code> を設定してメッセージ発行したときに送られるイベントデータの例です。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Type&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Notification&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;MessageId&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;789b67e7-9bd8-5a6e-99d0-3f10e520edf7&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;TopicArn&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;arn:aws:sns:ap-northeast-1:123456789012:mytopic&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Subject&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Message Title&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Message&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Message Body&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Timestamp&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2021-04-19T12:51:04.019Z&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;SignatureVersion&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Signature&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;bKXAFppLnPMeajvylkQvjiH/9RNeAlNfxbBC7HJbiOt7SKrw9oVk+CI1ZYsADcNt9aAtAOysdHrFD97J/N4n5o+tV+Dz5hsjxqKskYOCrYDRTTqLyhwa5OBtjAhU74IZy9ByfBSQWfOD1I5AFp0FLUWR8ieop/ZTV5buf4FodNm4scwW18nUJ1D5iTPNy3NinWq0wVP2FT7Ykt9HCdNleaFamMZ+war4OHsRhOgvDqOV4auZ2yvayMf70eJPHLbuQn09E0IlQYsvUArTOSknbFK3lsbeLfJBHmIa2qnuZm+VTknNgJxkCJNyer+7EKTrOABYqXsz55ENYJsn5xvjCA==&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;SigningCertURL&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;https://sns.ap-northeast-1.amazonaws.com/SimpleNotificationService-94bdb98bd93083010a507c1833636cda.pem&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;UnsubscribeURL&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;https://sns.ap-northeast-1.amazonaws.com/?Action=Unsubscribe&amp;amp;SubscriptionArn=arn:aws:sns:ap-northeast-1:123456789012:mytopic:97989c34-955f-49c8-856c-1b8e3e926a6f&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="s3-の-putobject-イベントを-sns-から通知したとき">S3 の PutObject イベントを SNS から通知したとき&lt;/h3>
&lt;p>S3 バケットに対して &lt;code>sample.txt&lt;/code> をアップロードしたときの SNS 通知の例です。
&lt;code>Message&lt;/code> プロパティの中に JSON 形式の情報が格納されていて、この中身を見ると、アップロードされたファイルの名前（S3 オブジェクトのキー）などが分かります。&lt;/p></description></item><item><title>AWS CloudFormation の設定例: S3 通知を SNS トピックに Publish する</title><link>https://maku.blog/p/3o2dpyb/</link><pubDate>Tue, 13 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/3o2dpyb/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>ここでは、CloudFormation のテンプレートを使って、次のような AWS リソースを定義してみます。&lt;/p>
&lt;ul>
&lt;li>S3 バケット（Logical ID: &lt;code>MyBucket&lt;/code>)&lt;/li>
&lt;li>SNS トピック (Logical ID: &lt;code>MyTopic&lt;/code>)&lt;/li>
&lt;li>上記の S3 バケットへの書き込み時に、SNS トピックへ publish&lt;/li>
&lt;/ul>
&lt;p>動作のイメージとしてはこんな感じです。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="" height="auto" src="../../p/3o2dpyb/img-s3-to-sns.svg" alt="/p/3o2dpyb/img-s3-to-sns.svg" />
&lt;/figure>

&lt;p>このような構成でリソースを作っておくと、S3 バケット上のデータ更新を、SNS トピックのサブスクライブによって監視できるようになります。
例えば、Lambda 関数を SNS トピックのサブスクライバーとして登録すれば、S3 バケットへの書き込みを Lambda 関数でハンドルできます。&lt;/p>
&lt;h3 id="参考情報">参考情報&lt;/h3>
&lt;p>CloudFormation テンプレートで S3 バケットや SNS トピックを定義する方法は、下記の記事を参考にしてください。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="../../p/ugt6gr4">CloudFormation で S3 バケットの作成&lt;/a>&lt;/li>
&lt;li>&lt;a href="../../p/ymzbmx9">CloudFormation で SNS トピックの作成&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="テンプレートの記述例">テンプレートの記述例&lt;/h2>
&lt;p>次の CloudFormation テンプレートでは、S3 バケットと SNS トピックのリソースを定義しています。
デフォルトの名前はそれぞれ次のようになっています。&lt;/p>
&lt;ul>
&lt;li>S3 バケット名: &lt;code>myapp-sample-bucket-&amp;lt;AccountId&amp;gt;&lt;/code>&lt;/li>
&lt;li>SNS トピック名: &lt;code>myapp-sample-topic&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>S3 バケット名は世界で一意でなければいけないため、末尾に使用中のアカウント ID を付加するようにしています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Parameters&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BucketPrefix&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">String&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Default&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">myapp-sample-bucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">TopicName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">String&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Default&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">myapp-sample-topic&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyTopic&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::SNS::Topic&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">TopicName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Sub ${TopicName}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyTopicPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::SNS::TopicPolicy&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">PolicyDocument&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Id&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Ref MyTopic&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="ld">2012-10-17&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Statement&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Effect&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Allow&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Principal&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Service&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">s3.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Action&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sns:Publish&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Resource&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Ref MyTopic&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Condition&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ArnLike&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">aws:SourceArn&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Sub arn:aws:s3:::${BucketPrefix}-${AWS::AccountId}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Topics&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- !&lt;span class="l">Ref MyTopic&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyBucket&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::S3::Bucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BucketName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Sub ${BucketPrefix}-${AWS::AccountId}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">NotificationConfiguration&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">TopicConfigurations&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Event&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">s3:ObjectCreated:Put&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Topic&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Ref MyTopic&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>このテンプレートを使って CloudFormation スタックを生成するには、例えば AWS CLI を使って次のように実行します。&lt;/p></description></item><item><title>AWS CloudFormation の設定例: S3 通知を SNS トピックに Publish する</title><link>https://maku.blog/p/3o2dpyb/</link><pubDate>Tue, 13 Apr 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/3o2dpyb/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>ここでは、CloudFormation のテンプレートを使って、次のような AWS リソースを定義してみます。&lt;/p>
&lt;ul>
&lt;li>S3 バケット（Logical ID: &lt;code>MyBucket&lt;/code>)&lt;/li>
&lt;li>SNS トピック (Logical ID: &lt;code>MyTopic&lt;/code>)&lt;/li>
&lt;li>上記の S3 バケットへの書き込み時に、SNS トピックへ publish&lt;/li>
&lt;/ul>
&lt;p>動作のイメージとしてはこんな感じです。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="" height="auto" src="../../p/3o2dpyb/img-s3-to-sns.svg" alt="/p/3o2dpyb/img-s3-to-sns.svg" />
&lt;/figure>

&lt;p>このような構成でリソースを作っておくと、S3 バケット上のデータ更新を、SNS トピックのサブスクライブによって監視できるようになります。
例えば、Lambda 関数を SNS トピックのサブスクライバーとして登録すれば、S3 バケットへの書き込みを Lambda 関数でハンドルできます。&lt;/p>
&lt;h3 id="参考情報">参考情報&lt;/h3>
&lt;p>CloudFormation テンプレートで S3 バケットや SNS トピックを定義する方法は、下記の記事を参考にしてください。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="../../p/ugt6gr4">CloudFormation で S3 バケットの作成&lt;/a>&lt;/li>
&lt;li>&lt;a href="../../p/ymzbmx9">CloudFormation で SNS トピックの作成&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="テンプレートの記述例">テンプレートの記述例&lt;/h2>
&lt;p>次の CloudFormation テンプレートでは、S3 バケットと SNS トピックのリソースを定義しています。
デフォルトの名前はそれぞれ次のようになっています。&lt;/p>
&lt;ul>
&lt;li>S3 バケット名: &lt;code>myapp-sample-bucket-&amp;lt;AccountId&amp;gt;&lt;/code>&lt;/li>
&lt;li>SNS トピック名: &lt;code>myapp-sample-topic&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>S3 バケット名は世界で一意でなければいけないため、末尾に使用中のアカウント ID を付加するようにしています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">template.yml&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">AWSTemplateFormatVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2010-09-09&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Parameters&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BucketPrefix&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">String&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Default&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">myapp-sample-bucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">TopicName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">String&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Default&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">myapp-sample-topic&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">Resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyTopic&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::SNS::Topic&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">TopicName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Sub ${TopicName}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyTopicPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::SNS::TopicPolicy&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">PolicyDocument&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Id&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Ref MyTopic&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="ld">2012-10-17&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Statement&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Effect&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Allow&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Principal&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Service&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">s3.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Action&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sns:Publish&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Resource&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Ref MyTopic&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Condition&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ArnLike&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">aws:SourceArn&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Sub arn:aws:s3:::${BucketPrefix}-${AWS::AccountId}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Topics&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- !&lt;span class="l">Ref MyTopic&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MyBucket&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AWS::S3::Bucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Properties&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BucketName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Sub ${BucketPrefix}-${AWS::AccountId}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">NotificationConfiguration&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">TopicConfigurations&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Event&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">s3:ObjectCreated:Put&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Topic&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>!&lt;span class="l">Ref MyTopic&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>このテンプレートを使って CloudFormation スタックを生成するには、例えば AWS CLI を使って次のように実行します。&lt;/p></description></item><item><title>AWS SDK for Node.js でプロキシ環境変数 (https_proxy) を反映させる</title><link>https://maku.blog/p/6vs27aa/</link><pubDate>Mon, 29 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/6vs27aa/</guid><description>&lt;h2 id="aws-sdk-for-nodejs-のプロキシ設定">AWS SDK for Node.js のプロキシ設定&lt;/h2>
&lt;p>社内のプロキシ環境下などから AWS SDK (for Node.js) を使って API 呼び出しを行うには、次のようにプロキシエージェント設定を行います。
ここでは、AWS SDK version 2 の設定例を示しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">プロキシ設定の例 (AWS SDK v2)&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">AWS&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;aws-sdk&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">HttpsProxyAgent&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;https-proxy-agent&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">AWS&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">update&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">httpOptions&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">agent&lt;/span>: &lt;span class="kt">new&lt;/span> &lt;span class="nx">HttpsProxyAgent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;http://proxy.example.com:8080&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これで、それ以降の AWS サービス (&lt;code>AWS.S3&lt;/code> など）の API 呼び出しがプロキシ経由で行われるようになります。&lt;/p>
&lt;h2 id="環境変数-https_proxy-の設定を使用する">環境変数 https_proxy の設定を使用する&lt;/h2>
&lt;p>次のようにすれば、環境変数 &lt;strong>&lt;code>https_proxy&lt;/code>&lt;/strong> に設定されたプロキシアドレスを、AWS SDK にも反映させることができます（といっても、&lt;code>process.env.https_proxy&lt;/code> を参照しているだけです）。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">AWS&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;aws-sdk&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">HttpsProxyAgent&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;https-proxy-agent&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// プロキシ設定を反映
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="nx">setupAwsProxy() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">proxy&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">process&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">env&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">https_proxy&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">proxy&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">AWS&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">update&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">httpOptions&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">agent&lt;/span>: &lt;span class="kt">new&lt;/span> &lt;span class="nx">HttpsProxyAgent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">proxy&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>あとは、AWS の各種サービス用の API を使用するだけです。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">async&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">putObjectToBucket() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setupAwsProxy&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="c1">// 環境変数のプロキシ設定を反映
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">s3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">AWS&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">S3&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">output&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">await&lt;/span> &lt;span class="nx">s3&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">putObject&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Bucket&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;my-s3-bucket-name&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Key&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;key-1&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Body&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;body-1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}).&lt;/span>&lt;span class="nx">promise&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;SUCCESS - Object added:&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">output&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ERROR:&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">putObjectToBucket&lt;/span>&lt;span class="p">();&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>AWS SDK for Node.js でプロキシ環境変数 (https_proxy) を反映させる</title><link>https://maku.blog/p/6vs27aa/</link><pubDate>Mon, 29 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/6vs27aa/</guid><description>&lt;h2 id="aws-sdk-for-nodejs-のプロキシ設定">AWS SDK for Node.js のプロキシ設定&lt;/h2>
&lt;p>社内のプロキシ環境下などから AWS SDK (for Node.js) を使って API 呼び出しを行うには、次のようにプロキシエージェント設定を行います。
ここでは、AWS SDK version 2 の設定例を示しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">プロキシ設定の例 (AWS SDK v2)&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">AWS&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;aws-sdk&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">HttpsProxyAgent&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;https-proxy-agent&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">AWS&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">update&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">httpOptions&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">agent&lt;/span>: &lt;span class="kt">new&lt;/span> &lt;span class="nx">HttpsProxyAgent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;http://proxy.example.com:8080&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これで、それ以降の AWS サービス (&lt;code>AWS.S3&lt;/code> など）の API 呼び出しがプロキシ経由で行われるようになります。&lt;/p>
&lt;h2 id="環境変数-https_proxy-の設定を使用する">環境変数 https_proxy の設定を使用する&lt;/h2>
&lt;p>次のようにすれば、環境変数 &lt;strong>&lt;code>https_proxy&lt;/code>&lt;/strong> に設定されたプロキシアドレスを、AWS SDK にも反映させることができます（といっても、&lt;code>process.env.https_proxy&lt;/code> を参照しているだけです）。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">AWS&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;aws-sdk&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">HttpsProxyAgent&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s1">&amp;#39;https-proxy-agent&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// プロキシ設定を反映
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="nx">setupAwsProxy() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">proxy&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">process&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">env&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">https_proxy&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">proxy&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">AWS&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">update&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">httpOptions&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">agent&lt;/span>: &lt;span class="kt">new&lt;/span> &lt;span class="nx">HttpsProxyAgent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">proxy&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>あとは、AWS の各種サービス用の API を使用するだけです。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">async&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">putObjectToBucket() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setupAwsProxy&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="c1">// 環境変数のプロキシ設定を反映
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">s3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">AWS&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">S3&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">output&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">await&lt;/span> &lt;span class="nx">s3&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">putObject&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Bucket&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;my-s3-bucket-name&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Key&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;key-1&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">Body&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;body-1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}).&lt;/span>&lt;span class="nx">promise&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;SUCCESS - Object added:&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">output&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ERROR:&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">putObjectToBucket&lt;/span>&lt;span class="p">();&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item><item><title>Amazon S3 バケット用のポリシー設定例</title><link>https://maku.blog/p/r9kv6gq/</link><pubDate>Sun, 21 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/r9kv6gq/</guid><description>&lt;h2 id="s3-用のポリシー設定例">S3 用のポリシー設定例&lt;/h2>
&lt;h3 id="指定したバケット内のオブジェクト一覧を取得できるようにする">指定したバケット内のオブジェクト一覧を取得できるようにする&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;s3:ListBucket&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;arn:aws:s3:::&amp;lt;バケット名&amp;gt;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="指定したバケット内のオブジェクトの内容を取得できるようにする">指定したバケット内のオブジェクトの内容を取得できるようにする&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;s3:GetObject&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;arn:aws:s3:::&amp;lt;バケット名&amp;gt;/*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="指定したバケットに対していろいろできるようにする">指定したバケットに対していろいろできるようにする&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;s3:DeleteObject&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;s3:GetObject&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;s3:ListBucket&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;s3:PutObject&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;s3:PutObjectAcl&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;arn:aws:s3:::&amp;lt;バケット名&amp;gt;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;arn:aws:s3:::&amp;lt;バケット名&amp;gt;/*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h3 id="すべての-s3-リソースに対して何でもできるようにする">すべての S3 リソースに対して何でもできるようにする&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;s3:*&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;ul>
&lt;li>S3 で静的 Web サイトをホストするときは、バケットポリシーで &lt;strong>&lt;code>s3:GetObject&lt;/code>&lt;/strong> アクションのみを指定すればよい。&lt;code>ListObject&lt;/code> や &lt;code>PutObject&lt;/code> アクセス許可しなくても OK。&lt;/li>
&lt;/ul>
&lt;h2 id="おまけcors-設定json-形式">（おまけ）CORS 設定（JSON 形式）&lt;/h2>
&lt;p>Web サイトの JavaScript などから S3 バケットにアクセスする場合は、バケットの設定で CORS アクセスを有効にしておく必要があります。
設定は次のように JSON 形式で行います。&lt;/p></description></item><item><title>AWS Lambda にデプロイするための ZIP パッケージを npm で作成する (npm-pack-zip)</title><link>https://maku.blog/p/zmydq3f/</link><pubDate>Sat, 20 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/zmydq3f/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>AWS Lambda で実行する関数は、ZIP ファイルの形でデプロイすることになります。
ここでは、Node.js で関数を実装しているという前提で、&lt;code>npm&lt;/code> スクリプトで簡単にデプロイ用の ZIP パッケージを作成する方法を説明します。&lt;/p>
&lt;p>Lambda 関数用の ZIP パッケージを作成するときは、次のようなことを考慮する必要があります。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>実行時に必要な &lt;code>node_modules&lt;/code> 以下のモジュールを含める&lt;/strong>（逆に &lt;code>devDependencies&lt;/code> で指定したモジュールは含めない。例えば &lt;code>typescript&lt;/code> とか &lt;code>eslint&lt;/code> とかは含めない）&lt;/li>
&lt;li>AWS SDK (&lt;code>aws-sdk&lt;/code>) は含めない（Lambda の実行環境にインストールされている）&lt;/li>
&lt;li>TypeScript を使っているのであれば、ビルド後の &lt;code>.js&lt;/code> ファイルのみを含める（例えば、&lt;code>src/*.ts&lt;/code> は含めず、&lt;code>build/*.js&lt;/code> を含める）&lt;/li>
&lt;/ul>
&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ AWS Lambda レイヤー&lt;/span>
 &lt;span class="xNote_body">&lt;p>Lambda の「レイヤー」という機能を使うと、関数の実行に必要な &lt;code>node_modules&lt;/code> を ZIP パッケージとは別に管理して、Lambda 関数から参照するということができます。
でも設定にひと手間かかります。AWS のこういうところは嫌いです。&lt;/p>
&lt;p>ここでは、レイヤーの機能は使わずに、ZIP パッケージに全部入れちゃう方法を説明しています。&lt;/p>
&lt;/span>
&lt;/div>

&lt;h2 id="npm-pack-zip-で-zip-ファイルを作成する">npm-pack-zip で ZIP ファイルを作成する&lt;/h2>
&lt;h3 id="npm-pack-zip-とは">npm-pack-zip とは&lt;/h3>
&lt;p>ここでは、&lt;strong>&lt;code>npm-pack-zip&lt;/code>&lt;/strong> パッケージを使って、Lambda 関数のデプロイ用 ZIP パッケージを作ってみます。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.npmjs.com/package/npm-pack-zip">npm-pack-zip - npm&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>NPM には、もともと標準で &lt;code>npm pack&lt;/code> というデプロイ用の NPM パッケージを作成する仕組みが搭載されています。
Lambda 用にもこれが使えると楽なのですが、残念ながら &lt;code>npm pack&lt;/code> は &lt;code>.tgz&lt;/code> 形式のパッケージしか作成できません。
&lt;code>npm-pack-zip&lt;/code> をインストールすると、&lt;code>npm pack&lt;/code> の仕組みをそのまま使い、&lt;code>.zip&lt;/code> 形式のパッケージを作成することができます。&lt;/p></description></item><item><title>AWS Lambda をコマンドライン (CLI) で操作する</title><link>https://maku.blog/p/n9nydjc/</link><pubDate>Fri, 12 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/n9nydjc/</guid><description>&lt;h2 id="lambda-関数の一覧を取得する-lambda-list-functions">Lambda 関数の一覧を取得する (lambda list-functions)&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws lambda list-functions --max-items 10&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">関数名だけ取り出す&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws lambda list-functions --max-items 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --query &amp;#34;Functions[].FunctionName&amp;#34;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Node.js 10 を使ってる関数の ARN を調べる&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws lambda list-functions --function-version ALL --output text
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --query &amp;#34;Functions[?Runtime==&amp;#39;nodejs10.x&amp;#39;].FunctionArn&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>AWS から来た「Node.js 10 のサポート切れるから乗り換えてね」というメール (2021-06-04) に書かれていたやり方です。&lt;/p>
&lt;h2 id="lambda-関数の情報を取得する-lambda-get-function">Lambda 関数の情報を取得する (lambda get-function)&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws lambda get-function --function-name my-function&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;div class="xAccordion">
 &lt;input id="id-958317264" type="checkbox">
 &lt;label class="xAccordion_title" for="id-958317264">実行結果&lt;/label>
 &lt;div class="xAccordion_body">
 

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;Configuration&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;FunctionName&amp;#34;: &amp;#34;my-function&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;FunctionArn&amp;#34;: &amp;#34;arn:aws:lambda:ap-northeast-1:123456789012:function:my-function&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;Runtime&amp;#34;: &amp;#34;nodejs12.x&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;Role&amp;#34;: &amp;#34;arn:aws:iam::123456789012:role/lambda-ex&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;CodeSha256&amp;#34;: &amp;#34;FpFMvUhayLkOoVBpNuNiIVML/tuGv2iJQ7t0yWVTU8c=&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;Version&amp;#34;: &amp;#34;$LATEST&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;TracingConfig&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;Mode&amp;#34;: &amp;#34;PassThrough&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;RevisionId&amp;#34;: &amp;#34;88ebe1e1-bfdf-4dc3-84de-3017268fa1ff&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;Code&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;RepositoryType&amp;#34;: &amp;#34;S3&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;Location&amp;#34;: &amp;#34;https://awslambda-ap-northeast-1-tasks.s3.ap-northeast-1.amazonaws.com/snapshots/123456789012/my-function-4203078a-b7c9-4f35-...&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


 &lt;/div>
&lt;/div>


&lt;p>Lambda 関数のデプロイパッケージをダウンロードするために使用できる、Lambda 関数メタデータと署名付き URL が含まれています。&lt;/p></description></item><item><title>AWS Lambda をコマンドライン (CLI) で操作する</title><link>https://maku.blog/p/n9nydjc/</link><pubDate>Fri, 12 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/n9nydjc/</guid><description>&lt;h2 id="lambda-関数の一覧を取得する-lambda-list-functions">Lambda 関数の一覧を取得する (lambda list-functions)&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws lambda list-functions --max-items 10&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">関数名だけ取り出す&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws lambda list-functions --max-items 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --query &amp;#34;Functions[].FunctionName&amp;#34;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Node.js 10 を使ってる関数の ARN を調べる&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws lambda list-functions --function-version ALL --output text
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --query &amp;#34;Functions[?Runtime==&amp;#39;nodejs10.x&amp;#39;].FunctionArn&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>AWS から来た「Node.js 10 のサポート切れるから乗り換えてね」というメール (2021-06-04) に書かれていたやり方です。&lt;/p>
&lt;h2 id="lambda-関数の情報を取得する-lambda-get-function">Lambda 関数の情報を取得する (lambda get-function)&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws lambda get-function --function-name my-function&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;div class="xAccordion">
 &lt;input id="id-958317264" type="checkbox">
 &lt;label class="xAccordion_title" for="id-958317264">実行結果&lt;/label>
 &lt;div class="xAccordion_body">
 

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;Configuration&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;FunctionName&amp;#34;: &amp;#34;my-function&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;FunctionArn&amp;#34;: &amp;#34;arn:aws:lambda:ap-northeast-1:123456789012:function:my-function&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;Runtime&amp;#34;: &amp;#34;nodejs12.x&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;Role&amp;#34;: &amp;#34;arn:aws:iam::123456789012:role/lambda-ex&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;CodeSha256&amp;#34;: &amp;#34;FpFMvUhayLkOoVBpNuNiIVML/tuGv2iJQ7t0yWVTU8c=&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;Version&amp;#34;: &amp;#34;$LATEST&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;TracingConfig&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;Mode&amp;#34;: &amp;#34;PassThrough&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;RevisionId&amp;#34;: &amp;#34;88ebe1e1-bfdf-4dc3-84de-3017268fa1ff&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;Code&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;RepositoryType&amp;#34;: &amp;#34;S3&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;Location&amp;#34;: &amp;#34;https://awslambda-ap-northeast-1-tasks.s3.ap-northeast-1.amazonaws.com/snapshots/123456789012/my-function-4203078a-b7c9-4f35-...&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


 &lt;/div>
&lt;/div>


&lt;p>Lambda 関数のデプロイパッケージをダウンロードするために使用できる、Lambda 関数メタデータと署名付き URL が含まれています。&lt;/p></description></item><item><title>AWS のコスト情報をコマンドライン (CLI) で取得する</title><link>https://maku.blog/p/ct4ckt3/</link><pubDate>Tue, 23 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/ct4ckt3/</guid><description>&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">aws ce get-cost-and-usage ...&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>次の例では、指定した期間の AWS 利用料金を求めています。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">aws ce get-cost-and-usage \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --granularity MONTHLY \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --time-period Start=2021-01-01,End=2021-02-01 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --metrics BlendedCost&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;div class="xAccordion">
 &lt;input id="id-321795486" type="checkbox">
 &lt;label class="xAccordion_title" for="id-321795486">実行結果&lt;/label>
 &lt;div class="xAccordion_body">
 

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">DimensionValueAttributes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">ResultsByTime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Estimated&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Groups&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">TimePeriod&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">End&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2021-02-01&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Start&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2021-01-01&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Total&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BlendedCost&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Amount&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;0.0900932477&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Unit&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">USD&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


 &lt;/div>
&lt;/div>


&lt;p>次の例では、サービスごとに料金表示しています。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">aws ce get-cost-and-usage \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --granularity MONTHLY \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --time-period Start=2021-01-01,End=2021-02-01 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --metrics BlendedCost \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --group-by Type=DIMENSION,Key=SERVICE&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;div class="xAccordion">
 &lt;input id="id-283675914" type="checkbox">
 &lt;label class="xAccordion_title" for="id-283675914">実行結果&lt;/label>
 &lt;div class="xAccordion_body">
 

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">DimensionValueAttributes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">GroupDefinitions&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Key&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">SERVICE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">DIMENSION&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">ResultsByTime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Estimated&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Groups&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Keys&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">AWS CloudShell&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Metrics&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BlendedCost&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Amount&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;0.0000032477&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Unit&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">USD&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Keys&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">AWS CodeCommit&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Metrics&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BlendedCost&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Amount&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Unit&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">USD&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Keys&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">AWS Key Management Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Metrics&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BlendedCost&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Amount&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Unit&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">USD&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Keys&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">AWS Lambda&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Metrics&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BlendedCost&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Amount&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Unit&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">USD&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Keys&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Amazon Simple Notification Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Metrics&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BlendedCost&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Amount&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Unit&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">USD&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Keys&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Amazon Simple Storage Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Metrics&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BlendedCost&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Amount&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;0.00009&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Unit&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">USD&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Keys&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">AmazonCloudWatch&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Metrics&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BlendedCost&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Amount&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Unit&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">USD&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Keys&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">CodeBuild&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Metrics&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BlendedCost&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Amount&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;0.08&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Unit&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">USD&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">Keys&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">Tax&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Metrics&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">BlendedCost&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Amount&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;0.01&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Unit&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">USD&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">TimePeriod&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">End&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2021-02-01&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Start&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2021-01-01&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Total&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


 &lt;/div>
&lt;/div>


&lt;p>サービスごとにコストを一行でシンプルに表示します。&lt;/p></description></item><item><title>DynamoDB Local で DynamoDB のローカルテスト環境を作る</title><link>https://maku.blog/p/rdq4eq2/</link><pubDate>Tue, 23 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/rdq4eq2/</guid><description>&lt;h2 id="dynamodb-local-とは">DynamoDB Local とは&lt;/h2>
&lt;p>DynamoDB Local を使うと、Amazon DynamoDB サービスを模倣するローカルサーバーを立ち上げることができます。
DynamoDB Local サーバーは、デフォルトでは &lt;code>http://localhost:8000&lt;/code> で起動し、ここに対して AWS CLI や AWS SDK で接続して操作します。&lt;/p>
&lt;p>DynamoDB ウェブサービスで複雑なデータ処理を行うときは、あらかじめ DynamoDB Local を使ってテストを行っておくと安心です。
DynamoDB の操作のために試行錯誤しても AWS の利用料金がかかることはありません。&lt;/p>
&lt;h2 id="dynamodb-local-のインストール">DynamoDB Local のインストール&lt;/h2>
&lt;h3 id="実行ファイルのダウンロード">実行ファイルのダウンロード&lt;/h3>
&lt;p>DynamoDB Local には、Java の実行ファイル (JAR) や、それを含む Docker コンテナとして提供されています。
Java のインストールされた環境では、JAR ファイルをダウンロードして起動するのが手っ取り早いです。
下記から ZIP ファイルでダウンロードできます。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/DynamoDBLocal.DownloadingAndRunning.html">DynamoDB Local のダウンロード&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>ダウンロードした ZIP ファイルを展開すると、次のような構成のディレクトリが展開されます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">アーカイブの内容&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">dynamodb_local_latest/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- DynamoDBLocal_lib/ ... 本体が使う依存ライブラリ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- DynamoDBLocal.jar ... 本体
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- その他のドキュメント&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>起動に必要なのは、&lt;code>DynamoDBLocal_lib&lt;/code> ディレクトリと &lt;code>DynamoDBLocal.jar&lt;/code> だけなので、この 2 つを任意のディレクトリにコピーします。
ここでは、次のようなディレクトリにコピーすることにします（Windows であれば、&lt;code>$HOME&lt;/code> は &lt;code>%USERPROFILE%&lt;/code> に置き換えてください）。&lt;/p></description></item><item><title>DynamoDB Local で DynamoDB のローカルテスト環境を作る</title><link>https://maku.blog/p/rdq4eq2/</link><pubDate>Tue, 23 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/rdq4eq2/</guid><description>&lt;h2 id="dynamodb-local-とは">DynamoDB Local とは&lt;/h2>
&lt;p>DynamoDB Local を使うと、Amazon DynamoDB サービスを模倣するローカルサーバーを立ち上げることができます。
DynamoDB Local サーバーは、デフォルトでは &lt;code>http://localhost:8000&lt;/code> で起動し、ここに対して AWS CLI や AWS SDK で接続して操作します。&lt;/p>
&lt;p>DynamoDB ウェブサービスで複雑なデータ処理を行うときは、あらかじめ DynamoDB Local を使ってテストを行っておくと安心です。
DynamoDB の操作のために試行錯誤しても AWS の利用料金がかかることはありません。&lt;/p>
&lt;h2 id="dynamodb-local-のインストール">DynamoDB Local のインストール&lt;/h2>
&lt;h3 id="実行ファイルのダウンロード">実行ファイルのダウンロード&lt;/h3>
&lt;p>DynamoDB Local には、Java の実行ファイル (JAR) や、それを含む Docker コンテナとして提供されています。
Java のインストールされた環境では、JAR ファイルをダウンロードして起動するのが手っ取り早いです。
下記から ZIP ファイルでダウンロードできます。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/DynamoDBLocal.DownloadingAndRunning.html">DynamoDB Local のダウンロード&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>ダウンロードした ZIP ファイルを展開すると、次のような構成のディレクトリが展開されます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">アーカイブの内容&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">dynamodb_local_latest/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- DynamoDBLocal_lib/ ... 本体が使う依存ライブラリ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- DynamoDBLocal.jar ... 本体
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-- その他のドキュメント&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>起動に必要なのは、&lt;code>DynamoDBLocal_lib&lt;/code> ディレクトリと &lt;code>DynamoDBLocal.jar&lt;/code> だけなので、この 2 つを任意のディレクトリにコピーします。
ここでは、次のようなディレクトリにコピーすることにします（Windows であれば、&lt;code>$HOME&lt;/code> は &lt;code>%USERPROFILE%&lt;/code> に置き換えてください）。&lt;/p></description></item><item><title>Amazon EC2 をコマンドライン (CLI) で操作する</title><link>https://maku.blog/p/zkx9ju6/</link><pubDate>Mon, 22 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/zkx9ju6/</guid><description>&lt;h2 id="ec2-で使用可能なリージョンの一覧を取得する-ec2-describe-regions">EC2 で使用可能なリージョンの一覧を取得する (ec2 describe-regions)&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws ec2 describe-regions&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;div class="xAccordion">
 &lt;input id="id-369481257" type="checkbox">
 &lt;label class="xAccordion_title" for="id-369481257">実行結果 (YAML形式）&lt;/label>
 &lt;div class="xAccordion_body">
 

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">Regions&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.eu-north-1.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eu-north-1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.ap-south-1.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ap-south-1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.eu-west-3.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eu-west-3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.eu-west-2.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eu-west-2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.eu-west-1.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eu-west-1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.ap-northeast-3.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ap-northeast-3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.ap-northeast-2.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ap-northeast-2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.ap-northeast-1.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ap-northeast-1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.sa-east-1.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sa-east-1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.ca-central-1.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ca-central-1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.ap-southeast-1.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ap-southeast-1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.ap-southeast-2.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ap-southeast-2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.eu-central-1.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eu-central-1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.us-east-1.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">us-east-1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.us-east-2.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">us-east-2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.us-west-1.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">us-west-1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">Endpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ec2.us-west-2.amazonaws.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">OptInStatus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">opt-in-not-required&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">RegionName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">us-west-2&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


 &lt;/div>
&lt;/div>


&lt;h2 id="ec2-インスタンスの情報を取得する-ec2-describe-instances">EC2 インスタンスの情報を取得する (ec2 describe-instances)&lt;/h2>
&lt;p>作成済みの EC2 インスタンスの一覧、あるいは指定した EC2 インスタンスの情報を取得します。&lt;/p></description></item><item><title>AWS CodeBuild をコマンドライン (CLI) から操作する</title><link>https://maku.blog/p/bwamw8i/</link><pubDate>Mon, 22 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/bwamw8i/</guid><description>&lt;h2 id="codebuild-プロジェクトの一覧を取得する-codebuild-list-projects">CodeBuild プロジェクトの一覧を取得する (codebuild list-projects)&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws codebuild list-projects&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: すべてのプロジェクト名を取得&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws codebuild list-projects
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">projects:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- app1-codebuild
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- app2-codebuild
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- app3-codebuild&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>出力結果をソートするには、次のオプションが使用できます。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>&lt;code>sort-by&lt;/code>&lt;/strong> &amp;hellip; &lt;code>NAME&lt;/code> / &lt;code>CREATED_TIME&lt;/code> / &lt;code>LAST_MODIFIED_TIME&lt;/code> のいずれかを指定&lt;/li>
&lt;li>&lt;strong>&lt;code>sort-order&lt;/code>&lt;/strong> .. &lt;code>ASCENDING&lt;/code> / &lt;code>DESCENDING&lt;/code> のいずれかを指定&lt;/li>
&lt;/ul>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">例: 最近作られたプロジェクトを 5 件表示&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws codebuild list-projects --sort-by CREATED_TIME --sort-order DESCENDING --max-items 5&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;div class="xAccordion">
 &lt;input id="id-495237618" type="checkbox">
 &lt;label class="xAccordion_title" for="id-495237618">実行結果&lt;/label>
 &lt;div class="xAccordion_body">
&lt;figure class="xCodeBlock">
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">NextToken: eyJuZXh0VG9rZW4iOiBudWxsLCAiYm90b190cnVuY2F0ZV9hbW91bnQiOiA1fQ==
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">projects:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- myapp25-codebuild
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- myapp24-codebuild
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- myapp23-codebuild
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- myapp22-codebuild
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- myapp21-codebuild&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>
&lt;p>&lt;code>NextToken&lt;/code> は、続きのエントリを取得したいときに、&lt;code>--starting-token&lt;/code> オプションで指定します。&lt;/p>
 &lt;/div>
&lt;/div>
&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ 出力形式 (YAML or JSON) を変えたいとき&lt;/span>
 &lt;span class="xNote_body">&lt;p>AWS CLI の出力形式は、デフォルトでは &lt;code>~/.aws/config&lt;/code> ファイルの &lt;code>output&lt;/code> プロパティで指定されている出力形式が使用されます。
明示的に出力形式を指定したい場合は、各コマンド実行時に &lt;code>--output yaml&lt;/code> や &lt;code>--output json&lt;/code> のようなオプション指定を行います。&lt;/p></description></item><item><title>DynamoDB をコマンドライン (CLI) で操作する</title><link>https://maku.blog/p/zkzamw8/</link><pubDate>Mon, 22 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/zkzamw8/</guid><description>&lt;h2 id="テーブルを作成する-dynamodb-create-table">テーブルを作成する (dynamodb create-table)&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">aws dynamodb create-table --table-name &amp;lt;テーブル名&amp;gt; ...&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>DynamoDB のテーブルを作成するときは、少なくともプライマリキーの設定や、課金モードの設定が必要になるので、少しだけコマンドが長くなります。&lt;/p>
&lt;p>次の例では、DynamoDB に MusicCollection というテーブルを作成します。
&lt;code>Artist&lt;/code> というパーティションキー (&lt;code>KeyType=HASH&lt;/code>) と、&lt;code>Artist&lt;/code> というソートキー (&lt;code>KeyType=RANGE&lt;/code>) を定義しています。
課金体系は「プロビジョンドモード」で最小構成になるよう設定しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">テーブル生成 (PartitionKey &amp;#43; SortKey)&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws dynamodb create-table \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --table-name MusicCollection \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --attribute-definitions AttributeName=Artist,AttributeType=S AttributeName=SongTitle,AttributeType=S \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --key-schema AttributeName=Artist,KeyType=HASH AttributeName=SongTitle,KeyType=RANGE \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --provisioned-throughput ReadCapacityUnits=1,WriteCapacityUnits=1&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>パーティションキーのみで良い場合（ソートキーなし）は、次のような感じになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">テーブル生成 (PartitionKey)&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws dynamodb create-table \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --table-name MusicCollection \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --attribute-definitions AttributeName=Artist,AttributeType=S \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --key-schema AttributeName=Artist,KeyType=HASH \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --provisioned-throughput ReadCapacityUnits=1,WriteCapacityUnits=1&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>キャパシティモード（課金体系）をオンデマンド（本当にアクセスした分だけの支払い）にするには、&lt;strong>&lt;code>--billing-mode PAY_PER_REQUEST&lt;/code>&lt;/strong> オプションを指定し、プロビジョン設定 (&lt;code>--provisioned-throughput&lt;/code>) を省略します。
一定間隔でそれなりにアクセスがある場合は、プロビジョンドモード (&lt;code>PROVISIONED&lt;/code>) にして常時稼働の形にしておいた方が総合的に安くなるようですが、テスト用途で作成する場合などは &lt;code>PAY_PER_REQUEST&lt;/code> にしておくのが無難かと思います。&lt;/p></description></item><item><title>DynamoDB をコマンドライン (CLI) で操作する</title><link>https://maku.blog/p/zkzamw8/</link><pubDate>Mon, 22 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/zkzamw8/</guid><description>&lt;h2 id="テーブルを作成する-dynamodb-create-table">テーブルを作成する (dynamodb create-table)&lt;/h2>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">aws dynamodb create-table --table-name &amp;lt;テーブル名&amp;gt; ...&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>DynamoDB のテーブルを作成するときは、少なくともプライマリキーの設定や、課金モードの設定が必要になるので、少しだけコマンドが長くなります。&lt;/p>
&lt;p>次の例では、DynamoDB に MusicCollection というテーブルを作成します。
&lt;code>Artist&lt;/code> というパーティションキー (&lt;code>KeyType=HASH&lt;/code>) と、&lt;code>Artist&lt;/code> というソートキー (&lt;code>KeyType=RANGE&lt;/code>) を定義しています。
課金体系は「プロビジョンドモード」で最小構成になるよう設定しています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">テーブル生成 (PartitionKey &amp;#43; SortKey)&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws dynamodb create-table \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --table-name MusicCollection \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --attribute-definitions AttributeName=Artist,AttributeType=S AttributeName=SongTitle,AttributeType=S \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --key-schema AttributeName=Artist,KeyType=HASH AttributeName=SongTitle,KeyType=RANGE \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --provisioned-throughput ReadCapacityUnits=1,WriteCapacityUnits=1&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>パーティションキーのみで良い場合（ソートキーなし）は、次のような感じになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">テーブル生成 (PartitionKey)&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ aws dynamodb create-table \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --table-name MusicCollection \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --attribute-definitions AttributeName=Artist,AttributeType=S \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --key-schema AttributeName=Artist,KeyType=HASH \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --provisioned-throughput ReadCapacityUnits=1,WriteCapacityUnits=1&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>キャパシティモード（課金体系）をオンデマンド（本当にアクセスした分だけの支払い）にするには、&lt;strong>&lt;code>--billing-mode PAY_PER_REQUEST&lt;/code>&lt;/strong> オプションを指定し、プロビジョン設定 (&lt;code>--provisioned-throughput&lt;/code>) を省略します。
一定間隔でそれなりにアクセスがある場合は、プロビジョンドモード (&lt;code>PROVISIONED&lt;/code>) にして常時稼働の形にしておいた方が総合的に安くなるようですが、テスト用途で作成する場合などは &lt;code>PAY_PER_REQUEST&lt;/code> にしておくのが無難かと思います。&lt;/p></description></item><item><title>AWS IAM の設定をコマンドライン (CLI) で行う</title><link>https://maku.blog/p/aov4bho/</link><pubDate>Sun, 07 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/aov4bho/</guid><description>&lt;p>AWS CLI（&lt;code>aws&lt;/code> コマンド）を使うと、様々な IAM 系の操作をコマンドラインから実行できるようになります。
ただし、IAM の制御を行えるのは、&lt;code>AdministratorAccess&lt;/code> ポリシーなどが割り当てられ、IAM 操作の権限が付いているユーザーに限られます。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/index.html">iam -- AWS CLI Command Reference&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="user">ユーザー関連&lt;/h2>
&lt;h3 id="iam-ユーザーを作成する-iam-create-user">IAM ユーザーを作成する (iam create-user)&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">aws iam create-user --user-name &amp;lt;ユーザー名&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;div class="xAccordion">
 &lt;input id="id-685942317" type="checkbox">
 &lt;label class="xAccordion_title" for="id-685942317">実行例&lt;/label>
 &lt;div class="xAccordion_body">
 

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="l">$ aws iam create-user --user-name user-1 --output yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">User&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Arn&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">arn:aws:iam::049957049344:user/user-1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CreateDate&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2021-11-01T08:41:29+00:00&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">UserId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AIDAQXINMCQAPJRMFE22H&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">UserName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">user-1&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


 &lt;/div>
&lt;/div>


&lt;p>&lt;a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/create-user.html">iam create-user&lt;/a> コマンドを使うと、指定した名前の IAM ユーザーを作成できます。
作成したユーザーの情報は、&lt;a href="#get-user">iam get-user&lt;/a> や &lt;a href="#list-users">iam list-users&lt;/a> コマンドで取得できます。
作成したユーザー用の API アクセスキーを生成するには、ひきつづき &lt;a href="#create-access-key">iam create-access-key&lt;/a> コマンドを使用します。&lt;/p>
&lt;h3 id="iam-ユーザーを削除する-iam-delete-user">IAM ユーザーを削除する (iam delete-user)&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">aws iam delete-user --user-name &amp;lt;ユーザー名&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>指定したユーザーに何らかの設定情報（アクセスキーや SSH キー、MFA など）が設定されている場合は、先にそれらの情報を削除しておく必要があります。
例えば、アクセスキーが設定されている場合は、&lt;a href="#delete-access-key">delete-access-key&lt;/a> コマンドで削除してからユーザー自体を削除します。&lt;/p></description></item><item><title>AWS IAM の設定をコマンドライン (CLI) で行う</title><link>https://maku.blog/p/aov4bho/</link><pubDate>Sun, 07 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/aov4bho/</guid><description>&lt;p>AWS CLI（&lt;code>aws&lt;/code> コマンド）を使うと、様々な IAM 系の操作をコマンドラインから実行できるようになります。
ただし、IAM の制御を行えるのは、&lt;code>AdministratorAccess&lt;/code> ポリシーなどが割り当てられ、IAM 操作の権限が付いているユーザーに限られます。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/index.html">iam -- AWS CLI Command Reference&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="user">ユーザー関連&lt;/h2>
&lt;h3 id="iam-ユーザーを作成する-iam-create-user">IAM ユーザーを作成する (iam create-user)&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">aws iam create-user --user-name &amp;lt;ユーザー名&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;div class="xAccordion">
 &lt;input id="id-685942317" type="checkbox">
 &lt;label class="xAccordion_title" for="id-685942317">実行例&lt;/label>
 &lt;div class="xAccordion_body">
 

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="l">$ aws iam create-user --user-name user-1 --output yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">User&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Arn&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">arn:aws:iam::049957049344:user/user-1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">CreateDate&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2021-11-01T08:41:29+00:00&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">Path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">UserId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AIDAQXINMCQAPJRMFE22H&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">UserName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">user-1&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


 &lt;/div>
&lt;/div>


&lt;p>&lt;a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/create-user.html">iam create-user&lt;/a> コマンドを使うと、指定した名前の IAM ユーザーを作成できます。
作成したユーザーの情報は、&lt;a href="#get-user">iam get-user&lt;/a> や &lt;a href="#list-users">iam list-users&lt;/a> コマンドで取得できます。
作成したユーザー用の API アクセスキーを生成するには、ひきつづき &lt;a href="#create-access-key">iam create-access-key&lt;/a> コマンドを使用します。&lt;/p>
&lt;h3 id="iam-ユーザーを削除する-iam-delete-user">IAM ユーザーを削除する (iam delete-user)&lt;/h3>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">aws iam delete-user --user-name &amp;lt;ユーザー名&amp;gt;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>指定したユーザーに何らかの設定情報（アクセスキーや SSH キー、MFA など）が設定されている場合は、先にそれらの情報を削除しておく必要があります。
例えば、アクセスキーが設定されている場合は、&lt;a href="#delete-access-key">delete-access-key&lt;/a> コマンドで削除してからユーザー自体を削除します。&lt;/p></description></item><item><title>AWS アカウント、IAM ユーザー、グループ、ポリシーの違い</title><link>https://maku.blog/p/4c7sdwg/</link><pubDate>Wed, 03 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/4c7sdwg/</guid><description>&lt;p>AWS を使う上で最初に理解しておくべき、「アカウント」と「ユーザー」まわりの概念についてまとめておきます。&lt;/p>
&lt;ul>
&lt;li>簡単なイメージとしてはこんな感じ。
&lt;ul>
&lt;li>AWS アカウント &amp;hellip; 組織およびルートユーザーのこと。通称アカウント。&lt;/li>
&lt;li>IAM ユーザー &amp;hellip; 組織内の個別ユーザー。通称ユーザー。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>ちなみに、IAM は Identity and Access Management の略。&lt;/p>
&lt;h2 id="aws-アカウントのルートユーザー">AWS アカウント（のルートユーザー）&lt;/h2>
&lt;ul>
&lt;li>AWS サインアップ時に作られる、組織で 1 つだけ用意されるルートユーザーです。&lt;/li>
&lt;li>AWS アカウントの ID は管理者のメールアドレスです。&lt;/li>
&lt;li>AWS アカウントは、契約／支払い設定などを含むフルアクセス権限があるので、通常の業務ではこのアカウントは使わず、IAM ユーザーを使います。&lt;/li>
&lt;/ul>
&lt;h2 id="iam-ユーザー">IAM ユーザー&lt;/h2>
&lt;ul>
&lt;li>AWS アカウントから作成されるユーザーで、通常の業務ではこの IAM ユーザーを使います。Linux の一般ユーザーのようなものです。&lt;/li>
&lt;li>1 つの AWS アカウントから複数の IAM ユーザーを作成することができます。&lt;/li>
&lt;li>IAM ユーザーに IAM ポリシーを割り当てることで、各種リソースへのアクセスが許可されます。IAM ユーザー作成直後は、何もアクセス権限がありません。ちなみに、IAM ポリシーは JSON 形式で記述されます。&lt;/li>
&lt;/ul>
&lt;h2 id="iam-グループ">IAM グループ&lt;/h2>
&lt;ul>
&lt;li>複数の IAM ユーザーをグルーピングするためのものです。&lt;/li>
&lt;li>IAM グループに対しても IAM ポリシーを割り当てることができ、複数の IAM ユーザーにまとめて権限設定することができます。&lt;/li>
&lt;/ul>
&lt;h2 id="iam-ロール">IAM ロール&lt;/h2>
&lt;ul>
&lt;li>特定の AWS サービス、IAM ユーザー、IAM グループに一時的に権限を与えるために使われます。例えば、EC2 インスタンスへのアクセス権割り当てなどに使われます。&lt;/li>
&lt;li>IAM ロールがどのような権限を表現するかは、IAM ロール自体に IAM ポリシーを割り当てることで制御します。&lt;/li>
&lt;li>協力会社のメンバーに自社リソースの権限を与えたいときに、協力会社側で使っている IAM ユーザーに対して、自社で作成した IAM ロールを割り当てる、という使い方ができます。→ 参考: &lt;a href="https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/id_roles_create_for-user.html">IAM ユーザーにアクセス権限を委任するロールの作成&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>AWS CodeBuild で Hello World（GitHub との連携）</title><link>https://maku.blog/p/xdnu3ah/</link><pubDate>Tue, 26 Jan 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/xdnu3ah/</guid><description>&lt;h2 id="何をやるか">何をやるか？&lt;/h2>
&lt;p>CodeBuild は AWS が提供するビルドサービスです。
例えば、GitHub に &lt;code>buildspec.yml&lt;/code> というビルド方法を記述したファイルを置いておくと、GitHub へのコードプッシュ時に、その設定通りビルドを行ってくれます。
GitHub Actions や Azure Pipelines といったサービスと同様です。&lt;/p>
&lt;p>ここでは、CodeBuild 導入の第一歩として、次のような構成でセットアップしてみます。&lt;/p>
&lt;ul>
&lt;li>&lt;b>ソースプロバイダ&lt;/b>
: GitHub（の適当なテストリポジトリ）&lt;/li>
&lt;li>&lt;b>ビルド内容&lt;/b>
: "Hello World" と echo 表示する&lt;/li>
&lt;/ul>
&lt;p>つまり、テスト用の GitHub リポジトリに何らかのファイルをプッシュしたときに、CodeBuild によるビルドを開始するところまでです。&lt;/p>
&lt;p>ソースプロバイダとしては、GitHub だけではなく、AWS CodeCommit、Bitbucket、GitHub Enterpise といった Git リポジトリを選択できますが、おそらく GitHub が一番よく使われているので、ここでは GitHub を使うことにします。&lt;/p>
&lt;p>最初の一歩はできるだけ簡単に済ませることが肝心です！&lt;/p>
&lt;h2 id="アカウントとリポジトリを準備する">アカウントとリポジトリを準備する&lt;/h2>
&lt;p>まず最低限の準備として、下記のアカウントは用意できているとします。&lt;/p>
&lt;ul>
&lt;li>AWS アカウント&lt;/li>
&lt;li>GitHub アカウント&lt;/li>
&lt;/ul>
&lt;p>次に、GitHub にテスト用の &lt;a href="https://github.com/new">リポジトリを作成&lt;/a> しておきます。
ここでは、リポジトリ名は &lt;code>hello-codebuild&lt;/code> とでもしておきます。
&lt;code>README.md&lt;/code> を自動生成しておくと、後のテストが楽です。&lt;/p>
&lt;h2 id="codebuild-にビルドプロジェクトを作成する">CodeBuild にビルドプロジェクトを作成する&lt;/h2>
&lt;p>次のようにして、CodeBuild に新規ビルドプロジェクトを作成します。&lt;/p>
&lt;ol>
&lt;li>&lt;a href="https://console.aws.amazon.com/codesuite/home">AWS CodeBuild console&lt;/a> を開きます。&lt;/li>
&lt;li>&lt;code>ビルド (CodeBuild)&lt;/code> → &lt;code>ビルドプロジェクト&lt;/code> → &lt;code>ビルドプロジェクトを作成する&lt;/code> と選択します。&lt;/li>
&lt;li>以下のような内容を入力してビルドプロジェクトを作成します。
&lt;ul>
&lt;li>&lt;b>プロジェクト名&lt;/b>
: &lt;code>build-hello&lt;/code>（名前は自由）&lt;/li>
&lt;li>&lt;b>ソースプロバイダ&lt;/b>
: &lt;code>GitHub&lt;/code> → 作成しておいた &lt;code>hello-codebuild&lt;/code> リポジトリを指定&lt;/li>
&lt;li>&lt;b>ウェブフック&lt;/b>
: &lt;code>コードの変更がこのレポジトリにプッシュされるたびに再構築する&lt;/code> にチェックを入れる（これで GitHub へのプッシュ時にビルドトリガがかかります）&lt;/li>
&lt;li>&lt;b>環境イメージ&lt;/b>
: &lt;code>マネージド型イメージ&lt;/code> → &lt;code>Amazon Linux 2&lt;/code> → ランタイムやイメージは適当に選択&lt;/li>
&lt;li>&lt;b>サービスロール&lt;/b>
: &lt;code>新しいサービスロール&lt;/code> → &lt;code>codebuild-build-hello-service-role&lt;/code>（デフォルト）&lt;/li>
&lt;li>&lt;b>ビルド仕様&lt;/b>
: &lt;code>buildspec ファイルを使用する&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>以下のような感じでビルドプロジェクトが作成されれば成功です。&lt;/p></description></item><item><title>AWS のサービス一覧（2021年版）</title><link>https://maku.blog/p/t8fmsz5/</link><pubDate>Mon, 25 Jan 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/t8fmsz5/</guid><description>&lt;p>AWS のサービスを概要説明付きでリスト化したものが欲しくて作っちゃったので置いておきます。
&lt;a href="../../p/t8fmsz5/aws-services.pdf">PDF 化したもの&lt;/a> も置いておきます。&lt;/p>
&lt;style>
.local-aws td {
 padding: 0 0 0.2em 0.2em;
 background: #fafafa;
}
.local-aws th {
 padding-top: 1.5em;
 border: none;
 background: white;
 text-align: left;
}
.local-aws img {
 max-width: 1.5em;
}
&lt;/style>
&lt;table class="local-aws">
 &lt;tbody>
 &lt;tr>&lt;th colspan="2">分析 (Analytics)&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Athena_16.svg" />
Amazon Athena&lt;/td>
 &lt;td>SQL を使用した S3 でのデータクエリ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-CloudSearch_16.svg" />
Amazon CloudSearch&lt;/td>
 &lt;td>マネージド型検索サービス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Elasticsearch-Service_16.svg" />
Amazon Elasticsearch Service&lt;/td>
 &lt;td>Elasticsearch クラスターを実行し、スケールする&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-EMR_16.svg" />
Amazon EMR&lt;/td>
 &lt;td>ホスト型 Hadoop フレームワーク&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Kinesis_16.svg" />
Amazon Kinesis&lt;/td>
 &lt;td>リアルタイムストリーミングデータとの連携&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Managed-Streaming-for-Kafka_16.svg" />
Amazon Managed Streaming for Apache Kafka&lt;/td>
 &lt;td>フルマネージド型 Apache Kafka サービス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Redshift_16.svg" />
Amazon Redshift&lt;/td>
 &lt;td>高速かつシンプルで、費用対効果の高いデータウェアハウス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-QuickSight_16.svg" />
Amazon QuickSight&lt;/td>
 &lt;td>高速ビジネス分析サービス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Data-Exchange_16.svg" />
AWS Data Exchange&lt;/td>
 &lt;td>クラウド内サードパーティのデータを検索、購読、および使用&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Data-Pipeline_16.svg" />
AWS Data Pipeline&lt;/td>
 &lt;td>定期的なデータ駆動型ワークフローに対するオーケストレーションサービス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Glue_16.svg" />
AWS Glue&lt;/td>
 &lt;td>シンプルでスケーラブルなサーバーレスデータ統合&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Lake-Formation_16.svg" />
AWS Lake Formation&lt;/td>
 &lt;td>安全なデータレイクを数日で構築&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Application Integration（アプリケーション統合）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Step-Functions_16.svg" />
AWS Step Functions&lt;/td>
 &lt;td>分散アプリケーションの調整&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-AppFlow_16.svg" />
Amazon AppFlow&lt;/td>
 &lt;td>SaaS アプリケーションと AWS のサービス向けのコード統合が不要&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-EventBridge_16.svg" />
Amazon EventBridge&lt;/td>
 &lt;td>SaaS アプリと AWS のサービス向けサーバーレスイベントバス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Amazon Managed Workflows for Apache Airflow&lt;/td>
 &lt;td>可用性に優れたセキュアなマネージドワークフローオーケストレーション&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-MQ_16.svg" />
Amazon MQ&lt;/td>
 &lt;td>マネージド型メッセージブローカーサービス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Simple-Notification-Service_16.svg" />
Amazon Simple Notification Service (SNS)&lt;/td>
 &lt;td>Pub/sub、SMS、E メール、およびモバイルプッシュ通知&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Simple-Queue-Service_16.svg" />
Amazon Simple Queue Service (SQS)&lt;/td>
 &lt;td>マネージド型メッセージキュー&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-AppSync_16.svg" />
Amazon AppSync&lt;/td>
 &lt;td>多くのソースから適切なデータを使用して、大規模にアプリを強化&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">AWS Cost Management（AWS コスト管理）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Cost-Explorer_16.svg" />
AWS Cost Explorer&lt;/td>
 &lt;td>AWS のコストと使用状況を分析する&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Budgets_16.svg" />
AWS 予算&lt;/td>
 &lt;td>カスタムコストと使用予算を設定する&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Cost-and-Usage-Report_16.svg" />
AWS のコストと使用状況レポート&lt;/td>
 &lt;td>包括的なコストと使用状況情報へのアクセス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Reserved-Instance-Reporting_16.svg" />
リザーブドインスタンスレポート&lt;/td>
 &lt;td>リザーブドインスタンス (RI) の詳細を把握する&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Savings-Plans_16.svg" />
Savings Plans&lt;/td>
 &lt;td>柔軟な料金設定でコンピューティング使用コストを最大 72% 節約&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Blockchain （ブロックチェーン）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Managed-Blockchain_16.svg" />
Amazon Managed Blockchain&lt;/td>
 &lt;td>スケーラブルなブロックチェーンネットワークを作成および管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Quantum-Ledger-Database_16.svg" />
Amazon Quantum Ledger Database (QLDB)&lt;/td>
 &lt;td>フルマネージド型台帳データベース&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Business Application（ビジネスアプリケーション）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Alexa-For-Business_16.svg" />
Alexa for Business&lt;/td>
 &lt;td>Alexa を使って組織を強化&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Chime_16.svg" />
Amazon Chime&lt;/td>
 &lt;td>フラストレーションフリーの会議、ビデオ電話、チャット&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Amazon Honeycode (ベータ)&lt;/td>
 &lt;td>プログラミングなしでモバイルおよびウェブアプリケーションを構築&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-WorkDocs_16.svg" />
Amazon WorkDocs&lt;/td>
 &lt;td>エンタープライズドキュメントの安全なストレージと共有&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-WorkMail_16.svg" />
Amazon WorkMail&lt;/td>
 &lt;td>セキュリティで保護されたマネージド型の企業向け E メールおよびカレンダー&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Compute（コンピューティング）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-EC2_16.svg" />
Amazon EC2&lt;/td>
 &lt;td>クラウド内の仮想サーバー&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-EC2-Auto-Scaling_16.svg" />
Amazon EC2 Auto Scaling&lt;/td>
 &lt;td>需要に合わせてコンピューティング性能をスケール&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Lightsail_16.svg" />
Amazon Lightsail&lt;/td>
 &lt;td>仮想プライベートサーバーを起動および管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Batch_16.svg" />
AWS Batch&lt;/td>
 &lt;td>あらゆる規模でバッチジョブを実行&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Elastic-Beanstalk_16.svg" />
AWS Elastic Beanstalk&lt;/td>
 &lt;td>ウェブアプリの実行と管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Lambda_16.svg" />
AWS Lambda&lt;/td>
 &lt;td>イベント発生時にコードを実行&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Outposts_16.svg" />
AWS Outposts&lt;/td>
 &lt;td>AWS サービスをオンプレミスで実行&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Serverless-Application-Repository_16.svg" />
AWS Serverless Application Repository&lt;/td>
 &lt;td>サーバーレスアプリケーションを検索、デプロイ、公開する&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
AWS Snow ファミリー&lt;/td>
 &lt;td>エッジロケーションでデータを集約および処理して AWS に転送するデバイス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Wavelength_16.svg" />
AWS Wavelength&lt;/td>
 &lt;td>5G デバイスのための超低レイテンシーアプリケーションを提供&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_VMware-Cloud-on-AWS_16.svg" />
VMware Cloud on AWS&lt;/td>
 &lt;td>カスタムハードウェアを使用せずにハイブリッドクラウドを構築する&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Containers（コンテナ）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Elastic-Container-Registry_16.svg" />
Amazon Elastic Container Registry&lt;/td>
 &lt;td>コンテナイメージを簡単に保存、管理、デプロイ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Elastic-Container-Service_16.svg" />
Amazon Elastic Container Service (ECS)&lt;/td>
 &lt;td>コンテナを実行するためのきわめて安全で信頼性と拡張性が高い方法&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Amazon ECS Anywhere (近日公開)&lt;/td>
 &lt;td>インフラストラクチャでの ECS&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Elastic-Container-Kubernetes_16.svg" />
Amazon Elastic Kubernetes Service (EKS)&lt;/td>
 &lt;td>信頼性が最も高い Kubernetes の実行方法&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Amazon EKS Anywhere (近日公開)&lt;/td>
 &lt;td>インフラストラクチャでの Kubernetes&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Amazon EKS Distro&lt;/td>
 &lt;td>一貫した Kubernetes クラスターの実行&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
AWS App2Container&lt;/td>
 &lt;td>既存のアプリケーションのコンテナ化と移行&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Fargate_16.svg" />
AWS Fargate&lt;/td>
 &lt;td>コンテナ向けサーバーレスコンピューティング&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
AWS での Red Hat OpenShift&lt;/td>
 &lt;td>マネージド Red Hat OpenShift クラスター&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Customer Engagement（カスタマーエンゲージメント）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Connect_16.svg" />
Amazon Connect&lt;/td>
 &lt;td>クラウドベースのコンタクトセンター&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Pinpoint_16.svg" />
Amazon Pinpoint&lt;/td>
 &lt;td>チャンネル間でのパーソナライズされたユーザーエンゲージメント&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Simple-Email-Service_16.svg" />
Amazon Simple Email Service (SES)&lt;/td>
 &lt;td>E メールの送受信&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Database（データベース）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Aurora_16.svg" />
Amazon Aurora&lt;/td>
 &lt;td>高性能マネージドリレーショナルデータベース&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Amazon Aurora Serverless v2 (プレビュー)&lt;/td>
 &lt;td>毎秒 100,000 件を超えるトランザクションに瞬時にスケール&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-DynamoDB_16.svg" />
Amazon DynamoDB&lt;/td>
 &lt;td>マネージド型の NoSQL データベース&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-DocumentDB_16.svg" />
Amazon DocumentDB (MongoDB 互換)&lt;/td>
 &lt;td>フルマネージド型ドキュメントデータベース&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-ElastiCache_16.svg" />
Amazon ElastiCache&lt;/td>
 &lt;td>インメモリキャッシングシステム&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Keyspaces_16.svg" />
Amazon Keyspaces (Apache Cassandra 用)&lt;/td>
 &lt;td>マネージド型の Cassandra 対応データベース&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Neptune_16.svg" />
Amazon Neptune&lt;/td>
 &lt;td>フルマネージド型グラフデータベースサービス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Quantum-Ledger-Database_16_b.svg" />
Amazon Quantum Ledger Database (QLDB)&lt;/td>
 &lt;td>フルマネージド型台帳データベース&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-RDS_16.svg" />
Amazon RDS&lt;/td>
 &lt;td>MySQL、PostgreSQL、Oracle、SQL Server、MariaDB 向けのマネージドリレーショナルデータベースサービス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-RDS-for-VMware_16.svg" />
Amazon RDS on VMware&lt;/td>
 &lt;td>オンプレミスデータベースの管理を自動化&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Redshift_16_b.svg" />
Amazon Redshift&lt;/td>
 &lt;td>高速、シンプル、費用対効果の高いデータウェアハウジング&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Timestream_16.svg" />
Amazon Timestream&lt;/td>
 &lt;td>フルマネージド型の時系列データベース&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Database-Migration_16.svg" />
AWS Database Migration Service&lt;/td>
 &lt;td>最小限のダウンタイムでデータベースを移行&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Glue_16.svg" />
AWS Glue&lt;/td>
 &lt;td>シンプルでスケーラブルなサーバーレスデータ統合&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Developer Tools（デベロッパーツール）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-CodeGuru_16.svg" />
Amazon CodeGuru&lt;/td>
 &lt;td>最もコストがかかるコード行を見つける&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Amazon Corretto&lt;/td>
 &lt;td>本番環境に向けて OpenJDK を配信&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Cloud-Development-Kit_16.svg" />
AWS Cloud Development Kit (CDK)&lt;/td>
 &lt;td>コードを使用してクラウドインフラストラクチャをモデル化する&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Cloud9_16.svg" />
AWS Cloud9&lt;/td>
 &lt;td>Cloud IDE でコードを記述、実行、デバッグ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
AWS CloudShell&lt;/td>
 &lt;td>ブラウザベースのシェル環境&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-CodeArtifact_16.svg" />
AWS CodeArtifact&lt;/td>
 &lt;td>ソフトウェア開発のためのセキュアかつスケーラブルでコスト効率性に優れたアーティファクト管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-CodeBuild_16.svg" />
AWS CodeBuild&lt;/td>
 &lt;td>コードのビルドとテスト&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-CodeCommit_16.svg" />
AWS CodeCommit&lt;/td>
 &lt;td>プライベート Git リポジトリでのコードの保存&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-CodeDeploy_16.svg" />
AWS CodeDeploy&lt;/td>
 &lt;td>コードデプロイの自動化&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-CodePipeline_16.svg" />
AWS CodePipeline&lt;/td>
 &lt;td>継続的デリバリーを使用したソフトウェアのリリース&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Codestar_16.svg" />
AWS CodeStar&lt;/td>
 &lt;td>AWS アプリケーションの開発とデプロイ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Command-Line-Interface_16.svg" />
AWS コマンドラインインターフェイス&lt;/td>
 &lt;td>AWS サービスを管理するための統合ツール&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Device-Farm_16.svg" />
AWS Device Farm&lt;/td>
 &lt;td>AWS クラウド内の実際のデバイスを使った Android、iOS、ウェブアプリケーションのテスト&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
AWS Fault Injection Simulator&lt;/td>
 &lt;td>完全マネージド型のカオスエンジニアリングサービス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Tools-and-SDK_16.svg" />
AWS ツールと SDK&lt;/td>
 &lt;td>AWS のためのツールと SDK&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-X-Ray_16.svg" />
AWS X-Ray&lt;/td>
 &lt;td>アプリケーションの分析とデバッグ&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">End User Computing（エンドユーザーコンピューティング）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-App-Stream_16.svg" />
Amazon AppStream 2.0&lt;/td>
 &lt;td>デスクトップアプリケーションを安全にブラウザへストリーミングするサービスです&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-WorkDocs_16_b.svg" />
Amazon WorkDocs&lt;/td>
 &lt;td>エンタープライズドキュメントの安全なストレージと共有&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-WorkLink_16.svg" />
Amazon WorkLink&lt;/td>
 &lt;td>社内のウェブサイトへのモバイルアクセスを可能にする&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-WorkSpaces_16.svg" />
Amazon WorkSpaces&lt;/td>
 &lt;td>デスクトップコンピューティングサービス&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Font-End Web &amp; Mobile（ウェブとモバイルのフロントエンド）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Amplify-Console_16.svg" />
AWS Amplify&lt;/td>
 &lt;td>モバイルおよびウェブアプリケーションの構築とデプロイ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-API-Gateway_16.svg" />
Amazon API Gateway&lt;/td>
 &lt;td>API を構築し、デプロイし、管理する&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Amazon Location Service (プレビュー)&lt;/td>
 &lt;td>アプリケーションにロケーションデータをセキュアかつ簡単に追加&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Pinpoint_16_b.svg" />
Amazon Pinpoint&lt;/td>
 &lt;td>チャンネル間でのパーソナライズされたユーザーエンゲージメント&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-AppSync_16_b.svg" />
AWS AppSync&lt;/td>
 &lt;td>多くのソースから適切なデータを使用して、大規模にアプリを強化&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Device-Farm_16.svg" />
AWS Device Farm&lt;/td>
 &lt;td>AWS クラウド内の実際のデバイスを使った Android、iOS、ウェブアプリケーションのテスト&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Game Tech&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-GameLift_16.svg" />
Amazon GameLift&lt;/td>
 &lt;td>シンプルで高速な費用対効果の高い専用ゲームサーバーホスティング&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Lumberyard_64.svg" />
Amazon Lumberyard&lt;/td>
 &lt;td>AWS や Twitch と統合された完全なソースを利用できる、無料のクロスプラットフォーム 3D ゲームエンジンです。&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Internet of Things（IoT: モノのインターネット）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-IoT-Core_16.svg" />
AWS IoT Core&lt;/td>
 &lt;td>デバイスをクラウドに接続&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-IoT-Greengrass-Core_16.svg" />
AWS Greengrass&lt;/td>
 &lt;td>デバイスのローカルでのコンピューティング、メッセージング、および同期&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-IoT-1-Click_16.svg" />
AWS IoT 1-Click&lt;/td>
 &lt;td>AWS Lambda トリガーのワンクリック作成&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-IoT-Analytics_16.svg" />
AWS IoT Analytics&lt;/td>
 &lt;td>IoT デバイスの分析&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-IoT-Button_16.svg" />
AWS IoT ボタン&lt;/td>
 &lt;td>クラウドのプログラミング可能なダッシュボタン&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-IoT-Device-Defender_16.svg" />
AWS IoT Device Defender&lt;/td>
 &lt;td>IoT デバイスのセキュリティ管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-IoT-Device-Management_16.svg" />
AWS IoT Device Management&lt;/td>
 &lt;td>IoT デバイスのオンボード、編成、リモート管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-IoT-Events_16.svg" />
AWS IoT Events&lt;/td>
 &lt;td>IoT イベントを検出し、対応&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-IoT-SiteWise_16.svg" />
AWS IoT SiteWise&lt;/td>
 &lt;td>IoT データコレクターおよびインタプリタ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-IoT-Things-Graph_16.svg" />
AWS IoT Things Graph&lt;/td>
 &lt;td>デバイスおよびウェブサービスを簡単に接続&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
AWS Partner Device Catalog&lt;/td>
 &lt;td>AWS 互換の IoT ハードウェアの精選カタログ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-FreeRTOS_16.svg" />
FreeRTOS&lt;/td>
 &lt;td>マイクロコントローラ向けリアルタイムオペレーティングシステム&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Machine Learning（機械学習）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-SageMaker_16.svg" />
Amazon SageMaker&lt;/td>
 &lt;td>機械学習モデルを大規模に構築、トレーニング、デプロイ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Augmented-AI-A2I_16.svg" />
Amazon Augmented AI&lt;/td>
 &lt;td>ML 予測のヒューマンレビューを簡単に導入&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-CodeGuru_16.svg" />
Amazon CodeGuru&lt;/td>
 &lt;td>最もコストがかかるコード行を見つける&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Comprehend_16.svg" />
Amazon Comprehend&lt;/td>
 &lt;td>テキストのインサイトや関係性を検出&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Amazon DevOps Guru&lt;/td>
 &lt;td>ML 駆動のクラウドオペレーションサービス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Elastic-Inference_16.svg" />
Amazon Elastic Inference&lt;/td>
 &lt;td>深層学習推論の高速化&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Forecast_16.svg" />
Amazon Forecast&lt;/td>
 &lt;td>機械学習を使用して予測の精度を向上させる&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Fraud-Detector_16.svg" />
Amazon Fraud Detector&lt;/td>
 &lt;td>オンライン詐欺をより素早く検知&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Kendra_16.svg" />
Amazon Kendra&lt;/td>
 &lt;td>ML を利用してエンタープライズ検索を改革&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Lex_16.svg" />
Amazon Lex&lt;/td>
 &lt;td>音声やテキストに対応するチャットボットの構築&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Amazon Lookout for Equipment (プレビュー)&lt;/td>
 &lt;td>センサーデータの分析による異常動作の検知&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Amazon Lookout for Metrics&lt;/td>
 &lt;td>メトリクス内における異常の検知&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Amazon Lookout for Vision&lt;/td>
 &lt;td>コンピュータビジョンを使用した製品欠陥の検出&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Amazon Monitron&lt;/td>
 &lt;td>機器モニタリングのためのエンドツーエンドシステム&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Personalize_16.svg" />
Amazon Personalize&lt;/td>
 &lt;td>アプリケーションへのリアルタイムレコメンデーションの構築&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Polly_16.svg" />
Amazon Polly&lt;/td>
 &lt;td>テキストを生きた話し声に変換&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Rekognition_16.svg" />
Amazon Rekognition&lt;/td>
 &lt;td>イメージとビデオを分析&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Amazon SageMaker Data Wrangler&lt;/td>
 &lt;td>ML 用にデータを準備するための最も速い方法&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-SageMaker-Ground-Truth_16.svg" />
Amazon SageMaker Ground Truth&lt;/td>
 &lt;td>精度の高い機械学習トレーニングデータセットの構築&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Textract_16.svg" />
Amazon Textract&lt;/td>
 &lt;td>ドキュメントからテキストやデータを抽出する&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Translate_16.svg" />
Amazon Translate&lt;/td>
 &lt;td>自然で流ちょうな言語翻訳&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Transcribe_16.svg" />
Amazon Transcribe&lt;/td>
 &lt;td>自動音声認識&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Deep-Learning-AMIs_16.svg" />
AWS 深層学習 AMI&lt;/td>
 &lt;td>EC2 で今すぐ深層学習を始める&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Deep-Learning-Containers_16.svg" />
AWS Deep Learning Containers&lt;/td>
 &lt;td>深層学習向け Docker イメージ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Deep-Composer_16.svg" />
AWS DeepComposer&lt;/td>
 &lt;td>機械学習が有効化されたミュージカルキーボード&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Deep-Lense_16.svg" />
AWS DeepLens&lt;/td>
 &lt;td>深層学習に対応したビデオカメラ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Deepracer_16.svg" />
AWS DeepRacer&lt;/td>
 &lt;td>機械学習による 18 分の 1 のスケールでの自律走行型レースカー&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
AWS Inferentia&lt;/td>
 &lt;td>機械学習インファレンスチップ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
AWS Panorama (プレビュー)&lt;/td>
 &lt;td>エッジに設置したコンピュータビジョンによる運営改善&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_TorchServe_16.svg" />
AWS での PyTorch&lt;/td>
 &lt;td>柔軟なオープンソースの機械学習フレームワーク&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Apache-MXNet_16.svg" />
AWS での Apache MXNet&lt;/td>
 &lt;td>スケーラブルでパフォーマンスに優れた深層学習&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-TensorFlow-on-AWS_16.svg" />
AWS での TensorFlow&lt;/td>
 &lt;td>オープンソースの Machine Intelligence Library&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Management &amp; Governance（マネジメントとガバナンス）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-CloudWatch_16.svg" />
Amazon CloudWatch&lt;/td>
 &lt;td>リソースとアプリケーションのモニタリング&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Auto-Scaling_16.svg" />
AWS Auto Scaling&lt;/td>
 &lt;td>需要に合わせて複数のリソースをスケール&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Chatbot_16.svg" />
AWS Chatbot&lt;/td>
 &lt;td>ChatOps for AWS&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-CloudFormation_16.svg" />
AWS CloudFormation&lt;/td>
 &lt;td>テンプレートを使ったリソースの作成と管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Cloud-Trail_16.svg" />
AWS CloudTrail&lt;/td>
 &lt;td>ユーザーアクティビティと API 使用状況の追跡&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Command-Line-Interface_16_b.svg" />
AWS コマンドラインインターフェイス&lt;/td>
 &lt;td>AWS サービスを管理するための統合ツール&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Compute-Optimizer_16.svg" />
AWS Compute Optimizer&lt;/td>
 &lt;td>最適な AWS コンピューティングリソースを特定&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Config_16.svg" />
AWS Config&lt;/td>
 &lt;td>リソースのインベントリと変更の追跡&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Control-Tower_16.svg" />
AWS Control Tower&lt;/td>
 &lt;td>安全かつ基準に準拠した複数のアカウント環境をセットアップおよび管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Console-Mobile-Application%20_16.svg" />
AWS コンソールモバイルアプリ&lt;/td>
 &lt;td>リソースの状態を外出先で確認&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
AWS Distro for OpenTelemetry (プレビュー)&lt;/td>
 &lt;td>相関するメトリクスとトレースの収集&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-License-Manager_16.svg" />
AWS License Manager&lt;/td>
 &lt;td>ライセンスの追跡、管理、制御&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Management-Console_16.svg" />
AWS マネジメントコンソール&lt;/td>
 &lt;td>ウェブベースのユーザーインターフェイス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Managed-Services_16.svg" />
AWS Managed Services&lt;/td>
 &lt;td>AWS のインフラストラクチャ運用管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Amazon Managed Service for Grafana&lt;/td>
 &lt;td>強力でインタラクティブなデータ視覚化&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Amazon Managed Service for Prometheus&lt;/td>
 &lt;td>コンテナのためのセキュアで可用性に優れたモニタリング&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-OpsWorks_16.svg" />
AWS OpsWorks&lt;/td>
 &lt;td>Chef と Puppet を使用した運用の自動化&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Organizations_16.svg" />
AWS Organizations&lt;/td>
 &lt;td>AWS アカウント全体の一元管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Personal-Health-Dashboard_16.svg" />
AWS Personal Health Dashboard&lt;/td>
 &lt;td>AWS のサービス状態のパーソナライズされた表示&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
AWS Proton (プレビュー)&lt;/td>
 &lt;td>コンテナとサーバーレスデプロイメントのための自動化された管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Service-Catalog_16.svg" />
AWS Service Catalog&lt;/td>
 &lt;td>標準化された製品の作成と使用&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Systems-Manager_16.svg" />
AWS Systems Manager&lt;/td>
 &lt;td>運用時の洞察を改善し、実行&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Trusted-Advisor_16.svg" />
AWS Trusted Advisor&lt;/td>
 &lt;td>パフォーマンスとセキュリティの最適化&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Well-Architect-Tool_16.svg" />
AWS Well-Architected Tool&lt;/td>
 &lt;td>ワークロードの見直しと改善&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Media Services（メディアサービス）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Elastic-Transcoder_16.svg" />
Amazon Elastic Transcoder&lt;/td>
 &lt;td>スケーラブルで使いやすいメディア変換サービス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Interactive-Video_16.svg" />
Amazon Interactive Video Service&lt;/td>
 &lt;td>マネージドライブ動画ソリューション&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Kinesis-Video-Streams_16.svg" />
Amazon Kinesis Video Streams&lt;/td>
 &lt;td>ビデオストリームの処理と分析&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Elemental-MediaConnect_16.svg" />
AWS Elemental MediaConnect&lt;/td>
 &lt;td>高い信頼性を安全性を持つライブ動画転送&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Elemental-MediaConvert_16.svg" />
AWS Elemental MediaConvert&lt;/td>
 &lt;td>ファイルベースのビデオコンテンツを変換&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Elemental-MediaLive_16.svg" />
AWS Elemental MediaLive&lt;/td>
 &lt;td>ライブビデオコンテンツを変換&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Elemental-MediaPackage_16.svg" />
AWS Elemental MediaPackage&lt;/td>
 &lt;td>動画の発信とパッケージ化&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Elemental-MediaStore_16.svg" />
AWS Elemental MediaStore&lt;/td>
 &lt;td>メディアストレージとシンプルな HTTP オリジン&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Elemental-MediaTailor_16.svg" />
AWS Elemental MediaTailor&lt;/td>
 &lt;td>動画のパーソナライズと収益化&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Elemental-Appliances-&amp;amp;-Software_16.svg" />
AWS Elemental アプライアンスとソフトウェア&lt;/td>
 &lt;td>オンプレミスメディアソリューション&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Migration &amp; Transfer（移行と転送）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Migration-Hub_16.svg" />
AWS Migration Hub&lt;/td>
 &lt;td>複数の移行を 1 か所で追跡&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Application-Discovery-Service_16.svg" />
AWS Application Discovery Service&lt;/td>
 &lt;td>オンプレミスのアプリケーションを検出して合理的に移行&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Database-Migration_16_b.svg" />
AWS Database Migration Service&lt;/td>
 &lt;td>最小限のダウンタイムでデータベースを移行&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Data-Sync_16.svg" />
AWS DataSync&lt;/td>
 &lt;td>シンプルかつ高速なオンラインデータ転送&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Server-Migration-Service_16.svg" />
AWS Server Migration Service&lt;/td>
 &lt;td>AWS へのオンプレミスサーバーの移行&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
AWS Snow ファミリー&lt;/td>
 &lt;td>AWS との間でデータを移行するためのデバイス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Transfer-Family_16.svg" />
AWS Transfer Family&lt;/td>
 &lt;td>フルマネージド SFTP、FTPS、および FTP サービス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-CloudEndure-Migration_16.svg" />
CloudEndure Migration&lt;/td>
 &lt;td>AWS への大規模な移行を自動化&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
Migration Evaluator（旧 TSO Logic）&lt;/td>
 &lt;td>クラウド移行のビジネスケースを作成&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Networking &amp; Content Delivery（ネットワーキングとコンテンツ配信）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Virtual-Private-Cloud_16.svg" />
Amazon VPC&lt;/td>
 &lt;td>独立したクラウドリソース&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-API-Gateway_16.svg" />
Amazon API Gateway&lt;/td>
 &lt;td>API を構築、デプロイ、管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-CloudFront_16.svg" />
Amazon CloudFront&lt;/td>
 &lt;td>グローバルコンテンツ配信ネットワーク&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Route-53_16.svg" />
Amazon Route 53&lt;/td>
 &lt;td>スケーラブルなドメインネームシステム (DNS)&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-PrivateLink_16.svg" />
AWS PrivateLink&lt;/td>
 &lt;td>AWS でホストされているサービスに安全にアクセス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-App-Mesh_16.svg" />
AWS App Mesh&lt;/td>
 &lt;td>マイクロサービスをモニタリングおよびコントロール&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-CloudMap_16.svg" />
AWS Cloud Map&lt;/td>
 &lt;td>マイクロサービス向けのアプリケーションリソースレジストリ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Direct-Connect_16.svg" />
AWS Direct Connect&lt;/td>
 &lt;td>AWS への専用ネットワーク接続&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Global-Accelerator_16.svg" />
AWS Global Accelerator&lt;/td>
 &lt;td>アプリケーションの可用性とパフォーマンスを向上&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Transit-Gateway_16.svg" />
AWS Transit Gateway&lt;/td>
 &lt;td>VPC およびアカウント接続を簡単にスケール&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Elastic-Load-Balancing_16.svg" />
Elastic Load Balancing&lt;/td>
 &lt;td>複数のターゲットにわたる着信トラフィックの分配&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Quantum Technologies（量子テクノロジー）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Braket_16.svg" />
Amazon Braket&lt;/td>
 &lt;td>量子コンピューティングを探索して実験&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Robotics（ロボット工学）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-RoboMaker_16.svg" />
AWS RoboMaker&lt;/td>
 &lt;td>ロボット工学アプリケーションの開発、テスト、デプロイ&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Satellite（人工衛星）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Ground-Station_16.svg" />
AWS Ground Station&lt;/td>
 &lt;td>サービスとしてのフルマネージド型地上局&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Security, Identity &amp; Compliance（セキュリティ、アイデンティティ、コンプライアンス）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Identity-and-Access-Management_16.svg" />
AWS Identity &amp; Access Management&lt;/td>
 &lt;td>サービスとリソースへのアクセスを安全に管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Cognito_16.svg" />
Amazon Cognito&lt;/td>
 &lt;td>アプリの ID 管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Detective_16.svg" />
Amazon Detective&lt;/td>
 &lt;td>潜在的なセキュリティ問題を調査&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-GuardDuty_16.svg" />
Amazon GuardDuty&lt;/td>
 &lt;td>マネージド型脅威検出サービス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Inspector_16.svg" />
Amazon Inspector&lt;/td>
 &lt;td>アプリケーションのセキュリティの分析&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Macie_16.svg" />
Amazon Macie&lt;/td>
 &lt;td>大規模な機密データを検出して保護する&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Artifact_16.svg" />
AWS Artifact&lt;/td>
 &lt;td>AWS のコンプライアンスレポートへのオンデマンドアクセス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
AWS Audit Manager&lt;/td>
 &lt;td>AWS 利用状況の継続的な監査&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Certificate-Manager_16.svg" />
AWS Certificate Manager&lt;/td>
 &lt;td>SSL/TLS 証明書のプロビジョニング、管理、およびデプロイメント&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-CloudHSM_16.svg" />
AWS CloudHSM&lt;/td>
 &lt;td>法令遵守のためのハードウェアベースキーストレージ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Directory-Service_16.svg" />
AWS Directory Service&lt;/td>
 &lt;td>Active Directory のホスティングと管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Firewall-Manager_16.svg" />
AWS Firewall Manager&lt;/td>
 &lt;td>ファイアウォールルールの一元管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Key-Management-Services_16.svg" />
AWS Key Management Service&lt;/td>
 &lt;td>マネージド型の暗号化キー作成と管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="" />
AWS Network Firewall&lt;/td>
 &lt;td>VPC 保護のためのネットワークセキュリティ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Resources-Access-Manager_16.svg" />
AWS Resource Access Manager&lt;/td>
 &lt;td>AWS のリソースを共有するためのシンプルでセキュアなサービス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Secrets-Manager_16.svg" />
AWS Secrets Manager&lt;/td>
 &lt;td>シークレットのローテーション、管理、取得&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Security-Hub_16.svg" />
AWS Security Hub&lt;/td>
 &lt;td>統合された AWS セキュリティ &amp; コンプライアンスセンター&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Shield_16.svg" />
AWS Shield&lt;/td>
 &lt;td>DDoS 保護&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Single-Sign-On_16.svg" />
AWS Single Sign-On&lt;/td>
 &lt;td>クラウドシングルサインオン (SSO) サービス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-WAF_16.svg" />
AWS WAF&lt;/td>
 &lt;td>悪意のあるウェブトラフィックのフィルター&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Serverless（サーバーレス）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Lambda_16.svg" />
AWS Lambda&lt;/td>
 &lt;td>サーバーに煩わされずにコードを実行&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-API-Gateway_16.svg" />
Amazon API Gateway&lt;/td>
 &lt;td>API の構築、デプロイ、管理&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-DynamoDB_16.svg" />
Amazon DynamoDB&lt;/td>
 &lt;td>マネージド型の NoSQL データベース&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-EventBridge_16.svg" />
Amazon EventBridge&lt;/td>
 &lt;td>SaaS アプリと AWS のサービス向けサーバーレスイベントバス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Simple-Notification-Service_16.svg" />
Amazon Simple Notification Service (SNS)&lt;/td>
 &lt;td>Pub/sub、SMS、E メール、およびモバイルプッシュ通知&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Simple-Queue-Service_16.svg" />
Amazon Simple Queue Service (SQS)&lt;/td>
 &lt;td>マネージド型メッセージキュー&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-S3-Standard_16.svg" />
Amazon Simple Storage Service (S3)&lt;/td>
 &lt;td>クラウド内のスケーラブルなストレージ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-AppSync_16.svg" />
AWS AppSync&lt;/td>
 &lt;td>多くのソースから適切なデータを使用して、大規模にアプリを強化&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Fargate_16.svg" />
AWS Fargate&lt;/td>
 &lt;td>コンテナ向けサーバーレスコンピューティング&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Step-Functions_16.svg" />
AWS Step Functions&lt;/td>
 &lt;td>分散型アプリケーションの調整&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">Storage（ストレージ）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-S3-Standard_16.svg" />
Amazon Simple Storage Service (S3)&lt;/td>
 &lt;td>スケーラブルなクラウドストレージ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Elastic-Block-Store_16.svg" />
Amazon Elastic Block Store (EBS)&lt;/td>
 &lt;td>EC2 ブロックストレージボリューム&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Elastic-File-System_16.svg" />
Amazon Elastic File System (EFS)&lt;/td>
 &lt;td>EC2 用フルマネージド型ファイルシステム&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-FSx-for-Lustre_16.svg" />
Amazon FSx for Lustre&lt;/td>
 &lt;td>S3 と統合されたハイパフォーマンスファイルシステム&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-FSx-For-WFS_16.svg" />
Amazon FSx for Windows File Server&lt;/td>
 &lt;td>フルマネージド型 Windows ネイティブのファイルシステム&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_Amazon-Glacier_16.svg" />
Amazon S3 Glacier&lt;/td>
 &lt;td>クラウド上の低コストなアーカイブストレージ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Backup_16.svg" />
AWS Backup&lt;/td>
 &lt;td>AWS のサービス全体にわたる一元管理型バックアップ&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Snowball_16.svg" />
AWS Snow ファミリー&lt;/td>
 &lt;td>厳しい環境や切断された環境向けの物理エッジコンピューティングおよびストレージデバイス&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Storage-Gateway_16.svg" />
AWS Storage Gateway&lt;/td>
 &lt;td>ハイブリッドストレージの統合&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-CloudEndure-Disaster-Recovery_16.svg" />
CloudEndure Disaster Recovery&lt;/td>
 &lt;td>高度に自動化した災害対策&lt;/td>
 &lt;/tr>
 &lt;tr>&lt;th colspan="2">VR &amp; AR（VR および AR）&lt;/th>&lt;/tr>
 &lt;tr>
 &lt;td>
&lt;img style="width: autopx; min-width: autopx;" src="../../p/t8fmsz5/Arch_AWS-Sumerian_16.svg" />
Amazon Sumerian&lt;/td>
 &lt;td>VR および AR アプリケーションの構築と実行&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table></description></item></channel></rss>