<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>AWS/CLI on まくろぐ</title><link>https://maku.blog/tags/aws/cli/</link><description>Recent content in AWS/CLI on まくろぐ</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Mon, 11 Apr 2022 00:00:00 +0900</lastBuildDate><atom:link href="https://maku.blog/tags/aws/cli/index.xml" rel="self" type="application/rss+xml"/><item><title>AWS の初期設定: AWS CLI と認証情報の設定</title><link>https://maku.blog/p/j5iu7it/</link><pubDate>Sun, 07 Feb 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/j5iu7it/</guid><description>&lt;h2 id="aws-cli-とは">AWS CLI とは？&lt;/h2>
&lt;p>AWS CLI (Command Line Interface) を使うと、AWS の各種サービスをコマンドラインから操作することができます。
例えば、次のように様々な処理を実行できます。&lt;/p>
&lt;ul>
&lt;li>S3 にファイルをコピーする
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws s3 cp ローカルファイル s3://バケット名/ディレクトリ名
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>IAM ユーザーのアクセスキーを表示する
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws iam list-access-keys --user-name&lt;span class="o">=&lt;/span>ユーザー名
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>DynamoDB にテーブルを作成する
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws dynamodb create-table --table-name テーブル名 ...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;p>AWS の各種サービスの設定は、それぞれのマネージメントコンソール（Web サイト）上で設定することができますが、AWS CLI を使うことで、Web ブラウザを開かずに設定を済ませられます。
頻繁に行う処理などは、シェルスクリプトなどにして自動化することができます。&lt;/p>
&lt;p>AWS CLI を使用するには、下記のような IAM ユーザーのアクセスキー（及びシークレットアクセスキー）が必要です。
以降の説明では、これらの情報が取得できていることを前提とします。&lt;/p>
&lt;ul>
&lt;li>API 用アクセスキー（例）: &lt;code>INMCAKIAQX77PNSXQAGP&lt;/code>&lt;/li>
&lt;li>API 用シークレットアクセスキー（例）: &lt;code>2ufOA3Q2KAmpNTo2GHPDXFJK7Jiv9yfZGegIdbCW&lt;/code>&lt;/li>
&lt;/ul>
&lt;aside style="display: flex; border: thin dashed gray;">
&lt;div style="align-self: stretch; writing-mode: vertical-lr; text-align: center; letter-spacing: 0.2em; color: #666; border-right: thin dashed gray; padding: 0.4em 0; line-height: 1.5;">参考&lt;/div>
&lt;div style="align-self: center; padding: 0.6em 0; line-height: 1.2 !important;">&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-creds">IAM ユーザーのアクセスキーを作成するには - AWS CLI&lt;/a>&lt;/li>
&lt;/ul>
&lt;/div>
&lt;/aside>
&lt;h2 id="aws-cli-のインストール">AWS CLI のインストール&lt;/h2>
&lt;h3 id="インストール方法">インストール方法&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-mac.html">macOS の場合&lt;/a> &amp;hellip; &lt;a href="https://awscli.amazonaws.com/AWSCLIV2.pkg">AWSCLIV2.pkg&lt;/a> をダウンロードしてインストールできます。&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-windows.html">Windows の場合&lt;/a> &amp;hellip; &lt;a href="https://awscli.amazonaws.com/AWSCLIV2.msi">AWSCLIV2.msi&lt;/a> をダウンロードしてインストールできます。&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html">Linux の場合&lt;/a> &amp;hellip; &lt;code>curl&lt;/code> コマンドでインストール用スクリプトをダウンロードしてインストールできます。&lt;/li>
&lt;/ul>
&lt;h3 id="インストール後の確認">インストール後の確認&lt;/h3>
&lt;p>何らかの &lt;code>aws&lt;/code> コマンドが実行できるようになっていれば成功です。&lt;/p></description></item><item><title>AWS CLI: Windows で HOME 環境変数を設定したときに credentials が見つからなくなる場合の対処</title><link>https://maku.blog/p/2td9ouj/</link><pubDate>Mon, 29 Mar 2021 00:00:00 +0900</pubDate><guid>https://maku.blog/p/2td9ouj/</guid><description>&lt;p>AWS CLI や AWS SDK が参照する共有認証ファイル（&lt;code>credentials&lt;/code> および &lt;code>config&lt;/code>）は、デフォルトでは下記のようなディレクトリになっています。&lt;/p>
&lt;ul>
&lt;li>Linux の場合: &lt;code>~/.aws/credentials&lt;/code>&lt;/li>
&lt;li>Windows の場合: &lt;code>~/%USERPROFILE%/.aws/credentials&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ところが、Windows を使用している場合に、環境変数 &lt;strong>&lt;code>%HOME%&lt;/code>&lt;/strong> を設定していると、CLI や SDK が &lt;code>%HOME%/.aws/credentials&lt;/code> を見に行ったりして、credentials が見つからない系のエラーが出ることがあります。
一貫して &lt;strong>&lt;code>%USERPROFILE%&lt;/code>&lt;/strong> の方を見に行ってくれれればよいのですが、このあたりの振る舞いは結構ルーズなようです。&lt;/p>
&lt;p>そこで、&lt;strong>Windows のジャンクション機能&lt;/strong> で、両方の &lt;code>.aws&lt;/code> ディレクトリが同じディレクトリを指すようにしてみました。
ジャンクション生成のコマンドは、&lt;strong>&lt;code>mklink /j &amp;lt;fromDir&amp;gt; &amp;lt;toDir&amp;gt;&lt;/code>&lt;/strong> です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">ジャンクションで 2 つの .aws を同一にする&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">C:\&amp;gt; mklink /j %HOME%\.aws %USERPROFILE%\.aws
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:\home\.aws &amp;lt;&amp;lt;===&amp;gt;&amp;gt; C:\Users\maku\.aws のジャンクションが作成されました&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これで、&lt;code>%HOME%\.aws&lt;/code> ディレクトリを参照したときの実体として、&lt;code>%USERPROFILE%\.aws&lt;/code> ディレクトリが使われるようになります。
今のところ快適に動作しています。&lt;/p>
&lt;p>ちなみに、ジャンクションを削除したいときは、ジャンクション元の &lt;code>%HOME%\.aws&lt;/code> ディレクトリを削除するだけです。
実体の方の &lt;code>%USERPROFILET%\.aws&lt;/code> は削除されないので安全です。&lt;/p></description></item><item><title>Amazon API Gateway をコマンドライン (CLI) から操作する</title><link>https://maku.blog/p/qwb6v89/</link><pubDate>Mon, 11 Apr 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/qwb6v89/</guid><description>&lt;p>AWS CLI（コマンドラインkツール）で Amazon API Gateway を操作するには、&lt;strong>&lt;code>aws apigatewayv2&lt;/code>&lt;/strong> コマンドを使用します。
API Gateway の作成や更新を行うためには、IAM ユーザーに適切な権限が必要ですが、&lt;strong>&lt;code>AmazonAPIGatewayAdministrator&lt;/code>&lt;/strong> 管理ポリシーを付けるとほとんどの操作が可能になります。
通常、REST API を作成する場合は、バックエンドの Lambda 関数も合わせて必要になるので、&lt;strong>&lt;code>AWSLambdaFullAccess&lt;/code>&lt;/strong> などの管理ポリシーも必要になります。&lt;/p>
&lt;h2 id="rest-api-を作成する-apigateway-create-rest-api">REST API を作成する (apigateway create-rest-api)&lt;/h2>
&lt;p>リファレンス: &lt;a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/apigateway/create-rest-api.html">apigateway create-rest-api&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> aws apigateway create-rest-api --name &lt;span class="s2">&amp;#34;My First API&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&lt;span class="go"> --description &amp;#34;This is my first API&amp;#34; \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> --region ap-northeast-1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="go">apiKeySource: HEADER
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">createdDate: &amp;#39;2022-04-18T15:46:00+09:00&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">description: This is my first API
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">disableExecuteApiEndpoint: false
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">endpointConfiguration:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> types:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go"> - EDGE
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">id: mk6mj65po6
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">name: My First API
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>--name&lt;/code> オプションのみが必須です。
API の作成に成功すると、上記のように ID (&lt;code>mk6mj65po6&lt;/code>) が返されます。&lt;/p></description></item></channel></rss>