<!doctype html><html lang=ja-jp>
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>WebGL入門 (3) バッファーオブジェクトで頂点座標をシェーダーへ送る (VBO)｜まくろぐ</title>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-63069513-4"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-63069513-4')</script><meta property="og:site_name" content="まくろぐ">
<meta property="og:title" content="WebGL入門 (3) バッファーオブジェクトで頂点座標をシェーダーへ送る (VBO)">
<meta property="og:type" content="website">
<meta property="og:url" content="https://maku.blog/p/ogk9ogw/">
<meta property="og:locale" content="ja_JP"><meta property="og:image" content="https://maku.blog/img/site-logo.png">
<meta property="og:image:width" content="1436">
<meta property="og:image:height" content="746">
<meta property="og:description" content="このブラウザは canvas タグに対応していません。   はじめに WebGL (OpenGL) でアプリケーション側 (CPU) のコードから、シェーダー側 (GPU) へ図形の頂点情報を送るには、バッファーオブジェクト (Buffer Object) の仕組みを使用します。 WebGL 側に確保したバッファーオブジェクトに、頂点座標の配列データをまとめて書き込んでおいて、最後に描画開始要求を送ることで、CPU と GPU 間の通信回数を抑えることができます。 頂点座標を格納するために確保したバッファーオブジェクトのことを、特に VBO (Vertext Buffer Object) と呼んだりします。
WebGL でバッファーオブジェクトを使って図形を描画するまでの流れは以下のようになります。
 WebGL 側にバッファーオブジェクトを作成する  gl.createBuffer()   バッファーオブジェクトをターゲットとバインドする  gl.bindBuffer()   バッファーオブジェクトに頂点情報を転送する  gl.bufferData()   頂点シェーダーの attribute 変数でそのデータを1つずつ取り出せるようにする  gl.getAttribLocation() gl.vertexAttribPointer() gl.enableVertexAttribArray()   描画要求を送る  gl.drawArrays()    以下、単純な三角形を描画するまでの手順を示します。
バッファーオブジェクトを作成する まず、WebGL 側に頂点情報を格納するためのバッファーオブジェクトを生成します。 これは、gl.createBuffer() をパラメータなしで呼ぶだけなので簡単です。
const vertexBuffer = gl.">
<meta property="fb:app_id" content="1572235596285254"><link rel=stylesheet href=../../css/main.min.912f23940528fc207a4dcbe6a6be831d1a99bf78143db42f914622722f63ad0b.css>
<link rel=icon sizes="16x16 32x32 48x48 64x64" href=../../assets/favicon/favicon.ico>
<link rel=icon sizes=192x192 href=../../assets/favicon/192x192.png>
<link rel=apple-touch-icon href=../../assets/favicon/180x180.png>
<script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin=anonymous></script>
<style>.codoc-support{display:inline-block;margin:.5rem 0 0!important;padding:12px!important;width:210px!important;max-width:100%}.codoc-support .codoc-support-title{font-size:smaller!important;white-space:nowrap;margin-bottom:12px!important}.codoc-support .codoc-btn{width:180px!important}</style>
<script src=https://codoc.jp/js/cms.js data-css=black data-usercode=tp6ZPzTj3w defer></script>
</head>
<body>
<div id=xRoot>
<div id=xSiteHeader><a href=../../>まくろぐ</a></div>
<aside>
<div class=xBreadcrumb>
<span class=xBreadcrumb_item><a href=../../>&#x1F3E0;</a>
</span>
<span class=xBreadcrumb_item><a href=../../p/3ftx6b2/>技術系</a>
</span>
<span class=xBreadcrumb_item><a href=../../p/ujqinda/>プログラミング</a>
</span>
<span class=xBreadcrumb_item><a href=../../p/qapsyfa/>3D</a>
</span>
<span class=xBreadcrumb_item>WebGL入門 (3) バッファーオブジェクトで頂点座標をシェーダーへ送る (VBO)
</span>
</div>
</aside>
<div id=xContainer>
<nav id=xMenu aria-label=メニュー>
<div id=sidebar style=height:100%>
<div id=sidebar_notFixed>
<a href=../../><img src=https://maku.blog/img/site-logo-sidebar.png></a>
<div class=xMenu_box data-sticky>
<form action=https://cse.google.com/cse target=_blank>
<div class=xSearchBox>
<input type=hidden name=cx value=partner-pub-6317852277883092:6890083468>
<input type=hidden name=ie value=UTF-8>
<input type=search name=q placeholder=サイト内検索 size=30 autocomplete=off>
<input type=submit value=検索></input>
</div>
</form>
<div class=xMenu_box_body>
</div>
</div>
<div class=xMenu_box data-sticky>
<h3 class=xMenu_box_title><a href=../../latest/>新着</a></h3>
<div class=xMenu_box_body>
<div class=xBoxLink>
<a href=../../p/cbuan5h/>
MUI で GitHub のようなリソース削除の確認ダイアログを作る（AreYouSure ダイアログ）
<time>2022-08-10</time></a>
</div>
<div class=xBoxLink>
<a href=../../p/2yahqx6/>
Ansible で VPS を設定するための準備
<time>2022-08-07</time></a>
</div>
<div class=xBoxLink>
<a href=../../p/hufvdta/>
Ansible で SSH サーバーをセキュアにする (ansible.builtin.lineinfile, ansible.builtin.service)
<time>2022-08-06</time></a>
</div>
<div class=xBoxLink>
<a href=../../p/cqaq7n4/>
Linuxメモ: ユーザーのデフォルトシェルを変更する (chsh)
<time>2022-08-05</time></a>
</div>
<div class=xBoxLink>
<a href=../../p/ehxgwt4/>
TypeScript を使った Node.js アプリを Docker コンテナ化する
<time>2022-07-29</time></a>
</div>
</div>
</div>
<div class=xMenu_box data-sticky>
<h3 class=xMenu_box_title><a href=../../sitemap/>フォルダ</a></h3>
<div class=xMenu_box_body>
<div class=xNavTree>
<ul>
<li><a class=xNavTree-dir href=../../p/3ftx6b2/>技術系</a>
<ul>
<li><a class=xNavTree-dir href=../../p/ujqinda/>プログラミング</a>
<ul>
<li><a class=xNavTree-dir href=../../p/d7p5jye/>React</a>
<li><a class=xNavTree-dir href=../../p/fn7m2gu/>JavaScript / Node.js</a>
<li><a class=xNavTree-dir href=../../p/gqo9yoo/>TypeScript</a>
<li><a class=xNavTree-dir href=../../p/5398aih/>Android プログラミング</a>
<li><a class=xNavTree-dir href=../../p/zkw9ju6/>Electron</a>
<li><a class=xNavTree-dir href=../../p/7zhxet9/>Java</a>
<li><a class=xNavTree-dir href=../../p/kevbq7k/>正規表現</a>
<li><a class=xNavTree-dir href=../../p/g3gs5gs/>Unity</a>
<li><a class=xNavTree-dir href=../../p/sfs4fq2/>プログラム雑多メモ</a>
<li><a class=xNavTree-dir href=../../p/qapsyfa/>3D</a>
<ul>
</ul>
<li><a class=xNavTree-dir href=../../p/qikq9o8/>MongoDB</a>
<li><a class=xNavTree-dir href=../../p/4vcr8ji/>Jade</a>
<li><a class=xNavTree-dir href=../../p/ce8c2q5/>Doxygen</a>
<li><a class=xNavTree-dir href=../../p/p3z9bup/>アルゴリズム</a>
<li><a class=xNavTree-dir href=../../p/bv6dksy/>Linux</a>
<li><a class=xNavTree-dir href=../../p/zff2scf/>SQL</a>
<li><a class=xNavTree-dir href=../../p/8zhwcq6/>C/C++</a>
</ul>
<li><a class=xNavTree-dir href=../../p/vrhjtds/>Azure</a>
<li><a class=xNavTree-dir href=../../p/8t6hr3d/>Ansible</a>
<li><a class=xNavTree-dir href=../../p/ruk3gu9/>Linux</a>
<li><a class=xNavTree-dir href=../../p/dj28oy5/>Docker 関連メモ</a>
<li><a class=xNavTree-dir href=../../p/nd3cmt3/>ネットワーク</a>
<li><a class=xNavTree-dir href=../../p/cm9nyco/>GraphQL</a>
<li><a class=xNavTree-dir href=../../p/6p3dox9/>Firebase</a>
<li><a class=xNavTree-dir href=../../p/7s7hs4e/>AWS</a>
<li><a class=xNavTree-dir href=../../p/5q4fr3d/>GitHub</a>
<li><a class=xNavTree-dir href=../../p/inh3k2j/>Visual Studio Code</a>
<li><a class=xNavTree-dir href=../../p/somcgdw/>macOS</a>
<li><a class=xNavTree-dir href=../../p/y42o4hw/>Windows</a>
<li><a class=xNavTree-dir href=../../p/e58h5in/>雑多な技術メモ</a>
<li><a class=xNavTree-dir href=../../p/jto2isn/>HTML/CSS のメモ</a>
<li><a class=xNavTree-dir href=../../p/ibs96hs/>フォント/文字コード/Locale/Unicode</a>
<li><a class=xNavTree-dir href=../../p/xb5w4in/>デザインパターン/UML</a>
<li><a class=xNavTree-dir href=../../p/9xv5548/>Jekyll</a>
<li><a class=xNavTree-dir href=../../p/zbgbb5u/>PlantUML</a>
<li><a class=xNavTree-dir href=../../p/xdsom3a/>Nginx（Web サーバー）</a>
<li><a class=xNavTree-dir href=../../p/jxvi6vv/>Excel のメモ</a>
</ul>
<li><a class=xNavTree-dir href=../../p/zb9ocav/>ツール</a>
<li><a class=xNavTree-dir href=../../p/35odek9/>読書</a>
<li><a class=xNavTree-dir href=../../p/ajj5753/>遊び</a>
<li><a class=xNavTree-dir href=../../p/qb73pxx/>日記・コラム</a>
<li><a class=xNavTree-dir href=../../p/syy4ryp/>設定</a>
<li><a class=xNavTree-dir href=../../p/tsjyzrn/>雑多</a>
<li><a class=xNavTree-dir href=../../p/hnoamfo/>管理人</a>
</ul>
</div>
</div>
</div>
<div class=xMenu_box data-sticky>
<h3 class=xMenu_box_title><a href=../../tags/>タグ</a></h3>
<div class=xMenu_box_body><div class=xMenu_tag>
<a href=../../tags/%E8%AA%AD%E6%9B%B8>読書 (79)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws>aws (61)</a>
</div><div class=xMenu_tag>
<a href=../../tags/azure>azure (58)</a>
</div><div class=xMenu_tag>
<a href=../../tags/typescript>typescript (58)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E6%97%A5%E8%A8%98>日記 (53)</a>
</div><div class=xMenu_tag>
<a href=../../tags/next.js>next.js (37)</a>
</div><div class=xMenu_tag>
<a href=../../tags/chatbot>chatbot (28)</a>
</div><div class=xMenu_tag>
<a href=../../tags/react>react (28)</a>
</div><div class=xMenu_tag>
<a href=../../tags/gnuplot>gnuplot (27)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws/cdk>aws/cdk (26)</a>
</div><div class=xMenu_tag>
<a href=../../tags/linux>linux (25)</a>
</div><div class=xMenu_tag>
<a href=../../tags/github>github (23)</a>
</div><div class=xMenu_tag>
<a href=../../tags/bot-builder-sdk>bot-builder-sdk (21)</a>
</div><div class=xMenu_tag>
<a href=../../tags/node.js>node.js (19)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws/dynamodb>aws/dynamodb (18)</a>
</div><div class=xMenu_tag>
<a href=../../tags/graphql>graphql (18)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws/cloudformation>aws/cloudformation (16)</a>
</div><div class=xMenu_tag>
<a href=../../tags/ansible>ansible (15)</a>
</div><div class=xMenu_tag>
<a href=../../tags/electron>electron (15)</a>
</div><div class=xMenu_tag>
<a href=../../tags/vs-code>vs-code (14)</a>
</div><div class=xMenu_tag>
<a href=../../tags/javascript>javascript (13)</a>
</div><div class=xMenu_tag>
<a href=../../tags/mongodb>mongodb (13)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws/cognito>aws/cognito (12)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0>プログラム (11)</a>
</div><div class=xMenu_tag>
<a href=../../tags/android>android (10)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws/lambda>aws/lambda (10)</a>
</div><div class=xMenu_tag>
<a href=../../tags/nginx>nginx (10)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%82%B2%E3%83%BC%E3%83%A0>ゲーム (10)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%83%93%E3%83%AA%E3%83%A4%E3%83%BC%E3%83%89>ビリヤード (10)</a>
</div><div class=xMenu_tag>
<a href=../../tags/java>java (9)</a>
</div><div class=xMenu_tag>
<a href=../../tags/python>python (9)</a>
</div><div class=xMenu_tag>
<a href=../../tags/uml>uml (9)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%82%BB%E3%83%9F%E3%83%8A%E3%83%BC%E8%AC%9B%E6%BC%94%E4%BC%9A>セミナー講演会 (9)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E6%95%B0%E5%AD%A6>数学 (9)</a>
</div><div class=xMenu_tag>
<a href=../../tags/3d>3d (8)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws/sam>aws/sam (8)</a>
</div><div class=xMenu_tag>
<a href=../../tags/firebase/firestore>firebase/firestore (8)</a>
</div><div class=xMenu_tag>
<a href=../../tags/unity>unity (8)</a>
</div><div class=xMenu_tag>
<a href=../../tags/webgl>webgl (8)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%82%A2%E3%82%A4%E3%83%87%E3%82%A2>アイデア (8)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E4%BB%95%E4%BA%8B>仕事 (8)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E6%8A%80%E8%A1%93>技術 (8)</a>
</div><div class=xMenu_tag>
<a href=../../tags/azure-cli>azure-cli (7)</a>
</div><div class=xMenu_tag>
<a href=../../tags/azure-pipelines>azure-pipelines (7)</a>
</div><div class=xMenu_tag>
<a href=../../tags/jade>jade (7)</a>
</div><div class=xMenu_tag>
<a href=../../tags/material-ui>material-ui (7)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3>デザインパターン (7)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%83%A9%E3%82%A4%E3%83%95%E3%83%8F%E3%83%83%E3%82%AF>ライフハック (7)</a>
</div><div class=xMenu_tag>
<a href=../../tags/apollo>apollo (6)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws/api-gateway>aws/api-gateway (6)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws/cli>aws/cli (6)</a>
</div><div class=xMenu_tag>
<a href=../../tags/azure-storage>azure-storage (6)</a>
</div><div class=xMenu_tag>
<a href=../../tags/doxygen>doxygen (6)</a>
</div><div class=xMenu_tag>
<a href=../../tags/firebase/cloudfunctions>firebase/cloudfunctions (6)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3>セキュリティ (6)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%83%84%E3%83%BC%E3%83%AB>ツール (6)</a>
</div><div class=xMenu_tag>
<a href=../../tags/azure-table-storage>azure-table-storage (5)</a>
</div><div class=xMenu_tag>
<a href=../../tags/luis>luis (5)</a>
</div><div class=xMenu_tag>
<a href=../../tags/qna-maker>qna-maker (5)</a>
</div><div class=xMenu_tag>
<a href=../../tags/ssh>ssh (5)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%81%8A%E7%B5%B5%E3%81%8B%E3%81%8D>お絵かき (5)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF>ネットワーク (5)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E6%8A%95%E8%B3%87>投資 (5)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E7%94%9F%E3%81%8D%E6%96%B9>生き方 (5)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws/ssm>aws/ssm (4)</a>
</div><div class=xMenu_tag>
<a href=../../tags/c/c++>c/c++ (4)</a>
</div><div class=xMenu_tag>
<a href=../../tags/docker>docker (4)</a>
</div><div class=xMenu_tag>
<a href=../../tags/eslint>eslint (4)</a>
</div><div class=xMenu_tag>
<a href=../../tags/firebase>firebase (4)</a>
</div><div class=xMenu_tag>
<a href=../../tags/html/css>html/css (4)</a>
</div><div class=xMenu_tag>
<a href=../../tags/sql>sql (4)</a>
</div><div class=xMenu_tag>
<a href=../../tags/windows>windows (4)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF>エディタ (4)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%83%A6%E3%83%8B%E3%83%83%E3%83%88%E3%83%86%E3%82%B9%E3%83%88>ユニットテスト (4)</a>
</div><div class=xMenu_tag>
<a href=../../tags/azure-functions>azure-functions (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/cosmos-db>cosmos-db (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/github-actions>github-actions (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/github-pages>github-pages (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/jekyll>jekyll (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/kotlin>kotlin (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/lets-encrypt>lets-encrypt (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/mac>mac (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/pc%E8%A8%AD%E5%AE%9A>pc設定 (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/powershell>powershell (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/prettier>prettier (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/sqlite>sqlite (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/textlint>textlint (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/tv>tv (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%81%8A%E3%81%A7%E3%81%8B%E3%81%91>おでかけ (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%82%A2%E3%83%97%E3%83%AA>アプリ (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0>アルゴリズム (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%83%81%E3%83%A3%E3%83%83%E3%83%88%E3%83%9C%E3%83%83%E3%83%88>チャットボット (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%83%9C%E3%83%BC%E3%83%89%E3%82%B2%E3%83%BC%E3%83%A0>ボードゲーム (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E5%83%8D%E3%81%8D%E6%96%B9>働き方 (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E7%A7%80%E4%B8%B8>秀丸 (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E8%87%AA%E5%88%86>自分 (3)</a>
</div><div class=xMenu_tag>
<a href=../../tags/apache>apache (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/arib>arib (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws/amplify>aws/amplify (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws/appsync>aws/appsync (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws/codebuild>aws/codebuild (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws/iam>aws/iam (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws/kms>aws/kms (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws/s3>aws/s3 (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/aws/sdk>aws/sdk (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/azure-app-service>azure-app-service (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/excel>excel (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/firebase/authentication>firebase/authentication (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/go>go (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/grpc>grpc (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/http>http (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/hugo>hugo (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/npm>npm (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/oauth>oauth (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/opengl>opengl (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/protocol-buffers>protocol-buffers (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/rsync>rsync (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/scp>scp (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/slack>slack (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/teraterm>teraterm (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/unicode>unicode (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/vercel>vercel (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/zip>zip (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%81%8A%E5%90%8D%E5%89%8D.com>お名前.com (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%82%A8%E3%83%9F%E3%83%A5%E3%83%AC%E3%83%BC%E3%82%BF%E3%83%BC>エミュレーター (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%83%95%E3%82%A9%E3%83%B3%E3%83%88>フォント (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0>プログラミング (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9>リファレンス (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E5%9C%A7%E7%B8%AE%E5%B1%95%E9%96%8B>圧縮展開 (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E6%96%87%E5%AD%97%E5%88%97>文字列 (2)</a>
</div><div class=xMenu_tag>
<a href=../../tags/.net>.net (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/androidstudio>androidstudio (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/apollo-server>apollo-server (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/atomic-design>atomic-design (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/blender>blender (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/bluetooth>bluetooth (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/bootstrap>bootstrap (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/bot-framework>bot-framework (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/boto3>boto3 (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/css>css (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/dns>dns (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/dvb>dvb (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/editorconfig>editorconfig (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/evernote>evernote (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/git>git (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/groovy>groovy (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/html>html (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/iso>iso (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/jest>jest (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/json>json (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/macos>macos (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/mui>mui (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/parcel>parcel (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/raspberrypi>raspberrypi (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/teams>teams (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/tex>tex (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/ubuntu>ubuntu (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/url>url (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/vim>vim (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/vps>vps (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/web>web (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/webpack>webpack (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/wsl>wsl (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%82%A2%E3%82%B8%E3%83%A3%E3%82%A4%E3%83%AB>アジャイル (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%83%90%E3%83%83%E3%83%81%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB>バッチファイル (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E8%A8%AD%E5%AE%9A>プロキシ設定 (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E6%96%87%E5%AD%97%E3%82%B3%E3%83%BC%E3%83%89>文字コード (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E6%96%87%E6%88%BF%E5%85%B7>文房具 (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E6%96%99%E7%90%86>料理 (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE>正規表現 (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E7%94%BB%E5%83%8F%E5%87%A6%E7%90%86>画像処理 (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E8%A8%80%E8%91%89>言葉 (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E8%A8%AD%E5%AE%9A>設定 (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E8%AA%8D%E8%A8%BC>認証 (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E9%80%9F%E8%AA%AD>速読 (1)</a>
</div><div class=xMenu_tag>
<a href=../../tags/%E9%9F%B3%E5%A3%B0%E8%AA%8D%E8%AD%98>音声認識 (1)</a>
</div></div>
</div>
<div class=xMenu_box data-sticky><br></div>
</div>
<div id=sidebar_fixed style=position:-webkit-sticky;position:sticky;top:4rem>
</div>
</div>
</nav>
<main id=xMain>
<article class=xArticle itemscope itemtype=https://schema.org/BlogPosting>
<aside>
<div class=xPrevNextLink>
<div class=xPrevNextLink_prev>
<a href=../../p/8s4uhzv/>WebGL入門 (2) シェーダーを使用する</a>
</div>
<div class=xPrevNextLink_next>
<a href=../../p/wqjqbpi/>WebGL入門 (4) 頂点属性をインターリーブしてバッファオブジェクトに格納する</a>
</div>
</div>
</aside>
<header class=xArticle_headerBox>
<div>
<span class=xArticle_headerBox_breadcrumb><a href=../../>&#x1F3E0;</a></span>
<span class=xArticle_headerBox_breadcrumb><a href=../../p/3ftx6b2/>技術系</a></span>
<span class=xArticle_headerBox_breadcrumb><a href=../../p/ujqinda/>プログラミング</a></span>
<span class=xArticle_headerBox_breadcrumb><a href=../../p/qapsyfa/>3D</a></span></div>
<div style=display:flex;margin-top:.8em>
<div style=width:80px;margin-right:.5em>
<img src=../../p/ujqinda/_index.svg style=width:80px;height:80px>
</div>
<div style=flex:1>
<h1 itemprop=headline class=xArticle_headerBox_title><a itemprop=mainEntityOfPage href=../../p/ogk9ogw/>WebGL入門 (3) バッファーオブジェクトで頂点座標をシェーダーへ送る (VBO)</a></h1>
<div class=xPageTags>
<span class=xPageTags_item><a href=../../tags/3d>3D</a></span>
<span class=xPageTags_item><a href=../../tags/webgl>WebGL</a></span>
</div>
</div>
</div>
<span class=xPageDate>
更新: <time itemprop=dateModified datetime=2019-09-11>2019-09-11</time><br>
作成: <time itemprop=datePublished datetime=2019-09-11>2019-09-11</time>
</span>
</header>
<div itemprop=articleBody class=xArticle_content>
<nav id=TableOfContents>
<ul>
<li><a href=#はじめに>はじめに</a></li>
<li><a href=#バッファーオブジェクトを作成する>バッファーオブジェクトを作成する</a></li>
<li><a href=#バッファーオブジェクトをターゲットにバインドする>バッファーオブジェクトをターゲットにバインドする</a></li>
<li><a href=#バッファーオブジェクトに頂点情報を転送する>バッファーオブジェクトに頂点情報を転送する</a></li>
<li><a href=#頂点シェーダーの-attribute-変数でデータを1つずつ取り出せるようにする>頂点シェーダーの attribute 変数でデータを1つずつ取り出せるようにする</a></li>
<li><a href=#描画要求を送る>描画要求を送る</a></li>
<li><a href=#全体のソースコード>全体のソースコード</a></li>
</ul>
</nav><center>
<canvas id=canvas-003 width=300 height=200>
このブラウザは canvas タグに対応していません。
</canvas>
</center>
<h2 id=はじめに>はじめに</h2>
<p>WebGL (OpenGL) でアプリケーション側 (CPU) のコードから、シェーダー側 (GPU) へ図形の頂点情報を送るには、<strong>バッファーオブジェクト (Buffer Object)</strong> の仕組みを使用します。
WebGL 側に確保したバッファーオブジェクトに、頂点座標の配列データをまとめて書き込んでおいて、最後に描画開始要求を送ることで、CPU と GPU 間の通信回数を抑えることができます。
頂点座標を格納するために確保したバッファーオブジェクトのことを、特に <strong>VBO (Vertext Buffer Object)</strong> と呼んだりします。</p>
<p>WebGL でバッファーオブジェクトを使って図形を描画するまでの流れは以下のようになります。</p>
<ol>
<li>WebGL 側にバッファーオブジェクトを作成する
<ul>
<li><code>gl.createBuffer()</code></li>
</ul>
</li>
<li>バッファーオブジェクトをターゲットとバインドする
<ul>
<li><code>gl.bindBuffer()</code></li>
</ul>
</li>
<li>バッファーオブジェクトに頂点情報を転送する
<ul>
<li><code>gl.bufferData()</code></li>
</ul>
</li>
<li>頂点シェーダーの attribute 変数でそのデータを1つずつ取り出せるようにする
<ul>
<li><code>gl.getAttribLocation()</code></li>
<li><code>gl.vertexAttribPointer()</code></li>
<li><code>gl.enableVertexAttribArray()</code></li>
</ul>
</li>
<li>描画要求を送る
<ul>
<li><code>gl.drawArrays()</code></li>
</ul>
</li>
</ol>
<p>以下、単純な三角形を描画するまでの手順を示します。</p>
<h2 id=バッファーオブジェクトを作成する>バッファーオブジェクトを作成する</h2>
<p>まず、WebGL 側に頂点情報を格納するためのバッファーオブジェクトを生成します。
これは、<a href=https://developer.mozilla.org/ja/docs/Web/API/WebGLRenderingContext/createBuffer>gl.createBuffer()</a> をパラメータなしで呼ぶだけなので簡単です。</p>
<figure class=xCodeBlock>
<div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=kr>const</span> <span class=nx>vertexBuffer</span> <span class=o>=</span> <span class=nx>gl</span><span class=p>.</span><span class=nx>createBuffer</span><span class=p>();</span>
<span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>vertexBuffer</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>throw</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Failed to create the buffer object.&#39;</span><span class=p>);</span>
<span class=p>}</span></code></pre></div></div>
</figure>
<h2 id=バッファーオブジェクトをターゲットにバインドする>バッファーオブジェクトをターゲットにバインドする</h2>
<p>バッファーオブジェクトを作成したら、<a href=https://developer.mozilla.org/ja/docs/Web/API/WebGLRenderingContext/bindBuffer>gl.bindBuffer()</a> を使って、そのバッファーオブジェクトをターゲットとバインドします。
ターゲットというのは、そのバッファーオブジェクトをどのような用途で使用するかを示すためのもので、頂点属性のために確保したのであれば、<strong><code>gl.ARRAY_BUFFER</code></strong> というターゲットとバインドします。
頂点属性というのは、「頂点座標」、「頂点カラー」、「テクスチャ座標」などのことで、ここでは頂点座標だけを扱います。</p>
<figure class=xCodeBlock>
<div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=nx>gl</span><span class=p>.</span><span class=nx>bindBuffer</span><span class=p>(</span><span class=nx>gl</span><span class=p>.</span><span class=nx>ARRAY_BUFFER</span><span class=p>,</span> <span class=nx>vertexBuffer</span><span class=p>);</span></code></pre></div></div>
</figure>
<div class=xNote>
<span class=xNote_title>☝️ ワンポイント</span>
<span class=xNote_body>バインドのイメージとしては、<code>gl.ARRAY_BUFFER</code> というターゲットを、<code>vertexBuffer</code> が示すバッファーオブジェクトを指すように設定すると考えるのがよいです。
というのも、この次に実行する <code>gl.bufferData()</code> は、<code>gl.ARRAY_BUFFER</code> をパラメータに指定することで、バッファーオブジェクトを操作することになるからです。</span>
</div>
<p>ターゲットには他にも <code>gl.ELEMENT_ARRAY_BUFFER</code> などがあり、これは、頂点配列の中のどのインデックスのデータを使うかを示すインデックス配列です。
何らかのオブジェクトを描画する場合、通常は、1 つの頂点が複数の面を構成するために繰り返し使用されます。
そのような場合に、頂点データを使いまわすことでメモリ効率を上げることができます。
<code>gl.ELEMENT_ARRAY_BUFFER</code> を使った描画に関しては、別の記事で説明します。</p>
<h2 id=バッファーオブジェクトに頂点情報を転送する>バッファーオブジェクトに頂点情報を転送する</h2>
<p>次に、アプリケーション側 (CPU側）で用意した座標の配列を、<a href=https://developer.mozilla.org/ja/docs/Web/API/WebGLRenderingContext/bufferData>gl.bufferData()</a> で GPU 側のバッファーオブジェクトに転送します。</p>
<p>座標配列は、JavaScript の配列として用意するのですが、汎用の <code>Array</code> 型ではなく Typed Array のひとつである <a href=https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Float32Array>Float32Array</a> を使用します。
頂点データ（座標や色）などの配列を扱う場合、すべての要素が同一の型であることを前提にして作成された Typed Array を使用した方が効率がよいからです。</p>
<ul>
<li><a href=../../p/twmzpfj>WebGL で使う Typed Array</a></li>
</ul>
<figure class=xCodeBlock>
<div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=kr>const</span> <span class=nx>vertices</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Float32Array</span><span class=p>([</span>
  <span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span>    <span class=c1>// 1つ目の頂点座標
</span><span class=c1></span>  <span class=o>-</span><span class=mf>0.5</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.5</span><span class=p>,</span>  <span class=c1>// 2つ目の頂点座標
</span><span class=c1></span>  <span class=mf>0.5</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.5</span>    <span class=c1>// 3つ目の頂点座標
</span><span class=c1></span><span class=p>]);</span>

<span class=nx>gl</span><span class=p>.</span><span class=nx>bufferData</span><span class=p>(</span><span class=nx>gl</span><span class=p>.</span><span class=nx>ARRAY_BUFFER</span><span class=p>,</span> <span class=nx>vertices</span><span class=p>,</span> <span class=nx>gl</span><span class=p>.</span><span class=nx>STATIC_DRAW</span><span class=p>);</span></code></pre></div></div>
</figure>
<p>第1引数には、バッファーオブジェクトではなく、ターゲット名（ここでは <code>gl.ARRAY_BUFFER</code>）を指定するところがちょっとわかりにくいところですね。
第2引数には転送する頂点データを格納した Typed Array オブジェクトを指定します。</p>
<p>第3引数は、この頂点データをどのように使用するかのパラメータで、WebGL が効率的に描画を行うためのヒント情報として使用されます（実際にどう活用されるかは WebGL の実装によります）。
ヒント情報としては下記のような値を指定できます（WebGL2 ではさらに増えています）。</p>
<ul>
<li><code>gl.STATIC_DRAW</code>: バッファーの内容はアプリから一度だけ設定され、描画するためにたくさん参照されます。</li>
<li><code>gl.STREAM_DRAW</code>: バッファーの内容はアプリから一度だけ設定され、描画するためにいくらか参照されます。</li>
<li><code>gl.DYNAMIC_DRAW</code>: バッファーの内容はアプリから何度も設定され、描画するためにたくさん参照されます。</li>
</ul>
<h2 id=頂点シェーダーの-attribute-変数でデータを1つずつ取り出せるようにする>頂点シェーダーの attribute 変数でデータを1つずつ取り出せるようにする</h2>
<p>バッファーオブジェクトに頂点座標の配列をセットしたら、頂点シェーダーからその座標値を1つずつ取り出せるようにする必要があります。
頂点シェーダーは、バッファーオブジェクトに設定した頂点 1 つごとに 1 回呼び出されることになります。</p>
<p>ここでは、頂点シェーダーを下記のように実装し、<code>a_Position</code> という名前の attribute 変数経由で座標値を 1 つずつ取り出すように実装します（<code>a_</code> プレフィックスは attribute を表します）。
<code>gl_Position</code> に代入した値が、その頂点の最終的な座標になります。</p>
<figure class=xCodeBlock>
<figcaption class=xCodeBlock_title>Vertex shader</figcaption>
<div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=n>attribute</span> <span class=n>vec4</span> <span class=n>a_Position</span><span class=p>;</span>

<span class=kt>void</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
  <span class=n>gl_Position</span> <span class=o>=</span> <span class=n>a_Position</span><span class=p>;</span>
<span class=p>}</span></code></pre></div></div>
</figure>
<p>ピクセル毎に呼び出されるフラグメントシェーダーは、下記のように単色（ここでは緑）で描画するようにしておきます。</p>
<figure class=xCodeBlock>
<figcaption class=xCodeBlock_title>Fragment shader</figcaption>
<div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=kt>void</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
  <span class=n>gl_FragColor</span> <span class=o>=</span> <span class=n>vec4</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>  <span class=c1>// RGBA
</span><span class=c1></span><span class=p>}</span></code></pre></div></div>
</figure>
<p>アプリ側のコードでは、頂点シェーダーが attribute 変数経由でバッファーオブジェクト内の頂点データを取り出せるように設定します。
まず、<a href=https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/getAttribLocation>gl.getAttribLocation()</a> で、attribute 変数にアクセスするためのハンドルを取得します。</p>
<figure class=xCodeBlock>
<div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=kr>const</span> <span class=nx>a_Position</span> <span class=o>=</span> <span class=nx>gl</span><span class=p>.</span><span class=nx>getAttribLocation</span><span class=p>(</span><span class=nx>gl</span><span class=p>.</span><span class=nx>program</span><span class=p>,</span> <span class=s1>&#39;a_Position&#39;</span><span class=p>);</span></code></pre></div></div>
</figure>
<p>ここで、第1引数にプログラムオブジェクトが必要になりますが、ここでは、<code>gl.program</code> というプロパティにあらかじめ格納されているとします。</p>
<p>次に、<a href=https://developer.mozilla.org/ja/docs/Web/API/WebGLRenderingContext/vertexAttribPointer>gl.vertexAttribPointer()</a> を使い、<strong>現在 <code>gl.ARRAY_BUFFER</code> にバインドされているバッファーオブジェクト</strong>に、頂点情報がどのようなレイアウトで格納されているかを設定します。つまり、シェーダー側に、attribute 変数経由でどのような単位でデータを取り出していけばよいかを知らせます。バッファーオブジェクトに設定した頂点情報は、構造化されていない一次元の配列（バイナリ）なので、このような情報が必要になります。</p>
<figure class=xCodeBlock>
<div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=nx>gl</span><span class=p>.</span><span class=nx>vertexAttribPointer</span><span class=p>(</span><span class=nx>a_Position</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=nx>gl</span><span class=p>.</span><span class=nx>FLOAT</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span></code></pre></div></div>
</figure>
<p>第2引数 (size) では、頂点あたりの次元数（頂点毎に消費する配列要素数）を指定します。
ここでは、X座標とY座標のペアを格納しているので、2 と指定します。
有効な値は 1～4 です。</p>
<p>第3引数 (type) では、各要素の型を指定します。
ここでは、<code>Float32Array</code> で頂点座標をセットしているので、対応する WebGL の型として <code>gl.FLOAT</code> を指定しています。</p>
<p>第4引数 (normalized) では、整数データを浮動小数点数に型変換するときに値の範囲を -1.0～1.0 に正規化するかを指定します。ただし、セットするデータがもともと浮動小数点数の場合は正規化は行われないので、ここは <code>false</code> にしておけば OK です。</p>
<p>第5引数 (stride) は、配列データ内に頂点座標、テクスチャ座標、頂点カラーといった複数種の属性を交互に詰めている（インターリーブされている）場合の、1 頂点あたりの使用バイト数を指定します。
最後の第6引数 (offset) は、最初の要素が、バッファー内のどこから始まるかを示すバイトオフセット値です。
ここでは、頂点座標だけを格納しているので、第5引数と第6引数は両方とも 0 を指定しておけば OK です。
インターリーブされたデータを扱う方法は下記の記事を参考にしてください。</p>
<ul>
<li>参考: <a href=../../p/wqjqbpi>頂点属性をインターリーブしてバッファオブジェクトに格納する</a></li>
</ul>
<p>最後に、<a href=https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/enableVertexAttribArray>gl.enableVertexAttribArray()</a> を呼び出して、attribute 変数に割り当てたバッファーオブジェクトを有効にします。</p>
<figure class=xCodeBlock>
<div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=nx>gl</span><span class=p>.</span><span class=nx>enableVertexAttribArray</span><span class=p>(</span><span class=nx>a_Position</span><span class=p>);</span></code></pre></div></div>
</figure>
<p>ここまで設定が終わると、頂点シェーダーの attribute 変数経由で、バッファオブジェクト内の頂点データを 1 つずつ取り出せるようになります。</p>
<div class=xNote>
<span class=xNote_title>☝️ ワンポイント</span>
<span class=xNote_body><code>gl.enableVertexAttribArray()</code> を実行した時点で、その attribute 変数はバッファオブジェクトからの入力専用になるため、<code>gl.vertexAttrib[1234]f()</code> などの関数で個々の頂点データを attribute 変数に直接渡すことはできなくなります。
<code>gl.disableVertexAttribArray()</code> すれば再び渡せるようになります。</span>
</div>
<h2 id=描画要求を送る>描画要求を送る</h2>
<p>バッファーオブジェクトへの頂点データの格納と、attribute 変数の設定を完了したら、あとは <a href=https://developer.mozilla.org/ja/docs/Web/API/WebGLRenderingContext/drawArrays>gl.drawArrays()</a> を呼び出すことで、実際に頂点データを使った描画が行われます。</p>
<figure class=xCodeBlock>
<div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=nx>gl</span><span class=p>.</span><span class=nx>drawArrays</span><span class=p>(</span><span class=nx>gl</span><span class=p>.</span><span class=nx>TRIANGLE_STRIP</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span></code></pre></div></div>
</figure>
<p>第1引数 (mode) では描画するプリミティブのタイプ（ここでは一つの三角形なので、<code>gl.TRIANGLE</code> でも <code>gl.TRIANGLE_STRIP</code> でも OK）を指定します。</p>
<p>第2引数 (first) では、頂点配列の開始インデックスを指定します。</p>
<p>第3引数 (count) では、使用する頂点の数を指定します。
ここでは、3 つの頂点を使うので、3 を指定しています。
頂点シェーダーは、3 回実行されることになります。</p>
<h2 id=全体のソースコード>全体のソースコード</h2>
<figure class=xCodeBlock>
<div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>script</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;vs&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;x-shader/x-vertex&#34;</span><span class=p>&gt;</span>
<span class=nx>attribute</span> <span class=nx>vec4</span> <span class=nx>a_Position</span><span class=p>;</span>
<span class=k>void</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
  <span class=nx>gl_Position</span> <span class=o>=</span> <span class=nx>a_Position</span><span class=p>;</span>
<span class=p>}</span>
<span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>

<span class=p>&lt;</span><span class=nt>script</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;fs&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;x-shader/x-fragment&#34;</span><span class=p>&gt;</span>
<span class=k>void</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
  <span class=nx>gl_FragColor</span> <span class=o>=</span> <span class=nx>vec4</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>  <span class=c1>// RGBA
</span><span class=c1></span><span class=p>}</span>
<span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>

<span class=p>&lt;</span><span class=nt>script</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;module&#34;</span><span class=p>&gt;</span>
<span class=kr>import</span> <span class=p>{</span> <span class=nx>initGL</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;/assets/js/webgl_util.js&#39;</span><span class=p>;</span>

<span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;load&#39;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
  <span class=kr>const</span> <span class=nx>gl</span> <span class=o>=</span> <span class=nx>initGL</span><span class=p>(</span><span class=s1>&#39;canvas&#39;</span><span class=p>,</span> <span class=s1>&#39;vs&#39;</span><span class=p>,</span> <span class=s1>&#39;fs&#39;</span><span class=p>);</span>

  <span class=kr>const</span> <span class=nx>vertices</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Float32Array</span><span class=p>([</span>
    <span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span>    <span class=c1>// 1つ目の頂点座標
</span><span class=c1></span>    <span class=o>-</span><span class=mf>0.5</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.5</span><span class=p>,</span>  <span class=c1>// 2つ目の頂点座標
</span><span class=c1></span>    <span class=mf>0.5</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.5</span>    <span class=c1>// 3つ目の頂点座標
</span><span class=c1></span>  <span class=p>]);</span>

  <span class=kr>const</span> <span class=nx>vertexBuffer</span> <span class=o>=</span> <span class=nx>gl</span><span class=p>.</span><span class=nx>createBuffer</span><span class=p>();</span>
  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>vertexBuffer</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>throw</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Failed to create the buffer object.&#39;</span><span class=p>);</span>
  <span class=p>}</span>
  <span class=nx>gl</span><span class=p>.</span><span class=nx>bindBuffer</span><span class=p>(</span><span class=nx>gl</span><span class=p>.</span><span class=nx>ARRAY_BUFFER</span><span class=p>,</span> <span class=nx>vertexBuffer</span><span class=p>);</span>
  <span class=nx>gl</span><span class=p>.</span><span class=nx>bufferData</span><span class=p>(</span><span class=nx>gl</span><span class=p>.</span><span class=nx>ARRAY_BUFFER</span><span class=p>,</span> <span class=nx>vertices</span><span class=p>,</span> <span class=nx>gl</span><span class=p>.</span><span class=nx>STATIC_DRAW</span><span class=p>);</span>

  <span class=kr>const</span> <span class=nx>a_Position</span> <span class=o>=</span> <span class=nx>gl</span><span class=p>.</span><span class=nx>getAttribLocation</span><span class=p>(</span><span class=nx>gl</span><span class=p>.</span><span class=nx>program</span><span class=p>,</span> <span class=s1>&#39;a_Position&#39;</span><span class=p>);</span>
  <span class=nx>gl</span><span class=p>.</span><span class=nx>vertexAttribPointer</span><span class=p>(</span><span class=nx>a_Position</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=nx>gl</span><span class=p>.</span><span class=nx>FLOAT</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
  <span class=nx>gl</span><span class=p>.</span><span class=nx>enableVertexAttribArray</span><span class=p>(</span><span class=nx>a_Position</span><span class=p>);</span>

  <span class=nx>gl</span><span class=p>.</span><span class=nx>clearColor</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
  <span class=nx>gl</span><span class=p>.</span><span class=nx>clear</span><span class=p>(</span><span class=nx>gl</span><span class=p>.</span><span class=nx>COLOR_BUFFER_BIT</span><span class=p>);</span>
  <span class=nx>gl</span><span class=p>.</span><span class=nx>drawArrays</span><span class=p>(</span><span class=nx>gl</span><span class=p>.</span><span class=nx>TRIANGLE_STRIP</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
<span class=p>});</span>
<span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></code></pre></div></div>
</figure>
<p>上記でインポートしている <code>webgl_util.js</code> は、プログラムオブジェクトを作成するユーティリティ関数 <code>initGL()</code> を定義しています。
プログラムオブジェクトの作成に関しては、<a href=../../p/8s4uhzv>こちら</a>を参照してください。</p>
<script id=vs-003 type=x-shader/x-vertex>
attribute vec4 a_Position;
void main() {
  gl_Position = a_Position;
}
</script>
<script id=fs-003 type=x-shader/x-fragment>
void main() {
  gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);  // RGBA
}
</script>
<script type=module>
import { initGL } from '/assets/js/webgl_util.js';

window.addEventListener('load', function () {
  const gl = initGL('canvas-003', 'vs-003', 'fs-003');

  const vertices = new Float32Array([
    0.0, 0.5,    // 1つ目の頂点座標
    -0.5, -0.5,  // 2つ目の頂点座標
    0.5, -0.5    // 3つ目の頂点座標
  ]);

  const vertexBuffer = gl.createBuffer();
  if (!vertexBuffer) {
    throw Error('Failed to create the buffer object.');
  }
  gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
  gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);

  const a_Position = gl.getAttribLocation(gl.program, 'a_Position');
  gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0);
  gl.enableVertexAttribArray(a_Position);

  gl.clearColor(0, 0, 0.5, 1.0);
  gl.clear(gl.COLOR_BUFFER_BIT);
  gl.drawArrays(gl.TRIANGLE_STRIP, 0, 3);
});
</script>
<meta itemprop=author content="まく">
<span itemprop=publisher itemscope itemtype=https://schema.org/Organization>
<meta itemprop=name content="まく">
</span>
<h3 style="border-bottom:1px solid gray">関連記事</h3>
<ul>
<li><a href=../../p/twmzpfj/>WebGL で使う Typed Array</a></li>
<li><a href=../../p/itkdix9/>WebGL で シェーダーコードを分離する方法</a></li>
<li><a href=../../p/8s4uhzv/>WebGL入門 (2) シェーダーを使用する</a></li>
<li><a href=../../p/46jrh68/>WebGL入門 (1) WebGL コンテキストの取得</a></li>
</ul>
<div class=xPageTags>
<span class=xPageTags_item><a href=../../tags/3d>3D</a></span>
<span class=xPageTags_item><a href=../../tags/webgl>WebGL</a></span>
</div>
</div>
<div style=text-align:right>
<div id=codoc-entry-4gYwTntzzw class=codoc-entries data-without-body=1 data-support-button-text="（っ'-')╮シュッ=͟͟͞͞ 💵" data-show-like=0 data-show-about-codoc=0 data-show-powered-by=0 data-support-message=まくに投げ銭できるよ></div>
</div>
<div class=xArticle_up>
<a href=../../p/qapsyfa/><span class=xArticle_up_label>3D</span><br>へ戻る</a>
</div>
<aside>
<div class=xPrevNextLink>
<div class=xPrevNextLink_prev>
<a href=../../p/8s4uhzv/>WebGL入門 (2) シェーダーを使用する</a>
</div>
<div class=xPrevNextLink_next>
<a href=../../p/wqjqbpi/>WebGL入門 (4) 頂点属性をインターリーブしてバッファオブジェクトに格納する</a>
</div>
</div>
</aside>
</article>
<script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-6317852277883092 data-ad-slot=8636867067></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script>
</main>
</div>
<aside>
<div class=xBreadcrumb>
<span class=xBreadcrumb_item><a href=../../>&#x1F3E0;</a>
</span>
<span class=xBreadcrumb_item><a href=../../p/3ftx6b2/>技術系</a>
</span>
<span class=xBreadcrumb_item><a href=../../p/ujqinda/>プログラミング</a>
</span>
<span class=xBreadcrumb_item><a href=../../p/qapsyfa/>3D</a>
</span>
<span class=xBreadcrumb_item>WebGL入門 (3) バッファーオブジェクトで頂点座標をシェーダーへ送る (VBO)
</span>
</div>
</aside>
<div id=xSiteFooter><a href=../../>まくろぐ</a></div>
<div id=xSiteFooter2>
<a href=../../sitemap/>サイトマップ</a> ｜
<a tatget=_blank href=https://forms.gle/xdUszEv4f5CEqH947>まくへのメッセージ</a>
</div>
</div>
<script src=../../assets/js/sidebar.js></script>
<script>document.addEventListener('DOMContentLoaded',function(){const a=document.querySelectorAll('a[href^=http]');for(let c=0;c<a.length;++c){const b=a[c];b.setAttribute('target','_blank'),b.setAttribute('rel','noopener');const d=b.getElementsByTagName('img');if(d.length>0)continue;b.classList.add('xExternalLinkIcon')}})</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"まくろぐ","item":"https://maku.blog/"},{"@type":"ListItem","position":2,"name":"技術系","item":"https://maku.blog/p/3ftx6b2/"},{"@type":"ListItem","position":3,"name":"プログラミング","item":"https://maku.blog/p/ujqinda/"},{"@type":"ListItem","position":4,"name":"3D","item":"https://maku.blog/p/qapsyfa/"},{"@type":"ListItem","position":5,"name":"WebGL入門 (3) バッファーオブジェクトで頂点座標をシェーダーへ送る (VBO)","item":"https://maku.blog/p/ogk9ogw/"}]}</script>
</body>
</html>