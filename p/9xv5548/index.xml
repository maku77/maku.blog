<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Jekyll on まくろぐ</title><link>https://maku.blog/p/9xv5548/</link><description>Recent content in Jekyll on まくろぐ</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Wed, 17 Aug 2022 00:00:00 +0900</lastBuildDate><atom:link href="https://maku.blog/p/9xv5548/index.xml" rel="self" type="application/rss+xml"/><item><title>Jekyll と Hugo を共存させて GitHub Actions でビルドする</title><link>https://maku.blog/p/qbmv6fp/</link><pubDate>Wed, 17 Aug 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/qbmv6fp/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>こことは違う Web サイト (GitHub Pages) の話ですが、いい加減 &lt;a href="../../p/xwfwdy6/">Jekyll での Web サイト管理は限界&lt;/a> になってきたので、重い腰を上げて全面的に Hugo に乗り換えようと思います。
待っていれば Jekyll も高速化されるかなという淡い期待を抱いて 3 年が経ちましたが、一向にその気配はないので、残念ですがここで Jekyll は見限ります（決して Ruby と Golang の速度の差だけだとは思いませんが、やはり Golang 製のツールの方が高速な傾向はあるのかも）。&lt;/p>
&lt;p>とはいえ、現状 Jekyll で管理している Web ページは何千ページにも膨れ上がっており、一気に乗り換えるのは困難です。
そこで、Jekyll 運用されている Web サイトに、少しずつ Hugo 管理のページを加えていく、という作戦を取りたいと思います。
ドメイン名はそのまま &lt;code>xxx.github.io&lt;/code> を使いたいので、ホスティングはこれまで通り GitHub Pages で行い、ビルドやデプロイには GitHub Actions を使うことにします。&lt;/p>
&lt;h2 id="基本方針">基本方針&lt;/h2>
&lt;p>GitHub Pages のデフォルトの仕組みとして、Markdown ファイルをソース用リポジトリに置いておくだけで、Jekyll で HTML に変換して公開してくれるというのがあるのですが、今回はこの仕組みは使えません。
なぜなら、Jekyll によるビルド結果と、Hugo によるビルド結果をマージしたものをデプロイしなければいけないからです。
イメージとしては、GitHub リポジトリに push したときに、GitHub Actions で次のような処理を実行できればうまくいくはずです。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="" height="auto" src="../../p/qbmv6fp/img-001.drawio.svg" alt="/p/qbmv6fp/img-001.drawio.svg" />
 &lt;figcaption>図: GitHub Actions でやること&lt;/figcaption>
&lt;/figure>

&lt;ol>
&lt;li>Jekyll プロジェクトの Markdown ファイルをビルドする
&lt;ul>
&lt;li>Jekyll のビルド対象から Hugo のディレクトリを除外しておきます&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Hugo プロジェクトの Markdown ファイルをビルドする&lt;/li>
&lt;li>Hugo プロジェクトのビルド結果を Jekyll プロジェクトのビルド結果にマージする
&lt;ul>
&lt;li>同名のファイルは上書きしないことにします（先輩である Jekyll の出力を優先）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>GitHub Pages のホスティング先にデプロイ
&lt;ul>
&lt;li>ここでは &lt;code>gh-pages&lt;/code> ブランチを公開ブランチとして使います&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>Hugo のプロジェクトをフラットに配置してしまうと、&lt;code>content&lt;/code> ディレクトリや &lt;code>layouts&lt;/code> ディレクトリが混在してわかりにくくなるので、Hugo 側のファイル群は、&lt;code>hugo-files&lt;/code> ディレクトリを作ってそこに配置することにします。
最終的に、Jekyll から Hugo への以降がすべて完了したら、この中のファイル群をルートに移動させる想定です。&lt;/p></description></item><item><title>Jekyll (GitHub Pages) でページの最終更新日を表示する</title><link>https://maku.blog/p/6ez7nuf/</link><pubDate>Thu, 12 Sep 2019 00:00:00 +0900</pubDate><guid>https://maku.blog/p/6ez7nuf/</guid><description>&lt;p>Jekyll では、HTML ファイルを生成するために Markdown 形式で記事を作成するのですが、先頭のフロントマターと呼ばれる部分に任意の変数を定義することができます。&lt;/p>
&lt;p>下記の例には、記事の作成日 (&lt;code>date&lt;/code>) と、最終更新日 (&lt;code>lastmod&lt;/code>) を入れてあります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">sample.md&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">title&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;ページタイトル&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">date&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;2015-01-01&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">lastmod&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;2019-09-12&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">本文...&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>これらの情報をレイアウトファイルから参照するには、下記のようにします。
ここでは、最終更新日 (&lt;code>lastmod&lt;/code>) の情報があればそちらを、なければ作成日 (&lt;code>date&lt;/code>) を表示するようにしています。
フロントマターでの &lt;code>lastmod&lt;/code> の指定はオプショナル扱いということです。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">{% if page.lastmod %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {% assign lastmod = page.lastmod %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{% else %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {% assign lastmod = page.date %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{% endif %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">span&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;date&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>{{ lastmod }}&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">span&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>HTML5 の time 要素や、schema.org の構造化データマークアップを使ってちゃんと SEO 対策するのであれば、下記のような感じでテンプレートを作成するのがよいでしょう。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">default.html（抜粋）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">{% if page.lastmod %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {% assign lastmod = page.lastmod %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{% else %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {% assign lastmod = page.date %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{% endif %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">article&lt;/span> &lt;span class="na">itemscope&lt;/span> &lt;span class="na">itemtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://schema.org/BlogPosting&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">header&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">h1&lt;/span> &lt;span class="na">itemprop&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;headline&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>{{ page.title }}&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">h1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">span&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>最終更新:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">time&lt;/span> &lt;span class="na">itemprop&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;dateModified&amp;#34;&lt;/span> &lt;span class="na">datetime&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;{{ lastmod }}&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>{{ lastmod }}&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">time&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">span&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">header&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">itemprop&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;articleBody&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {{ content }}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">article&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;ul>
&lt;li>参考: &lt;a href="../../p/ukama8m">HTML5 の time 要素の正しい使い方&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>