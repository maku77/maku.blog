<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Nginx（Web サーバー）のメモ on まくろぐ</title><link>https://maku.blog/p/xdsom3a/</link><description>Recent content in Nginx（Web サーバー）のメモ on まくろぐ</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Mon, 04 Mar 2024 00:00:00 +0900</lastBuildDate><atom:link href="https://maku.blog/p/xdsom3a/index.xml" rel="self" type="application/rss+xml"/><item><title>nginx-proxy コンテナで簡単にリバースプロキシを立ち上げる</title><link>https://maku.blog/p/kos367z/</link><pubDate>Mon, 12 Feb 2024 00:00:00 +0900</pubDate><guid>https://maku.blog/p/kos367z/</guid><description>&lt;h2 id="nginx-proxy-は-docker-コンテナ用のリバースプロキシ">nginx-proxy は Docker コンテナ用のリバースプロキシ&lt;/h2>
&lt;p>Docker コンテナイメージの &lt;a href="https://github.com/nginx-proxy/nginx-proxy">nginx-proxy&lt;/a> を使うと、複数の Docker コンテナ用のリバースプロキシを簡単に立ち上げることができます。&lt;/p>
&lt;p>例えば、1 つの VPS サーバー上で複数の Docker コンテナー（例えば Web サーバー）を立ち上げるような場合は、次のような感じで入り口にリバースプロキシを配置し、そこから各 Web サーバーにアクセスを振り分ける構成にします。
ここでは、&lt;code>aaa.example.com&lt;/code> と &lt;code>bbb.example.com&lt;/code> というサブドメインにより、プロキシ先を振り分けるようにしていますが、&lt;code>example.com&lt;/code> というベースドメインを使うこともできます。&lt;/p>


&lt;figure class="xImage">
 &lt;img style="" width="750" height="auto" src="../../p/kos367z/img-001.drawio.svg" alt="/p/kos367z/img-001.drawio.svg" />
 &lt;figcaption>図: nginx-proxy によるリバースプロキシでコンテナーを繋ぐ&lt;/figcaption>
&lt;/figure>

&lt;p>もともと Nginx でリバースプロキシを設定するのはそれほど難しくはないのですが、どうしてもその背後にあるコンテナーの設定がリバースプロキシ側の設定に染み出してしまいます。
また、リバースプロキシ用のコンテナーを最後に起動するという手順の複雑さもあります。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/q8tw6c4/">Nginx でバーチャルホストを設定する（リバースプロキシ）&lt;/a>&lt;/li>
&lt;li>参考: &lt;a href="https://maku77.github.io/p/5f2j2hz/">Docker Compose でリバースプロキシを立てて別の Docker Compose 内のコンテナに接続する - まくまく Docker ノート&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>nginx-proxy&lt;/code> によるリバースプロキシを起動しておくと、背後でコンテナーを起動するだけで、自動的にリバースプロキシのエントリに追加してくれます。
&lt;code>nginx-proxy&lt;/code> には次のような利点があります。&lt;/p>
&lt;ul>
&lt;li>背後の Docker コンテナの存在を意識しなくてよい（同一の Docker ネットーワーク内のコンテナ起動を検出して、自動的にリバースプロキシ設定に反映してくれます）&lt;/li>
&lt;li>各サブドメイン用の SSL 設定（HTTPS 対応）を自動で行ってくれる（&lt;a href="https://github.com/nginx-proxy/acme-companion">acme-companion&lt;/a> を組み合わせて使用することで、Let&amp;rsquo;s Encrypt による SSL 証明書の取得を自動化できます）&lt;/li>
&lt;/ul>
&lt;p>リバースプロキシの設定更新が自動化されているので、Web アプリ用の Docker コンテナーを簡単に追加・削除できます。&lt;/p>
&lt;h2 id="事前準備">事前準備&lt;/h2>
&lt;p>&lt;code>nginx-proxy&lt;/code> の設定を行う前に、サブドメイン用の DNS 設定や、80/443 ポートの解放などを行っておく必要があります。
ネットワーク的に繋がらないとどうしようもないですからね。&lt;/p></description></item><item><title>Nginx の設定: Web サイトのドメインを移転したときの 301 リダイレクト設定</title><link>https://maku.blog/p/mjs29go/</link><pubDate>Mon, 15 May 2023 00:00:00 +0900</pubDate><guid>https://maku.blog/p/mjs29go/</guid><description>&lt;h2 id="nginx-で-url-リダイレクト用のレスポンスを返す">nginx で URL リダイレクト用のレスポンスを返す&lt;/h2>
&lt;p>Web サイトのドメイン（URL プレフィックス）を次のような感じで移転することを考えます。&lt;/p>
&lt;ul>
&lt;li>旧アドレス: &lt;code>https://old.example.com&lt;/code>&lt;/li>
&lt;li>新アドレス: &lt;code>https://new.example.com&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>多くのユーザーが旧アドレスでブックマークしている可能性があるので、しばらくは旧アドレスにアクセスしてきたユーザー（ブラウザ）に対して、リダイレクト用のレスポンスを返すよう nginx を設定しておく必要があります。
下記は、旧アドレスでのアクセス時に 301 (Moved Permanently) リダイレクトレスポンスを返す設定例です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">/etc/nginx/conf.d/old.example.com.conf&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># これは http から https へリダイレクトする設定（オプション）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">old.example.com&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">return&lt;/span> &lt;span class="mi">301&lt;/span> &lt;span class="s">https://&lt;/span>&lt;span class="nv">$host$request_uri&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># https://old.example.com から
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># https://new.example.com へリダイレクトする設定
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">old.example.com&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">443&lt;/span> &lt;span class="s">ssl&lt;/span> &lt;span class="s">http2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">ssl_certificate&lt;/span> &lt;span class="s">/etc/letsencrypt/live/old.example.com/fullchain.pem&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">ssl_certificate_key&lt;/span> &lt;span class="s">/etc/letsencrypt/live/old.example.com/privkey.pem&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> &lt;span class="kn">return&lt;/span> &lt;span class="mi">301&lt;/span> &lt;span class="nv">$scheme://new.example.com$request_uri&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>ポイントは最後の &lt;strong>&lt;code>return&lt;/code>&lt;/strong> ディレクティブです。
1 つ目の引数に &lt;strong>&lt;code>301&lt;/code>&lt;/strong> を指定することで、301 (Moved Permanently) の HTTP レスポンスコードを返すことができます。
このコードを省略した場合は、302 (Moved Temporarily) になります。&lt;/p>
&lt;p>上記のように設定を変更したら、nginx サービスに &lt;a href="../../p/6aazmy3/">設定ファイルをリロード&lt;/a> させて完了です。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo service nginx reload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>これで、例えば、&lt;code>https://old.example.com/hoge&lt;/code> へのアクセスが、&lt;code>https://new.example.com/hoge&lt;/code> にリダイレクトされ、ブラウザの URL 表示も自動的に新しい URL に変わるようになります。&lt;/p></description></item><item><title>Nginx の設定: Nginx の設定内容を確認する (nginx -T)</title><link>https://maku.blog/p/bm6n5k2/</link><pubDate>Sun, 27 Nov 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/bm6n5k2/</guid><description>&lt;p>nginx サーバーが読み込む設定情報を確認するには、&lt;strong>&lt;code>nginx -T&lt;/code>&lt;/strong> コマンドを使用します。
正確には、このコマンドは設定ファイルの検証 (&lt;code>nginx -t&lt;/code>) と、内容の出力を同時に行うコマンドです。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">nginx が実際に読み込む設定を確認&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> nginx -T
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>下記は、&lt;code>nginx -T&lt;/code> コマンドを実行したときの出力例です。
最初の 2 行が設定ファイルの検証結果で、3 行目以降が具体的な設定内容です。&lt;/p>
&lt;div class="xAccordion">
 &lt;input id="id-896157234" type="checkbox">
 &lt;label class="xAccordion_title" for="id-896157234">出力例&lt;/label>
 &lt;div class="xAccordion_body">
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx: configuration file /etc/nginx/nginx.conf &lt;span class="nb">test&lt;/span> is successful
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># configuration file /etc/nginx/nginx.conf:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user nginx&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker_processes auto&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">error_log /var/log/nginx/error.log notice&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pid /var/run/nginx.pid&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">events &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> worker_connections 1024&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">http &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> include /etc/nginx/mime.types&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default_type application/octet-stream&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> log_format main &lt;span class="s1">&amp;#39;$remote_addr - $remote_user [$time_local] &amp;#34;$request&amp;#34; &amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;$status $body_bytes_sent &amp;#34;$http_referer&amp;#34; &amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#34;$http_user_agent&amp;#34; &amp;#34;$http_x_forwarded_for&amp;#34;&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> access_log /var/log/nginx/access.log main&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sendfile on&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#tcp_nopush on;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> keepalive_timeout 65&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#gzip on;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> include /etc/nginx/conf.d/*.conf&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># configuration file /etc/nginx/mime.types:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">types &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> text/html html htm shtml&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> text/css css&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> text/xml xml&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image/gif gif&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image/jpeg jpeg jpg&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/javascript js&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/atom+xml atom&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/rss+xml rss&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> text/mathml mml&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> text/plain txt&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> text/vnd.sun.j2me.app-descriptor jad&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> text/vnd.wap.wml wml&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> text/x-component htc&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image/avif avif&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image/png png&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image/svg+xml svg svgz&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image/tiff tif tiff&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image/vnd.wap.wbmp wbmp&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image/webp webp&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image/x-icon ico&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image/x-jng jng&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image/x-ms-bmp bmp&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> font/woff woff&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> font/woff2 woff2&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/java-archive jar war ear&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/json json&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/mac-binhex40 hqx&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/msword doc&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/pdf pdf&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/postscript ps eps ai&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/rtf rtf&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/vnd.apple.mpegurl m3u8&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/vnd.google-earth.kml+xml kml&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/vnd.google-earth.kmz kmz&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/vnd.ms-excel xls&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/vnd.ms-fontobject eot&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/vnd.ms-powerpoint ppt&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/vnd.oasis.opendocument.graphics odg&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/vnd.oasis.opendocument.presentation odp&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/vnd.oasis.opendocument.spreadsheet ods&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/vnd.oasis.opendocument.text odt&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/vnd.openxmlformats-officedocument.presentationml.presentation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pptx&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> xlsx&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/vnd.openxmlformats-officedocument.wordprocessingml.document
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> docx&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/vnd.wap.wmlc wmlc&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/wasm wasm&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/x-7z-compressed 7z&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/x-cocoa cco&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/x-java-archive-diff jardiff&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/x-java-jnlp-file jnlp&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/x-makeself run&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/x-perl pl pm&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/x-pilot prc pdb&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/x-rar-compressed rar&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/x-redhat-package-manager rpm&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/x-sea sea&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/x-shockwave-flash swf&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/x-stuffit sit&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/x-tcl tcl tk&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/x-x509-ca-cert der pem crt&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/x-xpinstall xpi&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/xhtml+xml xhtml&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/xspf+xml xspf&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/zip zip&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/octet-stream bin exe dll&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/octet-stream deb&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/octet-stream dmg&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/octet-stream iso img&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application/octet-stream msi msp msm&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> audio/midi mid midi kar&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> audio/mpeg mp3&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> audio/ogg ogg&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> audio/x-m4a m4a&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> audio/x-realaudio ra&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> video/3gpp 3gpp 3gp&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> video/mp2t ts&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> video/mp4 mp4&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> video/mpeg mpeg mpg&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> video/quicktime mov&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> video/webm webm&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> video/x-flv flv&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> video/x-m4v m4v&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> video/x-mng mng&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> video/x-ms-asf asx asf&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> video/x-ms-wmv wmv&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> video/x-msvideo avi&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># configuration file /etc/nginx/conf.d/default.conf:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">server &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 80&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name localhost&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#access_log /var/log/nginx/host.access.log main;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location / &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> root /usr/share/nginx/html&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> index index.html index.htm&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#error_page 404 /404.html;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># redirect server error pages to the static page /50x.html&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> error_page &lt;span class="m">500&lt;/span> &lt;span class="m">502&lt;/span> &lt;span class="m">503&lt;/span> &lt;span class="m">504&lt;/span> /50x.html&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">location&lt;/span> &lt;span class="o">=&lt;/span> /50x.html &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> root /usr/share/nginx/html&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># proxy the PHP scripts to Apache listening on 127.0.0.1:80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#location ~ \.php$ {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># proxy_pass http://127.0.0.1;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#location ~ \.php$ {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># root html;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># fastcgi_pass 127.0.0.1:9000;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># fastcgi_index index.php;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># include fastcgi_params;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># deny access to .htaccess files, if Apache&amp;#39;s document root&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># concurs with nginx&amp;#39;s one&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#location ~ /\.ht {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># deny all;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div> &lt;/div>
&lt;/div>
&lt;p>Docker がインストールされている環境では、上記の出力は次のような感じで確認できます。&lt;/p></description></item><item><title>Docker コンテナで Nginx サーバーを立ち上げる</title><link>https://maku.blog/p/99qo8zf/</link><pubDate>Wed, 13 Jul 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/99qo8zf/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>VPS などで Web アプリをホスティングする場合、各種サーバーを Docker コンテナとして立ち上げるようにすると OS 環境をクリーンに保てます。
特に、1 つのホスト（VPS サーバー）で複数の Web アプリを提供するような場合は、各アプリをコンテナで構成することで、関係ないアプリの設定が混ざってしまうのを防げます。
もちろん、Azure Container Instances や AWS Fargate といったコンテナ実行用のクラウドサービスを使えば、より独立した環境を構築できるのですが、これらのサービスは個人が趣味で使うにはまだまだ高価なので、VPS などの環境で Docker コンテナを立ち上げることには価値があります。&lt;/p>
&lt;p>ここでは、Nginx サーバーを Docker コンテナとして立ち上げる方法を示します。
Docker Hub で公開されている &lt;a href="https://hub.docker.com/_/nginx">Nginx イメージ&lt;/a> は、デフォルトでコンテナ内の &lt;strong>&lt;code>/usr/share/nginx/html&lt;/code>&lt;/strong> ディレクトリに配置されたコンテンツを公開するようになっています。
大きく分けて、次の 2 つのいずれかの方法で簡単にコンテンツを公開できます。&lt;/p>
&lt;ul>
&lt;li>bind マウントで Docker ホスト側のコンテンツを参照する方法&lt;/li>
&lt;li>コンテンツを含んだコンテナイメージを作成する方法&lt;/li>
&lt;/ul>
&lt;p>以下、それぞれの方法を順番に見ていきます。&lt;/p>
&lt;h2 id="bind-マウントで-docker-ホスト側のコンテンツを参照する方法">bind マウントで Docker ホスト側のコンテンツを参照する方法&lt;/h2>
&lt;p>Nginx のコンテナを起動するときに、Docker ホスト側のコンテンツディレクトリを bind マウントして、コンテナの &lt;code>/usr/share/nginx/html&lt;/code> ディレクトリとして参照できるようにする方法です。&lt;/p>
&lt;p>まず、簡単なコンテンツファイルとして次のような HTML ファイルを用意しておきます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">public/index.html&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">html&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>Hello&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">html&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>あとは、&lt;code>docker container run&lt;/code> コマンドで nginx コンテナを起動するだけです。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> docker container run --rm -d -p 8000:80 -v &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">pwd&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="s2">/public&amp;#34;&lt;/span>:/usr/share/nginx/html --name web nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>各引数は次のような意味を持っています。&lt;/p></description></item><item><title>Nginx で 403 Forbidden エラーが出るときのチェック項目</title><link>https://maku.blog/p/ew5zmmw/</link><pubDate>Thu, 10 Jan 2019 00:00:00 +0900</pubDate><guid>https://maku.blog/p/ew5zmmw/</guid><description>&lt;p>nginx サーバを起動して Web ブラウザでアクセスしたときに、ブラウザ上に &lt;strong>403 Forbidden&lt;/strong> エラーが表示されるときは、パーミッション系のエラーが発生しています。&lt;/p>
&lt;p>サーバ自体は稼働していますので、下記のあたりを確認すれば無事表示されるようになります。&lt;/p>
&lt;h2 id="ファイルに読み取り権限ディレクトリに実行権限を付ける">ファイルに読み取り権限、ディレクトリに実行権限を付ける&lt;/h2>
&lt;p>html ファイルなどのコンテンツファイル自身には読み取り権限、ディレクトリには実行権限が必要です。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ chmod 0755 -R /home/maku/website
&lt;/code>&lt;/pre>&lt;h2 id="ドキュメントルートまでのディレクトリに実行権限-x-を付ける">ドキュメントルートまでのディレクトリに実行権限 (x) を付ける&lt;/h2>
&lt;p>例えば、ドキュメントルートを &lt;code>/home/maku/website&lt;/code> としている場合は、&lt;code>/&lt;/code>、&lt;code>/home&lt;/code>、&lt;code>/home/maku&lt;/code>、&lt;code>/home/maku/website&lt;/code> のディレクトリに実行権限が必要です。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ chmod +x /home/maku
&lt;/code>&lt;/pre>&lt;p>特定のディレクトリのパーミッションは下記のように確認できます。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ ls -ld /home/maku
drwx--x--x 5 maku maku 156 1月 10 17:32 /home/maku
&lt;/code>&lt;/pre>&lt;h2 id="nginx-の設定を再読み込み">nginx の設定を再読み込み&lt;/h2>
&lt;p>ファイル群のパーミッションを変更しただけでは nginx の再起動は必要になりませんが、nginx の設定ファイルを変更した場合は、設定ファイルを反映する必要があります。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ sudo service nginx reload
&lt;/code>&lt;/pre></description></item><item><title>Nginx の設定: http でアクセスされた場合に https にリダイレクトする</title><link>https://maku.blog/p/jowgstm/</link><pubDate>Thu, 10 Jan 2019 00:00:00 +0900</pubDate><guid>https://maku.blog/p/jowgstm/</guid><description>&lt;p>nginx サーバの SSL 対応（https 有効化）が終わった後は、http プロトコルによるアクセスは避けてもらいたいですね。
そのような場合は、下記のように設定しておけば、http でアクセスされた場合に、https で再度アクセスしてもらうようにクライアントに応答することができます（301 という値は、Moved Permanently を示す HTTP レスポンスコードです）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">/etc/nginx/conf.d/xxx.conf&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># http でアクセスされた場合
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">example.com&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl"> &lt;span class="kn">return&lt;/span> &lt;span class="mi">301&lt;/span> &lt;span class="s">https://&lt;/span>&lt;span class="nv">$host$request_uri&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line hl">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># https でアクセスされた場合
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">example.com&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">443&lt;/span> &lt;span class="s">ssl&lt;/span> &lt;span class="s">http2&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># IPv4
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">listen&lt;/span> &lt;span class="s">[::]:443&lt;/span> &lt;span class="s">ssl&lt;/span> &lt;span class="s">http2&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># IPv6
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">ssl_certificate&lt;/span> &lt;span class="s">/etc/nginx/ssl/example.com-2024.crt&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">ssl_certificate_key&lt;/span> &lt;span class="s">/etc/nginx/ssl/example.com-2024.key&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">ssl_prefer_server_ciphers&lt;/span> &lt;span class="no">on&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># サーバー側の暗号スイートを優先
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">root&lt;/span> &lt;span class="s">/usr/share/nginx/html&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">index&lt;/span> &lt;span class="s">index.html&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>結果として、Web ブラウザから &lt;code>http://example.com/&lt;/code> にアクセスすると、Web ブラウザは自動的に &lt;code>https://example.com/&lt;/code> という URL でアクセスし直すことになります。&lt;/p></description></item><item><title>Nginx の設定: Nginx の設定ファイルの書き方が正しいか確認する (configtest, nginx -t)</title><link>https://maku.blog/p/3q8uzoo/</link><pubDate>Mon, 21 Sep 2015 00:00:00 +0900</pubDate><guid>https://maku.blog/p/3q8uzoo/</guid><description>&lt;p>nginx の &lt;strong>&lt;code>configtest&lt;/code>&lt;/strong> コマンドを使用すると、nginx のコンフィグファイルの記述方法が正しいかを確認することができます。
このコマンドは管理者権限で実行する必要があります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo /etc/init.d/nginx configtest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">nginx: configuration file /etc/nginx/nginx.conf test is successful
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>nginx&lt;/code> コマンド (&lt;code>/usr/sbin/nginx&lt;/code>) を認識している環境であれば、このコマンドの &lt;strong>&lt;code>-t&lt;/code>&lt;/strong> オプションで確認することもできます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo nginx -t
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">nginx: configuration file /etc/nginx/nginx.conf test is successful
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Nginx の設定: Nginx の設定ファイルの変更を反映する (nginx reload)</title><link>https://maku.blog/p/6aazmy3/</link><pubDate>Sun, 20 Sep 2015 00:00:00 +0900</pubDate><guid>https://maku.blog/p/6aazmy3/</guid><description>&lt;p>nginx の設定ファイル (&lt;code>/etc/nginx/nginx.conf&lt;/code> や &lt;code>/etc/nginx/conf.d/*.conf&lt;/code>) の内容を変更した場合は、次のように &lt;strong>&lt;code>nginx reload&lt;/code>&lt;/strong> で再読み込みします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo service nginx reload &lt;span class="c1"># 方法 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo /etc/init.d/nginx reload &lt;span class="c1"># 方法 2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>nginx の起動はとても速いので、単純な Web コンテンツだけを提供しているの Web サーバであれば、&lt;strong>&lt;code>nginx restart&lt;/code>&lt;/strong> でサービス自体を再起動してしまってもよいでしょう。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo service nginx restart &lt;span class="c1"># 方法 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo /etc/init.d/nginx restart &lt;span class="c1"># 方法 2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Nginx の設定: Nginx でバーチャルホストを設定する（リバースプロキシ）</title><link>https://maku.blog/p/q8tw6c4/</link><pubDate>Tue, 03 Dec 2013 00:00:00 +0900</pubDate><guid>https://maku.blog/p/q8tw6c4/</guid><description>&lt;ul>
&lt;li>（参考）&lt;a href="../../p/kos367z/">nginx-proxy コンテナで簡単にリバースプロキシを立ち上げる&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="アクセス時のドメイン名により別の-web-サーバに処理をフォワードする">アクセス時のドメイン名により別の Web サーバに処理をフォワードする&lt;/h2>
&lt;p>例えば、&lt;code>http://test.example.com/&lt;/code> というアドレス（80番ポート）で nginx サーバにアクセスしてきたときに、&lt;code>localhost:7000&lt;/code> で動作している Web サーバに処理を委譲するには、下記のように設定します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">/etc/nginx/conf.d/test.example.com.conf&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">test.example.com&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_pass&lt;/span> &lt;span class="s">http://localhost:7000/&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>この機能を利用することで、一つの PC 内に複数の Web サーバを（異なるポート）で立ち上げておき、アクセスしてきた URL（のドメイン名）によって処理を振り分けることができます。
例えば、次のように Web サーバへのアクセスをフォワードできます。&lt;/p>
&lt;ul>
&lt;li>http://&lt;strong>aaa&lt;/strong>.example.com/ でアクセスされた場合 → localhost:&lt;strong>7000&lt;/strong> で処理&lt;/li>
&lt;li>http://&lt;strong>bbb&lt;/strong>.example.com/ でアクセスされた場合 → localhost:&lt;strong>7100&lt;/strong> で処理&lt;/li>
&lt;li>http://&lt;strong>ccc&lt;/strong>.example.com/ でアクセスされた場合 → localhost:&lt;strong>7200&lt;/strong> で処理&lt;/li>
&lt;/ul>
&lt;p>それぞれのドメインは同じ IP アドレスにマッピングされており、物理的には 1 つのマシンに対してアクセスが発生するのですが、クライアント（Web ブラウザのユーザ）から見ると、あたかも異なるホストにアクセスしているかのように見えます（ドメイン名が異なるので）。
バーチャルなホストが存在しているような動作をするということで、このような Web サーバの機能を&lt;strong>バーチャルホスト&lt;/strong>と呼びます。&lt;/p>
&lt;p>また、このように、サーバ環境側（ここでは 80 ポートのサーバ）でいったんアクセスを受けておいて、アドレス等を見て別の内部サーバ（ここでは 7000 ポートで待ち受けているサーバなど）に処理をフォーワードする仕組みのことを、&lt;strong>リバースプロキシ&lt;/strong>と呼びます。&lt;/p>
&lt;p>リバースプロキシというのは Web サーバのためだけの仕組みではなく、より一般的なサーバの仕組みを指す名前です。
nginx や Apache などの Web サーバのバーチャルホスト機能は、リバースプロキシの仕組み（概念）を利用して実現されているということです。&lt;/p>
&lt;h2 id="アクセス時のドメイン名によりドキュメントルートを切り替える">アクセス時のドメイン名によりドキュメントルートを切り替える&lt;/h2>
&lt;p>上記の例では、クライアントからのアクセスを、別々の Web サーバ（例えば同じ PC 内の別のポートで待ち受けている Web サーバ）に振り分ける例でしたが、Web サーバは 1 つだけで、使用するコンテンツファイルのルートだけを切り替えるという方法もあります。&lt;/p></description></item><item><title>Nginx の設定: Nginx の設定ファイル (*.conf) の場所</title><link>https://maku.blog/p/pms426x/</link><pubDate>Mon, 02 Dec 2013 00:00:00 +0900</pubDate><guid>https://maku.blog/p/pms426x/</guid><description>&lt;p>nginx の設定ファイルは、&lt;strong>&lt;code>/etc/nginx/nginx.conf&lt;/code>&lt;/strong> です。
ソースからビルドする場合は、&lt;code>./configure&lt;/code> の実行時にパスを指定できます。&lt;/p>
&lt;p>この設定ファイルの中で、以下のように &lt;code>include&lt;/code> ディレクティブが指定されているため、&lt;strong>&lt;code>/etc/nginx/conf.d/&lt;/code>&lt;/strong> ディレクトリ内にある個別の設定ファイル (&lt;code>*.conf&lt;/code>) も読み込まれるようになっています。&lt;/p>

&lt;figure class="xCodeBlock">

&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">http {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> include /etc/nginx/conf.d/*.conf;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>バーチャルホスト機能を利用して複数ドメインのサーバを運用するようなケースでは、ドメインごとに設定ファイルを分けておくと管理しやすいでしょう。
例えば、&lt;code>example.com&lt;/code> ドメインのサーバ用には &lt;code>/etc/nginx/conf.d/example.com.conf&lt;/code> を作成します。&lt;/p></description></item><item><title>Nginx の基本: Nginx をインストールする</title><link>https://maku.blog/p/wyeboxi/</link><pubDate>Sun, 01 Dec 2013 00:00:00 +0900</pubDate><guid>https://maku.blog/p/wyeboxi/</guid><description>&lt;h2 id="yum-で-nginx-をインストールする">yum で nginx をインストールする&lt;/h2>
&lt;p>ここでは、CentOS などの Linux 環境を想定し、nginx を yum でインストールします。
下記のような yum の設定ファイルを作成しておくことで、最新に近い nginx をインストールできるようになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">/etc/yum.repos.d/nginx.repo&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">[nginx]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">name=nginx repo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gpgcheck=0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">enabled=1&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>下記のコマンドで nginx をインストールします（&lt;strong>バージョンアップも同じコマンドで実行できます&lt;/strong>）。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ sudo yum install nginx
&lt;/code>&lt;/pre>&lt;p>インストールできたか確認するために、バージョンを表示してみましょう。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ nginx -v
nginx version: nginx/1.4.4
&lt;/code>&lt;/pre>&lt;h2 id="nginx-の起動">nginx の起動&lt;/h2>
&lt;p>下記のようにして nginx サーバを起動できます。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ sudo service nginx start
&lt;/code>&lt;/pre>&lt;p>動作しているかを確認。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ sudo service nginx status
nginx (pid 19996) is running...
&lt;/code>&lt;/pre>&lt;h2 id="pc-起動時に-nginx-が自動起動するようにする">PC 起動時に nginx が自動起動するようにする&lt;/h2>
&lt;p>nginx が無事に起動するようになったら、&lt;strong>&lt;code>chkconfig&lt;/code>&lt;/strong> でマシンの立ち上げ時に nginx が自動起動するようにしておきましょう。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">nginx を自動起動するように設定&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ sudo chkconfig nginx on&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">設定内容の確認&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ chkconfig --list nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx 0:off 1:off 2:on 3:on 4:on 5:on 6:off&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure></description></item></channel></rss>