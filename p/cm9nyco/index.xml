<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>GraphQL 関連記事 on まくろぐ</title><link>https://maku.blog/p/cm9nyco/</link><description>Recent content in GraphQL 関連記事 on まくろぐ</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Wed, 21 Dec 2022 00:00:00 +0900</lastBuildDate><atom:link href="https://maku.blog/p/cm9nyco/index.xml" rel="self" type="application/rss+xml"/><item><title>GraphQL ベストプラクティス</title><link>https://maku.blog/p/4reqy9i/</link><pubDate>Wed, 12 Oct 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/4reqy9i/</guid><description>&lt;p>GraphQL アプリ開発のノウハウ集です。
GraphQL のスキーマ設計から、サーバー実装、クライアント実装まで、GraphQL を使ったアプリ開発全般にわたるベストプラクティスをまとめています。
業務や趣味での GraphQL アプリ開発を通じて学んだことをまとめていますが、多くの項目は、主要な GraphQL ライブラリ (Apollo や gqlgen）の設計や、『Production Ready GraphQL』、&lt;a target="_blank" href="https://www.amazon.co.jp/dp/161729568X?tag=maku04-22">『GraphQL in Action』&lt;/a>
 などの書籍を参考にしています。&lt;/p>
&lt;h2 id="クライアントファーストスキーマファースト">クライアントファースト、スキーマファースト&lt;/h2>
&lt;h3 id="クライアントファースト-client-first-で考える">クライアントファースト (Client First) で考える&lt;/h3>
&lt;p>何よりも、クライアントのユースケースを念頭において考えます。
これは、GraphQL を採用するそもそもの目的でもあります。
バックエンドで使うデータベースや言語などの、実装詳細に引っ張られた API 設計にならないように気を付けます。&lt;/p>
&lt;ul>
&lt;li>できるだけ早い段階でクライアントとのインテグレーションを始めるようにします。組織内での開発であれば、スキーマ定義が終わった段階で &lt;strong>すぐにモックサーバーを用意する&lt;/strong> ことで、クライアント開発チームが実装を開始できます。&lt;/li>
&lt;li>&lt;strong>クライアントのユースケース以上の API は作らない&lt;/strong> ようにします。&lt;a href="https://ja.wikipedia.org/wiki/YAGNI">YAGNI (You Aren&amp;rsquo;t Going to Need It)&lt;/a> の原則に従いましょう。クライアント要求のない API を提供しようとすると、混沌とした設計になりがちで、パフォーマンスの悪化やセキュリティリスクを招きます。そして、deprecated な API の管理に苦しむことになります。&lt;/li>
&lt;li>既存のデータベースから GraphQL API を生成するツールはいろいろありますが、クライアントファーストの考えからするとナンセンスであり、多くの場合は採用すべきではありません。クライアントのニーズを満たす API にはなりませんし、バックエンドの実装詳細に依存した API になってしまいます。必要のない情報まで公開してしまうことによるセキュリティリスクなど、総合的にデメリットが多いです。こういったツールは、本当にデータベースに依存した API がマッチするケースでのみ導入すべきです。REST API 定義から GraphQL スキーマを生成するツールもありますが、そもそも両者はデザインコンセプトから異なるものであり、それでよい API ができると考えてはいけません。&lt;/li>
&lt;/ul>
&lt;h3 id="スキーマファーストで実装を進める">スキーマファーストで実装を進める&lt;/h3>
&lt;p>多くのケースでは、スキーマ定義を先に考える &lt;strong>スキーマファースト&lt;/strong> で設計を進めると、サーバーとクライアントを並行して開発することができます。
どのような API を実装すればよいか、どのような情報を取得できるのかが、早い段階で全員に明らかになるからです。&lt;/p></description></item><item><title>GraphQL スキーマの Lint ツール (graphql-schema-linter) を導入する</title><link>https://maku.blog/p/adxcp3g/</link><pubDate>Wed, 21 Dec 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/adxcp3g/</guid><description>&lt;h2 id="graphql-schema-linter-とは">graphql-schema-linter とは？&lt;/h2>
&lt;p>&lt;a href="https://github.com/cjoudrey/graphql-schema-linter">graphql-schema-linter&lt;/a> は、GraphQL スキーマファイル (&lt;code>*.graphqls&lt;/code>) の記述の不備を指摘してくれる Linter です。
スキーマファーストなアプローチで GraphQL サーバー／クライアントを実装している場合は、Linter は早い段階で導入しておくことをお勧めします。&lt;/p>
&lt;h2 id="graphql-schema-linter-のインストール">graphql-schema-linter のインストール&lt;/h2>
&lt;p>&lt;code>graphql-schema-linter&lt;/code> コマンドは、&lt;code>yarn&lt;/code> あるいは &lt;code>npm&lt;/code> でインストールできます。
依存パッケージである &lt;code>graphql&lt;/code> も一緒にインストールする必要があります（&lt;code>package.json&lt;/code> ファイルがない場合は、先に &lt;code>npm init&lt;/code> で作成しておいてください）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">graphql-schema-linter のインストール&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">#&lt;/span> yarn の場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> yarn add --dev graphql graphql-schema-linter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">#&lt;/span> npm の場合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> npm install --save-dev graphql graphql-schema-linter
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>次のように実行できるようになっていれば OK です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">コマンドを実行できるか確認&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> npx graphql-schema-linter --help
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">...（ヘルプ表示）...
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>コマンド名が長いので、npm スクリプトを定義して、&lt;code>yarn lint&lt;/code> だけで実行できるようにしておくと便利です。
最低限の &lt;code>package.json&lt;/code> ファイルは次のような感じになります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">package.json&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;license&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;UNLICENSED&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;scripts&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;lint&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;graphql-schema-linter graph/*.graphqls&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;devDependencies&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;graphql&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;^16.6.0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;graphql-schema-linter&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;^3.0.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="graphql-schema-linter-の実行">graphql-schema-linter の実行&lt;/h2>
&lt;p>前述のような &lt;code>package.json&lt;/code> を定義していれば、&lt;strong>&lt;code>yarn lint&lt;/code>&lt;/strong> でスキーマの lint チェックを実行できます。&lt;/p></description></item><item><title>GraphQL Code Generator でスキーマから TypeScript の型情報を生成する (graphql-codegen)</title><link>https://maku.blog/p/n2k2hxd/</link><pubDate>Mon, 03 Oct 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/n2k2hxd/</guid><description>&lt;h2 id="graphql-code-generator-とは">GraphQL Code Generator とは&lt;/h2>
&lt;p>&lt;strong>GraphQL Code Generator (graphql-codegen)&lt;/strong> は、GraphQL スキーマ (&lt;code>schema.graphqls&lt;/code>) とクエリ用のドキュメント (&lt;code>query {...}&lt;/code>) を入力として与えることで、さまざまな言語とライブラリに対応した型情報を生成するツールです。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.the-guild.dev/graphql/codegen">公式 Web サイト - GraphQL Code Generator&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/dotansimha/graphql-code-generator">GitHub リポジトリ - dotansimha/graphql-code-generator&lt;/a>&lt;/li>
&lt;/ul>


&lt;figure class="xImage">
 &lt;img style="" width="" height="auto" src="../../p/n2k2hxd/img-001.drawio.svg" alt="/p/n2k2hxd/img-001.drawio.svg" />
 &lt;figcaption>図: graphql-codegen の動作概要&lt;/figcaption>
&lt;/figure>

&lt;p>C# や Dart 用のコードも生成できるようですが、ツール自体が NPM パッケージとして提供されているので、やはり TypeScript がメインターゲットですね。
クライアント側で、React + Apollo Client のフレームワークを使用している場合は、Apollo Client のフック API (&lt;code>useQuery&lt;/code>) に渡すためのオブジェクトを生成してくれます。
GraphQL サーバー側のリゾルバー実装に使用する型情報を生成するのにも使用できますが、&lt;a href="https://maku77.github.io/p/v48adgi/">GraphQL サーバーを Golang の gqlgen で作る&lt;/a> 場合などは、スキーマから Golang コードを生成する仕組みがそれ自体に備わっていたりするので、そこではこのツールは使いません。
一方、フロントエンドは React + TypeScript で作ることが比較的多いので、このツールの出番も多くなります。&lt;/p>
&lt;p>入力するスキーマ情報としては、スキーマファイル（&lt;code>schema.graphqls&lt;/code> など）を指定することも、GraphQL サーバーのアドレスを指定して Introspection 機能で取得することもできます。
GraphQL クライアントの開発中は、接続先の GraphQL サーバーも動いているでしょうから、そこから直接スキーマ情報を取得するのは理にかなっています。
例えば、GraphQL サーバー側の Git リポジトリでスキーマファイルを管理している場合、クライアント開発時にこのスキーマファイル自体を共有しなくて済みます。&lt;/p></description></item></channel></rss>