<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>SSH 関連記事 on まくろぐ</title><link>https://maku.blog/p/gwnatcs/</link><description>Recent content in SSH 関連記事 on まくろぐ</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Wed, 31 Jan 2024 00:00:00 +0900</lastBuildDate><atom:link href="https://maku.blog/p/gwnatcs/index.xml" rel="self" type="application/rss+xml"/><item><title>SSH キーの管理: SSH キーを作成する (ssh-keygen)</title><link>https://maku.blog/p/ftducs9/</link><pubDate>Wed, 13 Aug 2008 00:00:00 +0900</pubDate><guid>https://maku.blog/p/ftducs9/</guid><description>&lt;p>SSH (Secure Shell) によるマシン間接続を有効にするには、接続元のマシンで SSH のキーペア（秘密鍵＋公開鍵）を作成し、接続先のマシンに公開鍵を登録する必要があります。
ここでは OpenSSH の &lt;code>ssh-keygen&lt;/code> コマンドを使用した SSH キーの作成方法を紹介します。&lt;/p>
&lt;h2 id="ssh-鍵の作成">SSH 鍵の作成&lt;/h2>
&lt;p>&lt;strong>&lt;code>ssh-keygen&lt;/code>&lt;/strong> コマンドをオプションなしで実行すると、SSH キー（秘密鍵＋公開鍵）を作成できます（SSH プロトコル ver.2 用）。
デフォルトでは暗号アルゴリズムとして RSA を使用するキーが生成されますが、&lt;strong>&lt;code>-t&lt;/code>&lt;/strong> オプションで暗号アルゴリズムを指定することができます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">SSH キーペアの生成&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ssh-keygen -t ed25519 &lt;span class="c1"># Ed25519 鍵を作成する場合&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>&lt;code>-t&lt;/code> オプション&lt;/th>
 &lt;th>アルゴリズム&lt;/th>
 &lt;th>説明&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>&lt;code>rsa&lt;/code>&lt;/td>
 &lt;td>RSA 鍵&lt;/td>
 &lt;td>4096 bits の長い鍵長を選べば強度は出るが遅くなる&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;code>ecdsa&lt;/code>&lt;br>&lt;strong>★おすすめ2&lt;/strong>&lt;/td>
 &lt;td>ECDSA 鍵&lt;/td>
 &lt;td>楕円曲線暗号。少ない鍵長で強度あり。ED25519 より普及している&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;code>ed25519&lt;/code>&lt;br>&lt;strong>★おすすめ1&lt;/strong>&lt;/td>
 &lt;td>Ed25519 鍵&lt;/td>
 &lt;td>楕円曲線暗号。少ない鍵長で強度あり。ECDSA より高速&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;code>dsa&lt;/code>&lt;/td>
 &lt;td>DSA 鍵&lt;/td>
 &lt;td>（非推奨）SSH2 の環境で使えるが、1024 bits しか選べないことが多い&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;code>rsa1&lt;/code>&lt;/td>
 &lt;td>RSA1 鍵&lt;/td>
 &lt;td>（非推奨）SSH1 のレガシー環境用。強度が弱いので使わない方がよい&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;p>実際に &lt;code>ssh-keygen&lt;/code> コマンドを実行すると、パスワード (passphrase) の入力を求められるので、秘密鍵を使用する際のパスワードを設定しておきます。
このパスワードは、&lt;code>ssh&lt;/code> コマンドでリモートホストに接続する際に入力することになります。
パスワード入力時に、何も入力せずに &lt;key>Enter&lt;/key> を入力すれば、パスワードなしの SSH キーを生成できますが、通常はパスワードを設定してください。&lt;/p></description></item><item><title>SSH キーの管理: Windows で SSH の秘密鍵のパーミッションエラーが出る場合</title><link>https://maku.blog/p/ret8kky/</link><pubDate>Wed, 31 Jan 2024 00:00:00 +0900</pubDate><guid>https://maku.blog/p/ret8kky/</guid><description>&lt;p>Windows から SSH 接続するときに、次のような秘密鍵（プライベートキー）のパーミッションエラーが出ることがあります。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Windows 上での SSH 接続時の秘密鍵エラー&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">D:\&amp;gt; ssh -i D:\temp\private.key maku@example.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Permissions for &amp;#39;D:\\temp\\private.key&amp;#39; are too open.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">It is required that your private key files are NOT accessible by others.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">This private key will be ignored.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Load key &amp;#34;D:\\temp\\private.key&amp;#34;: bad permissions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">maku@example.com&amp;#39;s password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">（↑ SSH キーではなくユーザーパスワードでの接続にフォールバックされてしまう）&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>このエラーは、秘密鍵のパーミッションがカレントユーザーのみのアクセスに絞られていないときに発生します。
下記のいずれかの方法で解決できます。&lt;/p>
&lt;ul>
&lt;li>（方法1）秘密鍵を &lt;strong>%USERPFOFILE%&lt;/strong> ディレクトリ以下に格納する
&lt;ul>
&lt;li>SSH 秘密鍵を &lt;code>C:\Users\maku\.ssh\private.key&lt;/code> のようなパスに配置するだけで OK です。&lt;/li>
&lt;li>ユーザーディレクトリに配置したファイルはカレントユーザーしか参照できないので、パーミッションのエラーが出なくなります。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>（方法2）秘密鍵のパーミッション情報を変更する
&lt;ul>
&lt;li>
&lt;p>コマンドプロンプトから &lt;strong>&lt;code>icacls&lt;/code>&lt;/strong> コマンドを使って SSH 秘密鍵のアクセス権を変更します。&lt;/p>
&lt;pre tabindex="0">&lt;code>icacls .\private.key /inheritance:r
icacls .\private.key /grant:r &amp;#34;%USERNAME%:R&amp;#34;
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>&lt;code>icacls&lt;/code> コマンド (Integrity Control Access Control List) は、Windows コマンドプロンプトおよび PowerShell で使用できるコマンドラインツールで、ファイルやディレクトリのアクセス制御リスト (ACL) を変更するために使用されます（ファイル自体の内容が変更されるわけではありません）。
上記のように実行することで、秘密鍵ファイルの読み込み権限をカレントユーザーのみに制限できます。&lt;/p></description></item><item><title>SSH キーの管理: SSH キーのコメントを確認する／変更する (ssh-keygen -c)</title><link>https://maku.blog/p/o3m4j2h/</link><pubDate>Thu, 24 Nov 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/o3m4j2h/</guid><description>&lt;h2 id="ssh-鍵ファイルのコメントを確認する">SSH 鍵ファイルのコメントを確認する&lt;/h2>
&lt;p>OpenSSH の &lt;a href="../../p/ftducs9/">&lt;code>ssh-keygen&lt;/code> コマンド&lt;/a> で生成した SSH キーペア（秘密鍵＋公開鍵）には、デフォルトで &lt;strong>&lt;code>ユーザー名@ホスト名&lt;/code>&lt;/strong> という形のコメントが付加されます。
このコメントは、公開鍵ファイル (&lt;code>~/.ssh/id_XXX.pub&lt;/code>) の末尾を見ると確認できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">~/.ssh/id_ed25519.pub&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">ssh-ed25519 AAA3NzaC1AA...省略...COst+87ciWFY maku@macbook.local&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>あるいは、&lt;strong>&lt;code>ssh-keygen -l&lt;/code>&lt;/strong> コマンドで確認することもできます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">SSH キーの内容を確認&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ssh-keygen -l -f ~/.ssh/id_ed25519
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">256 SHA256:vd6Ab577wzS6/so1BR1zGP8r7br0smWV4Wklw28Rre0 maku@macbook.local (ED25519)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="ssh-鍵ファイルのコメントを設定する">SSH 鍵ファイルのコメントを設定する&lt;/h2>
&lt;p>SSH キーのコメントは、キーの作成時に &lt;strong>&lt;code>-C&lt;/code>&lt;/strong> オプションで自由に設定できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">SSH キーの作成時にコメントを設定&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ssh-keygen -t ed25519 -C &lt;span class="s2">&amp;#34;your_email@example.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>既存の SSH キーのコメントを修正するには、&lt;strong>&lt;code>ssh-keygen -c&lt;/code>&lt;/strong> コマンドを使用します。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">SSH キーのコメントを変更&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ssh-keygen -c -C &lt;span class="s2">&amp;#34;新しいコメント&amp;#34;&lt;/span> -f ~/.ssh/id_ed25519
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>オプションの大文字と小文字に注意してください。
最初は小文字 (&lt;code>-c&lt;/code>) で、後ろは大文字 (&lt;code>-C&lt;/code>) です。&lt;/p></description></item><item><title>SSH キーの管理: SSH キーのパスワードを変更する (ssh-keygen -p)</title><link>https://maku.blog/p/as2ahpw/</link><pubDate>Thu, 24 Nov 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/as2ahpw/</guid><description>&lt;p>既存の SSH キー（秘密鍵）のパスワード（パスフレーズ）を変更するには、&lt;strong>&lt;code>ssh-keygen -p&lt;/code>&lt;/strong> コマンドを使用します。&lt;/p>
&lt;pre tabindex="0">&lt;code>$ ssh-keygen -p [-a rounds] [-f keyfile] [-m format] [-N new_passphrase] [-P old_passphrase]
&lt;/code>&lt;/pre>&lt;p>変更する SSH キーのファイルパス (&lt;code>-f&lt;/code>) や、旧パスワード (&lt;code>-P&lt;/code>)、新パスワード (&lt;code>-N&lt;/code>) をオプションで指定することもできますが、次のようにオプションなしで実行すれば、対話的に変更内容を入力していけます。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ssh-keygen -p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Enter file in which the key is (/Users/maku/.ssh/id_rsa):
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Enter old passphrase: ********
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Key has comment &amp;#39;maku@macbook.local&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Enter new passphrase (empty for no passphrase): ********
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Enter same passphrase again: ********
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Your identification has been saved with the new passphrase.
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>パスワードはオプションで指定すると入力内容が見えてしまうので、上記のように対話的に入力した方がよいでしょう。&lt;/p></description></item><item><title>SSH キーの管理: SSH キーの種類やフィンガープリントを確認する (ssh-keygen -l)</title><link>https://maku.blog/p/m2k4j2h/</link><pubDate>Thu, 24 Nov 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/m2k4j2h/</guid><description>&lt;p>作成済みの SSH 鍵ファイルの種類（暗号アルゴリズム）やフィンガープリントを確認したいときは、&lt;strong>&lt;code>ssh-keygen -l&lt;/code>&lt;/strong> コマンドを使用します。
&lt;code>-f&lt;/code> オプションで指定する鍵ファイルのパスは、秘密鍵でも公開鍵でも構いません。
次の例では、OpenSSH の &lt;code>ssh-keygen&lt;/code> コマンドで作成したさまざまな種類の SSH キーの内容を表示しています。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ssh-keygen -l -f ~/.ssh/id_ed25519.pub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">256 SHA256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx yourname@example.com (ED25519)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> ssh-keygen -l -f ~/.ssh/id_ecdsa.pub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">256 SHA256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx yourname@example.com (ECDSA)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> ssh-keygen -l -f ~/.ssh/id_rsa.pub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">2048 SHA256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx yourname@example.com (RSA)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">$&lt;/span> ssh-keygen -l -f ~/.ssh/id_dsa.pub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">1024 SHA256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx yourname@example.com (DSA)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>各フィールドは、「鍵のビット長」「フィンガープリント」「コメント」「暗号アルゴリズム」を示しています。&lt;/p>
&lt;p>Windows PC の場合は、&lt;code>~/.ssh&lt;/code> の部分は &lt;code>%USERPROFILE%\.ssh&lt;/code> と読みかえてください。&lt;/p></description></item><item><title>SSH キーの管理: SSH の接続先ごとにキーを使い分ける (~/.ssh/config)</title><link>https://maku.blog/p/szajt4d/</link><pubDate>Sun, 17 Jul 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/szajt4d/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>SSH 鍵を使って複数の SSH サーバーに接続する場合、1 つの SSH 鍵ファイルを使い回すこともできますが、場合によっては SSH サーバーごと（SSH ユーザーごと）に鍵ファイルを使い分けたいこともあるかもしれません。
ここでは、SSH サーバーごとの SSH キーを用意する方法を説明します。&lt;/p>
&lt;h2 id="鍵ファイルを作成する">鍵ファイルを作成する&lt;/h2>
&lt;p>例えば、&lt;a href="https://px.a8.net/svt/ejp?a8mat=3NCT8C+FN831U+50+4YR6O2" rel="nofollow">ConoHa VPS&lt;/a>
&lt;img border="0" width="1" height="1" src="https://www11.a8.net/0.gif?a8mat=3NCT8C+FN831U+50+4YR6O2" alt="">
 に &lt;code>maku&lt;/code> というユーザーで SSH 接続するための SSH キーを作成するとします。
一般的に SSH のキーペアは &lt;code>~/.ssh&lt;/code> ディレクトリ以下に保存しますが、次のような感じで接続先ごとにディレクトリ (&lt;code>&amp;lt;接続先&amp;gt;-&amp;lt;ユーザー&amp;gt;&lt;/code>) を作ると管理しやすくなります（ファイル名で表現することもできます）。&lt;/p>
&lt;ul>
&lt;li>&lt;code>~/.ssh/conoha-maku/id_rsa&lt;/code> &amp;hellip; 秘密鍵&lt;/li>
&lt;li>&lt;code>~/.ssh/conoha-maku/id_rsa.pub&lt;/code> &amp;hellip; 公開鍵&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">#&lt;/span> SSH キーペア用のディレクトリを作成
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> mkdir -p -m &lt;span class="m">0700&lt;/span> ~/.ssh/conoha-maku
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="gp">#&lt;/span> SSH キーペアを作成
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ssh-keygen -t rsa -f ~/.ssh/conoha-maku/id_rsa
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="公開鍵を-ssh-サーバーに登録">公開鍵を SSH サーバーに登録&lt;/h2>
&lt;p>SSH キーで SSH 接続するには、接続先の SSH サーバーの &lt;code>~/.ssh/authorized_keys&lt;/code> に公開鍵を登録しておく必要があります。
この作業は、&lt;code>ssh-copy-id&lt;/code> コマンドを使うと簡単に済ませられます（参考: &lt;a href="../../p/2mzbmw8/">ssh-id-copy で SSH の公開鍵をリモートホストに登録する&lt;/a>）。&lt;/p></description></item><item><title>SSH サーバー (sshd) の起動・停止・再起動方法まとめ</title><link>https://maku.blog/p/9gs3cmu/</link><pubDate>Sun, 17 Jul 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/9gs3cmu/</guid><description>&lt;p>各 OS（ディストリビューション）で SSH サーバーを起動・停止するときのコマンドのまとめです。&lt;/p>
&lt;h2 id="debian-系-ubuntudebian">Debian 系 (Ubuntu/Debian)&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Ubuntu 15.04 以降&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo systemctl start ssh （起動）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo systemctl stop ssh （停止）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo systemctl restart ssh （再起動）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo systemctl reload ssh （設定リロード）
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">Ubuntu 14.10 以前&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo service ssh start （起動）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo service ssh stop （停止）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo service ssh restart （再起動）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo service ssh reload （設定リロード）
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ ssh でも sshd でも OK&lt;/span>
 &lt;span class="xNote_body">&lt;code>/lib/systemd/system/ssh.service&lt;/code> ファイルに、エイリアスとして &lt;code>sshd.service&lt;/code> が定義されています。
なので、上記コマンドの &lt;code>ssh&lt;/code> の部分は &lt;code>sshd&lt;/code> としても動作します。
サービス名のサフィックス (&lt;code>.service&lt;/code>) はほとんどのケースで省略できます。&lt;/span>
&lt;/div>
&lt;h2 id="red-hat-系-rhelfedoracentosrocky-linux">Red Hat 系 (RHEL/Fedora/CentOS/Rocky Linux)&lt;/h2>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">CentOS 7.x/8.x&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl"># systemctl start sshd.service （起動）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># systemctl stop sshd.service （停止）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># systemctl restart sshd.service （再起動）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># systemctl reload sshd.service （設定リロード）&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">CentOS 4.x/5.x/6.x&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl"># service sshd start （起動）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># service sshd stop （停止）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># service sshd restart （再起動）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># service sshd reload （設定リロード）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># /etc/init.d/sshd start （起動）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># /etc/init.d/sshd stop （停止）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># /etc/init.d/sshd restart （再起動）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># /etc/init.d/sshd reload （設定リロード）&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="freebsd--openbsd">FreeBSD / OpenBSD&lt;/h2>
&lt;pre tabindex="0">&lt;code># /etc/rc.d/sshd start （起動）
# /etc/rc.d/sshd stop （停止）
# /etc/rc.d/sshd restart （再起動）
# /etc/rc.d/sshd reload （設定リロード）
&lt;/code>&lt;/pre></description></item><item><title>SSH サーバー (sshd) 設定のベストプラクティス</title><link>https://maku.blog/p/42cmu5d/</link><pubDate>Sun, 17 Jul 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/42cmu5d/</guid><description>&lt;h2 id="これは何">これは何？&lt;/h2>
&lt;p>SSH をできるだけ安全に使うための sshd（OpenSSH サーバー）の設定方法です。&lt;/p>
&lt;p>sshd の設定は、&lt;strong>&lt;code>/etc/ssh/sshd_config&lt;/code>&lt;/strong> ファイルで行います。
&lt;code>sudo&lt;/code> などで設定ファイルを編集後、sshd サービスにリロード要求することで反映できます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">典型的な sshd の設定変更手順&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo vim /etc/ssh/sshd_config &lt;span class="c1"># エディタで設定を変更&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> sudo systemctl reload ssh &lt;span class="c1"># sshd を再起動&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;ul>
&lt;li>参考: &lt;a href="../../p/9gs3cmu/">SSH サーバー (sshd) の起動・停止・再起動方法まとめ&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>sshd&lt;/code> の再起動や設定のリロードを行っても、作業中の SSH 接続が切れることはありません。
設定変更後は、別のターミナルから接続できることを確認してから、作業用の SSH 接続をクローズするようにしましょう。&lt;/p>
&lt;h2 id="root-ユーザーでの接続を拒否する-permitrootlogin">root ユーザーでの接続を拒否する (PermitRootLogin)&lt;/h2>
&lt;p>&lt;strong>&lt;code>PermitRootLogin&lt;/code>&lt;/strong> を &lt;code>no&lt;/code> に設定することで、このサーバーには &lt;code>root&lt;/code> ユーザーで SSH 接続することができなくなります（&lt;code>ssh root@example.com&lt;/code> できなくなる）。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">/etc/ssh/sshd_config&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">PermitRootLogin no&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>管理者権限での作業が必要な場合は、一般ユーザーでの接続後に &lt;code>sudo&lt;/code> 実行することになります。
&lt;code>root&lt;/code> ユーザーで直接 SSH 接続できるようになっていると、悪意のあるユーザーによるパスワード総当たり攻撃を許してしまうことになります。
後述の &lt;code>PasswordAuthentication&lt;/code> 設定でパスワードによる認証を拒否している場合でも、&lt;code>root&lt;/code> ユーザーでの直接接続は避けるべきです。
なぜなら、いきなり &lt;code>root&lt;/code> ユーザーで接続してしまうと、実際に誰が &lt;code>root&lt;/code> 接続して作業したのかをログから判別できなくなってしまうからです。
一般ユーザーでログインして &lt;code>sudo&lt;/code> することを強制しておけば、誰が管理者権限でコマンド実行したのかをログから確認することができます (&lt;code>sudo grep COMMAND /var/log/auth.log&lt;/code>)。&lt;/p></description></item><item><title>SSH キーの管理: ssh-id-copy で SSH の公開鍵をリモートホストに登録する</title><link>https://maku.blog/p/2mzbmw8/</link><pubDate>Thu, 17 Feb 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/2mzbmw8/</guid><description>&lt;h2 id="ssh-id-copy-とは">ssh-id-copy とは&lt;/h2>
&lt;p>SSH で公開鍵認証方式を使ってリモートホストに接続するには、リモートホスト側の &lt;code>~/.ssh/authorized_keys&lt;/code> ファイルに公開鍵を書き込んでおく必要がありますが、&lt;a href="https://manpages.ubuntu.com/manpages/en/man1/ssh-copy-id.1.html">ssh-copy-id&lt;/a> コマンドを使うと、この作業を一撃で済ますことができます。
&lt;code>ssh-copy-id&lt;/code> コマンドは Linux 環境であれば標準でインストールされているはずです。&lt;/p>
&lt;p>&lt;strong>前提条件として、接続先ホストにパスワード認証で SSH 接続できる状態&lt;/strong> にしておく必要があります。
公開鍵の内容をコピーする段階では、まだ SSH キーを使った接続ができないからです。
例えば、次のような感じで、接続先ホストに登録されている「ユーザー名」と「ユーザーパスワード」のペアで接続できるようになっていれば OK です。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">パスワード認証で接続できるか確認&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ssh maku@192.168.1.20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">maku@192.168.1.20&amp;#39;s password: （接続先ホストのユーザー maku のパスワードを入力）
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>本記事の作業が完了すれば、SSH 接続時に「ユーザーパスワード」を送信する必要はなくなり、代わりに「SSH 秘密鍵」を使って接続できるようになります。
SSH 秘密鍵のパスフレーズを入力する必要があるかもしれませんが、このパスフレーズがネットワーク上に流れることはないので安全です。&lt;/p>
&lt;h2 id="必要があれば鍵ファイルの作成-ssh-keygen">（必要があれば）鍵ファイルの作成 (ssh-keygen)&lt;/h2>
&lt;p>接続元のマシンに次のような秘密鍵＆公開鍵のペアが存在しないときは、&lt;a href="../../p/ftducs9/">ssh-keygen コマンドなどで作成&lt;/a>しておきます。&lt;/p>
&lt;ul>
&lt;li>&lt;code>~/.ssh/id_rsa&lt;/code> &amp;hellip; 秘密鍵&lt;/li>
&lt;li>&lt;code>~/.ssh/id_rsa.pub&lt;/code> &amp;hellip; 公開鍵（これをリモートホストに登録します）&lt;/li>
&lt;/ul>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">秘密鍵と公開鍵を生成する&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> ssh-keygen
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Generating public/private rsa key pair.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Enter file in which to save the key (/Users/maku/.ssh/id_rsa): （このパスでよければ Enter）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Enter passphrase (empty for no passphrase): （鍵のパスワードを入力）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Enter same passphrase again: （パスワードを再入力）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Your identification has been saved in /Users/maku/.ssh/id_rsa.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Your public key has been saved in /Users/maku/.ssh/id_rsa.pub.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">The key fingerprint is:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">SHA256:hmOfShQhPstmuGyB3qj0wpdosKXD82ibJs+7Jsb+wSl maku@makumac.local
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">The key&amp;#39;s randomart image is:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">+---[RSA 3072]----+
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">| |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">| |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">|o.* * . |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">|O O O = S |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">|o . . . |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">|.@ o * . . |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">|oB * B o |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">| *E+o+ |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">|++oOOo |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">+----[SHA256]-----+
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="リモートホストに公開鍵を登録する-ssh-copy-id">リモートホストに公開鍵を登録する (ssh-copy-id)&lt;/h2>
&lt;p>公開鍵の準備ができたら、&lt;code>ssh-copy-id&lt;/code> コマンドでリモートホストの &lt;code>~/.ssh/authorized_keys&lt;/code> に書き込みます。
最初は、&lt;strong>&lt;code>-n&lt;/code>&lt;/strong> オプションをつけて &lt;strong>dry-run 実行&lt;/strong> してみるのがよいです。
実際には実行されませんが、どの公開鍵が登録されるかを確認できます。&lt;/p></description></item></channel></rss>