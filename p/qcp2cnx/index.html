<!doctype html><html lang=ja-jp><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Apollo Client で GitHub GraphQL API を使う (Node & React)｜まくろぐ</title>
<link rel=stylesheet href=../../css/main.min.1b08373a67e56e3d90adb51bb188f808b107b0892c25e62a2340b390420eacdf.css><script src=../../assets/js/sidebar.js defer></script><style>.codoc-support{display:inline-block;margin:.5rem 0 0!important;padding:12px!important;width:210px!important;max-width:100%}.codoc-support .codoc-support-title{font-size:smaller!important;white-space:nowrap;margin-bottom:12px!important}.codoc-support .codoc-btn{width:180px!important}</style><script src=https://codoc.jp/js/cms.js data-css=black data-usercode=tp6ZPzTj3w defer></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-V7PSCLD1ML"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-V7PSCLD1ML")</script><link rel=icon sizes="16x16 32x32 48x48 64x64" href=../../assets/img/favicon/favicon.ico><link rel=icon sizes=192x192 href=../../assets/img/favicon/192x192.png><link rel=apple-touch-icon href=../../assets/img/favicon/180x180.png><meta name=twitter:card content="summary"><meta property="og:site_name" content="まくろぐ"><meta property="og:title" content="Apollo Client で GitHub GraphQL API を使う (Node & React)"><meta property="og:type" content="article"><meta property="og:url" content="https://maku.blog/p/qcp2cnx/"><meta property="og:locale" content="ja_JP"><meta property="og:image" content="https://maku.blog/img/site-logo.png"><meta property="og:image:width" content="1436"><meta property="og:image:height" content="746"><meta property="og:description" content="Apollo Client とは Apollo パッケージは、GraphQL を使ったクライアントアプリやサーバーを作成するためのライブラリ群です。 クライアントアプリを作るためのライブラリは、Apollo Client として @apollo/client という NPM パッケージにまとめられています。
Web アプリのコンポーネントを作成するときは React がよく使われますが、Apollo は GraphQL を扱いやすくする React コンポーネント（ApolloProvider、Query、Mutation、Subscription）や React Hook 拡張（useQuery) などを提供しています。
ここでは、Apollo Client パッケージを使用して、
Node.js アプリ（コマンドラインアプリの JS）から GraphQL API の実行 React アプリ（Web サイトの JS）から GraphQL API の実行 を行ってみます。 呼び出す GraphQL API は何でもよいのですが、今回は GitHub GraphQL API を利用することにします。
Node パッケージのインストール Apollo Client Apollo Client 関連のパッケージとしては、@apollo/client と、それが使用する graphql をインストールします。
Apollo Client のインストール ### yarn の場合 $ yarn add @apollo/client graphql ### npm の場合 $ npm install @apollo/client graphql fetch ポリフィル Apollo クライアント内部の実装では、Web ブラウザの fetch API を利用しています。 React アプリから Apollo クライアントを利用する場合は問題ないのですが、コンソールで動作する Node."><meta property="fb:app_id" content="1572235596285254"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6317852277883092" crossorigin=anonymous></script><link rel=stylesheet href=../../css/mm/all.min.0620ddba302e0cbda0c31be8ea28d1990131c49dc5f36144be3a2fb4fe6c9884.css></head><body><div id=xRoot><div id=xSiteHeader><a href=../../>まくろぐ</a></div><aside><div class=xBreadcrumb><span class=xBreadcrumb_item><a href=../../>&#x1F3E0;</a>
</span><span class=xBreadcrumb_item><a href=../../p/3ftx6b2/>技術系</a>
</span><span class=xBreadcrumb_item><a href=../../p/5q4fr3d/>GitHub</a>
</span><span class=xBreadcrumb_item>Apollo Client で GitHub GraphQL API を使う (Node & React)</span></div></aside><div id=xContainer><nav id=xMenu aria-label=メニュー><div id=sidebar style=height:100%><div id=sidebar_notFixed><a href=../../><img src=https://maku.blog/img/site-logo-sidebar.png alt=サイトロゴ></a><div class=xMenu_box data-sticky><form action=https://cse.google.com/cse target=_blank><div class=xSearchBox><input type=hidden name=cx value=partner-pub-6317852277883092:6890083468>
<input type=hidden name=ie value=UTF-8>
<input type=search name=q placeholder=サイト内検索 size=30 autocomplete=off>
<input type=submit value=検索></div></form><div class=xMenu_box_body></div></div><div class=xMenu_box data-sticky><h3 class=xMenu_box_title><a href=../../latest/>新着</a></h3><div class=xMenu_box_body><div class=xBoxLink><a href=../../p/cxuuci5/>ドラクエ 3（HD-2D リメイク）やり込み完了
<time>2024-12-27</time></a></div><div class=xBoxLink><a href=../../p/t4ontr2/>ドラクエ 3 はやっぱり面白い（ドラゴンクエストIII HD-2D リメイク）
<time>2024-11-17</time></a></div><div class=xBoxLink><a href=../../p/2m7krmb/>統計メモ: ポアソン分布について
<time>2024-11-16</time></a></div><div class=xBoxLink><a href=../../p/y2gu9vz/>数学メモ: 母集団の推測方法のまとめ
<time>2024-11-13</time></a></div><div class=xBoxLink><a href=../../p/n597k8j/>数学メモ: 統計で使う用語のまとめ（分散や標準偏差など）
<time>2024-11-12</time></a></div></div></div><div class=xMenu_box data-sticky><h3 class=xMenu_box_title><a href=../../sitemap/>フォルダ</a></h3><div class=xMenu_box_body><div class=xNavTree><ul><li><a class=xNavTree-dir href=../../p/qb73pxx/>日記・コラム</a><li><a class=xNavTree-dir href=../../p/tsjyzrn/>雑多</a><li><a class=xNavTree-dir href=../../p/3ftx6b2/>技術系</a><ul><li><a class=xNavTree-dir href=../../p/ujqinda/>プログラミング</a><li><a class=xNavTree-dir href=../../p/vrhjtds/>Azure</a><li><a class=xNavTree-dir href=../../p/inh3k2j/>Visual Studio Code</a><li><a class=xNavTree-dir href=../../p/td962u6/>Svelte</a><li><a class=xNavTree-dir href=../../p/7ipkgyk/>機械学習／ディープラーニング</a><li><a class=xNavTree-dir href=../../p/y42o4hw/>Windows</a><li><a class=xNavTree-dir href=../../p/nd3cmt3/>ネットワーク</a><li><a class=xNavTree-dir href=../../p/ndbcxgb/>Meilisearch</a><li><a class=xNavTree-dir href=../../p/xdsom3a/>Nginx（Web サーバー）</a><li><a class=xNavTree-dir href=../../p/e58h5in/>雑多な技術メモ</a><li><a class=xNavTree-dir href=../../p/j3fmwym/>D3.js</a><li><a class=xNavTree-dir href=../../p/ruk3gu9/>Linux</a><li><a class=xNavTree-dir href=../../p/fsancxy/>SVG</a><li><a class=xNavTree-dir href=../../p/669r7r2/>Astro</a><li><a class=xNavTree-dir href=../../p/y29x85e/>Terraform</a><li><a class=xNavTree-dir href=../../p/7s7hs4e/>AWS</a><li><a class=xNavTree-dir href=../../p/c9sar9p/>Cloudflare</a><li><a class=xNavTree-dir href=../../p/cm9nyco/>GraphQL</a><li><a class=xNavTree-dir href=../../p/dj28oy5/>Docker 関連メモ</a><li><a class=xNavTree-dir href=../../p/8t6hr3d/>Ansible</a><li><a class=xNavTree-dir href=../../p/5q4fr3d/>GitHub</a><ul><li><a class=xNavTree-dir href=../../p/ubkahpw/>GitHub GraphQL API のクエリ例</a></ul><li><a class=xNavTree-dir href=../../p/9xv5548/>Jekyll</a><li><a class=xNavTree-dir href=../../p/6p3dox9/>Firebase</a><li><a class=xNavTree-dir href=../../p/somcgdw/>macOS</a><li><a class=xNavTree-dir href=../../p/jto2isn/>HTML/CSS のメモ</a><li><a class=xNavTree-dir href=../../p/ibs96hs/>フォント/文字コード/Locale/Unicode</a><li><a class=xNavTree-dir href=../../p/xb5w4in/>デザインパターン/UML</a><li><a class=xNavTree-dir href=../../p/zbgbb5u/>PlantUML</a><li><a class=xNavTree-dir href=../../p/jxvi6vv/>Excel のメモ</a></ul><li><a class=xNavTree-dir href=../../p/ajj5753/>遊び</a><li><a class=xNavTree-dir href=../../p/35odek9/>読書</a><li><a class=xNavTree-dir href=../../p/zb9ocav/>ツール</a><li><a class=xNavTree-dir href=../../p/syy4ryp/>設定</a><li><a class=xNavTree-dir href=../../p/hnoamfo/>管理人</a></ul></div></div></div><div class=xMenu_box data-sticky><h3 class=xMenu_box_title><a href=../../tags/>タグ</a></h3><div class=xMenu_box_body><div id=local-tag-container><div class=xMenu_tag><a href=../../tags/%E8%AA%AD%E6%9B%B8/>読書 (84)</a></div><div class=xMenu_tag><a href=../../tags/aws/>AWS (62)</a></div><div class=xMenu_tag><a href=../../tags/%E6%97%A5%E8%A8%98/>日記 (60)</a></div><div class=xMenu_tag><a href=../../tags/typescript/>TypeScript (59)</a></div><div class=xMenu_tag><a href=../../tags/azure/>Azure (58)</a></div><div class=xMenu_tag><a href=../../tags/next.js/>Next.js (38)</a></div><div class=xMenu_tag><a href=../../tags/graphql/>GraphQL (35)</a></div><div class=xMenu_tag><a href=../../tags/react/>React (30)</a></div><div class=xMenu_tag><a href=../../tags/chatbot/>Chatbot (28)</a></div><div class=xMenu_tag><a href=../../tags/linux/>Linux (28)</a></div><div class=xMenu_tag><a href=../../tags/gnuplot/>gnuplot (27)</a></div><div class=xMenu_tag><a href=../../tags/aws/cdk/>AWS/CDK (26)</a></div><div class=xMenu_tag><a href=../../tags/github/>GitHub (24)</a></div><div class=xMenu_tag><a href=../../tags/d3.js/>D3.js (23)</a></div><div class=xMenu_tag><a href=../../tags/ansible/>Ansible (21)</a></div><div class=xMenu_tag><a href=../../tags/bot-builder-sdk/>Bot Builder SDK (21)</a></div><div class=xMenu_tag><a href=../../tags/svelte/>Svelte (20)</a></div><div class=xMenu_tag><a href=../../tags/node.js/>Node.js (19)</a></div><div class=xMenu_tag><a href=../../tags/%E6%95%B0%E5%AD%A6/>数学 (19)</a></div><div class=xMenu_tag><a href=../../tags/aws/dynamodb/>AWS/DynamoDB (18)</a></div><div class=xMenu_tag><a href=../../tags/mongodb/>MongoDB (18)</a></div><div class=xMenu_tag><a href=../../tags/aws/cloudformation/>AWS/CloudFormation (16)</a></div><div class=xMenu_tag><a href=../../tags/electron/>Electron (15)</a></div><div class=xMenu_tag><a href=../../tags/vs-code/>VS Code (15)</a></div><div class=xMenu_tag><a href=../../tags/%E3%82%B2%E3%83%BC%E3%83%A0/>ゲーム (15)</a></div><div class=xMenu_tag><a href=../../tags/aws/cognito/>AWS/Cognito (14)</a></div><div class=xMenu_tag><a href=../../tags/protocol-buffers/>Protocol Buffers (14)</a></div><div class=xMenu_tag><a href=../../tags/javascript/>JavaScript (13)</a></div><div class=xMenu_tag><a href=../../tags/nginx/>nginx (13)</a></div><div class=xMenu_tag><a href=../../tags/python/>Python (12)</a></div><div class=xMenu_tag><a href=../../tags/%E3%83%93%E3%83%AA%E3%83%A4%E3%83%BC%E3%83%89/>ビリヤード (11)</a></div><div class=xMenu_tag><a href=../../tags/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0/>プログラム (11)</a></div><div class=xMenu_tag><a href=../../tags/android/>Android (10)</a></div><div class=xMenu_tag><a href=../../tags/aws/lambda/>AWS/Lambda (10)</a></div><div class=xMenu_tag><a href=../../tags/ssh/>SSH (10)</a></div><div class=xMenu_tag><a href=../../tags/svg/>SVG (10)</a></div><div class=xMenu_tag><a href=../../tags/cheatsheet/>チートシート／リファレンス (9)</a></div><div class=xMenu_tag><a href=../../tags/deno/>Deno (9)</a></div><div class=xMenu_tag><a href=../../tags/docker/>Docker (9)</a></div><div class=xMenu_tag><a href=../../tags/java/>Java (9)</a></div><div class=xMenu_tag><a href=../../tags/uml/>UML (9)</a></div><div class=xMenu_tag><a href=../../tags/%E3%82%BB%E3%83%9F%E3%83%8A%E3%83%BC%E8%AC%9B%E6%BC%94%E4%BC%9A/>セミナー／講演会 (9)</a></div><div class=xMenu_tag><a href=../../tags/3d/>3D (8)</a></div><div class=xMenu_tag><a href=../../tags/aws/sam/>AWS/SAM (8)</a></div><div class=xMenu_tag><a href=../../tags/firebase/firestore/>Firebase/Firestore (8)</a></div><div class=xMenu_tag><a href=../../tags/unity/>Unity (8)</a></div><div class=xMenu_tag><a href=../../tags/webgl/>WebGL (8)</a></div><div class=xMenu_tag><a href=../../tags/%E3%82%A2%E3%82%A4%E3%83%87%E3%82%A2/>アイデア (8)</a></div><div class=xMenu_tag><a href=../../tags/%E4%BB%95%E4%BA%8B/>仕事 (8)</a></div><div class=xMenu_tag><a href=../../tags/apollo/>Apollo (7)</a></div><div class=xMenu_tag><a href=../../tags/azure-cli/>Azure CLI (7)</a></div><div class=xMenu_tag><a href=../../tags/azure-pipelines/>Azure Pipelines (7)</a></div><div class=xMenu_tag><a href=../../tags/jade/>Jade (7)</a></div><div class=xMenu_tag><a href=../../tags/material-ui/>Material-UI (7)</a></div><div class=xMenu_tag><a href=../../tags/%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3/>デザインパターン (7)</a></div><div class=xMenu_tag><a href=../../tags/%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF/>ネットワーク (7)</a></div><div class=xMenu_tag><a href=../../tags/%E3%83%A9%E3%82%A4%E3%83%95%E3%83%8F%E3%83%83%E3%82%AF/>ライフハック (7)</a></div><div class=xMenu_tag><a href=../../tags/%E6%8A%80%E8%A1%93/>技術 (7)</a></div><div class=xMenu_tag><a href=../../tags/aws/api-gateway/>AWS/API Gateway (6)</a></div><div class=xMenu_tag><a href=../../tags/aws/cli/>AWS/CLI (6)</a></div><div class=xMenu_tag><a href=../../tags/azure-storage/>Azure Storage (6)</a></div><div class=xMenu_tag><a href=../../tags/doxygen/>Doxygen (6)</a></div><div class=xMenu_tag><a href=../../tags/firebase/cloudfunctions/>Firebase/CloudFunctions (6)</a></div><div class=xMenu_tag><a href=../../tags/%E3%83%84%E3%83%BC%E3%83%AB/>ツール (6)</a></div><div class=xMenu_tag><a href=../../tags/%E3%83%A6%E3%83%8B%E3%83%83%E3%83%88%E3%83%86%E3%82%B9%E3%83%88/>ユニットテスト (6)</a></div><div class=xMenu_tag><a href=../../tags/azure-table-storage/>Azure Table Storage (5)</a></div><div class=xMenu_tag><a href=../../tags/c/c++/>C/C++ (5)</a></div><div class=xMenu_tag><a href=../../tags/github-actions/>GitHub Actions (5)</a></div><div class=xMenu_tag><a href=../../tags/luis/>LUIS (5)</a></div><div class=xMenu_tag><a href=../../tags/ml/>機械学習/ディープラーニング (5)</a></div><div class=xMenu_tag><a href=../../tags/qna-maker/>QnA Maker (5)</a></div><div class=xMenu_tag><a href=../../tags/security/>security (5)</a></div><div class=xMenu_tag><a href=../../tags/%E3%81%8A%E7%B5%B5%E3%81%8B%E3%81%8D/>お絵かき (5)</a></div><div class=xMenu_tag><a href=../../tags/%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3/>セキュリティ (5)</a></div><div class=xMenu_tag><a href=../../tags/%E6%8A%95%E8%B3%87/>投資 (5)</a></div><div class=xMenu_tag><a href=../../tags/%E7%94%9F%E3%81%8D%E6%96%B9/>生き方 (5)</a></div><div class=xMenu_tag><a href=../../tags/aws/ssm/>AWS/SSM (4)</a></div><div class=xMenu_tag><a href=../../tags/eslint/>ESLint (4)</a></div><div class=xMenu_tag><a href=../../tags/firebase/>Firebase (4)</a></div><div class=xMenu_tag><a href=../../tags/github-pages/>GitHub Pages (4)</a></div><div class=xMenu_tag><a href=../../tags/html/css/>HTML/CSS (4)</a></div><div class=xMenu_tag><a href=../../tags/jekyll/>Jekyll (4)</a></div><div class=xMenu_tag><a href=../../tags/json/>JSON (4)</a></div><div class=xMenu_tag><a href=../../tags/lets-encrypt/>Let's Encrypt (4)</a></div><div class=xMenu_tag><a href=../../tags/powershell/>PowerShell (4)</a></div><div class=xMenu_tag><a href=../../tags/sql/>SQL (4)</a></div><div class=xMenu_tag><a href=../../tags/ssl/>ssl (4)</a></div><div class=xMenu_tag><a href=../../tags/windows/>Windows (4)</a></div><div class=xMenu_tag><a href=../../tags/%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF/>エディタ (4)</a></div><div class=xMenu_tag><a href=../../tags/%E8%8B%B1%E8%AA%9E/>英語 (4)</a></div><div class=xMenu_tag><a href=../../tags/azure-functions/>Azure Functions (3)</a></div><div class=xMenu_tag><a href=../../tags/cosmos-db/>Cosmos DB (3)</a></div><div class=xMenu_tag><a href=../../tags/grpc/>gRPC (3)</a></div><div class=xMenu_tag><a href=../../tags/http/>HTTP (3)</a></div><div class=xMenu_tag><a href=../../tags/hugo/>Hugo (3)</a></div><div class=xMenu_tag><a href=../../tags/kotlin/>Kotlin (3)</a></div><div class=xMenu_tag><a href=../../tags/mac/>mac (3)</a></div><div class=xMenu_tag><a href=../../tags/pc%E8%A8%AD%E5%AE%9A/>PC設定 (3)</a></div><div class=xMenu_tag><a href=../../tags/prettier/>Prettier (3)</a></div><div class=xMenu_tag><a href=../../tags/sqlite/>SQLite (3)</a></div><div class=xMenu_tag><a href=../../tags/textlint/>textlint (3)</a></div><div class=xMenu_tag><a href=../../tags/tv/>TV (3)</a></div><div class=xMenu_tag><a href=../../tags/yaml/>YAML (3)</a></div><div class=xMenu_tag><a href=../../tags/%E3%81%8A%E3%81%A7%E3%81%8B%E3%81%91/>おでかけ (3)</a></div><div class=xMenu_tag><a href=../../tags/%E3%82%A2%E3%83%97%E3%83%AA/>アプリ (3)</a></div><div class=xMenu_tag><a href=../../tags/%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0/>アルゴリズム (3)</a></div><div class=xMenu_tag><a href=../../tags/%E3%83%81%E3%83%A3%E3%83%83%E3%83%88%E3%83%9C%E3%83%83%E3%83%88/>チャットボット (3)</a></div><div class=xMenu_tag><a href=../../tags/%E3%83%9C%E3%83%BC%E3%83%89%E3%82%B2%E3%83%BC%E3%83%A0/>ボードゲーム (3)</a></div><div class=xMenu_tag><a href=../../tags/%E5%83%8D%E3%81%8D%E6%96%B9/>働き方 (3)</a></div><div class=xMenu_tag><a href=../../tags/%E7%A7%80%E4%B8%B8/>秀丸 (3)</a></div><div class=xMenu_tag><a href=../../tags/%E8%87%AA%E5%88%86/>自分 (3)</a></div><div class=xMenu_tag><a href=../../tags/apache/>Apache (2)</a></div><div class=xMenu_tag><a href=../../tags/arib/>ARIB (2)</a></div><div class=xMenu_tag><a href=../../tags/astro/>Astro (2)</a></div><div class=xMenu_tag><a href=../../tags/aws/amplify/>AWS/Amplify (2)</a></div><div class=xMenu_tag><a href=../../tags/aws/appsync/>AWS/AppSync (2)</a></div><div class=xMenu_tag><a href=../../tags/aws/codebuild/>AWS/CodeBuild (2)</a></div><div class=xMenu_tag><a href=../../tags/aws/iam/>AWS/IAM (2)</a></div><div class=xMenu_tag><a href=../../tags/aws/kms/>AWS/KMS (2)</a></div><div class=xMenu_tag><a href=../../tags/aws/s3/>AWS/S3 (2)</a></div><div class=xMenu_tag><a href=../../tags/aws/sdk/>AWS/SDK (2)</a></div><div class=xMenu_tag><a href=../../tags/azure-app-service/>Azure App Service (2)</a></div><div class=xMenu_tag><a href=../../tags/cloudflare/>Cloudflare (2)</a></div><div class=xMenu_tag><a href=../../tags/curl/>cURL (2)</a></div><div class=xMenu_tag><a href=../../tags/excel/>Excel (2)</a></div><div class=xMenu_tag><a href=../../tags/firebase/authentication/>Firebase/Authentication (2)</a></div><div class=xMenu_tag><a href=../../tags/gimp/>Gimp (2)</a></div><div class=xMenu_tag><a href=../../tags/go/>Go (2)</a></div><div class=xMenu_tag><a href=../../tags/meilisearch/>Meilisearch (2)</a></div><div class=xMenu_tag><a href=../../tags/mui/>MUI (2)</a></div><div class=xMenu_tag><a href=../../tags/npm/>npm (2)</a></div><div class=xMenu_tag><a href=../../tags/oauth/>OAuth (2)</a></div><div class=xMenu_tag><a href=../../tags/opengl/>OpenGL (2)</a></div><div class=xMenu_tag><a href=../../tags/rsync/>rsync (2)</a></div><div class=xMenu_tag><a href=../../tags/scp/>scp (2)</a></div><div class=xMenu_tag><a href=../../tags/slack/>Slack (2)</a></div><div class=xMenu_tag><a href=../../tags/teraterm/>TeraTerm (2)</a></div><div class=xMenu_tag><a href=../../tags/unicode/>Unicode (2)</a></div><div class=xMenu_tag><a href=../../tags/vercel/>Vercel (2)</a></div><div class=xMenu_tag><a href=../../tags/zip/>zip (2)</a></div><div class=xMenu_tag><a href=../../tags/%E3%81%8A%E5%90%8D%E5%89%8D.com/>お名前.com (2)</a></div><div class=xMenu_tag><a href=../../tags/%E3%82%A8%E3%83%9F%E3%83%A5%E3%83%AC%E3%83%BC%E3%82%BF%E3%83%BC/>エミュレーター (2)</a></div><div class=xMenu_tag><a href=../../tags/%E3%83%95%E3%82%A9%E3%83%B3%E3%83%88/>フォント (2)</a></div><div class=xMenu_tag><a href=../../tags/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0/>プログラミング (2)</a></div><div class=xMenu_tag><a href=../../tags/%E5%9C%A7%E7%B8%AE%E5%B1%95%E9%96%8B/>圧縮・展開 (2)</a></div><div class=xMenu_tag><a href=../../tags/%E6%96%87%E5%AD%97%E5%88%97/>文字列 (2)</a></div><div class=xMenu_tag><a href=../../tags/%E9%9F%B3%E5%A3%B0%E8%AA%8D%E8%AD%98/>音声認識 (2)</a></div><div class=xMenu_tag><a href=../../tags/.net/>.NET (1)</a></div><div class=xMenu_tag><a href=../../tags/alacritty/>Alacritty (1)</a></div><div class=xMenu_tag><a href=../../tags/androidstudio/>AndroidStudio (1)</a></div><div class=xMenu_tag><a href=../../tags/apollo-server/>Apollo Server (1)</a></div><div class=xMenu_tag><a href=../../tags/atomic-design/>Atomic Design (1)</a></div><div class=xMenu_tag><a href=../../tags/blender/>Blender (1)</a></div><div class=xMenu_tag><a href=../../tags/bluetooth/>Bluetooth (1)</a></div><div class=xMenu_tag><a href=../../tags/bootstrap/>Bootstrap (1)</a></div><div class=xMenu_tag><a href=../../tags/bot-framework/>Bot Framework (1)</a></div><div class=xMenu_tag><a href=../../tags/boto3/>boto3 (1)</a></div><div class=xMenu_tag><a href=../../tags/certbot/>Certbot (1)</a></div><div class=xMenu_tag><a href=../../tags/chatgpt/>ChatGPT (1)</a></div><div class=xMenu_tag><a href=../../tags/confluence/>confluence (1)</a></div><div class=xMenu_tag><a href=../../tags/css/>CSS (1)</a></div><div class=xMenu_tag><a href=../../tags/ctf/>CTF (1)</a></div><div class=xMenu_tag><a href=../../tags/d3js/>D3.js (1)</a></div><div class=xMenu_tag><a href=../../tags/dns/>DNS (1)</a></div><div class=xMenu_tag><a href=../../tags/dvb/>DVB (1)</a></div><div class=xMenu_tag><a href=../../tags/editorconfig/>EditorConfig (1)</a></div><div class=xMenu_tag><a href=../../tags/evernote/>Evernote (1)</a></div><div class=xMenu_tag><a href=../../tags/git/>Git (1)</a></div><div class=xMenu_tag><a href=../../tags/golang/>Golang (1)</a></div><div class=xMenu_tag><a href=../../tags/google-analytics/>Google Analytics (1)</a></div><div class=xMenu_tag><a href=../../tags/groovy/>Groovy (1)</a></div><div class=xMenu_tag><a href=../../tags/html/>HTML (1)</a></div><div class=xMenu_tag><a href=../../tags/igdb/>IGDB (1)</a></div><div class=xMenu_tag><a href=../../tags/iso/>ISO (1)</a></div><div class=xMenu_tag><a href=../../tags/jest/>Jest (1)</a></div><div class=xMenu_tag><a href=../../tags/jira/>jira (1)</a></div><div class=xMenu_tag><a href=../../tags/lsof/>lsof (1)</a></div><div class=xMenu_tag><a href=../../tags/macos/>macOS (1)</a></div><div class=xMenu_tag><a href=../../tags/mediapipe/>MediaPipe (1)</a></div><div class=xMenu_tag><a href=../../tags/parcel/>Parcel (1)</a></div><div class=xMenu_tag><a href=../../tags/raspberrypi/>RaspberryPi (1)</a></div><div class=xMenu_tag><a href=../../tags/rclone/>rclone (1)</a></div><div class=xMenu_tag><a href=../../tags/regexp/>正規表現 (1)</a></div><div class=xMenu_tag><a href=../../tags/ruff/>Ruff (1)</a></div><div class=xMenu_tag><a href=../../tags/sbom/>sbom (1)</a></div><div class=xMenu_tag><a href=../../tags/stylelint/>Stylelint (1)</a></div><div class=xMenu_tag><a href=../../tags/teams/>Teams (1)</a></div><div class=xMenu_tag><a href=../../tags/terraform/>Terraform (1)</a></div><div class=xMenu_tag><a href=../../tags/tex/>TeX (1)</a></div><div class=xMenu_tag><a href=../../tags/tmux/>tmux (1)</a></div><div class=xMenu_tag><a href=../../tags/ubuntu/>Ubuntu (1)</a></div><div class=xMenu_tag><a href=../../tags/url/>URL (1)</a></div><div class=xMenu_tag><a href=../../tags/vim/>Vim (1)</a></div><div class=xMenu_tag><a href=../../tags/vps/>VPS (1)</a></div><div class=xMenu_tag><a href=../../tags/web/>Web (1)</a></div><div class=xMenu_tag><a href=../../tags/webpack/>webpack (1)</a></div><div class=xMenu_tag><a href=../../tags/wsl/>WSL (1)</a></div><div class=xMenu_tag><a href=../../tags/%E3%82%A2%E3%82%B8%E3%83%A3%E3%82%A4%E3%83%AB/>アジャイル (1)</a></div><div class=xMenu_tag><a href=../../tags/%E3%83%90%E3%83%83%E3%83%81%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB/>バッチファイル (1)</a></div><div class=xMenu_tag><a href=../../tags/%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E8%A8%AD%E5%AE%9A/>プロキシ設定 (1)</a></div><div class=xMenu_tag><a href=../../tags/%E4%BA%BA%E7%94%9F%E7%94%9F%E3%81%8D%E6%96%B9/>人生・生き方 (1)</a></div><div class=xMenu_tag><a href=../../tags/%E6%96%87%E5%AD%97%E3%82%B3%E3%83%BC%E3%83%89/>文字コード (1)</a></div><div class=xMenu_tag><a href=../../tags/%E6%96%87%E6%88%BF%E5%85%B7/>文房具 (1)</a></div><div class=xMenu_tag><a href=../../tags/%E6%96%99%E7%90%86/>料理 (1)</a></div><div class=xMenu_tag><a href=../../tags/%E7%94%BB%E5%83%8F%E5%87%A6%E7%90%86/>画像処理 (1)</a></div><div class=xMenu_tag><a href=../../tags/%E7%B5%B1%E8%A8%88/>統計 (1)</a></div><div class=xMenu_tag><a href=../../tags/%E8%A8%80%E8%91%89/>言葉 (1)</a></div><div class=xMenu_tag><a href=../../tags/%E8%A8%AD%E5%AE%9A/>設定 (1)</a></div><div class=xMenu_tag><a href=../../tags/%E8%AA%8D%E8%A8%BC/>認証 (1)</a></div><div class=xMenu_tag><a href=../../tags/%E9%80%9F%E8%AA%AD/>速読 (1)</a></div></div><a href=../../tags/ style="display:block;padding:.2em .4em;margin:.3em;font-size:smaller">すべて表示 …</a></div></div><script>const NUM_TAGS=10;function getRandomItemsFromArray(e,t){const n=e.sort(()=>Math.random()-.5);return n.slice(0,t)}const containerElem=document.getElementById("local-tag-container"),tagElems=document.querySelectorAll(".xMenu_tag"),tagArray=Array.from(tagElems),shuffledTags=getRandomItemsFromArray(tagArray,NUM_TAGS);containerElem.innerHTML="",shuffledTags.forEach(e=>containerElem.appendChild(e))</script><div class=xMenu_box data-sticky><br></div></div><div id=sidebar_fixed style=position:-webkit-sticky;position:sticky;top:4rem></div></div></nav><main id=xMain><div id=redirect-notification style=display:none;font-size:smaller;padding:1em>Web サイトの URL が変わりました。ブックマークの変更をお願いします。<br>変更前: <s>https://memoja.net</s><br>変更後: <a href=https://toushi.maku.blog>https://toushi.maku.blog</a><br></div><script>const url=new URL(document.location);if(url.searchParams.get("redirected_from")==="memoja.net"){const e=document.getElementById("redirect-notification");e.style.display="block",url.searchParams.delete("redirected_from"),history.replaceState({},"",url)}</script><article class=xArticle itemscope itemtype=https://schema.org/BlogPosting><aside><div class=xPrevNextLink><div class=xPrevNextLink_prev><a href=../../p/ar2bjs2/>GitHub OAuth トークンを取得する (2) Azure Functions 経由で取得する</a></div><div class=xPrevNextLink_next><a href=../../p/v9r8o5k/>GitHub Actions でコンテナイメージをビルドして Docker Hub へ push する</a></div></div></aside><header class=xArticle_headerBox><div><span class=xArticle_headerBox_breadcrumb><a href=../../>&#x1F3E0;</a></span>
<span class=xArticle_headerBox_breadcrumb><a href=../../p/3ftx6b2/>技術系</a></span>
<span class=xArticle_headerBox_breadcrumb><a href=../../p/5q4fr3d/>GitHub</a></span></div><div style=display:flex;margin-top:.8em><div style=width:80px;margin-right:.5em><img src=../../p/5q4fr3d/_index.svg style=width:80px;height:80px alt=カテゴリーアイコン></div><div style=flex:1><h1 itemprop=headline class=xArticle_headerBox_title><a itemprop=mainEntityOfPage href=../../p/qcp2cnx/>Apollo Client で GitHub GraphQL API を使う (Node & React)</a></h1><div class=xPageTags><span class=xPageTags_item><a href=../../tags/apollo/>Apollo</a></span>
<span class=xPageTags_item><a href=../../tags/github/>GitHub</a></span>
<span class=xPageTags_item><a href=../../tags/graphql/>GraphQL</a></span>
<span class=xPageTags_item><a href=../../tags/react/>React</a></span></div></div></div><span class=xPageDate>更新: <time itemprop=dateModified datetime=2020-07-31>2020-07-31</time>
/ 作成: <time itemprop=datePublished datetime=2020-07-31>2020-07-31</time></span><div style=text-align:right;margin-top:.5rem><div class=mm-snsButtons><a rel="nofollow noopener noreferrer" target=_blank href="https://twitter.com/intent/post?url=https%3a%2f%2fmaku.blog%2fp%2fqcp2cnx%2f"><span class=mm-snsButtons__icon><svg fill="#000" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>X</title><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932zM17.61 20.644h2.039L6.486 3.24H4.298z"/></svg></span></a><a rel="nofollow noopener noreferrer" target=_blank href="https://www.threads.net/intent/post?text=https%3a%2f%2fmaku.blog%2fp%2fqcp2cnx%2f" name=HOGE><span class=mm-snsButtons__icon><svg fill="#000" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Threads</title><path d="M12.186 24h-.007c-3.581-.024-6.334-1.205-8.184-3.509C2.35 18.44 1.5 15.586 1.472 12.01v-.017c.03-3.579.879-6.43 2.525-8.482C5.845 1.205 8.6.024 12.18.0h.014c2.746.02 5.043.725 6.826 2.098 1.677 1.29 2.858 3.13 3.509 5.467l-2.04.569c-1.104-3.96-3.898-5.984-8.304-6.015-2.91.022-5.11.936-6.54 2.717C4.307 6.504 3.616 8.914 3.589 12c.027 3.086.718 5.496 2.057 7.164 1.43 1.783 3.631 2.698 6.54 2.717 2.623-.02 4.358-.631 5.8-2.045 1.647-1.613 1.618-3.593 1.09-4.798-.31-.71-.873-1.3-1.634-1.75-.192 1.352-.622 2.446-1.284 3.272-.886 1.102-2.14 1.704-3.73 1.79-1.202.065-2.361-.218-3.259-.801-1.063-.689-1.685-1.74-1.752-2.964-.065-1.19.408-2.285 1.33-3.082.88-.76 2.119-1.207 3.583-1.291a13.853 13.853.0 013.02.142c-.126-.742-.375-1.332-.75-1.757-.513-.586-1.308-.883-2.359-.89h-.029c-.844.0-1.992.232-2.721 1.32L7.734 7.847c.98-1.454 2.568-2.256 4.478-2.256h.044c3.194.02 5.097 1.975 5.287 5.388.108.046.216.094.321.142 1.49.7 2.58 1.761 3.154 3.07.797 1.82.871 4.79-1.548 7.158-1.85 1.81-4.094 2.628-7.277 2.65zm1.003-11.69c-.242.0-.487.007-.739.021-1.836.103-2.98.946-2.916 2.143.067 1.256 1.452 1.839 2.784 1.767 1.224-.065 2.818-.543 3.086-3.71a10.5 10.5.0 00-2.215-.221z"/></svg></span></a><a rel="nofollow noopener noreferrer" target=_blank href="https://www.facebook.com/share.php?u=https%3a%2f%2fmaku.blog%2fp%2fqcp2cnx%2f"><span class=mm-snsButtons__icon><svg fill="#0866ff" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Facebook</title><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401.0.955.042 1.468.103a8.68 8.68.0 011.141.195v3.325a8.623 8.623.0 00-.653-.036 26.805 26.805.0 00-.733-.009c-.707.0-1.259.096-1.675.309a1.686 1.686.0 00-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647z"/></svg></span></a><a rel="nofollow noopener noreferrer" target=_blank href="https://timeline.line.me/social-plugin/share?url=https%3a%2f%2fmaku.blog%2fp%2fqcp2cnx%2f&text=Apollo%20Client%20%e3%81%a7%20GitHub%20GraphQL%20API%20%e3%82%92%e4%bd%bf%e3%81%86%20%28Node%20&%20React%29%20-%20%e3%81%be%e3%81%8f%e3%82%8d%e3%81%90"><span class=mm-snsButtons__icon><svg fill="#00c300" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LINE</title><path d="M19.365 9.863c.349.0.63.285.63.631.0.345-.281.63-.63.63H17.61v1.125h1.755c.349.0.63.283.63.63.0.344-.281.629-.63.629h-2.386c-.345.0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346.0.627.285.627.63.0.349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211.0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346.0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195.0.375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345.0.63.285.63.63v4.771zm-5.741.0c0 .344-.282.629-.631.629-.345.0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346.0.628.285.628.63v4.771zm-2.466.629H4.917c-.345.0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348.0.63.285.63.63v4.141h1.756c.348.0.629.283.629.63.0.344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943.0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/></svg></span></a><a rel="nofollow noopener noreferrer" target=_blank href="https://b.hatena.ne.jp/entry?url=https%3a%2f%2fmaku.blog%2fp%2fqcp2cnx%2f"><span class=mm-snsButtons__icon><svg fill="#00a4de" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Hatena Bookmark</title><path d="M20.47.0C22.42.0 24 1.58 24 3.53v16.94c0 1.95-1.58 3.53-3.53 3.53H3.53C1.58 24 0 22.42.0 20.47V3.53C0 1.58 1.58.0 3.53.0h16.94zm-3.705 14.47c-.78.0-1.41.63-1.41 1.41s.63 1.414 1.41 1.414 1.41-.645 1.41-1.425-.63-1.41-1.41-1.41zM8.61 17.247c1.2.0 2.056-.042 2.58-.12.526-.084.976-.222 1.32-.412.45-.232.78-.564 1.02-.99s.36-.915.36-1.48c0-.78-.21-1.403-.63-1.87-.42-.48-.99-.734-1.74-.794.66-.18 1.156-.45 1.456-.81.315-.344.465-.824.465-1.424.0-.48-.103-.885-.3-1.26-.21-.36-.493-.645-.883-.87-.345-.195-.735-.315-1.215-.405-.464-.074-1.29-.12-2.474-.12H5.654v10.486H8.61zm.736-4.185c.705.0 1.185.088 1.44.262.27.18.39.495.39.93.0.405-.135.69-.42.855-.27.18-.765.254-1.44.254H8.31v-2.297h1.05zm8.656.706v-7.06h-2.46v7.06H18zM8.925 9.08c.71.0 1.185.08 1.432.24.245.16.367.435.367.83.0.38-.13.646-.39.804-.265.154-.747.232-1.452.232h-.57V9.08h.615z"/></svg></span></a><a rel="nofollow noopener noreferrer" target=_blank href="https://getpocket.com/edit?url=https%3a%2f%2fmaku.blog%2fp%2fqcp2cnx%2f&title=Apollo%20Client%20%e3%81%a7%20GitHub%20GraphQL%20API%20%e3%82%92%e4%bd%bf%e3%81%86%20%28Node%20&%20React%29%20-%20%e3%81%be%e3%81%8f%e3%82%8d%e3%81%90"><span class=mm-snsButtons__icon><svg fill="#ef3f56" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Pocket</title><path d="M18.813 10.259l-5.646 5.419c-.32.305-.73.458-1.141.458-.41.0-.821-.153-1.141-.458l-5.646-5.419c-.657-.628-.677-1.671-.049-2.326.63-.657 1.671-.679 2.325-.05l4.511 4.322 4.517-4.322c.66-.631 1.697-.607 2.326.049.631.645.615 1.695-.045 2.326l-.011.001zm5.083-7.546c-.299-.858-1.125-1.436-2.041-1.436H2.179c-.9.0-1.717.564-2.037 1.405-.094.25-.142.511-.142.774v7.245l.084 1.441c.348 3.277 2.047 6.142 4.682 8.139.045.036.094.07.143.105l.03.023c1.411 1.03 2.989 1.728 4.694 2.072.786.158 1.591.24 2.389.24.739.0 1.481-.067 2.209-.204.088-.029.176-.045.264-.06.023.0.049-.015.074-.029 1.633-.36 3.148-1.036 4.508-2.025l.029-.031.135-.105c2.627-1.995 4.324-4.862 4.686-8.148L24 10.678V3.445c0-.251-.031-.5-.121-.742l.017.01z"/></svg></span></a></div></div></header><div itemprop=articleBody class=xArticle_content><nav id=TableOfContents><ul><li><a href=#apollo-client-とは>Apollo Client とは</a></li><li><a href=#node-パッケージのインストール>Node パッケージのインストール</a><ul><li><a href=#apollo-client>Apollo Client</a></li><li><a href=#fetch-ポリフィル>fetch ポリフィル</a></li><li><a href=#コラム古いパッケージ>（コラム）古いパッケージ</a></li></ul></li><li><a href=#token>GitHub アクセストークンの発行</a></li><li><a href=#nodejs-アプリから-apollo-client-を使用する>Node.js アプリから Apollo Client を使用する</a><ul><li><a href=#サンプルコード>サンプルコード</a></li><li><a href=#実行結果>実行結果</a></li></ul></li><li><a href=#react-アプリから-apollo-client-を使用する>React アプリから Apollo Client を使用する</a><ul><li><a href=#サンプルコード-1>サンプルコード</a></li><li><a href=#実行結果-1>実行結果</a></li></ul></li><li><a href=#ローカルストレージに保存したアクセストークンを使用する>ローカルストレージに保存したアクセストークンを使用する</a><ul><li><a href=#環境変数に設定したアクセストークンを使用する>環境変数に設定したアクセストークンを使用する</a></li></ul></li><li><a href=#おまけ-graphql-クエリにパラメータを設定する>おまけ： GraphQL クエリにパラメータを設定する</a></li></ul></nav><h2 id=apollo-client-とは>Apollo Client とは</h2><p>Apollo パッケージは、GraphQL を使ったクライアントアプリやサーバーを作成するためのライブラリ群です。
クライアントアプリを作るためのライブラリは、<strong>Apollo Client</strong> として <strong><code>@apollo/client</code></strong> という NPM パッケージにまとめられています。</p><p>Web アプリのコンポーネントを作成するときは React がよく使われますが、Apollo は GraphQL を扱いやすくする React コンポーネント（<code>ApolloProvider</code>、<code>Query</code>、<code>Mutation</code>、<code>Subscription</code>）や React Hook 拡張（<code>useQuery</code>) などを提供しています。</p><p>ここでは、Apollo Client パッケージを使用して、</p><ul><li>Node.js アプリ（コマンドラインアプリの JS）から GraphQL API の実行</li><li>React アプリ（Web サイトの JS）から GraphQL API の実行</li></ul><p>を行ってみます。
呼び出す GraphQL API は何でもよいのですが、今回は <strong>GitHub GraphQL API</strong> を利用することにします。</p><h2 id=node-パッケージのインストール>Node パッケージのインストール</h2><h3 id=apollo-client>Apollo Client</h3><p>Apollo Client 関連のパッケージとしては、<strong><code>@apollo/client</code></strong> と、それが使用する <strong><code>graphql</code></strong> をインストールします。</p><figure class=xCodeBlock><figcaption class=xCodeBlock_title>Apollo Client のインストール</figcaption><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>### yarn の場合
</span></span><span class=line><span class=cl>$ yarn add @apollo/client graphql
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>### npm の場合
</span></span><span class=line><span class=cl>$ npm install @apollo/client graphql</span></span></code></pre></div></div></figure><h3 id=fetch-ポリフィル>fetch ポリフィル</h3><p>Apollo クライアント内部の実装では、Web ブラウザの fetch API を利用しています。
React アプリから Apollo クライアントを利用する場合は問題ないのですが、コンソールで動作する Node.js アプリから利用する場合は、fetch API の埋め合わせ (polyfill) をするモジュールが必要になります。
ここでは、<strong><code>cross-fetch</code></strong> パッケージをインストールしておきます。</p><figure class=xCodeBlock><figcaption class=xCodeBlock_title>fetch ライブラリのインストール</figcaption><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>### yarn の場合
</span></span><span class=line><span class=cl>$ yarn add cross-fetch
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>### npm の場合
</span></span><span class=line><span class=cl>$ npm install cross-fetch</span></span></code></pre></div></div></figure><h3 id=コラム古いパッケージ>（コラム）古いパッケージ</h3><p>Apollo のクライアント系パッケージはいろいろな名前で提供されていましたが、すべて <code>@apollo/client</code> 以下にまとめられました。
次のようなパッケージはもう使用しません。</p><ul><li><b>apollo-client:</b>
すべて <code>@apollo/client</code> に統合されたので使いません</li><li><b>apollo-boost:</b>
次のように <code>ApolloClient</code> コンストラクタを使えばOKです (<code>import {ApolloClient} from '@apollo/client/core'</code>)</li><li><b>graphql-tag:</b>
GraphQL をパースするための <code>gql</code> も <code>@apollo/client</code> に統合されています (<code>import {gql} from '@apollo/client'</code>)</li></ul><h2 id=token>GitHub アクセストークンの発行</h2><p>GitHub の GraphQL API を使用するには、下記のように POST リクエストのヘッダで GitHub アクセストークンを付加する必要があります。</p><figure class=xCodeBlock><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>authorization: Bearer a4304a13bc6cdd52509c90a38a676fce962ce518</span></span></code></pre></div></div></figure><p>アクセストークンを付加しないと、API 実行時に次のような HTTP 401 エラーが返されます。</p><figure class=xCodeBlock><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>ApolloError: Response not successful: Received status code 401</span></span></code></pre></div></div></figure><p>GitHub のアクセストークンは、下記の設定画面から <strong><code>Generate new token</code></strong> ボタンを押すことで作成できます。</p><ul><li><a href=https://github.com/settings/tokens>GitHub / Settings / Developer settings / Personal Access Tokens</a></li></ul><p>このとき、公開するデータのスコープ設定を行うのですが、何もチェックしなくても Public なリポジトリ情報やユーザー情報は取得可能です。
<strong><code>repo</code></strong> にチェックを入れると、Private なリポジトリの読み書きが可能になり、<strong><code>user</code></strong> にチェックを入れると、ユーザー情報の読み書きが可能になります。
<strong><code>read:user</code></strong> にだけチェックを入れると、ユーザー情報の読み込みだけが可能になります。
残念ながら、Private リポジトリをリードオンリーで扱うスコープは存在しないようです（設計ミス？）。</p><p>スコープの詳細については、下記の GitHub ドキュメントを参考にしてください。</p><ul><li>参考: <a href=https://docs.github.com/en/developers/apps/scopes-for-oauth-apps>Scopes for OAuth Apps - GitHub Docs</a></li></ul><h2 id=nodejs-アプリから-apollo-client-を使用する>Node.js アプリから Apollo Client を使用する</h2><p>まずは、Node.js を使ったコマンドラインアプリから、<strong><code>ApolloClient</code></strong> を使って GitHub GraphQL API を呼び出してみます。
下記のサンプルコードでは、指定した GitHub リポジトリ (<code>apollographql/apollo</code>) の最新 Issue 5件分を取得しています。
このコードを実行できるようになれば、あとはクエリ部分を変更することでいろいろな情報を取得できます。</p><p>ポイントとしては、下記のあたりでしょうか。</p><ul><li><code>cross-fetch/polyfill</code> モジュールをインポートして、Web ブラウザの <code>fetch</code> 関数をエミュレートする</li><li><code>authorization</code> ヘッダで GitHub のアクセストークンを指定する</li><li>GraphQL クエリを <code>gql`クエリ文字列` </code>という形で定義する</li></ul><h3 id=サンプルコード>サンプルコード</h3><figure class=xCodeBlock><figcaption class=xCodeBlock_title>main.ts</figcaption><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span><span class=nx>ApolloClient</span><span class=p>,</span> <span class=nx>ApolloError</span><span class=p>,</span> <span class=nx>InMemoryCache</span><span class=p>,</span> <span class=nx>gql</span><span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@apollo/client/core&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=s1>&#39;cross-fetch/polyfill&#39;</span><span class=p>;</span>  <span class=c1>// グローバルな fetch 関数を定義する
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// トークンは環境変数などから取得するのが常套手段
</span></span></span><span class=line><span class=cl><span class=c1>// const token = &#39;a4304a13bc6cdd52509c90a38a676fce962ce518&#39;;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>token</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>MYAPP_GITHUB_TOKEN</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>token</span> <span class=o>===</span> <span class=s1>&#39;undefined&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;MYAPP_GITHUB_TOKEN cannot be found&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// GraphQL クライアントを生成
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>apolloClient</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ApolloClient</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>uri</span><span class=o>:</span> <span class=s1>&#39;https://api.github.com/graphql&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span><span class=nx>authorization</span><span class=o>:</span> <span class=sb>`Bearer </span><span class=si>${</span><span class=nx>token</span><span class=si>}</span><span class=sb>`</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>cache</span>: <span class=kt>new</span> <span class=nx>InMemoryCache</span><span class=p>(),</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 発行する GraphQL クエリ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>searchQuery</span> <span class=o>=</span> <span class=nx>gql</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>  query {
</span></span></span><span class=line><span class=cl><span class=sb>    search(query: &#34;repo:apollographql/apollo is:issue&#34;, type: ISSUE, first: 5) {
</span></span></span><span class=line><span class=cl><span class=sb>      issueCount
</span></span></span><span class=line><span class=cl><span class=sb>      nodes {
</span></span></span><span class=line><span class=cl><span class=sb>        ... on Issue { number title }
</span></span></span><span class=line><span class=cl><span class=sb>      }
</span></span></span><span class=line><span class=cl><span class=sb>    }
</span></span></span><span class=line><span class=cl><span class=sb>  }
</span></span></span><span class=line><span class=cl><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// クエリを発行
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>apolloClient</span><span class=p>.</span><span class=nx>query</span><span class=p>({</span><span class=nx>query</span>: <span class=kt>searchQuery</span><span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>result</span> <span class=o>=&gt;</span> <span class=nx>handleApolloResult</span><span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>handleApolloError</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// GraphQL レスポンスをハンドル
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>handleApolloResult</span><span class=p>(</span><span class=nx>data</span>: <span class=kt>any</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span><span class=nx>issueCount</span><span class=p>,</span> <span class=nx>nodes</span><span class=p>}</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>search</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Num of issues: </span><span class=si>${</span><span class=nx>issueCount</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>issue</span> <span class=k>of</span> <span class=nx>nodes</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`* </span><span class=si>${</span><span class=nx>issue</span><span class=p>.</span><span class=kt>number</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=nx>issue</span><span class=p>.</span><span class=nx>title</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// GraphQL のエラーをハンドル
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>handleApolloError</span><span class=p>(</span><span class=nx>err</span>: <span class=kt>ApolloError</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></figure><h3 id=実行結果>実行結果</h3><figure class=xCodeBlock><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>Num of issues: 176
</span></span><span class=line><span class=cl>* 937: Broken code display in blog for scaling GraphQL
</span></span><span class=line><span class=cl>* 934: Unknown directives
</span></span><span class=line><span class=cl>* 929: start apollo gateway
</span></span><span class=line><span class=cl>* 926: using REST services in apolo federation
</span></span><span class=line><span class=cl>* 909: Get a Graph Manager API key instructions need updating</span></span></code></pre></div></div></figure><h2 id=react-アプリから-apollo-client-を使用する>React アプリから Apollo Client を使用する</h2><p>次に、React アプリから Apollo Client を使って GraphQL API を実行してみます。
Apollo Client はもともと React アプリから使用することを想定して作られているため、とてもきれいに実装できます。
GitHub のアクセストークンは相変わらず必要なので、<a href=#token>上記の説明</a> を参考にして取得しておいてください。</p><p>下記の例では、GitHub のアクセストークンを TypeScript コードに埋め込んでいますが、本番用の Web アプリでは、OAuth などの仕組みを使って動的にユーザーのアクセストークンを取得する必要があります。
OAuth 関連の実装を説明すると長くなってしまうので、そのあたりは下記の記事を参考にしてください。</p><ul><li><a href=../../p/ubkt3ai>GitHub OAuth トークンを取得する (1) 処理の流れを理解する</a></li><li><a href=../../p/ar2bjs2>GitHub OAuth トークンを取得する (2) Azure Functions 経由で取得する</a></li></ul><h3 id=サンプルコード-1>サンプルコード</h3><p>次の <code>App</code> コンポーネントでは、前述のコマンドラインアプリと同様に <strong><code>ApolloClient</code></strong> インスタンスを生成しています。
このインスタンスを、<strong><code>ApolloProvider</code></strong> コンポーネントの <strong><code>client</code></strong> プロパティにセットすると、下位のコンポーネントから簡単に GraphQL API を呼び出せるようになります（後述）。</p><figure class=xCodeBlock><figcaption class=xCodeBlock_title>App.tsx</figcaption><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>import</span> <span class=o>*</span> <span class=nx>as</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span><span class=nx>ApolloClient</span><span class=p>,</span> <span class=nx>ApolloProvider</span><span class=p>,</span> <span class=nx>InMemoryCache</span><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@apollo/client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span><span class=nx>Issues</span><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;./Issues&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 注意: 本番環境ではアクセストークンは OAuth などで動的に取得すること
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>GITHUB_TOKEN</span> <span class=o>=</span> <span class=s1>&#39;a4304a13bc6cdd52509c90a38a676fce962ce518&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// GraphQL クライアントを生成
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>apolloClient</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ApolloClient</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>uri</span><span class=o>:</span> <span class=s1>&#39;https://api.github.com/graphql&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span><span class=nx>authorization</span><span class=o>:</span> <span class=sb>`Bearer </span><span class=si>${</span><span class=nx>GITHUB_TOKEN</span><span class=si>}</span><span class=sb>`</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>cache</span><span class=o>:</span> <span class=k>new</span> <span class=nx>InMemoryCache</span><span class=p>(),</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>App</span><span class=o>:</span> <span class=nx>React</span><span class=p>.</span><span class=nx>FC</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ApolloProvider</span> <span class=na>client</span><span class=o>=</span><span class=p>{</span><span class=nx>apolloClient</span><span class=p>}&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>Issues</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>ApolloProvider</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></div></div></figure><p>次の <code>Issues</code> コンポーネントは、Apollo Client を使って GitHub GraphQL API を呼び出し、指定したリポジトリの最新 Issue 5件分を取得して表示します（前述のコマンドラインアプリと同様です）。
クエリの実行方法はとても簡単で、Apollo Client が提供する <strong><code>useQuery</code></strong> フックを呼び出すだけです。
クエリの実行結果により、ロード中 (<code>loading</code>)、エラー発生 (<code>error</code>)、取得完了 (<code>data</code>) の戻り値を得られるので、現在の状況に応じて描画内容を切り替えることができます。</p><figure class=xCodeBlock><figcaption class=xCodeBlock_title>Issues.tsx</figcaption><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>import</span> <span class=o>*</span> <span class=nx>as</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span><span class=nx>gql</span><span class=p>,</span> <span class=nx>useQuery</span><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@apollo/client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 発行する GraphQL クエリ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>GET_ISSUES</span> <span class=o>=</span> <span class=nx>gql</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>  query {
</span></span></span><span class=line><span class=cl><span class=sb>    search(query: &#34;repo:apollographql/apollo is:issue&#34;, type: ISSUE, first: 5) {
</span></span></span><span class=line><span class=cl><span class=sb>      issueCount
</span></span></span><span class=line><span class=cl><span class=sb>      nodes {
</span></span></span><span class=line><span class=cl><span class=sb>        ... on Issue { number title }
</span></span></span><span class=line><span class=cl><span class=sb>      }
</span></span></span><span class=line><span class=cl><span class=sb>    }
</span></span></span><span class=line><span class=cl><span class=sb>  }
</span></span></span><span class=line><span class=cl><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>Issues</span><span class=o>:</span> <span class=nx>React</span><span class=p>.</span><span class=nx>FC</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// GraphQL のクエリを実行
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=p>{</span><span class=nx>loading</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>data</span><span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>(</span><span class=nx>GET_ISSUES</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// クエリ実行中の表示
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=nx>loading</span><span class=p>)</span> <span class=k>return</span> <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>Loading</span> <span class=p>...&lt;/</span><span class=nt>p</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// エラー発生時（レスポンスがないとき）の表示
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=k>return</span> <span class=p>&lt;</span><span class=nt>p</span> <span class=na>style</span><span class=o>=</span><span class=p>{{</span><span class=nx>color</span><span class=o>:</span> <span class=s1>&#39;red&#39;</span><span class=p>}}&gt;{</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>}&lt;/</span><span class=nt>p</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// クエリの結果が返ってきたときの表示
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=p>{</span><span class=nx>issueCount</span><span class=p>,</span> <span class=nx>nodes</span><span class=o>:</span> <span class=nx>issues</span><span class=p>}</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>search</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>&lt;&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;</span><span class=nx>Num</span> <span class=k>of</span> <span class=nx>issues</span><span class=o>:</span> <span class=p>{</span><span class=nx>issueCount</span><span class=p>}&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span> <span class=nx>issues</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>i</span> <span class=p>=&gt;</span> <span class=p>&lt;</span><span class=nt>li</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>.</span><span class=nx>number</span><span class=p>}&gt;{</span><span class=nx>i</span><span class=p>.</span><span class=nx>number</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>i</span><span class=p>.</span><span class=nx>title</span><span class=p>}&lt;/</span><span class=nt>li</span><span class=p>&gt;)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/&gt;;</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></div></div></figure><h3 id=実行結果-1>実行結果</h3><figure class=xImage><img style="border:solid #ccc 2px" width=600 height=88 src=../../p/qcp2cnx/img-001_hufdbb55dc9e18df0447fd3410b3c4fa80_1553_600x0_resize_box_3.png alt=/p/qcp2cnx/img-001.png><figcaption>図: クエリ実行中</figcaption></figure><figure class=xImage><img style="border:solid #ccc 2px" width=600 height=181 src=../../p/qcp2cnx/img-002_hu8e5c379bd6e7bdd2b86faa54095ef323_33955_600x0_resize_box_3.png alt=/p/qcp2cnx/img-002.png><figcaption>図: 結果の取得後</figcaption></figure><p>ここでは、クエリ実行中に「Loading &mldr;」と表示するだけにしていますが、ロード中のくるくるアイコンなどを表示すると、かなりそれっぽくなります。</p><h2 id=ローカルストレージに保存したアクセストークンを使用する>ローカルストレージに保存したアクセストークンを使用する</h2><p>上記の例では、GitHub のアクセストークンをハードコードしていますが、実運用ではこのようなコードはデプロイできません。
ここでは、ローカルストーレージ (<code>GITHUB_TOKEN</code>) に保存されたアクセストークンを使って、<code>ApolloClient</code> および <code>ApolloProvider</code> を生成する方法を紹介します。</p><p>OAuth によってアクセストークンを取得し、ローカルストレージに保存するまでの流れは次の記事を参考にしてください。</p><ul><li><a href=../../p/ar2bjs2>GitHub OAuth トークンを取得する (2) Azure Functions 経由で取得する</a></li></ul><p>次のサンプルコンポーネント <code>GitHubApolloProvider</code> は、GitHub のアクセストークンを HTTP ヘッダに付けて GraphQL クエリを発行するための <code>ApolloProvider</code> を提供します。
このような <code>ApolloClient</code> のカスタマイズ方法は、Apollo 本家サイトの <a href=https://www.apollographql.com/docs/react/networking/authentication/#header>Authentication のページ</a> で説明されています。</p><figure class=xCodeBlock><figcaption class=xCodeBlock_title>GitHubApolloProvider.tsx</figcaption><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>import</span> <span class=o>*</span> <span class=nx>as</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>ApolloClient</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>ApolloProvider</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>createHttpLink</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>InMemoryCache</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@apollo/client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>setContext</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@apollo/client/link/context&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>httpLink</span> <span class=o>=</span> <span class=nx>createHttpLink</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>uri</span><span class=o>:</span> <span class=s1>&#39;https://api.github.com/graphql&#39;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>authLink</span> <span class=o>=</span> <span class=nx>setContext</span><span class=p>((</span><span class=nx>_</span><span class=p>,</span> <span class=p>{</span> <span class=nx>headers</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Get the authentication token from local storage if it exists
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>token</span> <span class=o>=</span> <span class=nx>localStorage</span><span class=p>.</span><span class=nx>getItem</span><span class=p>(</span><span class=s1>&#39;GITHUB_TOKEN&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Return the headers to the context so httpLink can read them
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=p>...</span><span class=nx>headers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>authorization</span><span class=o>:</span> <span class=nx>token</span> <span class=o>?</span> <span class=sb>`Bearer </span><span class=si>${</span><span class=nx>token</span><span class=si>}</span><span class=sb>`</span> <span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create a GraphQL client
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>apolloClient</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ApolloClient</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>link</span><span class=o>:</span> <span class=nx>authLink</span><span class=p>.</span><span class=nx>concat</span><span class=p>(</span><span class=nx>httpLink</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>cache</span><span class=o>:</span> <span class=k>new</span> <span class=nx>InMemoryCache</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>GitHubApolloProvider</span><span class=o>:</span> <span class=nx>React</span><span class=p>.</span><span class=nx>FC</span> <span class=o>=</span> <span class=p>(</span><span class=nx>prop</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>&lt;</span><span class=nt>ApolloProvider</span> <span class=na>client</span><span class=o>=</span><span class=p>{</span><span class=nx>apolloClient</span><span class=p>}&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nx>prop</span><span class=p>.</span><span class=nx>children</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>ApolloProvider</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></div></div></figure><p>あとは、<code>ApolloProvider</code> を使っていたところを次のように <code>GitHubApolloProvider</code> に置き換えれば、それ以下のコンポーネントでアクセストークン付きの GraphQL クエリを発行できるようなります。</p><figure class=xCodeBlock><figcaption class=xCodeBlock_title>App.tsx</figcaption><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>import</span> <span class=o>*</span> <span class=nx>as</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span><span class=nx>GitHubApolloProvider</span><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;./GitHubApolloProvider&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span><span class=nx>Issues</span><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;./Issues&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>App</span><span class=o>:</span> <span class=nx>React</span><span class=p>.</span><span class=nx>FC</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>GitHubApolloProvider</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>Issues</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>GitHubApolloProvider</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></div></div></figure><p>ローカルストレージに保存されたアクセストークンは、GraphQL のリクエストを実行するたびに参照してくれるので、<code>ApolloClient</code> インスタンスを生成した後でアクセストークンが設定された場合にもうまく動作します。</p><ul><li>参考: <a href=../../p/xa62yo4/>Apollo Client の ApolloLink チェーンで HTTP リクエストをカスタマイズする</a></li></ul><h3 id=環境変数に設定したアクセストークンを使用する>環境変数に設定したアクセストークンを使用する</h3><p>ローカル環境での開発時に、何らかの理由で、環境変数に保存した GitHub アクセストークン (<a href=https://github.com/settings/tokens>Personal access token</a>) を使用したい場合は、<code>index.tsx</code> の最初の方で、次のような感じで環境変数の値をローカルストレージにコピーしてしまえば OK です。</p><figure class=xCodeBlock><figcaption class=xCodeBlock_title>index.tsx</figcaption><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span> <span class=o>===</span> <span class=s1>&#39;development&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>MYAPP_GITHUB_TOKEN</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>warn</span><span class=p>(</span><span class=s1>&#39;In development mode, use MYAPP_GITHUB_TOKEN env variable.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>localStorage</span><span class=p>.</span><span class=nx>setItem</span><span class=p>(</span><span class=s1>&#39;GITHUB_TOKEN&#39;</span><span class=p>,</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>MYAPP_GITHUB_TOKEN</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></figure><h2 id=おまけ-graphql-クエリにパラメータを設定する>おまけ： GraphQL クエリにパラメータを設定する</h2><p>パラメータ付きの GraphQL クエリを実行するには、<a href=https://www.apollographql.com/docs/react/api/react/hooks/#usequery>useQuery フック</a> の第2パラメータで、次のような形で変数オブジェクト（変数名と値の連想配列）を渡します。</p><figure class=xCodeBlock><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span><span class=nx>loading</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>data</span><span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>(</span><span class=nx>QUERY</span><span class=p>,</span> <span class=p>{</span><span class=nx>variables</span>: <span class=kt>変数オブジェクト</span><span class=p>});</span></span></span></code></pre></div></div></figure><p>下記のサンプルコードでは、変数で指定した GitHub リポジトリのイシューを取得しています。</p><figure class=xCodeBlock><figcaption class=xCodeBlock_title>Issues.tsx</figcaption><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>import</span> <span class=o>*</span> <span class=nx>as</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span><span class=nx>gql</span><span class=p>,</span> <span class=nx>useQuery</span><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@apollo/client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>QUERY</span> <span class=o>=</span> <span class=nx>gql</span><span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>  query($searchQuery: String!) {
</span></span></span><span class=line><span class=cl><span class=sb>    search(query: $searchQuery, type: ISSUE, first: 5) {
</span></span></span><span class=line><span class=cl><span class=sb>      nodes {
</span></span></span><span class=line><span class=cl><span class=sb>        ... on Issue { number title }
</span></span></span><span class=line><span class=cl><span class=sb>      }
</span></span></span><span class=line><span class=cl><span class=sb>    }
</span></span></span><span class=line><span class=cl><span class=sb>  }
</span></span></span><span class=line><span class=cl><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>Issues</span><span class=o>:</span> <span class=nx>React</span><span class=p>.</span><span class=nx>FC</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 変数を渡して GraphQL クエリを実行
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>queryVars</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>searchQuery</span><span class=o>:</span> <span class=s1>&#39;repo:apollographql/apollo is:issue&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span><span class=nx>loading</span><span class=p>,</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>data</span><span class=p>}</span> <span class=o>=</span> <span class=nx>useQuery</span><span class=p>(</span><span class=nx>QUERY</span><span class=p>,</span> <span class=p>{</span><span class=nx>variables</span><span class=o>:</span> <span class=nx>queryVars</span><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>loading</span><span class=p>)</span> <span class=k>return</span> <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span><span class=nx>Loading</span> <span class=p>...&lt;/</span><span class=nt>p</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=k>return</span> <span class=p>&lt;</span><span class=nt>p</span> <span class=na>style</span><span class=o>=</span><span class=p>{{</span><span class=nx>color</span><span class=o>:</span> <span class=s1>&#39;red&#39;</span><span class=p>}}&gt;{</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>}&lt;/</span><span class=nt>p</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span><span class=nx>nodes</span><span class=p>}</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>search</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>&lt;&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=nx>nodes</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>x</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>li</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>x</span><span class=p>.</span><span class=nx>number</span><span class=p>}&gt;{</span><span class=nx>x</span><span class=p>.</span><span class=nx>number</span><span class=p>}</span> <span class=o>-</span> <span class=p>{</span><span class=nx>x</span><span class=p>.</span><span class=nx>title</span><span class=p>}&lt;/</span><span class=nt>li</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>)}</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/&gt;;</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></div></div></figure><meta itemprop=author content="まく"><span itemprop=publisher itemscope itemtype=https://schema.org/Organization><meta itemprop=name content="まく"></span><h3 style="border-bottom:1px solid gray">関連記事</h3><ul><li><a href=../../p/9bku4cj/>GitHub GraphQL API のクエリ例: ユーザー情報を取得する (viewer, user)</a></li><li><a href=../../p/e2dpycn/>React コンポーネントのプロパティでハンドラメソッドを渡す</a></li><li><a href=../../p/eu4cksy/>React コンポーネントに CSS スタイルを設定する</a></li><li><a href=../../p/tdpybmw/>React コンポーネントで入力フォームを作成する (1) 自力編</a></li><li><a href=../../p/av9mxak/>React コンポーネントのプロパティで配列データを渡す</a></li><li><a href=../../p/vfr3cnw/>React コンポーネント実装の基本（関数コンポーネントとクラスコンポーネント）</a></li><li><a href=../../p/6pybmv6/>Electron で Hello World (3) React を使えるようにする</a></li></ul><div class=xPageTags><span class=xPageTags_item><a href=../../tags/apollo/>Apollo</a></span>
<span class=xPageTags_item><a href=../../tags/github/>GitHub</a></span>
<span class=xPageTags_item><a href=../../tags/graphql/>GraphQL</a></span>
<span class=xPageTags_item><a href=../../tags/react/>React</a></span></div></div><div style=text-align:right><div id=codoc-entry-4gYwTntzzw class=codoc-entries data-without-body=1 data-support-button-text="（っ'-')╮シュッ=͟͟͞͞ 💵" data-show-like=0 data-show-about-codoc=0 data-show-powered-by=0 data-support-message=まくに投げ銭できるよ></div></div><div class=xArticle_up><a href=../../p/5q4fr3d/><span class=xArticle_up_label>GitHubメモ</span><br>へ戻る</a></div><aside><div class=xPrevNextLink><div class=xPrevNextLink_prev><a href=../../p/ar2bjs2/>GitHub OAuth トークンを取得する (2) Azure Functions 経由で取得する</a></div><div class=xPrevNextLink_next><a href=../../p/v9r8o5k/>GitHub Actions でコンテナイメージをビルドして Docker Hub へ push する</a></div></div></aside></article></main></div><aside><div class=xBreadcrumb><span class=xBreadcrumb_item><a href=../../>&#x1F3E0;</a>
</span><span class=xBreadcrumb_item><a href=../../p/3ftx6b2/>技術系</a>
</span><span class=xBreadcrumb_item><a href=../../p/5q4fr3d/>GitHub</a>
</span><span class=xBreadcrumb_item>Apollo Client で GitHub GraphQL API を使う (Node & React)</span></div></aside><div id=xSiteFooter><a href=../../>まくろぐ</a></div><div id=xSiteFooter2><a href=../../sitemap/>サイトマップ</a> ｜
<a target=_blank href=https://forms.gle/xdUszEv4f5CEqH947>まくへのメッセージ</a></div></div><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"まくろぐ","item":"https://maku.blog/"},{"@type":"ListItem","position":2,"name":"技術系","item":"https://maku.blog/p/3ftx6b2/"},{"@type":"ListItem","position":3,"name":"GitHub","item":"https://maku.blog/p/5q4fr3d/"},{"@type":"ListItem","position":4,"name":"Apollo Client で GitHub GraphQL API を使う (Node \u0026 React)","item":"https://maku.blog/p/qcp2cnx/"}]}</script><script>document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll("a[href^=http]");for(let n=0;n<e.length;++n){const t=e[n];if(t.href.startsWith("https://maku77.github.io"))continue;const s=t.getElementsByTagName("img");if(s.length>0)continue;const o=t.getElementsByTagName("svg");if(o.length>0)continue;t.classList.add("xExternalLinkIcon"),t.setAttribute("target","_blank"),t.setAttribute("rel","noopener")}})</script></body></html>