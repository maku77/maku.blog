<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Deno プログラミング関連メモ on まくろぐ</title><link>https://maku.blog/p/dp4r2wz/</link><description>Recent content in Deno プログラミング関連メモ on まくろぐ</description><generator>Hugo</generator><language>ja-jp</language><lastBuildDate>Fri, 08 Mar 2024 00:00:00 +0900</lastBuildDate><atom:link href="https://maku.blog/p/dp4r2wz/index.xml" rel="self" type="application/rss+xml"/><item><title>Deno プログラミングをはじめる</title><link>https://maku.blog/p/d8s6fpz/</link><pubDate>Mon, 12 Dec 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/d8s6fpz/</guid><description>&lt;h2 id="deno-とは">Deno とは？&lt;/h2>
&lt;p>&lt;a href="https://deno.land/">Deno&lt;/a>（発音: ディーノ）は、Node.js の作者であるライアン・ダール (Ryan Dahl) 氏が作成した JavaScript/TypeScript の実行環境です。
Deno という名前は、Node を逆にしたネーミングになっています。
Node.js での反省を活かした改善が行われており、今後は Node.js ではなく Deno で作成されるアプリケーションが増えていくと思われます。
Deno には次のような特徴があります。&lt;/p>
&lt;ul>
&lt;li>シンプルな 1 つの実行ファイル（&lt;code>deno&lt;/code> コマンド）で提供&lt;/li>
&lt;li>ネイティブに TypeScript 実行をサポート（&lt;code>tsc&lt;/code> コマンドのインストールが不要）&lt;/li>
&lt;li>ゼロコンフィグで開発を始められる（必要に応じて &lt;code>deno.json&lt;/code> を用意することも可能）&lt;/li>
&lt;li>&lt;code>package.json&lt;/code> で依存モジュールを管理する必要がない&lt;/li>
&lt;li>各種開発ツールを &lt;code>deno&lt;/code> サブコマンドで標準搭載
&lt;ul>
&lt;li>&lt;code>deno fmt&lt;/code> &amp;hellip; フォーマッター&lt;/li>
&lt;li>&lt;code>deno lint&lt;/code> &amp;hellip; Lint ツール&lt;/li>
&lt;li>&lt;code>deno test&lt;/code> &amp;hellip; テストランナー&lt;/li>
&lt;li>&lt;code>deno bundle&lt;/code> &amp;hellip; バンドラー（1 つの JavaScript ファイルにまとめる）&lt;/li>
&lt;li>&lt;code>deno compile&lt;/code> &amp;hellip; コンパイラー（OS ごとの実行ファイルを生成する）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>クロスプラットフォームな &lt;code>deno task&lt;/code>（Node の &lt;code>npm run&lt;/code> に相当）&lt;/li>
&lt;li>Web 標準の JavaScript API と互換性のある API 定義 (Web Platform APIs)&lt;/li>
&lt;li>Promise ベースの Deno API 実装&lt;/li>
&lt;li>Rust 実装による高速動作（当初は Golang 実装だった）&lt;/li>
&lt;li>npm モジュールのサポート（2022 年に追加）&lt;/li>
&lt;li>公式のサーバレス環境 Deno Deploy が提供されている&lt;/li>
&lt;/ul>
&lt;p>Node.js の時代は、TypeScript 環境の準備や ESLint、Prettier の設定など、本質的ではないことに時間を取られがちでしたが、Deno であれば最初から全部入りなので、時間を有効活用できて幸せな人生を送ることができます。
Golang や Rust の開発体験のよさに、TypeScript/JavaScript が追いついた感じですね。&lt;/p></description></item><item><title>Node.js と Deno のコーディング方法の違いまとめ</title><link>https://maku.blog/p/zbaga2z/</link><pubDate>Wed, 21 Dec 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/zbaga2z/</guid><description>&lt;p>Deno でのコーディングは、Node.js とほぼ同様の書き方で行えますが、いくつか押さえておきたいポイントがあるのでまとめておきます。&lt;/p>
&lt;h2 id="web-platform-apis">Web Platform APIs&lt;/h2>
&lt;ul>
&lt;li>Web ブラウザーで使える JavaScript の標準 API、例えば &lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">fetch API&lt;/a> や、それに付随する &lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/Request">Request&lt;/a> や &lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/Response">Response&lt;/a> インタフェースをデフォルトで使用することができます。&lt;/li>
&lt;li>これは、Chrome や Firefox などのブラウザ上で動作する JavaScript で使える API と同様の API を使えるということです。もちろん、Deno の実行環境はブラウザではないので、セキュリティモデルなどに微妙に違いがありますが、インタフェースが統一されているので学習コストが低いです。&lt;/li>
&lt;/ul>
&lt;p>Web Platform API の一覧は、&lt;a href="https://deno.land/manual/runtime/web_platform_apis">こちらを参照&lt;/a>してください。&lt;/p>
&lt;h2 id="deno-apis--built-in-apis">Deno APIs / Built-in APIs&lt;/h2>
&lt;ul>
&lt;li>JavaScript 標準ではない、組み込みの API (Deno API) は、&lt;strong>&lt;code>Deno&lt;/code>&lt;/strong> という namespace 以下のメソッド／プロパティとして提供されています。Deno が提供している API ということが一目でわかります。下記は、コマンドライン引数を参照するときの例です。
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Deno&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">argv&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="c1">// Deno の場合
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">process&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">argv&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="c1">// Node の場合
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>Deno API 呼び出し時に発生するエラーは、&lt;a href="https://deno.land/api?s=Deno.errors">Deno.errors&lt;/a> namespace に定義されています。&lt;/li>
&lt;li>Deno API には、まだ安定版 (stable) になっていないものがあり、それらを使う場合は、&lt;code>deno run&lt;/code> 実行時に &lt;strong>&lt;code>--unstable&lt;/code>&lt;/strong> オプションを指定します。&lt;/li>
&lt;/ul>
&lt;p>Deno namespace の API の一覧は、&lt;a href="https://deno.land/api?s=Deno">こちらを参照&lt;/a>してください。&lt;/p></description></item><item><title>Deno Deploy で Deno のサーバープログラムを公開する</title><link>https://maku.blog/p/phz7fo3/</link><pubDate>Sat, 24 Dec 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/phz7fo3/</guid><description>&lt;h2 id="deno-deploy-とは">Deno Deploy とは？&lt;/h2>
&lt;p>&lt;a href="https://deno.com/deploy">Deno Deploy&lt;/a> を使うと、Deno で作成したサーバープログラムを簡単に公開することができます。
Deno Deploy はエッジサーバーで動作する Deno 実行環境を提供しており、ゼロコンフィグでデプロイすることができます。&lt;/p>
&lt;ul>
&lt;li>TypeScript コードで記述したプログラムがそのまま動きます（Deno なので）&lt;/li>
&lt;li>CLI ツール (&lt;a href="https://github.com/denoland/deployctl">deployctl&lt;/a>) や GitHub 統合、GitHub Actions で簡単にデプロイできます&lt;/li>
&lt;li>デプロイは数秒で終わります（GitHub 連携による Deno Deploy へのデプロイは、&lt;a href="https://deno.com/blog/fastest-git-deploys-to-the-edge">Vercel や Cloudflare へのデプロイより 10 倍以上速い&lt;/a>）&lt;/li>
&lt;li>サーバー上で公開されている &lt;code>.ts&lt;/code> ファイルを直接デプロイすることができます&lt;/li>
&lt;li>プレビューサイト用の URL が自動生成されます（もちろん SSL 対応）&lt;/li>
&lt;li>1 日に 10 万回までの呼び出しであれば無料で利用できます（それ以上は$10/月からの有料プラン）&lt;/li>
&lt;/ul>
&lt;h2 id="deployctl-のインストール">deployctl のインストール&lt;/h2>
&lt;p>ローカルにある &lt;code>.ts&lt;/code> ファイルを Deno Deploy へデプロイするには、CLI コマンドの &lt;a href="https://github.com/denoland/deployctl">deployctl&lt;/a> を使用します。
このコマンドは、&lt;code>deno&lt;/code> コマンドでインストールできます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">deployctl のインストール（deno 1.41 で確認済）&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">$ deno install -Arf jsr:@deno/deployctl&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>インストールに失敗する場合は、&lt;code>deno upgrade&lt;/code> で &lt;code>deno&lt;/code> 自体を更新してから実行してみてください。&lt;/p></description></item><item><title>Deno でテキストファイルを出力する</title><link>https://maku.blog/p/jkov7xs/</link><pubDate>Tue, 26 Dec 2023 00:00:00 +0900</pubDate><guid>https://maku.blog/p/jkov7xs/</guid><description>&lt;h2 id="ファイル出力用の-deno-api">ファイル出力用の Deno API&lt;/h2>
&lt;p>Deno でファイルへの出力を行うには、次のような File System API を使用します。&lt;/p>
&lt;table>
 &lt;thead>
 &lt;tr>
 &lt;th>API&lt;/th>
 &lt;th>渡せるデータ&lt;/th>
 &lt;th style="text-align: center">同期&lt;/th>
 &lt;/tr>
 &lt;/thead>
 &lt;tbody>
 &lt;tr>
 &lt;td>&lt;a href="https://deno.land/api?s=Deno.writeFile">&lt;code>Deno.writeFile&lt;/code>&lt;/a>&lt;/td>
 &lt;td>バイナリ (&lt;code>Uint8Array&lt;/code>/&lt;code>ReadableStream&amp;lt;Uint8Array&amp;gt;&lt;/code>)&lt;/td>
 &lt;td style="text-align: center">&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://deno.land/api?s=Deno.writeFileSync">&lt;code>Deno.writeFileSync&lt;/code>&lt;/a>&lt;/td>
 &lt;td>バイナリ (&lt;code>Uint8Array&lt;/code>)&lt;/td>
 &lt;td style="text-align: center">✅&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://deno.land/api?s=Deno.writeTextFile">&lt;code>Deno.writeTextFile&lt;/code>&lt;/a>&lt;/td>
 &lt;td>テキスト (&lt;code>string&lt;/code>/&lt;code>ReadableStream&amp;lt;string&amp;gt;&lt;/code>)&lt;/td>
 &lt;td style="text-align: center">&lt;/td>
 &lt;/tr>
 &lt;tr>
 &lt;td>&lt;a href="https://deno.land/api?s=Deno.writeTextFileSync">&lt;code>Deno.writeTextFileSync&lt;/code>&lt;/a>&lt;/td>
 &lt;td>テキスト (&lt;code>string&lt;/code>)&lt;/td>
 &lt;td style="text-align: center">✅&lt;/td>
 &lt;/tr>
 &lt;/tbody>
&lt;/table>
&lt;p>前者の 2 つはバイナリデータ (&lt;code>Uint8Array&lt;/code>) の書き込み用なので、文字列データ (&lt;code>string&lt;/code>) を出力するには、&lt;a href="https://developer.mozilla.org/ja/docs/Web/API/TextEncoder">TextEncoder#encode()&lt;/a> で UTF-8 形式のバイナリ (&lt;code>Uint8Array&lt;/code>) に変換してから渡す必要があります。
後者の 2 つは文字列データ (&lt;code>string&lt;/code>) をそのまま渡せるで、こちらを使うのが簡単です。&lt;/p>
&lt;h2 id="テキストファイル出力の例">テキストファイル出力の例&lt;/h2>
&lt;h3 id="テキスト出力の基本">テキスト出力の基本&lt;/h3>
&lt;p>下記は、&lt;code>Hello&lt;/code> という文字列をテキストファイルに出力する Deno プログラムです。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">main.ts&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="k">await&lt;/span> &lt;span class="nx">Deno&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">writeTextFile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;hello.txt&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Hello&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>このプログラムを実行するときは、&lt;strong>&lt;code>--allow-write&lt;/code>&lt;/strong> オプションを付けてファイル出力を許可してやる必要があります。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> deno run --allow-write main.ts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> cat hello.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">Hello
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="複数行のテキストを書き込む">複数行のテキストを書き込む&lt;/h3>
&lt;p>複数行のテキストを出力したい場合は、改行文字 (&lt;code>\n&lt;/code>) を含む文字列を &lt;code>Deno.writeTextFile()&lt;/code> に渡せば OK です。
必要に応じて、文字列配列を &lt;code>join(&amp;quot;\n&amp;quot;)&lt;/code> で結合して渡すとよいです。&lt;/p></description></item><item><title>Deno で MongoDB にアクセスする</title><link>https://maku.blog/p/3pwojuj/</link><pubDate>Wed, 18 Jan 2023 00:00:00 +0900</pubDate><guid>https://maku.blog/p/3pwojuj/</guid><description>&lt;p>Deno 用の MongoDB ドライバーとして、&lt;strong>deno_mongo&lt;/strong> が公開されています。
&lt;a href="../../p/phz7fo3/">Deno Deploy&lt;/a> 上でも使えるので、Deno Deploy で公開する Web API から MongoDB Atlas に接続する、といったことが簡単に行えます。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://deno.land/x/mongo">mongo | Deno&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/denodrivers/mongo">GitHub - denodrivers/mongo: MongoDB driver for Deno&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="mongodb-サーバーへ接続する">MongoDB サーバーへ接続する&lt;/h2>
&lt;p>ローカルホスト上で起動した MongoDB サーバーへ接続するには次のようにします。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">MongoClient&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s2">&amp;#34;https://deno.land/x/mongo@v0.31.1/mod.ts&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">client&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">MongoClient&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">await&lt;/span> &lt;span class="nx">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">connect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;mongodb://127.0.0.1:27017&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 後は client インスタンスを使って MongoDB を操作する
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>実運用を考えると、&lt;strong>&lt;code>MONGODB_URI_MYAPP&lt;/code>&lt;/strong> のような環境変数で接続先の MongoDB サーバー（およびユーザー ID とパスワード）を指定できるようにしておいた方がよいでしょう。
例えば、MongoDB Atlas サービスを使用している場合は、次のような構成の接続文字列 (SRV URI) が発行されますが、ここには接続パスワードなどが含まれるので、この URI をハードコーディングすることはできません。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">MongoDB 接続文字列 (SRV URI) の基本構成&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-plain" data-lang="plain">&lt;span class="line">&lt;span class="cl">mongodb+srv://&amp;lt;user&amp;gt;:&amp;lt;password&amp;gt;@&amp;lt;cluster-url&amp;gt;/&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;div class="xNote">
 &lt;span class="xNote_title">☝️ SRV URI で authentication failed になる場合&lt;/span>
 &lt;span class="xNote_body">SRV URI を使って MongoDB サーバーにアクセスしようとしたときに認証系のエラーが出る場合は、まずはユーザー ID とパスワードを確認してください。
正しく指定しているのにも関わらずエラーが出る場合は、使用する認証メカニズムの食い違いが発生している可能性があります。
&lt;a href="https://www.mongodb.com/docs/drivers/node/current/fundamentals/authentication/mechanisms/">MongoDB はいくつかの認証メカニズム&lt;/a> を備えており、MongoDB のバージョンによってどれを使うかが異なっています。
URL の末尾のクエリパラメーターで、&lt;strong>&lt;code>?authMechanism=SCRAM-SHA-1&lt;/code>&lt;/strong> のように認証メカニズムを指定できます。&lt;/span>
&lt;/div>
&lt;p>次の &lt;code>client.ts&lt;/code> モジュールは、&lt;code>MongoClient&lt;/code> インスタンスを &lt;code>MONGODB_URI_MYAPP&lt;/code> 環境変数が示す MongoDB サーバーに接続し、&lt;code>export&lt;/code> しています。&lt;/p></description></item><item><title>Deno のタスクランナーの使い方 (deno task)</title><link>https://maku.blog/p/ho4gs5h/</link><pubDate>Sat, 14 Jan 2023 00:00:00 +0900</pubDate><guid>https://maku.blog/p/ho4gs5h/</guid><description>&lt;h2 id="deno-のタスクランナーとは-npm-スクリプトとの違いは">Deno のタスクランナーとは？ npm スクリプトとの違いは？&lt;/h2>
&lt;p>Deno は標準で &lt;a href="https://deno.land/manual/tools/task_runner">deno task コマンド&lt;/a> を提供しており、&lt;strong>&lt;code>deno.json&lt;/code>&lt;/strong>（あるいは &lt;strong>&lt;code>deno.jsonc&lt;/code>&lt;/strong>）の &lt;strong>&lt;code>tasks&lt;/code>&lt;/strong> プロパティで定義したタスクを実行できるようになっています。
これは、Node.js で言うところの npm スクリプト (&lt;code>npm run&lt;/code>) に相当するものですが、&lt;code>deno task&lt;/code> の場合は、&lt;strong>クロスプラットフォームなタスクを定義できる&lt;/strong> ところが大きな特徴になっています。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">deno.json でのタスク定義&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;tasks&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;hello&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;echo Hello, Deno Task Runner!&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">タスクの実行方法&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> deno task hello
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>npm スクリプトの場合は、定義したタスクが OS のシェル上で実行されることが前提だったので、シェルの機能をうかつに使ってしまうと、Linux では動くけど Windows では動かないというタスクなってしまいがちでした。
例えば、ファイルをまとめて削除するタスクを作りたい場合、Linux に依存した &lt;code>rm -rf&lt;/code> コマンドは使えず、いちいち &lt;code>rimraf&lt;/code> モジュールをインストールするといったことが必要でした。
一方、Deno 場合は、クロスプラットフォームで動作する &lt;strong>組み込みコマンドとして &lt;code>rm&lt;/code> コマンドを備えています&lt;/strong>。
他にも、&lt;code>cp&lt;/code>、&lt;code>mv&lt;/code>、&lt;code>mkdir&lt;/code>、&lt;code>echo&lt;/code>、&lt;code>cat&lt;/code> といったよく使うコマンドが、Linux や Windows、macOS などで共通で使えるようになっています。&lt;/p>
&lt;p>また、Linux と Windows では、パイプやリダイレクトの記述方法も微妙に異なっていますが、Deno のタスクランナーでは、&lt;strong>組み込みでパイプやリダイレクトの構文を処理する&lt;/strong> ようになっており、連続したコマンド実行も OS のシェルに依存せずに定義できます。&lt;/p>
&lt;h2 id="jsonc-フォーマットがおすすめ-json-with-comments">jsonc フォーマットがおすすめ (JSON with Comments)&lt;/h2>
&lt;p>&lt;code>deno.json&lt;/code> の代わりに、&lt;strong>&lt;code>deno.jsonc&lt;/code>&lt;/strong> という名前で Deno の設定ファイルを作成すると、ファイル内にコメントを記述することができます。
JSONC は JSON with Comments の略です。&lt;/p></description></item><item><title>Deno で JSON ファイルを読み込む方法いろいろ</title><link>https://maku.blog/p/a83hr2b/</link><pubDate>Wed, 28 Dec 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/a83hr2b/</guid><description>&lt;p>Deno で JSON ファイルを読み込んで、JavaScript のオブジェクトとして参照できるようにするには、&lt;code>import&lt;/code> で直接インポートする方法と、&lt;code>Deno.readTextFile&lt;/code> で読み込んでから &lt;code>JSON.parse&lt;/code> する方法があります。
ここでは、それぞれの方法で次のような JSON ファイルを読み込んでみます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">books.json&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;title&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Title 1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nt">&amp;#34;author&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Author 1&amp;#34;&lt;/span>&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;title&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Title 2&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nt">&amp;#34;author&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Author 2&amp;#34;&lt;/span>&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;title&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Title 3&amp;#34;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;h2 id="json-モジュールとしてインポートする方法">JSON モジュールとしてインポートする方法&lt;/h2>
&lt;p>Deno では、&lt;strong>&lt;code>import&lt;/code>&lt;/strong> 文で JSON ファイルを直接インポートできるようになっています。
JSON ファイルをインポートするときは、&lt;a href="https://github.com/tc39/proposal-import-assertions">import assertions&lt;/a> の機能を使って、JSON ファイルであることを明示する必要があります。&lt;/p>
&lt;h3 id="import-文で静的インポート">import 文で静的インポート&lt;/h3>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">main.ts&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">books&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s2">&amp;#34;./books.json&amp;#34;&lt;/span> &lt;span class="nx">assert&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="kr">type&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;json&amp;#34;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="nx">b&lt;/span> &lt;span class="k">of&lt;/span> &lt;span class="nx">books&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`title: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">title&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">, author: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">author&lt;/span> &lt;span class="o">??&lt;/span> &lt;span class="s2">&amp;#34;Unknown&amp;#34;&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>


&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">実行例&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-console" data-lang="console">&lt;span class="line">&lt;span class="cl">&lt;span class="gp">$&lt;/span> deno run main.ts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">title: Title 1, author: Author 1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">title: Title 2, author: Author 2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="go">title: Title 3, author: Unknown
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>この方法では JSON ファイルが静的に読み込まれるため、次のような恩恵があります。&lt;/p>
&lt;ul>
&lt;li>JSON データから TypeScript の型情報を推測してくれるので、VS Code などで入力補完が効きます。&lt;/li>
&lt;li>&lt;code>deno run&lt;/code> でのプログラム実行時に、&lt;code>--allow-read&lt;/code> を付加する必要がありません。&lt;/li>
&lt;/ul>
&lt;h3 id="import-関数で動的インポート">import 関数で動的インポート&lt;/h3>
&lt;p>&lt;code>import&lt;/code> 文の代わりに &lt;code>import&lt;/code> 関数を使うと、動的に JSON ファイルを読み込むことができます。&lt;/p></description></item><item><title>Deno Deploy の例: JSON ファイルを読み込んで返す REST API を作る (oak)</title><link>https://maku.blog/p/zt3birz/</link><pubDate>Tue, 27 Dec 2022 00:00:00 +0900</pubDate><guid>https://maku.blog/p/zt3birz/</guid><description>&lt;h2 id="何をするか">何をするか？&lt;/h2>
&lt;p>Deno Deploy を使うと、Web API を簡単にデプロイすることができます。
ここでは、よくある例として、サーバー側で JSON ファイルを読み込んで、その内容をレスポンスとして返す REST API を作ってみます。
ここでは、次のような関数やモジュールを使用します。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://deno.land/api?s=Deno.readTextFile">Deno.readTextFile&lt;/a>
&lt;ul>
&lt;li>テキストファイルを読み込むために使用する Deno の標準 API です。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://deno.land/x/oak">x/oak モジュール&lt;/a>
&lt;ul>
&lt;li>HTTP サーバーを作るときに使えるミドルウェアフレームワークです。リクエストのパスに応じて、処理を簡単に振り分けることができます。Node の express と同じように使えます。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="前提条件">前提条件&lt;/h2>
&lt;p>Deno Deploy の基本的な使い方は下記ページを参考にしてください。&lt;/p>
&lt;ul>
&lt;li>参考: &lt;a href="../../p/phz7fo3/">Deno Deploy で Deno のサーバープログラムを公開する&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>後述の記事では、デプロイ用の &lt;strong>&lt;code>deployctl&lt;/code>&lt;/strong> コマンドを使用するので、上記ページに従って先にインストールしておいてください。&lt;/p>
&lt;h2 id="json-ファイル">JSON ファイル&lt;/h2>
&lt;p>サーバー側で読み込む、サンプルの JSON ファイルを用意しておきます。&lt;/p>

&lt;figure class="xCodeBlock">
&lt;figcaption class="xCodeBlock_title">data/books.json&lt;/figcaption>
&lt;div class="xCodeBlock_code">&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;title&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Title 1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;title&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Title 2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;3&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;title&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Title 3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>
&lt;/figure>

&lt;p>3 冊の書籍データが格納されているという想定です。
実際のアプリケーションでは、RDB や mongoDB などのデータベースから情報取得することになると思います。&lt;/p>
&lt;h2 id="サーバーの実装">サーバーの実装&lt;/h2>
&lt;p>先に、&lt;code>data/books.json&lt;/code> ファイルの情報を読み込んで返す &lt;code>getAllBooks&lt;/code> 関数と &lt;code>getBook&lt;/code> 関数を作成しておきます。
テキストファイルは、&lt;strong>&lt;code>Deno.readTextFile&lt;/code>&lt;/strong> 関数で読み込むことができます。&lt;/p></description></item></channel></rss>